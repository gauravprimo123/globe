import{r as gi,R as OR,O as nf,V as _t,M as dn,a as ge,C as Hg,G as Os,b as gn,S as Jo,c as ds,F as cx,d as ho,T as Wg,e as XA,B as Hr,f as Cs,g as Hi,I as zo,h as hx,i as qo,j as FR,k as x_,l as IR,m as fx,w as De,H as or,N as Ba,P as kR,n as rf,o as fn,p as Be,q as Sn,s as ea,L as Xi,t as zi,u as $t,v as UR,x as yr,y as uA,D as xi,W as $0,z as gs,A as qR,E as dx,J as GR,K as Qg,Q as px,U as VR,X as zR,Y as jR,Z as $R,_ as HR,$ as WR,a0 as QR,a1 as XR,a2 as sf,a3 as Xg,a4 as Wi,a5 as Yg,a6 as T_,a7 as jn,a8 as wA,a9 as YR,aa as KR,ab as ii,ac as jo,ad as Un,ae as $o,af as Ho,ag as AA,ah as $s,ai as Bo,aj as mx,ak as Yl,al as ZR,am as Kg,an as Zg,ao as Wp,ap as Jg,aq as e1,ar as Da,as as ft,at as YA,au as t1,av as of,aw as Qo,ax as JR,ay as H0,az as wr,aA as af,aB as SA,aC as lf,aD as qa,aE as Qp,aF as EA,aG as gx,aH as qi,aI as yx,aJ as _x,aK as vx,aL as bx,aM as xx,aN as uf,aO as Tx,aP as wx,aQ as w_,aR as Kl,aS as yi,aT as eC,aU as Sx,aV as Ex,aW as Rx,aX as Cx,aY as Nx,aZ as Mx,a_ as Px,a$ as Bx,b0 as Dx,b1 as Lx,b2 as Ox,b3 as Fx,b4 as tC,b5 as nC,b6 as rC,b7 as Zl,b8 as W0,b9 as Q0,ba as X0,bb as Ys,bc as Ix,bd as kx,be as Ux,bf as qx,bg as Gx,bh as Vx,bi as zx,bj as jx,bk as iC,bl as sC,bm as $x,bn as Hx,bo as cA,bp as hA,bq as Ll,br as oC,bs as n1,bt as r1,bu as i1,bv as Qs,bw as s1,bx as o1,by as b0,bz as x0,bA as T0,bB as w0,bC as S_,bD as E_,bE as R_,bF as C_,bG as Xp,bH as Yp,bI as Kp,bJ as Zp,bK as Jp,bL as Y0,bM as em,bN as tm,bO as nm,bP as rm,bQ as im,bR as sm,bS as om,bT as am,bU as lm,bV as um,bW as Am,bX as cm,bY as hm,bZ as fm,b_ as dm,b$ as pm,c0 as mm,c1 as gm,c2 as K0,c3 as ym,c4 as Wx,c5 as Qx,c6 as aC,c7 as lC,c8 as uC,c9 as AC,ca as cC,cb as Af,cc as hC,cd as Xx,ce as fC,cf as dC,cg as pC,ch as mC,ci as gC,cj as yC,ck as Yx,cl as Jl,cm as _C,cn as vC,co as bC,cp as xC,cq as TC,cr as wC,cs as SC,ct as EC,cu as RC,cv as CC,cw as NC,cx as MC,cy as PC,cz as BC,cA as DC,cB as LC,cC as OC,cD as FC,cE as Kx,cF as IC,cG as kC,cH as UC,cI as qC,cJ as GC,cK as VC,cL as Zx,cM as zC,cN as RA,cO as jC,cP as a1,cQ as $C,cR as S0,cS as l1,cT as Z0,cU as J0,cV as Fd,cW as Id,cX as HC,cY as WC,cZ as eh,c_ as u1,c$ as QC,d0 as Jx,d1 as XC,d2 as YC,d3 as KC,d4 as ZC,d5 as cf,d6 as eu,d7 as E0,d8 as A1,d9 as R0,da as JC,db as eN,dc as tN,dd as c1,de as nN,df as e4,dg as t4,dh as rN,di as iN,dj as sN,dk as Cu,dl as h1,dm as Ti,dn as Ol,dp as N_,dq as oN,dr as aN,ds as n4,dt as lN,du as uN}from"./index-BIMXn0ae.js";function AN(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function cN(n,e,t){return e=_N(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function M_(n,e){return dN(n)||AN(n,e)||r4(n,e)||gN()}function hN(n){return fN(n)||pN(n)||r4(n)||mN()}function fN(n){if(Array.isArray(n))return _m(n)}function dN(n){if(Array.isArray(n))return n}function pN(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function r4(n,e){if(n){if(typeof n=="string")return _m(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _m(n,e)}}function _m(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function mN(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gN(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yN(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function _N(n){var e=yN(n,"string");return typeof e=="symbol"?e:String(e)}var vN=function(e,t){var r=new Set(t);return Object.assign.apply(Object,[{}].concat(hN(Object.entries(e).filter(function(i){var s=M_(i,1),o=s[0];return!r.has(o)}).map(function(i){var s=M_(i,2),o=s[0],a=s[1];return cN({},o,a)}))))};function vm(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function bN(n){if(Array.isArray(n))return n}function xN(n){if(Array.isArray(n))return vm(n)}function TN(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function wN(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function SN(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function EN(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RN(n,e){return bN(n)||wN(n,e)||i4(n,e)||SN()}function P_(n){return xN(n)||TN(n)||i4(n)||EN()}function i4(n,e){if(n){if(typeof n=="string")return vm(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?vm(n,e):void 0}}function CN(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.wrapperElementType,r=t===void 0?"div":t,i=e.nodeMapper,s=i===void 0?function(p){return p}:i,o=e.methodNames,a=o===void 0?[]:o,c=e.initPropNames,f=c===void 0?[]:c;return gi.forwardRef(function(p,g){var v=gi.useRef(),x=gi.useMemo(function(){var E=Object.fromEntries(f.filter(function(N){return p.hasOwnProperty(N)}).map(function(N){return[N,p[N]]}));return n(E)},[]);B_(function(){x(s(v.current))},gi.useLayoutEffect),B_(function(){return x._destructor instanceof Function?x._destructor:void 0});var T=gi.useCallback(function(E){for(var N=arguments.length,P=new Array(N>1?N-1:0),B=1;B<N;B++)P[B-1]=arguments[B];return x[E]instanceof Function?x[E].apply(x,P):void 0},[x]),S=gi.useRef({});return Object.keys(vN(p,[].concat(P_(a),P_(f)))).filter(function(E){return S.current[E]!==p[E]}).forEach(function(E){return T(E,p[E])}),S.current=p,gi.useImperativeHandle(g,function(){return Object.fromEntries(a.map(function(E){return[E,function(){for(var N=arguments.length,P=new Array(N),B=0;B<N;B++)P[B]=arguments[B];return T.apply(void 0,[E].concat(P))}]}))},[T]),OR.createElement(r,{ref:v})})}function B_(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:gi.useEffect,t=gi.useRef(),r=gi.useRef(!1),i=gi.useRef(!1),s=gi.useState(0),o=RN(s,2);o[0];var a=o[1];r.current&&(i.current=!0),e(function(){return r.current||(t.current=n(),r.current=!0),a(function(c){return c+1}),function(){i.current&&t.current&&t.current()}},[])}class NN extends nf{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new _t(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element&&t.element instanceof t.element.ownerDocument.defaultView.Element&&t.element.parentNode!==null&&t.element.remove()})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const cl=new ge,D_=new dn,L_=new dn,O_=new ge,F_=new ge;class MN{constructor(e={}){const t=this;let r,i,s,o;const a={objects:new WeakMap},c=e.element!==void 0?e.element:document.createElement("div");c.style.overflow="hidden",this.domElement=c,this.sortObjects=!0,this.getSize=function(){return{width:r,height:i}},this.render=function(T,S){T.matrixWorldAutoUpdate===!0&&T.updateMatrixWorld(),S.parent===null&&S.matrixWorldAutoUpdate===!0&&S.updateMatrixWorld(),D_.copy(S.matrixWorldInverse),L_.multiplyMatrices(S.projectionMatrix,D_),p(T,T,S),this.sortObjects&&x(T)},this.setSize=function(T,S){r=T,i=S,s=r/2,o=i/2,c.style.width=T+"px",c.style.height=S+"px"};function f(T){T.isCSS2DObject&&(T.element.style.display="none");for(let S=0,E=T.children.length;S<E;S++)f(T.children[S])}function p(T,S,E){if(T.visible===!1){f(T);return}if(T.isCSS2DObject){cl.setFromMatrixPosition(T.matrixWorld),cl.applyMatrix4(L_);const N=cl.z>=-1&&cl.z<=1&&T.layers.test(E.layers)===!0,P=T.element;P.style.display=N===!0?"":"none",N===!0&&(T.onBeforeRender(t,S,E),P.style.transform="translate("+-100*T.center.x+"%,"+-100*T.center.y+"%)translate("+(cl.x*s+s)+"px,"+(-cl.y*o+o)+"px)",P.parentNode!==c&&c.appendChild(P),T.onAfterRender(t,S,E));const B={distanceToCameraSquared:g(E,T)};a.objects.set(T,B)}for(let N=0,P=T.children.length;N<P;N++)p(T.children[N],S,E)}function g(T,S){return O_.setFromMatrixPosition(T.matrixWorld),F_.setFromMatrixPosition(S.matrixWorld),O_.distanceToSquared(F_)}function v(T){const S=[];return T.traverseVisible(function(E){E.isCSS2DObject&&S.push(E)}),S}function x(T){const S=v(T).sort(function(N,P){if(N.renderOrder!==P.renderOrder)return P.renderOrder-N.renderOrder;const B=a.objects.get(N).distanceToCameraSquared,L=a.objects.get(P).distanceToCameraSquared;return B-L}),E=S.length;for(let N=0,P=S.length;N<P;N++)S[N].element.style.zIndex=E-N}}}function bm(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var PN=typeof global=="object"&&global&&global.Object===Object&&global,BN=typeof self=="object"&&self&&self.Object===Object&&self,s4=PN||BN||Function("return this")(),kd=function(){return s4.Date.now()},DN=/\s/;function LN(n){for(var e=n.length;e--&&DN.test(n.charAt(e)););return e}var ON=/^\s+/;function FN(n){return n&&n.slice(0,LN(n)+1).replace(ON,"")}var th=s4.Symbol,o4=Object.prototype,IN=o4.hasOwnProperty,kN=o4.toString,Nu=th?th.toStringTag:void 0;function UN(n){var e=IN.call(n,Nu),t=n[Nu];try{n[Nu]=void 0;var r=!0}catch{}var i=kN.call(n);return r&&(e?n[Nu]=t:delete n[Nu]),i}var qN=Object.prototype,GN=qN.toString;function VN(n){return GN.call(n)}var zN="[object Null]",jN="[object Undefined]",I_=th?th.toStringTag:void 0;function $N(n){return n==null?n===void 0?jN:zN:I_&&I_ in Object(n)?UN(n):VN(n)}function HN(n){return n!=null&&typeof n=="object"}var WN="[object Symbol]";function QN(n){return typeof n=="symbol"||HN(n)&&$N(n)==WN}var k_=NaN,XN=/^[-+]0x[0-9a-f]+$/i,YN=/^0b[01]+$/i,KN=/^0o[0-7]+$/i,ZN=parseInt;function U_(n){if(typeof n=="number")return n;if(QN(n))return k_;if(bm(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=bm(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=FN(n);var t=YN.test(n);return t||KN.test(n)?ZN(n.slice(2),t?2:8):XN.test(n)?k_:+n}var JN="Expected a function",eM=Math.max,tM=Math.min;function nM(n,e,t){var r,i,s,o,a,c,f=0,p=!1,g=!1,v=!0;if(typeof n!="function")throw new TypeError(JN);e=U_(e)||0,bm(t)&&(p=!!t.leading,g="maxWait"in t,s=g?eM(U_(t.maxWait)||0,e):s,v="trailing"in t?!!t.trailing:v);function x(q){var I=r,U=i;return r=i=void 0,f=q,o=n.apply(U,I),o}function T(q){return f=q,a=setTimeout(N,e),p?x(q):o}function S(q){var I=q-c,U=q-f,j=e-I;return g?tM(j,s-U):j}function E(q){var I=q-c,U=q-f;return c===void 0||I>=e||I<0||g&&U>=s}function N(){var q=kd();if(E(q))return P(q);a=setTimeout(N,S(q))}function P(q){return a=void 0,v&&r?x(q):(r=i=void 0,o)}function B(){a!==void 0&&clearTimeout(a),f=0,r=c=i=a=void 0}function L(){return a===void 0?o:P(kd())}function k(){var q=kd(),I=E(q);if(r=arguments,i=this,c=q,I){if(a===void 0)return T(c);if(g)return clearTimeout(a),a=setTimeout(N,e),x(c)}return a===void 0&&(a=setTimeout(N,e)),o}return k.cancel=B,k.flush=L,k}function q_(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function rM(n){if(Array.isArray(n))return n}function iM(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function sM(n,e,t){return Object.defineProperty(n,"prototype",{writable:!1}),n}function oM(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function aM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function lM(n,e){return rM(n)||oM(n,e)||uM(n,e)||aM()}function uM(n,e){if(n){if(typeof n=="string")return q_(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?q_(n,e):void 0}}var AM=sM(function n(e,t){var r=t.default,i=r===void 0?null:r,s=t.triggerUpdate,o=s===void 0?!0:s,a=t.onChange,c=a===void 0?function(f,p){}:a;iM(this,n),this.name=e,this.defaultVal=i,this.triggerUpdate=o,this.onChange=c});function $n(n){var e=n.stateInit,t=e===void 0?function(){return{}}:e,r=n.props,i=r===void 0?{}:r,s=n.methods,o=s===void 0?{}:s,a=n.aliases,c=a===void 0?{}:a,f=n.init,p=f===void 0?function(){}:f,g=n.update,v=g===void 0?function(){}:g,x=Object.keys(i).map(function(T){return new AM(T,i[T])});return function T(){for(var S=arguments.length,E=new Array(S),N=0;N<S;N++)E[N]=arguments[N];var P=!!(this instanceof T&&this.constructor),B=P?E.shift():void 0,L=E[0],k=L===void 0?{}:L,q=Object.assign({},t instanceof Function?t(k):t,{initialised:!1}),I={};function U(Q){return j(Q,k),J(),U}var j=function(K,te){p.call(U,K,q,te),q.initialised=!0},J=nM(function(){q.initialised&&(v.call(U,q,I),I={})},1);return x.forEach(function(Q){U[Q.name]=K(Q);function K(te){var oe=te.name,Y=te.triggerUpdate,ae=Y===void 0?!1:Y,he=te.onChange,xe=he===void 0?function(ke,Ke){}:he,me=te.defaultVal,Oe=me===void 0?null:me;return function(ke){var Ke=q[oe];if(!arguments.length)return Ke;var Ye=ke===void 0?Oe:ke;return q[oe]=Ye,xe.call(U,Ye,q,Ke),!I.hasOwnProperty(oe)&&(I[oe]=Ke),ae&&J(),U}}}),Object.keys(o).forEach(function(Q){U[Q]=function(){for(var K,te=arguments.length,oe=new Array(te),Y=0;Y<te;Y++)oe[Y]=arguments[Y];return(K=o[Q]).call.apply(K,[U,q].concat(oe))}}),Object.entries(c).forEach(function(Q){var K=lM(Q,2),te=K[0],oe=K[1];return U[te]=U[oe]}),U.resetProps=function(){return x.forEach(function(Q){U[Q.name](Q.defaultVal)}),U},U.resetProps(),q._rerender=J,P&&B&&U(B),U}}var er=Object.freeze({Linear:Object.freeze({None:function(n){return n},In:function(n){return n},Out:function(n){return n},InOut:function(n){return n}}),Quadratic:Object.freeze({In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}}),Cubic:Object.freeze({In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}}),Quartic:Object.freeze({In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}}),Quintic:Object.freeze({In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}}),Sinusoidal:Object.freeze({In:function(n){return 1-Math.sin((1-n)*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return .5*(1-Math.sin(Math.PI*(.5-n)))}}),Exponential:Object.freeze({In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}}),Circular:Object.freeze({In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}}),Elastic:Object.freeze({In:function(n){return n===0?0:n===1?1:-Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI)},Out:function(n){return n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n-.1)*5*Math.PI)+1},InOut:function(n){return n===0?0:n===1?1:(n*=2,n<1?-.5*Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI):.5*Math.pow(2,-10*(n-1))*Math.sin((n-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(n){var e=1.70158;return n===1?1:n*n*((e+1)*n-e)},Out:function(n){var e=1.70158;return n===0?0:--n*n*((e+1)*n+e)+1},InOut:function(n){var e=2.5949095;return(n*=2)<1?.5*(n*n*((e+1)*n-e)):.5*((n-=2)*n*((e+1)*n+e)+2)}}),Bounce:Object.freeze({In:function(n){return 1-er.Bounce.Out(1-n)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(n){return n<.5?er.Bounce.In(n*2)*.5:er.Bounce.Out(n*2-1)*.5+.5}}),generatePow:function(n){return n===void 0&&(n=4),n=n<Number.EPSILON?Number.EPSILON:n,n=n>1e4?1e4:n,{In:function(e){return Math.pow(e,n)},Out:function(e){return 1-Math.pow(1-e,n)},InOut:function(e){return e<.5?Math.pow(e*2,n)/2:(1-Math.pow(2-e*2,n))/2+.5}}}}),Ju=function(){return performance.now()},f1=(function(){function n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,e)}return n.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},n.prototype.removeAll=function(){this._tweens={}},n.prototype.add=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];for(var i=0,s=t;i<s.length;i++){var o=s[i];(e=o._group)===null||e===void 0||e.remove(o),o._group=this,this._tweens[o.getId()]=o,this._tweensAddedDuringUpdate[o.getId()]=o}},n.prototype.remove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,i=e;r<i.length;r++){var s=i[r];s._group=void 0,delete this._tweens[s.getId()],delete this._tweensAddedDuringUpdate[s.getId()]}},n.prototype.allStopped=function(){return this.getAll().every(function(e){return!e.isPlaying()})},n.prototype.update=function(e,t){e===void 0&&(e=Ju()),t===void 0&&(t=!0);var r=Object.keys(this._tweens);if(r.length!==0)for(;r.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<r.length;i++){var s=this._tweens[r[i]],o=!t;s&&s.update(e,o)===!1&&!t&&this.remove(s)}r=Object.keys(this._tweensAddedDuringUpdate)}},n})(),xm={Linear:function(n,e){var t=n.length-1,r=t*e,i=Math.floor(r),s=xm.Utils.Linear;return e<0?s(n[0],n[1],r):e>1?s(n[t],n[t-1],t-r):s(n[i],n[i+1>t?t:i+1],r-i)},Utils:{Linear:function(n,e,t){return(e-n)*t+n}}},a4=(function(){function n(){}return n.nextId=function(){return n._nextId++},n._nextId=0,n})(),Tm=new f1,Gr=(function(){function n(e,t){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=er.Linear.None,this._interpolationFunction=xm.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=a4.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=e,typeof t=="object"?(this._group=t,t.add(this)):t===!0&&(this._group=Tm,Tm.add(this))}return n.prototype.getId=function(){return this._id},n.prototype.isPlaying=function(){return this._isPlaying},n.prototype.isPaused=function(){return this._isPaused},n.prototype.getDuration=function(){return this._duration},n.prototype.to=function(e,t){if(t===void 0&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},n.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},n.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},n.prototype.start=function(e,t){if(e===void 0&&(e=Ju()),t===void 0&&(t=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var r in this._valuesStartRepeat)this._swapEndStartRepeatValues(r),this._valuesStart[r]=this._valuesStartRepeat[r]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var i={};for(var s in this._valuesEnd)i[s]=this._valuesEnd[s];this._valuesEnd=i}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},n.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},n.prototype._setupProperties=function(e,t,r,i,s){for(var o in r){var a=e[o],c=Array.isArray(a),f=c?"array":typeof a,p=!c&&Array.isArray(r[o]);if(!(f==="undefined"||f==="function")){if(p){var g=r[o];if(g.length===0)continue;for(var v=[a],x=0,T=g.length;x<T;x+=1){var S=this._handleRelativeValue(a,g[x]);if(isNaN(S)){p=!1,console.warn("Found invalid interpolation list. Skipping.");break}v.push(S)}p&&(r[o]=v)}if((f==="object"||c)&&a&&!p){t[o]=c?[]:{};var E=a;for(var N in E)t[o][N]=E[N];i[o]=c?[]:{};var g=r[o];if(!this._isDynamic){var P={};for(var N in g)P[N]=g[N];r[o]=g=P}this._setupProperties(E,t[o],g,i[o],s)}else(typeof t[o]>"u"||s)&&(t[o]=a),c||(t[o]*=1),p?i[o]=r[o].slice().reverse():i[o]=t[o]||0}}},n.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},n.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},n.prototype.pause=function(e){return e===void 0&&(e=Ju()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this)},n.prototype.resume=function(e){return e===void 0&&(e=Ju()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this)},n.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},n.prototype.group=function(e){return e?(e.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},n.prototype.remove=function(){var e;return(e=this._group)===null||e===void 0||e.remove(this),this},n.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},n.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},n.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},n.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},n.prototype.easing=function(e){return e===void 0&&(e=er.Linear.None),this._easingFunction=e,this},n.prototype.interpolation=function(e){return e===void 0&&(e=xm.Linear),this._interpolationFunction=e,this},n.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},n.prototype.onStart=function(e){return this._onStartCallback=e,this},n.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},n.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},n.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},n.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},n.prototype.onStop=function(e){return this._onStopCallback=e,this},n.prototype.update=function(e,t){var r=this,i;if(e===void 0&&(e=Ju()),t===void 0&&(t=n.autoStartOnUpdate),this._isPaused)return!0;var s;if(!this._goToEnd&&!this._isPlaying)if(t)this.start(e,!0);else return!1;if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var o=e-this._startTime,a=this._duration+((i=this._repeatDelayTime)!==null&&i!==void 0?i:this._delayTime),c=this._duration+this._repeat*a,f=function(){if(r._duration===0||o>c)return 1;var S=Math.trunc(o/a),E=o-S*a,N=Math.min(E/r._duration,1);return N===0&&o===r._duration?1:N},p=f(),g=this._easingFunction(p);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,g),this._onUpdateCallback&&this._onUpdateCallback(this._object,p),this._duration===0||o>=this._duration)if(this._repeat>0){var v=Math.min(Math.trunc((o-this._duration)/a)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=v);for(s in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[s]=="string"&&(this._valuesStartRepeat[s]=this._valuesStartRepeat[s]+parseFloat(this._valuesEnd[s])),this._yoyo&&this._swapEndStartRepeatValues(s),this._valuesStart[s]=this._valuesStartRepeat[s];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=a*v,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var x=0,T=this._chainedTweens.length;x<T;x++)this._chainedTweens[x].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},n.prototype._updateProperties=function(e,t,r,i){for(var s in r)if(t[s]!==void 0){var o=t[s]||0,a=r[s],c=Array.isArray(e[s]),f=Array.isArray(a),p=!c&&f;p?e[s]=this._interpolationFunction(a,i):typeof a=="object"&&a?this._updateProperties(e[s],o,a,i):(a=this._handleRelativeValue(o,a),typeof a=="number"&&(e[s]=o+(a-o)*i))}},n.prototype._handleRelativeValue=function(e,t){return typeof t!="string"?t:t.charAt(0)==="+"||t.charAt(0)==="-"?e+parseFloat(t):parseFloat(t)},n.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],r=this._valuesEnd[e];typeof r=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(r):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},n.autoStartOnUpdate=!1,n})();a4.nextId;var Ns=Tm;Ns.getAll.bind(Ns);Ns.removeAll.bind(Ns);Ns.add.bind(Ns);Ns.remove.bind(Ns);Ns.update.bind(Ns);function cM(n){const e=+this._x.call(null,n),t=+this._y.call(null,n),r=+this._z.call(null,n);return l4(this.cover(e,t,r),e,t,r,n)}function l4(n,e,t,r,i){if(isNaN(e)||isNaN(t)||isNaN(r))return n;var s,o=n._root,a={data:i},c=n._x0,f=n._y0,p=n._z0,g=n._x1,v=n._y1,x=n._z1,T,S,E,N,P,B,L,k,q,I,U;if(!o)return n._root=a,n;for(;o.length;)if((L=e>=(T=(c+g)/2))?c=T:g=T,(k=t>=(S=(f+v)/2))?f=S:v=S,(q=r>=(E=(p+x)/2))?p=E:x=E,s=o,!(o=o[I=q<<2|k<<1|L]))return s[I]=a,n;if(N=+n._x.call(null,o.data),P=+n._y.call(null,o.data),B=+n._z.call(null,o.data),e===N&&t===P&&r===B)return a.next=o,s?s[I]=a:n._root=a,n;do s=s?s[I]=new Array(8):n._root=new Array(8),(L=e>=(T=(c+g)/2))?c=T:g=T,(k=t>=(S=(f+v)/2))?f=S:v=S,(q=r>=(E=(p+x)/2))?p=E:x=E;while((I=q<<2|k<<1|L)===(U=(B>=E)<<2|(P>=S)<<1|N>=T));return s[U]=o,s[I]=a,n}function hM(n){Array.isArray(n)||(n=Array.from(n));const e=n.length,t=new Float64Array(e),r=new Float64Array(e),i=new Float64Array(e);let s=1/0,o=1/0,a=1/0,c=-1/0,f=-1/0,p=-1/0;for(let g=0,v,x,T,S;g<e;++g)isNaN(x=+this._x.call(null,v=n[g]))||isNaN(T=+this._y.call(null,v))||isNaN(S=+this._z.call(null,v))||(t[g]=x,r[g]=T,i[g]=S,x<s&&(s=x),x>c&&(c=x),T<o&&(o=T),T>f&&(f=T),S<a&&(a=S),S>p&&(p=S));if(s>c||o>f||a>p)return this;this.cover(s,o,a).cover(c,f,p);for(let g=0;g<e;++g)l4(this,t[g],r[g],i[g],n[g]);return this}function fM(n,e,t){if(isNaN(n=+n)||isNaN(e=+e)||isNaN(t=+t))return this;var r=this._x0,i=this._y0,s=this._z0,o=this._x1,a=this._y1,c=this._z1;if(isNaN(r))o=(r=Math.floor(n))+1,a=(i=Math.floor(e))+1,c=(s=Math.floor(t))+1;else{for(var f=o-r||1,p=this._root,g,v;r>n||n>=o||i>e||e>=a||s>t||t>=c;)switch(v=(t<s)<<2|(e<i)<<1|n<r,g=new Array(8),g[v]=p,p=g,f*=2,v){case 0:o=r+f,a=i+f,c=s+f;break;case 1:r=o-f,a=i+f,c=s+f;break;case 2:o=r+f,i=a-f,c=s+f;break;case 3:r=o-f,i=a-f,c=s+f;break;case 4:o=r+f,a=i+f,s=c-f;break;case 5:r=o-f,a=i+f,s=c-f;break;case 6:o=r+f,i=a-f,s=c-f;break;case 7:r=o-f,i=a-f,s=c-f;break}this._root&&this._root.length&&(this._root=p)}return this._x0=r,this._y0=i,this._z0=s,this._x1=o,this._y1=a,this._z1=c,this}function dM(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function pM(n){return arguments.length?this.cover(+n[0][0],+n[0][1],+n[0][2]).cover(+n[1][0],+n[1][1],+n[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function sn(n,e,t,r,i,s,o){this.node=n,this.x0=e,this.y0=t,this.z0=r,this.x1=i,this.y1=s,this.z1=o}function mM(n,e,t,r){var i,s=this._x0,o=this._y0,a=this._z0,c,f,p,g,v,x,T=this._x1,S=this._y1,E=this._z1,N=[],P=this._root,B,L;for(P&&N.push(new sn(P,s,o,a,T,S,E)),r==null?r=1/0:(s=n-r,o=e-r,a=t-r,T=n+r,S=e+r,E=t+r,r*=r);B=N.pop();)if(!(!(P=B.node)||(c=B.x0)>T||(f=B.y0)>S||(p=B.z0)>E||(g=B.x1)<s||(v=B.y1)<o||(x=B.z1)<a))if(P.length){var k=(c+g)/2,q=(f+v)/2,I=(p+x)/2;N.push(new sn(P[7],k,q,I,g,v,x),new sn(P[6],c,q,I,k,v,x),new sn(P[5],k,f,I,g,q,x),new sn(P[4],c,f,I,k,q,x),new sn(P[3],k,q,p,g,v,I),new sn(P[2],c,q,p,k,v,I),new sn(P[1],k,f,p,g,q,I),new sn(P[0],c,f,p,k,q,I)),(L=(t>=I)<<2|(e>=q)<<1|n>=k)&&(B=N[N.length-1],N[N.length-1]=N[N.length-1-L],N[N.length-1-L]=B)}else{var U=n-+this._x.call(null,P.data),j=e-+this._y.call(null,P.data),J=t-+this._z.call(null,P.data),Q=U*U+j*j+J*J;if(Q<r){var K=Math.sqrt(r=Q);s=n-K,o=e-K,a=t-K,T=n+K,S=e+K,E=t+K,i=P.data}}return i}const gM=(n,e,t,r,i,s)=>Math.sqrt((n-r)**2+(e-i)**2+(t-s)**2);function yM(n,e,t,r){const i=[],s=n-r,o=e-r,a=t-r,c=n+r,f=e+r,p=t+r;return this.visit((g,v,x,T,S,E,N)=>{if(!g.length)do{const P=g.data;gM(n,e,t,this._x(P),this._y(P),this._z(P))<=r&&i.push(P)}while(g=g.next);return v>c||x>f||T>p||S<s||E<o||N<a}),i}function _M(n){if(isNaN(v=+this._x.call(null,n))||isNaN(x=+this._y.call(null,n))||isNaN(T=+this._z.call(null,n)))return this;var e,t=this._root,r,i,s,o=this._x0,a=this._y0,c=this._z0,f=this._x1,p=this._y1,g=this._z1,v,x,T,S,E,N,P,B,L,k,q;if(!t)return this;if(t.length)for(;;){if((P=v>=(S=(o+f)/2))?o=S:f=S,(B=x>=(E=(a+p)/2))?a=E:p=E,(L=T>=(N=(c+g)/2))?c=N:g=N,e=t,!(t=t[k=L<<2|B<<1|P]))return this;if(!t.length)break;(e[k+1&7]||e[k+2&7]||e[k+3&7]||e[k+4&7]||e[k+5&7]||e[k+6&7]||e[k+7&7])&&(r=e,q=k)}for(;t.data!==n;)if(i=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,i?(s?i.next=s:delete i.next,this):e?(s?e[k]=s:delete e[k],(t=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&t===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!t.length&&(r?r[q]=t:this._root=t),this):(this._root=s,this)}function vM(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function bM(){return this._root}function xM(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function TM(n){var e=[],t,r=this._root,i,s,o,a,c,f,p;for(r&&e.push(new sn(r,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));t=e.pop();)if(!n(r=t.node,s=t.x0,o=t.y0,a=t.z0,c=t.x1,f=t.y1,p=t.z1)&&r.length){var g=(s+c)/2,v=(o+f)/2,x=(a+p)/2;(i=r[7])&&e.push(new sn(i,g,v,x,c,f,p)),(i=r[6])&&e.push(new sn(i,s,v,x,g,f,p)),(i=r[5])&&e.push(new sn(i,g,o,x,c,v,p)),(i=r[4])&&e.push(new sn(i,s,o,x,g,v,p)),(i=r[3])&&e.push(new sn(i,g,v,a,c,f,x)),(i=r[2])&&e.push(new sn(i,s,v,a,g,f,x)),(i=r[1])&&e.push(new sn(i,g,o,a,c,v,x)),(i=r[0])&&e.push(new sn(i,s,o,a,g,v,x))}return this}function wM(n){var e=[],t=[],r;for(this._root&&e.push(new sn(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));r=e.pop();){var i=r.node;if(i.length){var s,o=r.x0,a=r.y0,c=r.z0,f=r.x1,p=r.y1,g=r.z1,v=(o+f)/2,x=(a+p)/2,T=(c+g)/2;(s=i[0])&&e.push(new sn(s,o,a,c,v,x,T)),(s=i[1])&&e.push(new sn(s,v,a,c,f,x,T)),(s=i[2])&&e.push(new sn(s,o,x,c,v,p,T)),(s=i[3])&&e.push(new sn(s,v,x,c,f,p,T)),(s=i[4])&&e.push(new sn(s,o,a,T,v,x,g)),(s=i[5])&&e.push(new sn(s,v,a,T,f,x,g)),(s=i[6])&&e.push(new sn(s,o,x,T,v,p,g)),(s=i[7])&&e.push(new sn(s,v,x,T,f,p,g))}t.push(r)}for(;r=t.pop();)n(r.node,r.x0,r.y0,r.z0,r.x1,r.y1,r.z1);return this}function SM(n){return n[0]}function EM(n){return arguments.length?(this._x=n,this):this._x}function RM(n){return n[1]}function CM(n){return arguments.length?(this._y=n,this):this._y}function NM(n){return n[2]}function MM(n){return arguments.length?(this._z=n,this):this._z}function u4(n,e,t,r){var i=new d1(e??SM,t??RM,r??NM,NaN,NaN,NaN,NaN,NaN,NaN);return n==null?i:i.addAll(n)}function d1(n,e,t,r,i,s,o,a,c){this._x=n,this._y=e,this._z=t,this._x0=r,this._y0=i,this._z0=s,this._x1=o,this._y1=a,this._z1=c,this._root=void 0}function G_(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var Ar=u4.prototype=d1.prototype;Ar.copy=function(){var n=new d1(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),e=this._root,t,r;if(!e)return n;if(!e.length)return n._root=G_(e),n;for(t=[{source:e,target:n._root=new Array(8)}];e=t.pop();)for(var i=0;i<8;++i)(r=e.source[i])&&(r.length?t.push({source:r,target:e.target[i]=new Array(8)}):e.target[i]=G_(r));return n};Ar.add=cM;Ar.addAll=hM;Ar.cover=fM;Ar.data=dM;Ar.extent=pM;Ar.find=mM;Ar.findAllWithinRadius=yM;Ar.remove=_M;Ar.removeAll=vM;Ar.root=bM;Ar.size=xM;Ar.visit=TM;Ar.visitAfter=wM;Ar.x=EM;Ar.y=CM;Ar.z=MM;function C0(n,e){return n==null||e==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}function PM(n,e){return n==null||e==null?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function A4(n){let e,t,r;n.length!==2?(e=C0,t=(a,c)=>C0(n(a),c),r=(a,c)=>n(a)-c):(e=n===C0||n===PM?n:BM,t=n,r=n);function i(a,c,f=0,p=a.length){if(f<p){if(e(c,c)!==0)return p;do{const g=f+p>>>1;t(a[g],c)<0?f=g+1:p=g}while(f<p)}return f}function s(a,c,f=0,p=a.length){if(f<p){if(e(c,c)!==0)return p;do{const g=f+p>>>1;t(a[g],c)<=0?f=g+1:p=g}while(f<p)}return f}function o(a,c,f=0,p=a.length){const g=i(a,c,f,p-1);return g>f&&r(a[g-1],c)>-r(a[g],c)?g-1:g}return{left:i,center:o,right:s}}function BM(){return 0}function DM(n){return n===null?NaN:+n}const LM=A4(C0),c4=LM.right;A4(DM).center;function nh(n,e){let t,r;if(e===void 0)for(const i of n)i!=null&&(t===void 0?i>=i&&(t=r=i):(t>i&&(t=i),r<i&&(r=i)));else{let i=-1;for(let s of n)(s=e(s,++i,n))!=null&&(t===void 0?s>=s&&(t=r=s):(t>s&&(t=s),r<s&&(r=s)))}return[t,r]}class Ks{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let r=0;for(let i=0;i<this._n&&i<32;i++){const s=t[i],o=e+s,a=Math.abs(e)<Math.abs(s)?e-(o-s):s-(o-e);a&&(t[r++]=a),e=o}return t[r]=e,this._n=r+1,this}valueOf(){const e=this._partials;let t=this._n,r,i,s,o=0;if(t>0){for(o=e[--t];t>0&&(r=o,i=e[--t],o=r+i,s=i-(o-r),!s););t>0&&(s<0&&e[t-1]<0||s>0&&e[t-1]>0)&&(i=s*2,r=o+i,i==r-o&&(o=r))}return o}}const OM=Math.sqrt(50),FM=Math.sqrt(10),IM=Math.sqrt(2);function rh(n,e,t){const r=(e-n)/Math.max(0,t),i=Math.floor(Math.log10(r)),s=r/Math.pow(10,i),o=s>=OM?10:s>=FM?5:s>=IM?2:1;let a,c,f;return i<0?(f=Math.pow(10,-i)/o,a=Math.round(n*f),c=Math.round(e*f),a/f<n&&++a,c/f>e&&--c,f=-f):(f=Math.pow(10,i)*o,a=Math.round(n/f),c=Math.round(e/f),a*f<n&&++a,c*f>e&&--c),c<a&&.5<=t&&t<2?rh(n,e,t*2):[a,c,f]}function kM(n,e,t){if(e=+e,n=+n,t=+t,!(t>0))return[];if(n===e)return[n];const r=e<n,[i,s,o]=r?rh(e,n,t):rh(n,e,t);if(!(s>=i))return[];const a=s-i+1,c=new Array(a);if(r)if(o<0)for(let f=0;f<a;++f)c[f]=(s-f)/-o;else for(let f=0;f<a;++f)c[f]=(s-f)*o;else if(o<0)for(let f=0;f<a;++f)c[f]=(i+f)/-o;else for(let f=0;f<a;++f)c[f]=(i+f)*o;return c}function wm(n,e,t){return e=+e,n=+n,t=+t,rh(n,e,t)[2]}function UM(n,e,t){e=+e,n=+n,t=+t;const r=e<n,i=r?wm(e,n,t):wm(n,e,t);return(r?-1:1)*(i<0?1/-i:i)}function qM(n,e){let t;for(const r of n)r!=null&&(t<r||t===void 0&&r>=r)&&(t=r);return t}function GM(n,e){let t=0,r=0;if(e===void 0)for(let i of n)i!=null&&(i=+i)>=i&&(++t,r+=i);else{let i=-1;for(let s of n)(s=e(s,++i,n))!=null&&(s=+s)>=s&&(++t,r+=s)}if(t)return r/t}function*VM(n){for(const e of n)yield*e}function CA(n){return Array.from(VM(n))}function Fl(n,e,t){n=+n,e=+e,t=(i=arguments.length)<2?(e=n,n=0,1):i<3?1:+t;for(var r=-1,i=Math.max(0,Math.ceil((e-n)/t))|0,s=new Array(i);++r<i;)s[r]=n+r*t;return s}function zM(n,e){let t=0;for(let r of n)(r=+r)&&(t+=r);return t}function h4(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}function p1(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function f4(n,e){var t=Object.create(n.prototype);for(var r in e)t[r]=e[r];return t}function KA(){}var NA=.7,ih=1/NA,Vl="\\s*([+-]?\\d+)\\s*",MA="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",vs="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",jM=/^#([0-9a-f]{3,8})$/,$M=new RegExp(`^rgb\\(${Vl},${Vl},${Vl}\\)$`),HM=new RegExp(`^rgb\\(${vs},${vs},${vs}\\)$`),WM=new RegExp(`^rgba\\(${Vl},${Vl},${Vl},${MA}\\)$`),QM=new RegExp(`^rgba\\(${vs},${vs},${vs},${MA}\\)$`),XM=new RegExp(`^hsl\\(${MA},${vs},${vs}\\)$`),YM=new RegExp(`^hsla\\(${MA},${vs},${vs},${MA}\\)$`),V_={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};p1(KA,$a,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:z_,formatHex:z_,formatHex8:KM,formatHsl:ZM,formatRgb:j_,toString:j_});function z_(){return this.rgb().formatHex()}function KM(){return this.rgb().formatHex8()}function ZM(){return d4(this).formatHsl()}function j_(){return this.rgb().formatRgb()}function $a(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=jM.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?$_(e):t===3?new Fr(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?wc(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?wc(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=$M.exec(n))?new Fr(e[1],e[2],e[3],1):(e=HM.exec(n))?new Fr(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=WM.exec(n))?wc(e[1],e[2],e[3],e[4]):(e=QM.exec(n))?wc(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=XM.exec(n))?Q_(e[1],e[2]/100,e[3]/100,1):(e=YM.exec(n))?Q_(e[1],e[2]/100,e[3]/100,e[4]):V_.hasOwnProperty(n)?$_(V_[n]):n==="transparent"?new Fr(NaN,NaN,NaN,0):null}function $_(n){return new Fr(n>>16&255,n>>8&255,n&255,1)}function wc(n,e,t,r){return r<=0&&(n=e=t=NaN),new Fr(n,e,t,r)}function JM(n){return n instanceof KA||(n=$a(n)),n?(n=n.rgb(),new Fr(n.r,n.g,n.b,n.opacity)):new Fr}function Sm(n,e,t,r){return arguments.length===1?JM(n):new Fr(n,e,t,r??1)}function Fr(n,e,t,r){this.r=+n,this.g=+e,this.b=+t,this.opacity=+r}p1(Fr,Sm,f4(KA,{brighter(n){return n=n==null?ih:Math.pow(ih,n),new Fr(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?NA:Math.pow(NA,n),new Fr(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new Fr(Ga(this.r),Ga(this.g),Ga(this.b),sh(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:H_,formatHex:H_,formatHex8:e9,formatRgb:W_,toString:W_}));function H_(){return`#${La(this.r)}${La(this.g)}${La(this.b)}`}function e9(){return`#${La(this.r)}${La(this.g)}${La(this.b)}${La((isNaN(this.opacity)?1:this.opacity)*255)}`}function W_(){const n=sh(this.opacity);return`${n===1?"rgb(":"rgba("}${Ga(this.r)}, ${Ga(this.g)}, ${Ga(this.b)}${n===1?")":`, ${n})`}`}function sh(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function Ga(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function La(n){return n=Ga(n),(n<16?"0":"")+n.toString(16)}function Q_(n,e,t,r){return r<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new Gi(n,e,t,r)}function d4(n){if(n instanceof Gi)return new Gi(n.h,n.s,n.l,n.opacity);if(n instanceof KA||(n=$a(n)),!n)return new Gi;if(n instanceof Gi)return n;n=n.rgb();var e=n.r/255,t=n.g/255,r=n.b/255,i=Math.min(e,t,r),s=Math.max(e,t,r),o=NaN,a=s-i,c=(s+i)/2;return a?(e===s?o=(t-r)/a+(t<r)*6:t===s?o=(r-e)/a+2:o=(e-t)/a+4,a/=c<.5?s+i:2-s-i,o*=60):a=c>0&&c<1?0:o,new Gi(o,a,c,n.opacity)}function t9(n,e,t,r){return arguments.length===1?d4(n):new Gi(n,e,t,r??1)}function Gi(n,e,t,r){this.h=+n,this.s=+e,this.l=+t,this.opacity=+r}p1(Gi,t9,f4(KA,{brighter(n){return n=n==null?ih:Math.pow(ih,n),new Gi(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?NA:Math.pow(NA,n),new Gi(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,r=t+(t<.5?t:1-t)*e,i=2*t-r;return new Fr(Ud(n>=240?n-240:n+120,i,r),Ud(n,i,r),Ud(n<120?n+240:n-120,i,r),this.opacity)},clamp(){return new Gi(X_(this.h),Sc(this.s),Sc(this.l),sh(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=sh(this.opacity);return`${n===1?"hsl(":"hsla("}${X_(this.h)}, ${Sc(this.s)*100}%, ${Sc(this.l)*100}%${n===1?")":`, ${n})`}`}}));function X_(n){return n=(n||0)%360,n<0?n+360:n}function Sc(n){return Math.max(0,Math.min(1,n||0))}function Ud(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}const m1=n=>()=>n;function n9(n,e){return function(t){return n+t*e}}function r9(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(r){return Math.pow(n+r*e,t)}}function i9(n){return(n=+n)==1?p4:function(e,t){return t-e?r9(e,t,n):m1(isNaN(e)?t:e)}}function p4(n,e){var t=e-n;return t?n9(n,t):m1(isNaN(n)?e:n)}const Y_=(function n(e){var t=i9(e);function r(i,s){var o=t((i=Sm(i)).r,(s=Sm(s)).r),a=t(i.g,s.g),c=t(i.b,s.b),f=p4(i.opacity,s.opacity);return function(p){return i.r=o(p),i.g=a(p),i.b=c(p),i.opacity=f(p),i+""}}return r.gamma=n,r})(1);function m4(n,e){e||(e=[]);var t=n?Math.min(e.length,n.length):0,r=e.slice(),i;return function(s){for(i=0;i<t;++i)r[i]=n[i]*(1-s)+e[i]*s;return r}}function g4(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function s9(n,e){return(g4(e)?m4:y4)(n,e)}function y4(n,e){var t=e?e.length:0,r=n?Math.min(t,n.length):0,i=new Array(r),s=new Array(t),o;for(o=0;o<r;++o)i[o]=g1(n[o],e[o]);for(;o<t;++o)s[o]=e[o];return function(a){for(o=0;o<r;++o)s[o]=i[o](a);return s}}function o9(n,e){var t=new Date;return n=+n,e=+e,function(r){return t.setTime(n*(1-r)+e*r),t}}function PA(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}function a9(n,e){var t={},r={},i;(n===null||typeof n!="object")&&(n={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in n?t[i]=g1(n[i],e[i]):r[i]=e[i];return function(s){for(i in t)r[i]=t[i](s);return r}}var Em=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,qd=new RegExp(Em.source,"g");function l9(n){return function(){return n}}function u9(n){return function(e){return n(e)+""}}function A9(n,e){var t=Em.lastIndex=qd.lastIndex=0,r,i,s,o=-1,a=[],c=[];for(n=n+"",e=e+"";(r=Em.exec(n))&&(i=qd.exec(e));)(s=i.index)>t&&(s=e.slice(t,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,c.push({i:o,x:PA(r,i)})),t=qd.lastIndex;return t<e.length&&(s=e.slice(t),a[o]?a[o]+=s:a[++o]=s),a.length<2?c[0]?u9(c[0].x):l9(e):(e=c.length,function(f){for(var p=0,g;p<e;++p)a[(g=c[p]).i]=g.x(f);return a.join("")})}function g1(n,e){var t=typeof e,r;return e==null||t==="boolean"?m1(e):(t==="number"?PA:t==="string"?(r=$a(e))?(e=r,Y_):A9:e instanceof $a?Y_:e instanceof Date?o9:g4(e)?m4:Array.isArray(e)?y4:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?a9:PA)(n,e)}function c9(n,e){return n=+n,e=+e,function(t){return Math.round(n*(1-t)+e*t)}}function h9(n){return function(){return n}}function f9(n){return+n}var K_=[0,1];function Il(n){return n}function Rm(n,e){return(e-=n=+n)?function(t){return(t-n)/e}:h9(isNaN(e)?NaN:.5)}function d9(n,e){var t;return n>e&&(t=n,n=e,e=t),function(r){return Math.max(n,Math.min(e,r))}}function p9(n,e,t){var r=n[0],i=n[1],s=e[0],o=e[1];return i<r?(r=Rm(i,r),s=t(o,s)):(r=Rm(r,i),s=t(s,o)),function(a){return s(r(a))}}function m9(n,e,t){var r=Math.min(n.length,e.length)-1,i=new Array(r),s=new Array(r),o=-1;for(n[r]<n[0]&&(n=n.slice().reverse(),e=e.slice().reverse());++o<r;)i[o]=Rm(n[o],n[o+1]),s[o]=t(e[o],e[o+1]);return function(a){var c=c4(n,a,1,r)-1;return s[c](i[c](a))}}function g9(n,e){return e.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function y9(){var n=K_,e=K_,t=g1,r,i,s,o=Il,a,c,f;function p(){var v=Math.min(n.length,e.length);return o!==Il&&(o=d9(n[0],n[v-1])),a=v>2?m9:p9,c=f=null,g}function g(v){return v==null||isNaN(v=+v)?s:(c||(c=a(n.map(r),e,t)))(r(o(v)))}return g.invert=function(v){return o(i((f||(f=a(e,n.map(r),PA)))(v)))},g.domain=function(v){return arguments.length?(n=Array.from(v,f9),p()):n.slice()},g.range=function(v){return arguments.length?(e=Array.from(v),p()):e.slice()},g.rangeRound=function(v){return e=Array.from(v),t=c9,p()},g.clamp=function(v){return arguments.length?(o=v?!0:Il,p()):o!==Il},g.interpolate=function(v){return arguments.length?(t=v,p()):t},g.unknown=function(v){return arguments.length?(s=v,g):s},function(v,x){return r=v,i=x,p()}}function _9(){return y9()(Il,Il)}function v9(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function oh(n,e){if((t=(n=e?n.toExponential(e-1):n.toExponential()).indexOf("e"))<0)return null;var t,r=n.slice(0,t);return[r.length>1?r[0]+r.slice(2):r,+n.slice(t+1)]}function tu(n){return n=oh(Math.abs(n)),n?n[1]:NaN}function b9(n,e){return function(t,r){for(var i=t.length,s=[],o=0,a=n[0],c=0;i>0&&a>0&&(c+a+1>r&&(a=Math.max(1,r-c)),s.push(t.substring(i-=a,i+a)),!((c+=a+1)>r));)a=n[o=(o+1)%n.length];return s.reverse().join(e)}}function x9(n){return function(e){return e.replace(/[0-9]/g,function(t){return n[+t]})}}var T9=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ah(n){if(!(e=T9.exec(n)))throw new Error("invalid format: "+n);var e;return new y1({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}ah.prototype=y1.prototype;function y1(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}y1.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function w9(n){e:for(var e=n.length,t=1,r=-1,i;t<e;++t)switch(n[t]){case".":r=i=t;break;case"0":r===0&&(r=t),i=t;break;default:if(!+n[t])break e;r>0&&(r=0);break}return r>0?n.slice(0,r)+n.slice(i+1):n}var _4;function S9(n,e){var t=oh(n,e);if(!t)return n+"";var r=t[0],i=t[1],s=i-(_4=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+oh(n,Math.max(0,e+s-1))[0]}function Z_(n,e){var t=oh(n,e);if(!t)return n+"";var r=t[0],i=t[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const J_={"%":(n,e)=>(n*100).toFixed(e),b:n=>Math.round(n).toString(2),c:n=>n+"",d:v9,e:(n,e)=>n.toExponential(e),f:(n,e)=>n.toFixed(e),g:(n,e)=>n.toPrecision(e),o:n=>Math.round(n).toString(8),p:(n,e)=>Z_(n*100,e),r:Z_,s:S9,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function e3(n){return n}var t3=Array.prototype.map,n3=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function E9(n){var e=n.grouping===void 0||n.thousands===void 0?e3:b9(t3.call(n.grouping,Number),n.thousands+""),t=n.currency===void 0?"":n.currency[0]+"",r=n.currency===void 0?"":n.currency[1]+"",i=n.decimal===void 0?".":n.decimal+"",s=n.numerals===void 0?e3:x9(t3.call(n.numerals,String)),o=n.percent===void 0?"%":n.percent+"",a=n.minus===void 0?"":n.minus+"",c=n.nan===void 0?"NaN":n.nan+"";function f(g){g=ah(g);var v=g.fill,x=g.align,T=g.sign,S=g.symbol,E=g.zero,N=g.width,P=g.comma,B=g.precision,L=g.trim,k=g.type;k==="n"?(P=!0,k="g"):J_[k]||(B===void 0&&(B=12),L=!0,k="g"),(E||v==="0"&&x==="=")&&(E=!0,v="0",x="=");var q=S==="$"?t:S==="#"&&/[boxX]/.test(k)?"0"+k.toLowerCase():"",I=S==="$"?r:/[%p]/.test(k)?o:"",U=J_[k],j=/[defgprs%]/.test(k);B=B===void 0?6:/[gprs]/.test(k)?Math.max(1,Math.min(21,B)):Math.max(0,Math.min(20,B));function J(Q){var K=q,te=I,oe,Y,ae;if(k==="c")te=U(Q)+te,Q="";else{Q=+Q;var he=Q<0||1/Q<0;if(Q=isNaN(Q)?c:U(Math.abs(Q),B),L&&(Q=w9(Q)),he&&+Q==0&&T!=="+"&&(he=!1),K=(he?T==="("?T:a:T==="-"||T==="("?"":T)+K,te=(k==="s"?n3[8+_4/3]:"")+te+(he&&T==="("?")":""),j){for(oe=-1,Y=Q.length;++oe<Y;)if(ae=Q.charCodeAt(oe),48>ae||ae>57){te=(ae===46?i+Q.slice(oe+1):Q.slice(oe))+te,Q=Q.slice(0,oe);break}}}P&&!E&&(Q=e(Q,1/0));var xe=K.length+Q.length+te.length,me=xe<N?new Array(N-xe+1).join(v):"";switch(P&&E&&(Q=e(me+Q,me.length?N-te.length:1/0),me=""),x){case"<":Q=K+Q+te+me;break;case"=":Q=K+me+Q+te;break;case"^":Q=me.slice(0,xe=me.length>>1)+K+Q+te+me.slice(xe);break;default:Q=me+K+Q+te;break}return s(Q)}return J.toString=function(){return g+""},J}function p(g,v){var x=f((g=ah(g),g.type="f",g)),T=Math.max(-8,Math.min(8,Math.floor(tu(v)/3)))*3,S=Math.pow(10,-T),E=n3[8+T/3];return function(N){return x(S*N)+E}}return{format:f,formatPrefix:p}}var Ec,v4,b4;R9({thousands:",",grouping:[3],currency:["$",""]});function R9(n){return Ec=E9(n),v4=Ec.format,b4=Ec.formatPrefix,Ec}function C9(n){return Math.max(0,-tu(Math.abs(n)))}function N9(n,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(tu(e)/3)))*3-tu(Math.abs(n)))}function M9(n,e){return n=Math.abs(n),e=Math.abs(e)-n,Math.max(0,tu(e)-tu(n))+1}function P9(n,e,t,r){var i=UM(n,e,t),s;switch(r=ah(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(n),Math.abs(e));return r.precision==null&&!isNaN(s=N9(i,o))&&(r.precision=s),b4(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=M9(i,Math.max(Math.abs(n),Math.abs(e))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=C9(i))&&(r.precision=s-(r.type==="%")*2);break}}return v4(r)}function x4(n){var e=n.domain;return n.ticks=function(t){var r=e();return kM(r[0],r[r.length-1],t??10)},n.tickFormat=function(t,r){var i=e();return P9(i[0],i[i.length-1],t??10,r)},n.nice=function(t){t==null&&(t=10);var r=e(),i=0,s=r.length-1,o=r[i],a=r[s],c,f,p=10;for(a<o&&(f=o,o=a,a=f,f=i,i=s,s=f);p-- >0;){if(f=wm(o,a,t),f===c)return r[i]=o,r[s]=a,e(r);if(f>0)o=Math.floor(o/f)*f,a=Math.ceil(a/f)*f;else if(f<0)o=Math.ceil(o*f)/f,a=Math.floor(a*f)/f;else break;c=f}return n},n}function io(){var n=_9();return n.copy=function(){return g9(n,io())},h4.apply(n,arguments),x4(n)}function T4(){var n=0,e=1,t=1,r=[.5],i=[0,1],s;function o(c){return c!=null&&c<=c?i[c4(r,c,0,t)]:s}function a(){var c=-1;for(r=new Array(t);++c<t;)r[c]=((c+1)*e-(c-t)*n)/(t+1);return o}return o.domain=function(c){return arguments.length?([n,e]=c,n=+n,e=+e,a()):[n,e]},o.range=function(c){return arguments.length?(t=(i=Array.from(c)).length-1,a()):i.slice()},o.invertExtent=function(c){var f=i.indexOf(c);return f<0?[NaN,NaN]:f<1?[n,r[0]]:f>=t?[r[t-1],e]:[r[f-1],r[f]]},o.unknown=function(c){return arguments.length&&(s=c),o},o.thresholds=function(){return r.slice()},o.copy=function(){return T4().domain([n,e]).range(i).unknown(s)},h4.apply(x4(o),arguments)}var wt=1e-6,lh=1e-12,Bt=Math.PI,Ir=Bt/2,uh=Bt/4,oi=Bt*2,Nn=180/Bt,ct=Bt/180,nn=Math.abs,_1=Math.atan,Si=Math.atan2,dt=Math.cos,Rc=Math.ceil,B9=Math.exp,Cm=Math.hypot,D9=Math.log,at=Math.sin,L9=Math.sign||function(n){return n>0?1:n<0?-1:0},so=Math.sqrt,O9=Math.tan;function F9(n){return n>1?0:n<-1?Bt:Math.acos(n)}function oo(n){return n>1?Ir:n<-1?-Ir:Math.asin(n)}function r3(n){return(n=at(n/2))*n}function pr(){}function Ah(n,e){n&&s3.hasOwnProperty(n.type)&&s3[n.type](n,e)}var i3={Feature:function(n,e){Ah(n.geometry,e)},FeatureCollection:function(n,e){for(var t=n.features,r=-1,i=t.length;++r<i;)Ah(t[r].geometry,e)}},s3={Sphere:function(n,e){e.sphere()},Point:function(n,e){n=n.coordinates,e.point(n[0],n[1],n[2])},MultiPoint:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)n=t[r],e.point(n[0],n[1],n[2])},LineString:function(n,e){Nm(n.coordinates,e,0)},MultiLineString:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)Nm(t[r],e,0)},Polygon:function(n,e){o3(n.coordinates,e)},MultiPolygon:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)o3(t[r],e)},GeometryCollection:function(n,e){for(var t=n.geometries,r=-1,i=t.length;++r<i;)Ah(t[r],e)}};function Nm(n,e,t){var r=-1,i=n.length-t,s;for(e.lineStart();++r<i;)s=n[r],e.point(s[0],s[1],s[2]);e.lineEnd()}function o3(n,e){var t=-1,r=n.length;for(e.polygonStart();++t<r;)Nm(n[t],e,1);e.polygonEnd()}function hf(n,e){n&&i3.hasOwnProperty(n.type)?i3[n.type](n,e):Ah(n,e)}var ch=new Ks,a3=new Ks,w4,S4,Mm,Pm,Bm,ao={point:pr,lineStart:pr,lineEnd:pr,polygonStart:function(){ch=new Ks,ao.lineStart=I9,ao.lineEnd=k9},polygonEnd:function(){var n=+ch;a3.add(n<0?oi+n:n),this.lineStart=this.lineEnd=this.point=pr},sphere:function(){a3.add(oi)}};function I9(){ao.point=U9}function k9(){E4(w4,S4)}function U9(n,e){ao.point=E4,w4=n,S4=e,n*=ct,e*=ct,Mm=n,Pm=dt(e=e/2+uh),Bm=at(e)}function E4(n,e){n*=ct,e*=ct,e=e/2+uh;var t=n-Mm,r=t>=0?1:-1,i=r*t,s=dt(e),o=at(e),a=Bm*o,c=Pm*s+a*dt(i),f=a*r*at(i);ch.add(Si(f,c)),Mm=n,Pm=s,Bm=o}function hh(n){return[Si(n[1],n[0]),oo(n[2])]}function Ha(n){var e=n[0],t=n[1],r=dt(t);return[r*dt(e),r*at(e),at(t)]}function Cc(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function nu(n,e){return[n[1]*e[2]-n[2]*e[1],n[2]*e[0]-n[0]*e[2],n[0]*e[1]-n[1]*e[0]]}function Gd(n,e){n[0]+=e[0],n[1]+=e[1],n[2]+=e[2]}function Nc(n,e){return[n[0]*e,n[1]*e,n[2]*e]}function fh(n){var e=so(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=e,n[1]/=e,n[2]/=e}var Tn,Or,Cn,ri,wa,R4,C4,zl,fA,Do,lo,zs={point:Dm,lineStart:l3,lineEnd:u3,polygonStart:function(){zs.point=M4,zs.lineStart=q9,zs.lineEnd=G9,fA=new Ks,ao.polygonStart()},polygonEnd:function(){ao.polygonEnd(),zs.point=Dm,zs.lineStart=l3,zs.lineEnd=u3,ch<0?(Tn=-(Cn=180),Or=-(ri=90)):fA>wt?ri=90:fA<-wt&&(Or=-90),lo[0]=Tn,lo[1]=Cn},sphere:function(){Tn=-(Cn=180),Or=-(ri=90)}};function Dm(n,e){Do.push(lo=[Tn=n,Cn=n]),e<Or&&(Or=e),e>ri&&(ri=e)}function N4(n,e){var t=Ha([n*ct,e*ct]);if(zl){var r=nu(zl,t),i=[r[1],-r[0],0],s=nu(i,r);fh(s),s=hh(s);var o=n-wa,a=o>0?1:-1,c=s[0]*Nn*a,f,p=nn(o)>180;p^(a*wa<c&&c<a*n)?(f=s[1]*Nn,f>ri&&(ri=f)):(c=(c+360)%360-180,p^(a*wa<c&&c<a*n)?(f=-s[1]*Nn,f<Or&&(Or=f)):(e<Or&&(Or=e),e>ri&&(ri=e))),p?n<wa?ei(Tn,n)>ei(Tn,Cn)&&(Cn=n):ei(n,Cn)>ei(Tn,Cn)&&(Tn=n):Cn>=Tn?(n<Tn&&(Tn=n),n>Cn&&(Cn=n)):n>wa?ei(Tn,n)>ei(Tn,Cn)&&(Cn=n):ei(n,Cn)>ei(Tn,Cn)&&(Tn=n)}else Do.push(lo=[Tn=n,Cn=n]);e<Or&&(Or=e),e>ri&&(ri=e),zl=t,wa=n}function l3(){zs.point=N4}function u3(){lo[0]=Tn,lo[1]=Cn,zs.point=Dm,zl=null}function M4(n,e){if(zl){var t=n-wa;fA.add(nn(t)>180?t+(t>0?360:-360):t)}else R4=n,C4=e;ao.point(n,e),N4(n,e)}function q9(){ao.lineStart()}function G9(){M4(R4,C4),ao.lineEnd(),nn(fA)>wt&&(Tn=-(Cn=180)),lo[0]=Tn,lo[1]=Cn,zl=null}function ei(n,e){return(e-=n)<0?e+360:e}function V9(n,e){return n[0]-e[0]}function A3(n,e){return n[0]<=n[1]?n[0]<=e&&e<=n[1]:e<n[0]||n[1]<e}function P4(n){var e,t,r,i,s,o,a;if(ri=Cn=-(Tn=Or=1/0),Do=[],hf(n,zs),t=Do.length){for(Do.sort(V9),e=1,r=Do[0],s=[r];e<t;++e)i=Do[e],A3(r,i[0])||A3(r,i[1])?(ei(r[0],i[1])>ei(r[0],r[1])&&(r[1]=i[1]),ei(i[0],r[1])>ei(r[0],r[1])&&(r[0]=i[0])):s.push(r=i);for(o=-1/0,t=s.length-1,e=0,r=s[t];e<=t;r=i,++e)i=s[e],(a=ei(r[1],i[0]))>o&&(o=a,Tn=i[0],Cn=r[1])}return Do=lo=null,Tn===1/0||Or===1/0?[[NaN,NaN],[NaN,NaN]]:[[Tn,Or],[Cn,ri]]}var eA,dh,ph,mh,gh,yh,_h,vh,Lm,Om,Fm,B4,D4,Sr,Er,Rr,ji={sphere:pr,point:v1,lineStart:c3,lineEnd:h3,polygonStart:function(){ji.lineStart=$9,ji.lineEnd=H9},polygonEnd:function(){ji.lineStart=c3,ji.lineEnd=h3}};function v1(n,e){n*=ct,e*=ct;var t=dt(e);ZA(t*dt(n),t*at(n),at(e))}function ZA(n,e,t){++eA,ph+=(n-ph)/eA,mh+=(e-mh)/eA,gh+=(t-gh)/eA}function c3(){ji.point=z9}function z9(n,e){n*=ct,e*=ct;var t=dt(e);Sr=t*dt(n),Er=t*at(n),Rr=at(e),ji.point=j9,ZA(Sr,Er,Rr)}function j9(n,e){n*=ct,e*=ct;var t=dt(e),r=t*dt(n),i=t*at(n),s=at(e),o=Si(so((o=Er*s-Rr*i)*o+(o=Rr*r-Sr*s)*o+(o=Sr*i-Er*r)*o),Sr*r+Er*i+Rr*s);dh+=o,yh+=o*(Sr+(Sr=r)),_h+=o*(Er+(Er=i)),vh+=o*(Rr+(Rr=s)),ZA(Sr,Er,Rr)}function h3(){ji.point=v1}function $9(){ji.point=W9}function H9(){L4(B4,D4),ji.point=v1}function W9(n,e){B4=n,D4=e,n*=ct,e*=ct,ji.point=L4;var t=dt(e);Sr=t*dt(n),Er=t*at(n),Rr=at(e),ZA(Sr,Er,Rr)}function L4(n,e){n*=ct,e*=ct;var t=dt(e),r=t*dt(n),i=t*at(n),s=at(e),o=Er*s-Rr*i,a=Rr*r-Sr*s,c=Sr*i-Er*r,f=Cm(o,a,c),p=oo(f),g=f&&-p/f;Lm.add(g*o),Om.add(g*a),Fm.add(g*c),dh+=p,yh+=p*(Sr+(Sr=r)),_h+=p*(Er+(Er=i)),vh+=p*(Rr+(Rr=s)),ZA(Sr,Er,Rr)}function f3(n){eA=dh=ph=mh=gh=yh=_h=vh=0,Lm=new Ks,Om=new Ks,Fm=new Ks,hf(n,ji);var e=+Lm,t=+Om,r=+Fm,i=Cm(e,t,r);return i<lh&&(e=yh,t=_h,r=vh,dh<wt&&(e=ph,t=mh,r=gh),i=Cm(e,t,r),i<lh)?[NaN,NaN]:[Si(t,e)*Nn,oo(r/i)*Nn]}function Im(n,e){function t(r,i){return r=n(r,i),e(r[0],r[1])}return n.invert&&e.invert&&(t.invert=function(r,i){return r=e.invert(r,i),r&&n.invert(r[0],r[1])}),t}function km(n,e){return nn(n)>Bt&&(n-=Math.round(n/oi)*oi),[n,e]}km.invert=km;function O4(n,e,t){return(n%=oi)?e||t?Im(p3(n),m3(e,t)):p3(n):e||t?m3(e,t):km}function d3(n){return function(e,t){return e+=n,nn(e)>Bt&&(e-=Math.round(e/oi)*oi),[e,t]}}function p3(n){var e=d3(n);return e.invert=d3(-n),e}function m3(n,e){var t=dt(n),r=at(n),i=dt(e),s=at(e);function o(a,c){var f=dt(c),p=dt(a)*f,g=at(a)*f,v=at(c),x=v*t+p*r;return[Si(g*i-x*s,p*t-v*r),oo(x*i+g*s)]}return o.invert=function(a,c){var f=dt(c),p=dt(a)*f,g=at(a)*f,v=at(c),x=v*i-g*s;return[Si(g*i+v*s,p*t+x*r),oo(x*t-p*r)]},o}function Q9(n){n=O4(n[0]*ct,n[1]*ct,n.length>2?n[2]*ct:0);function e(t){return t=n(t[0]*ct,t[1]*ct),t[0]*=Nn,t[1]*=Nn,t}return e.invert=function(t){return t=n.invert(t[0]*ct,t[1]*ct),t[0]*=Nn,t[1]*=Nn,t},e}function X9(n,e,t,r,i,s){if(t){var o=dt(e),a=at(e),c=r*t;i==null?(i=e+r*oi,s=e-c/2):(i=g3(o,i),s=g3(o,s),(r>0?i<s:i>s)&&(i+=r*oi));for(var f,p=i;r>0?p>s:p<s;p-=c)f=hh([o,-a*dt(p),-a*at(p)]),n.point(f[0],f[1])}}function g3(n,e){e=Ha(e),e[0]-=n,fh(e);var t=F9(-e[1]);return((-e[2]<0?-t:t)+oi-wt)%oi}function F4(){var n=[],e;return{point:function(t,r,i){e.push([t,r,i])},lineStart:function(){n.push(e=[])},lineEnd:pr,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var t=n;return n=[],e=null,t}}}function N0(n,e){return nn(n[0]-e[0])<wt&&nn(n[1]-e[1])<wt}function Mc(n,e,t,r){this.x=n,this.z=e,this.o=t,this.e=r,this.v=!1,this.n=this.p=null}function I4(n,e,t,r,i){var s=[],o=[],a,c;if(n.forEach(function(T){if(!((S=T.length-1)<=0)){var S,E=T[0],N=T[S],P;if(N0(E,N)){if(!E[2]&&!N[2]){for(i.lineStart(),a=0;a<S;++a)i.point((E=T[a])[0],E[1]);i.lineEnd();return}N[0]+=2*wt}s.push(P=new Mc(E,T,null,!0)),o.push(P.o=new Mc(E,null,P,!1)),s.push(P=new Mc(N,T,null,!1)),o.push(P.o=new Mc(N,null,P,!0))}}),!!s.length){for(o.sort(e),y3(s),y3(o),a=0,c=o.length;a<c;++a)o[a].e=t=!t;for(var f=s[0],p,g;;){for(var v=f,x=!0;v.v;)if((v=v.n)===f)return;p=v.z,i.lineStart();do{if(v.v=v.o.v=!0,v.e){if(x)for(a=0,c=p.length;a<c;++a)i.point((g=p[a])[0],g[1]);else r(v.x,v.n.x,1,i);v=v.n}else{if(x)for(p=v.p.z,a=p.length-1;a>=0;--a)i.point((g=p[a])[0],g[1]);else r(v.x,v.p.x,-1,i);v=v.p}v=v.o,p=v.z,x=!x}while(!v.v);i.lineEnd()}}}function y3(n){if(e=n.length){for(var e,t=0,r=n[0],i;++t<e;)r.n=i=n[t],i.p=r,r=i;r.n=i=n[0],i.p=r}}function Vd(n){return nn(n[0])<=Bt?n[0]:L9(n[0])*((nn(n[0])+Bt)%oi-Bt)}function k4(n,e){var t=Vd(e),r=e[1],i=at(r),s=[at(t),-dt(t),0],o=0,a=0,c=new Ks;i===1?r=Ir+wt:i===-1&&(r=-Ir-wt);for(var f=0,p=n.length;f<p;++f)if(v=(g=n[f]).length)for(var g,v,x=g[v-1],T=Vd(x),S=x[1]/2+uh,E=at(S),N=dt(S),P=0;P<v;++P,T=L,E=q,N=I,x=B){var B=g[P],L=Vd(B),k=B[1]/2+uh,q=at(k),I=dt(k),U=L-T,j=U>=0?1:-1,J=j*U,Q=J>Bt,K=E*q;if(c.add(Si(K*j*at(J),N*I+K*dt(J))),o+=Q?U+j*oi:U,Q^T>=t^L>=t){var te=nu(Ha(x),Ha(B));fh(te);var oe=nu(s,te);fh(oe);var Y=(Q^U>=0?-1:1)*oo(oe[2]);(r>Y||r===Y&&(te[0]||te[1]))&&(a+=Q^U>=0?1:-1)}}return(o<-wt||o<wt&&c<-lh)^a&1}function U4(n,e,t,r){return function(i){var s=e(i),o=F4(),a=e(o),c=!1,f,p,g,v={point:x,lineStart:S,lineEnd:E,polygonStart:function(){v.point=N,v.lineStart=P,v.lineEnd=B,p=[],f=[]},polygonEnd:function(){v.point=x,v.lineStart=S,v.lineEnd=E,p=CA(p);var L=k4(f,r);p.length?(c||(i.polygonStart(),c=!0),I4(p,K9,L,t,i)):L&&(c||(i.polygonStart(),c=!0),i.lineStart(),t(null,null,1,i),i.lineEnd()),c&&(i.polygonEnd(),c=!1),p=f=null},sphere:function(){i.polygonStart(),i.lineStart(),t(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function x(L,k){n(L,k)&&i.point(L,k)}function T(L,k){s.point(L,k)}function S(){v.point=T,s.lineStart()}function E(){v.point=x,s.lineEnd()}function N(L,k){g.push([L,k]),a.point(L,k)}function P(){a.lineStart(),g=[]}function B(){N(g[0][0],g[0][1]),a.lineEnd();var L=a.clean(),k=o.result(),q,I=k.length,U,j,J;if(g.pop(),f.push(g),g=null,!!I){if(L&1){if(j=k[0],(U=j.length-1)>0){for(c||(i.polygonStart(),c=!0),i.lineStart(),q=0;q<U;++q)i.point((J=j[q])[0],J[1]);i.lineEnd()}return}I>1&&L&2&&k.push(k.pop().concat(k.shift())),p.push(k.filter(Y9))}}return v}}function Y9(n){return n.length>1}function K9(n,e){return((n=n.x)[0]<0?n[1]-Ir-wt:Ir-n[1])-((e=e.x)[0]<0?e[1]-Ir-wt:Ir-e[1])}const _3=U4(function(){return!0},Z9,eP,[-Bt,-Ir]);function Z9(n){var e=NaN,t=NaN,r=NaN,i;return{lineStart:function(){n.lineStart(),i=1},point:function(s,o){var a=s>0?Bt:-Bt,c=nn(s-e);nn(c-Bt)<wt?(n.point(e,t=(t+o)/2>0?Ir:-Ir),n.point(r,t),n.lineEnd(),n.lineStart(),n.point(a,t),n.point(s,t),i=0):r!==a&&c>=Bt&&(nn(e-r)<wt&&(e-=r*wt),nn(s-a)<wt&&(s-=a*wt),t=J9(e,t,s,o),n.point(r,t),n.lineEnd(),n.lineStart(),n.point(a,t),i=0),n.point(e=s,t=o),r=a},lineEnd:function(){n.lineEnd(),e=t=NaN},clean:function(){return 2-i}}}function J9(n,e,t,r){var i,s,o=at(n-t);return nn(o)>wt?_1((at(e)*(s=dt(r))*at(t)-at(r)*(i=dt(e))*at(n))/(i*s*o)):(e+r)/2}function eP(n,e,t,r){var i;if(n==null)i=t*Ir,r.point(-Bt,i),r.point(0,i),r.point(Bt,i),r.point(Bt,0),r.point(Bt,-i),r.point(0,-i),r.point(-Bt,-i),r.point(-Bt,0),r.point(-Bt,i);else if(nn(n[0]-e[0])>wt){var s=n[0]<e[0]?Bt:-Bt;i=t*s/2,r.point(-s,i),r.point(0,i),r.point(s,i)}else r.point(e[0],e[1])}function tP(n){var e=dt(n),t=2*ct,r=e>0,i=nn(e)>wt;function s(p,g,v,x){X9(x,n,t,v,p,g)}function o(p,g){return dt(p)*dt(g)>e}function a(p){var g,v,x,T,S;return{lineStart:function(){T=x=!1,S=1},point:function(E,N){var P=[E,N],B,L=o(E,N),k=r?L?0:f(E,N):L?f(E+(E<0?Bt:-Bt),N):0;if(!g&&(T=x=L)&&p.lineStart(),L!==x&&(B=c(g,P),(!B||N0(g,B)||N0(P,B))&&(P[2]=1)),L!==x)S=0,L?(p.lineStart(),B=c(P,g),p.point(B[0],B[1])):(B=c(g,P),p.point(B[0],B[1],2),p.lineEnd()),g=B;else if(i&&g&&r^L){var q;!(k&v)&&(q=c(P,g,!0))&&(S=0,r?(p.lineStart(),p.point(q[0][0],q[0][1]),p.point(q[1][0],q[1][1]),p.lineEnd()):(p.point(q[1][0],q[1][1]),p.lineEnd(),p.lineStart(),p.point(q[0][0],q[0][1],3)))}L&&(!g||!N0(g,P))&&p.point(P[0],P[1]),g=P,x=L,v=k},lineEnd:function(){x&&p.lineEnd(),g=null},clean:function(){return S|(T&&x)<<1}}}function c(p,g,v){var x=Ha(p),T=Ha(g),S=[1,0,0],E=nu(x,T),N=Cc(E,E),P=E[0],B=N-P*P;if(!B)return!v&&p;var L=e*N/B,k=-e*P/B,q=nu(S,E),I=Nc(S,L),U=Nc(E,k);Gd(I,U);var j=q,J=Cc(I,j),Q=Cc(j,j),K=J*J-Q*(Cc(I,I)-1);if(!(K<0)){var te=so(K),oe=Nc(j,(-J-te)/Q);if(Gd(oe,I),oe=hh(oe),!v)return oe;var Y=p[0],ae=g[0],he=p[1],xe=g[1],me;ae<Y&&(me=Y,Y=ae,ae=me);var Oe=ae-Y,ke=nn(Oe-Bt)<wt,Ke=ke||Oe<wt;if(!ke&&xe<he&&(me=he,he=xe,xe=me),Ke?ke?he+xe>0^oe[1]<(nn(oe[0]-Y)<wt?he:xe):he<=oe[1]&&oe[1]<=xe:Oe>Bt^(Y<=oe[0]&&oe[0]<=ae)){var Ye=Nc(j,(-J+te)/Q);return Gd(Ye,I),[oe,hh(Ye)]}}}function f(p,g){var v=r?n:Bt-n,x=0;return p<-v?x|=1:p>v&&(x|=2),g<-v?x|=4:g>v&&(x|=8),x}return U4(o,a,s,r?[0,-n]:[-Bt,n-Bt])}function nP(n,e,t,r,i,s){var o=n[0],a=n[1],c=e[0],f=e[1],p=0,g=1,v=c-o,x=f-a,T;if(T=t-o,!(!v&&T>0)){if(T/=v,v<0){if(T<p)return;T<g&&(g=T)}else if(v>0){if(T>g)return;T>p&&(p=T)}if(T=i-o,!(!v&&T<0)){if(T/=v,v<0){if(T>g)return;T>p&&(p=T)}else if(v>0){if(T<p)return;T<g&&(g=T)}if(T=r-a,!(!x&&T>0)){if(T/=x,x<0){if(T<p)return;T<g&&(g=T)}else if(x>0){if(T>g)return;T>p&&(p=T)}if(T=s-a,!(!x&&T<0)){if(T/=x,x<0){if(T>g)return;T>p&&(p=T)}else if(x>0){if(T<p)return;T<g&&(g=T)}return p>0&&(n[0]=o+p*v,n[1]=a+p*x),g<1&&(e[0]=o+g*v,e[1]=a+g*x),!0}}}}}var tA=1e9,Pc=-tA;function rP(n,e,t,r){function i(f,p){return n<=f&&f<=t&&e<=p&&p<=r}function s(f,p,g,v){var x=0,T=0;if(f==null||(x=o(f,g))!==(T=o(p,g))||c(f,p)<0^g>0)do v.point(x===0||x===3?n:t,x>1?r:e);while((x=(x+g+4)%4)!==T);else v.point(p[0],p[1])}function o(f,p){return nn(f[0]-n)<wt?p>0?0:3:nn(f[0]-t)<wt?p>0?2:1:nn(f[1]-e)<wt?p>0?1:0:p>0?3:2}function a(f,p){return c(f.x,p.x)}function c(f,p){var g=o(f,1),v=o(p,1);return g!==v?g-v:g===0?p[1]-f[1]:g===1?f[0]-p[0]:g===2?f[1]-p[1]:p[0]-f[0]}return function(f){var p=f,g=F4(),v,x,T,S,E,N,P,B,L,k,q,I={point:U,lineStart:K,lineEnd:te,polygonStart:J,polygonEnd:Q};function U(Y,ae){i(Y,ae)&&p.point(Y,ae)}function j(){for(var Y=0,ae=0,he=x.length;ae<he;++ae)for(var xe=x[ae],me=1,Oe=xe.length,ke=xe[0],Ke,Ye,Ft=ke[0],mt=ke[1];me<Oe;++me)Ke=Ft,Ye=mt,ke=xe[me],Ft=ke[0],mt=ke[1],Ye<=r?mt>r&&(Ft-Ke)*(r-Ye)>(mt-Ye)*(n-Ke)&&++Y:mt<=r&&(Ft-Ke)*(r-Ye)<(mt-Ye)*(n-Ke)&&--Y;return Y}function J(){p=g,v=[],x=[],q=!0}function Q(){var Y=j(),ae=q&&Y,he=(v=CA(v)).length;(ae||he)&&(f.polygonStart(),ae&&(f.lineStart(),s(null,null,1,f),f.lineEnd()),he&&I4(v,a,Y,s,f),f.polygonEnd()),p=f,v=x=T=null}function K(){I.point=oe,x&&x.push(T=[]),k=!0,L=!1,P=B=NaN}function te(){v&&(oe(S,E),N&&L&&g.rejoin(),v.push(g.result())),I.point=U,L&&p.lineEnd()}function oe(Y,ae){var he=i(Y,ae);if(x&&T.push([Y,ae]),k)S=Y,E=ae,N=he,k=!1,he&&(p.lineStart(),p.point(Y,ae));else if(he&&L)p.point(Y,ae);else{var xe=[P=Math.max(Pc,Math.min(tA,P)),B=Math.max(Pc,Math.min(tA,B))],me=[Y=Math.max(Pc,Math.min(tA,Y)),ae=Math.max(Pc,Math.min(tA,ae))];nP(xe,me,n,e,t,r)?(L||(p.lineStart(),p.point(xe[0],xe[1])),p.point(me[0],me[1]),he||p.lineEnd(),q=!1):he&&(p.lineStart(),p.point(Y,ae),q=!1)}P=Y,B=ae,L=he}return I}}var Um,qm,M0,P0,ru={sphere:pr,point:pr,lineStart:iP,lineEnd:pr,polygonStart:pr,polygonEnd:pr};function iP(){ru.point=oP,ru.lineEnd=sP}function sP(){ru.point=ru.lineEnd=pr}function oP(n,e){n*=ct,e*=ct,qm=n,M0=at(e),P0=dt(e),ru.point=aP}function aP(n,e){n*=ct,e*=ct;var t=at(e),r=dt(e),i=nn(n-qm),s=dt(i),o=at(i),a=r*o,c=P0*t-M0*r*s,f=M0*t+P0*r*s;Um.add(Si(so(a*a+c*c),f)),qm=n,M0=t,P0=r}function lP(n){return Um=new Ks,hf(n,ru),+Um}var Gm=[null,null],uP={type:"LineString",coordinates:Gm};function Xo(n,e){return Gm[0]=n,Gm[1]=e,lP(uP)}var v3={Feature:function(n,e){return bh(n.geometry,e)},FeatureCollection:function(n,e){for(var t=n.features,r=-1,i=t.length;++r<i;)if(bh(t[r].geometry,e))return!0;return!1}},b3={Sphere:function(){return!0},Point:function(n,e){return x3(n.coordinates,e)},MultiPoint:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)if(x3(t[r],e))return!0;return!1},LineString:function(n,e){return T3(n.coordinates,e)},MultiLineString:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)if(T3(t[r],e))return!0;return!1},Polygon:function(n,e){return w3(n.coordinates,e)},MultiPolygon:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)if(w3(t[r],e))return!0;return!1},GeometryCollection:function(n,e){for(var t=n.geometries,r=-1,i=t.length;++r<i;)if(bh(t[r],e))return!0;return!1}};function bh(n,e){return n&&b3.hasOwnProperty(n.type)?b3[n.type](n,e):!1}function x3(n,e){return Xo(n,e)===0}function T3(n,e){for(var t,r,i,s=0,o=n.length;s<o;s++){if(r=Xo(n[s],e),r===0||s>0&&(i=Xo(n[s],n[s-1]),i>0&&t<=i&&r<=i&&(t+r-i)*(1-Math.pow((t-r)/i,2))<lh*i))return!0;t=r}return!1}function w3(n,e){return!!k4(n.map(AP),q4(e))}function AP(n){return n=n.map(q4),n.pop(),n}function q4(n){return[n[0]*ct,n[1]*ct]}function cP(n,e){return(n&&v3.hasOwnProperty(n.type)?v3[n.type]:bh)(n,e)}function S3(n,e,t){var r=Fl(n,e-wt,t).concat(e);return function(i){return r.map(function(s){return[i,s]})}}function E3(n,e,t){var r=Fl(n,e-wt,t).concat(e);return function(i){return r.map(function(s){return[s,i]})}}function hP(){var n,e,t,r,i,s,o,a,c=10,f=c,p=90,g=360,v,x,T,S,E=2.5;function N(){return{type:"MultiLineString",coordinates:P()}}function P(){return Fl(Rc(r/p)*p,t,p).map(T).concat(Fl(Rc(a/g)*g,o,g).map(S)).concat(Fl(Rc(e/c)*c,n,c).filter(function(B){return nn(B%p)>wt}).map(v)).concat(Fl(Rc(s/f)*f,i,f).filter(function(B){return nn(B%g)>wt}).map(x))}return N.lines=function(){return P().map(function(B){return{type:"LineString",coordinates:B}})},N.outline=function(){return{type:"Polygon",coordinates:[T(r).concat(S(o).slice(1),T(t).reverse().slice(1),S(a).reverse().slice(1))]}},N.extent=function(B){return arguments.length?N.extentMajor(B).extentMinor(B):N.extentMinor()},N.extentMajor=function(B){return arguments.length?(r=+B[0][0],t=+B[1][0],a=+B[0][1],o=+B[1][1],r>t&&(B=r,r=t,t=B),a>o&&(B=a,a=o,o=B),N.precision(E)):[[r,a],[t,o]]},N.extentMinor=function(B){return arguments.length?(e=+B[0][0],n=+B[1][0],s=+B[0][1],i=+B[1][1],e>n&&(B=e,e=n,n=B),s>i&&(B=s,s=i,i=B),N.precision(E)):[[e,s],[n,i]]},N.step=function(B){return arguments.length?N.stepMajor(B).stepMinor(B):N.stepMinor()},N.stepMajor=function(B){return arguments.length?(p=+B[0],g=+B[1],N):[p,g]},N.stepMinor=function(B){return arguments.length?(c=+B[0],f=+B[1],N):[c,f]},N.precision=function(B){return arguments.length?(E=+B,v=S3(s,i,90),x=E3(e,n,E),T=S3(a,o,90),S=E3(r,t,E),N):E},N.extentMajor([[-180,-90+wt],[180,90-wt]]).extentMinor([[-180,-80-wt],[180,80+wt]])}function fP(){return hP()()}function b1(n,e){var t=n[0]*ct,r=n[1]*ct,i=e[0]*ct,s=e[1]*ct,o=dt(r),a=at(r),c=dt(s),f=at(s),p=o*dt(t),g=o*at(t),v=c*dt(i),x=c*at(i),T=2*oo(so(r3(s-r)+o*c*r3(i-t))),S=at(T),E=T?function(N){var P=at(N*=T)/S,B=at(T-N)/S,L=B*p+P*v,k=B*g+P*x,q=B*a+P*f;return[Si(k,L)*Nn,Si(q,so(L*L+k*k))*Nn]}:function(){return[t*Nn,r*Nn]};return E.distance=T,E}const R3=n=>n;var iu=1/0,xh=iu,BA=-iu,Th=BA,C3={point:dP,lineStart:pr,lineEnd:pr,polygonStart:pr,polygonEnd:pr,result:function(){var n=[[iu,xh],[BA,Th]];return BA=Th=-(xh=iu=1/0),n}};function dP(n,e){n<iu&&(iu=n),n>BA&&(BA=n),e<xh&&(xh=e),e>Th&&(Th=e)}function x1(n){return function(e){var t=new Vm;for(var r in n)t[r]=n[r];return t.stream=e,t}}function Vm(){}Vm.prototype={constructor:Vm,point:function(n,e){this.stream.point(n,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function T1(n,e,t){var r=n.clipExtent&&n.clipExtent();return n.scale(150).translate([0,0]),r!=null&&n.clipExtent(null),hf(t,n.stream(C3)),e(C3.result()),r!=null&&n.clipExtent(r),n}function G4(n,e,t){return T1(n,function(r){var i=e[1][0]-e[0][0],s=e[1][1]-e[0][1],o=Math.min(i/(r[1][0]-r[0][0]),s/(r[1][1]-r[0][1])),a=+e[0][0]+(i-o*(r[1][0]+r[0][0]))/2,c=+e[0][1]+(s-o*(r[1][1]+r[0][1]))/2;n.scale(150*o).translate([a,c])},t)}function pP(n,e,t){return G4(n,[[0,0],e],t)}function mP(n,e,t){return T1(n,function(r){var i=+e,s=i/(r[1][0]-r[0][0]),o=(i-s*(r[1][0]+r[0][0]))/2,a=-s*r[0][1];n.scale(150*s).translate([o,a])},t)}function gP(n,e,t){return T1(n,function(r){var i=+e,s=i/(r[1][1]-r[0][1]),o=-s*r[0][0],a=(i-s*(r[1][1]+r[0][1]))/2;n.scale(150*s).translate([o,a])},t)}var N3=16,yP=dt(30*ct);function M3(n,e){return+e?vP(n,e):_P(n)}function _P(n){return x1({point:function(e,t){e=n(e,t),this.stream.point(e[0],e[1])}})}function vP(n,e){function t(r,i,s,o,a,c,f,p,g,v,x,T,S,E){var N=f-r,P=p-i,B=N*N+P*P;if(B>4*e&&S--){var L=o+v,k=a+x,q=c+T,I=so(L*L+k*k+q*q),U=oo(q/=I),j=nn(nn(q)-1)<wt||nn(s-g)<wt?(s+g)/2:Si(k,L),J=n(j,U),Q=J[0],K=J[1],te=Q-r,oe=K-i,Y=P*te-N*oe;(Y*Y/B>e||nn((N*te+P*oe)/B-.5)>.3||o*v+a*x+c*T<yP)&&(t(r,i,s,o,a,c,Q,K,j,L/=I,k/=I,q,S,E),E.point(Q,K),t(Q,K,j,L,k,q,f,p,g,v,x,T,S,E))}}return function(r){var i,s,o,a,c,f,p,g,v,x,T,S,E={point:N,lineStart:P,lineEnd:L,polygonStart:function(){r.polygonStart(),E.lineStart=k},polygonEnd:function(){r.polygonEnd(),E.lineStart=P}};function N(U,j){U=n(U,j),r.point(U[0],U[1])}function P(){g=NaN,E.point=B,r.lineStart()}function B(U,j){var J=Ha([U,j]),Q=n(U,j);t(g,v,p,x,T,S,g=Q[0],v=Q[1],p=U,x=J[0],T=J[1],S=J[2],N3,r),r.point(g,v)}function L(){E.point=N,r.lineEnd()}function k(){P(),E.point=q,E.lineEnd=I}function q(U,j){B(i=U,j),s=g,o=v,a=x,c=T,f=S,E.point=B}function I(){t(g,v,p,x,T,S,s,o,i,a,c,f,N3,r),E.lineEnd=L,L()}return E}}var bP=x1({point:function(n,e){this.stream.point(n*ct,e*ct)}});function xP(n){return x1({point:function(e,t){var r=n(e,t);return this.stream.point(r[0],r[1])}})}function TP(n,e,t,r,i){function s(o,a){return o*=r,a*=i,[e+n*o,t-n*a]}return s.invert=function(o,a){return[(o-e)/n*r,(t-a)/n*i]},s}function P3(n,e,t,r,i,s){if(!s)return TP(n,e,t,r,i);var o=dt(s),a=at(s),c=o*n,f=a*n,p=o/n,g=a/n,v=(a*t-o*e)/n,x=(a*e+o*t)/n;function T(S,E){return S*=r,E*=i,[c*S-f*E+e,t-f*S-c*E]}return T.invert=function(S,E){return[r*(p*S-g*E+v),i*(x-g*S-p*E)]},T}function wP(n){return SP(function(){return n})()}function SP(n){var e,t=150,r=480,i=250,s=0,o=0,a=0,c=0,f=0,p,g=0,v=1,x=1,T=null,S=_3,E=null,N,P,B,L=R3,k=.5,q,I,U,j,J;function Q(Y){return U(Y[0]*ct,Y[1]*ct)}function K(Y){return Y=U.invert(Y[0],Y[1]),Y&&[Y[0]*Nn,Y[1]*Nn]}Q.stream=function(Y){return j&&J===Y?j:j=bP(xP(p)(S(q(L(J=Y)))))},Q.preclip=function(Y){return arguments.length?(S=Y,T=void 0,oe()):S},Q.postclip=function(Y){return arguments.length?(L=Y,E=N=P=B=null,oe()):L},Q.clipAngle=function(Y){return arguments.length?(S=+Y?tP(T=Y*ct):(T=null,_3),oe()):T*Nn},Q.clipExtent=function(Y){return arguments.length?(L=Y==null?(E=N=P=B=null,R3):rP(E=+Y[0][0],N=+Y[0][1],P=+Y[1][0],B=+Y[1][1]),oe()):E==null?null:[[E,N],[P,B]]},Q.scale=function(Y){return arguments.length?(t=+Y,te()):t},Q.translate=function(Y){return arguments.length?(r=+Y[0],i=+Y[1],te()):[r,i]},Q.center=function(Y){return arguments.length?(s=Y[0]%360*ct,o=Y[1]%360*ct,te()):[s*Nn,o*Nn]},Q.rotate=function(Y){return arguments.length?(a=Y[0]%360*ct,c=Y[1]%360*ct,f=Y.length>2?Y[2]%360*ct:0,te()):[a*Nn,c*Nn,f*Nn]},Q.angle=function(Y){return arguments.length?(g=Y%360*ct,te()):g*Nn},Q.reflectX=function(Y){return arguments.length?(v=Y?-1:1,te()):v<0},Q.reflectY=function(Y){return arguments.length?(x=Y?-1:1,te()):x<0},Q.precision=function(Y){return arguments.length?(q=M3(I,k=Y*Y),oe()):so(k)},Q.fitExtent=function(Y,ae){return G4(Q,Y,ae)},Q.fitSize=function(Y,ae){return pP(Q,Y,ae)},Q.fitWidth=function(Y,ae){return mP(Q,Y,ae)},Q.fitHeight=function(Y,ae){return gP(Q,Y,ae)};function te(){var Y=P3(t,0,0,v,x,g).apply(null,e(s,o)),ae=P3(t,r-Y[0],i-Y[1],v,x,g);return p=O4(a,c,f),I=Im(e,ae),U=Im(p,I),q=M3(I,k),oe()}function oe(){return j=J=null,Q}return function(){return e=n.apply(this,arguments),Q.invert=e.invert&&K,te()}}function EP(n){return function(e,t){var r=so(e*e+t*t),i=n(r),s=at(i),o=dt(i);return[Si(e*s,r*o),oo(r&&t*s/r)]}}function w1(n,e){return[n,D9(O9((Ir+e)/2))]}w1.invert=function(n,e){return[n,2*_1(B9(e))-Ir]};function V4(n,e){var t=dt(e),r=1+dt(n)*t;return[t*at(n)/r,at(e)/r]}V4.invert=EP(function(n){return 2*_1(n)});function RP(){return wP(V4).scale(250).clipAngle(142)}function zm(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function CP(n){if(Array.isArray(n))return n}function NP(n){if(Array.isArray(n))return zm(n)}function dA(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function MP(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function PP(n,e,t){return e=wh(e),GP(n,j4()?Reflect.construct(e,[],wh(n).constructor):e.apply(n,t))}function z4(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function BP(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function bt(n,e){return n.get(dA(n,e))}function wo(n,e,t){z4(n,e),e.set(n,t)}function So(n,e,t){return n.set(dA(n,e),t),t}function DP(n,e){z4(n,e),e.add(n)}function LP(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,H4(r.key),r)}}function OP(n,e,t){return e&&LP(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function hl(n,e,t){return(e=H4(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function wh(n){return wh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},wh(n)}function FP(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&jm(n,e)}function j4(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(j4=function(){return!!n})()}function IP(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function kP(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function UP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function qP(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GP(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return MP(n)}function jm(n,e){return jm=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},jm(n,e)}function B0(n,e){return CP(n)||kP(n,e)||W4(n,e)||UP()}function $4(n){return NP(n)||IP(n)||W4(n)||qP()}function VP(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}function H4(n){var e=VP(n,"string");return typeof e=="symbol"?e:e+""}function W4(n,e){if(n){if(typeof n=="string")return zm(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?zm(n,e):void 0}}var Q4=function(e){e instanceof Array?e.forEach(Q4):(e.map&&e.map.dispose(),e.dispose())},X4=function(e){e.geometry&&e.geometry.dispose(),e.material&&Q4(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(X4)},B3=function(e){if(e&&e.children)for(;e.children.length;){var t=e.children[0];e.remove(t),X4(t)}};function Y4(n,e,t){var r=(90-n)*Math.PI/180,i=(90-e)*Math.PI/180;return{x:t*Math.sin(r)*Math.cos(i),y:t*Math.cos(r),z:t*Math.sin(r)*Math.sin(i)}}function zP(n){var e=n.x,t=n.y,r=n.z,i=Math.sqrt(e*e+t*t+r*r),s=Math.acos(t/i),o=Math.atan2(r,e);return{lat:90-s*180/Math.PI,lng:90-o*180/Math.PI-(o<-Math.PI/2?360:0),r:i}}function da(n){return n*Math.PI/180}var K4=function(e){return 1-(w1(0,(.5-e)*Math.PI)[1]/Math.PI+1)/2},zd=function(e){return Math.max(0,Math.min(1,K4(e)))},D3=function(e){return .5-w1.invert(0,(2*(1-e)-1)*Math.PI)[1]/Math.PI},jP=function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=io().domain([1,0]).range([t,r]).clamp(!0),s=io().domain([zd(t),zd(r)]).range([1,0]).clamp(!0),o=function(g){return s(zd(i(g)))},a=e.array,c=0,f=a.length;c<f;c+=2)a[c+1]=o(a[c+1]);e.needsUpdate=!0},L3=function(e,t,r,i){var s=Math.pow(2,e),o=Math.max(0,Math.min(s-1,Math.floor((r+180)*s/360))),a=(90-i)/180;t&&(a=Math.max(0,Math.min(1,K4(a))));var c=Math.floor(a*s);return[o,c]},$m=function(e,t){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,a=[],c=Math.pow(2,e),f=360/c,p=180/c,g=s===void 0?c-1:s,v=o===void 0?c-1:o,x=r,T=Math.min(c-1,g);x<=T;x++)for(var S=i,E=Math.min(c-1,v);S<=E;S++){var N=S,P=p;if(t){N=S===0?S:D3(S/c)*c;var B=S+1===c?S+1:D3((S+1)/c)*c;P=(B-N)*180/c}var L=-180+(x+.5)*f,k=90-(N*180/c+P/2),q=P;a.push({x,y:S,lng:L,lat:k,latLen:q})}return a},$P=6,HP=7,WP=3,QP=90,hs=new WeakMap,Oo=new WeakMap,jd=new WeakMap,Bc=new WeakMap,di=new WeakMap,Sh=new WeakMap,jl=new WeakMap,pa=new WeakMap,Dc=new WeakSet,XP=(function(n){function e(t){var r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=i.tileUrl,o=i.minLevel,a=o===void 0?0:o,c=i.maxLevel,f=c===void 0?17:c,p=i.mercatorProjection,g=p===void 0?!0:p;return BP(this,e),r=PP(this,e),DP(r,Dc),wo(r,hs,void 0),wo(r,Oo,void 0),wo(r,jd,void 0),wo(r,Bc,void 0),wo(r,di,{}),wo(r,Sh,void 0),wo(r,jl,void 0),wo(r,pa,void 0),hl(r,"minLevel",void 0),hl(r,"maxLevel",void 0),hl(r,"thresholds",$4(new Array(30)).map(function(v,x){return 8/Math.pow(2,x)})),hl(r,"curvatureResolution",5),hl(r,"tileMargin",0),hl(r,"clearTiles",function(){Object.values(bt(di,r)).forEach(function(v){v.forEach(function(x){x.obj&&(r.remove(x.obj),B3(x.obj),delete x.obj)})}),So(di,r,{})}),So(hs,r,t),r.tileUrl=s,So(Oo,r,g),r.minLevel=a,r.maxLevel=f,r.level=0,r.add(So(pa,r,new gn(new Jo(bt(hs,r)*.99,180,90),new ds({color:0})))),bt(pa,r).visible=!1,bt(pa,r).material.polygonOffset=!0,bt(pa,r).material.polygonOffsetUnits=3,bt(pa,r).material.polygonOffsetFactor=1,r}return FP(e,n),OP(e,[{key:"tileUrl",get:function(){return bt(jd,this)},set:function(r){So(jd,this,r),this.updatePov(bt(jl,this))}},{key:"level",get:function(){return bt(Bc,this)},set:function(r){var i,s=this;bt(di,this)[r]||dA(Dc,this,YP).call(this,r);var o=bt(Bc,this);if(So(Bc,this,r),!(r===o||o===void 0)){if(bt(pa,this).visible=r>0,bt(di,this)[r].forEach(function(c){return c.obj&&(c.obj.material.depthWrite=!0)}),o<r&&((i=bt(di,this)[o])===null||i===void 0||i.forEach(function(c){return c.obj&&(c.obj.material.depthWrite=!1)})),o>r)for(var a=r+1;a<=o;a++)bt(di,this)[a]&&bt(di,this)[a].forEach(function(c){c.obj&&(s.remove(c.obj),B3(c.obj),delete c.obj)});dA(Dc,this,O3).call(this)}}},{key:"updatePov",value:function(r){var i=this;if(!(!r||!(r instanceof Hg))){So(jl,this,r);var s;if(So(Sh,this,function(p){if(!p.hullPnts){var g=360/Math.pow(2,i.level),v=p.lng,x=p.lat,T=p.latLen,S=v-g/2,E=v+g/2,N=x-T/2,P=x+T/2;p.hullPnts=[[x,v],[N,S],[P,S],[N,E],[P,E]].map(function(B){var L=B0(B,2),k=L[0],q=L[1];return Y4(k,q,bt(hs,i))}).map(function(B){var L=B.x,k=B.y,q=B.z;return new ge(L,k,q)})}return s||(s=new cx,r.updateMatrix(),r.updateMatrixWorld(),s.setFromProjectionMatrix(new dn().multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse))),p.hullPnts.some(function(B){return s.containsPoint(B.clone().applyMatrix4(i.matrixWorld))})}),this.tileUrl){var o=r.position.clone(),a=o.distanceTo(this.getWorldPosition(new ge)),c=(a-bt(hs,this))/bt(hs,this),f=this.thresholds.findIndex(function(p){return p&&p<=c});this.level=Math.min(this.maxLevel,Math.max(this.minLevel,f<0?this.thresholds.length:f)),dA(Dc,this,O3).call(this)}}}}])})(Os);function YP(n){var e=this;if(n>HP){bt(di,this)[n]=[];return}var t=bt(di,this)[n]=$m(n,bt(Oo,this));t.forEach(function(r){return r.centroid=Y4(r.lat,r.lng,bt(hs,e))}),t.octree=u4().x(function(r){return r.centroid.x}).y(function(r){return r.centroid.y}).z(function(r){return r.centroid.z}).addAll(t)}function O3(){var n=this;if(!(!this.tileUrl||this.level===void 0||!bt(di,this).hasOwnProperty(this.level))&&!(!bt(Sh,this)&&this.level>$P)){var e=bt(di,this)[this.level];if(bt(jl,this)){var t=this.worldToLocal(bt(jl,this).position.clone());if(e.octree){var r,i=this.worldToLocal(bt(jl,this).position.clone()),s=(i.length()-bt(hs,this))*WP;e=(r=e.octree).findAllWithinRadius.apply(r,$4(i).concat([s]))}else{var o=zP(t),a=(o.r/bt(hs,this)-1)*QP,c=a/Math.cos(da(o.lat)),f=[o.lng-c,o.lng+c],p=[o.lat+a,o.lat-a],g=L3(this.level,bt(Oo,this),f[0],p[0]),v=B0(g,2),x=v[0],T=v[1],S=L3(this.level,bt(Oo,this),f[1],p[1]),E=B0(S,2),N=E[0],P=E[1];!e.record&&(e.record={});var B=e.record;if(!B.hasOwnProperty("".concat(Math.round((x+N)/2),"_").concat(Math.round((T+P)/2))))e=$m(this.level,bt(Oo,this),x,T,N,P).map(function(U){var j="".concat(U.x,"_").concat(U.y);return B.hasOwnProperty(j)?B[j]:(B[j]=U,e.push(U),U)});else{for(var L=[],k=x;k<=N;k++)for(var q=T;q<=P;q++){var I="".concat(k,"_").concat(q);B.hasOwnProperty(I)||(B[I]=$m(this.level,bt(Oo,this),k,q,k,q)[0],e.push(B[I])),L.push(B[I])}e=L}}}e.filter(function(U){return!U.obj}).filter(bt(Sh,this)||function(){return!0}).forEach(function(U){var j=U.x,J=U.y,Q=U.lng,K=U.lat,te=U.latLen,oe=360/Math.pow(2,n.level);if(!U.obj){var Y=oe*(1-n.tileMargin),ae=te*(1-n.tileMargin),he=da(Q),xe=da(-K),me=new gn(new Jo(bt(hs,n),Math.ceil(Y/n.curvatureResolution),Math.ceil(ae/n.curvatureResolution),da(90-Y/2)+he,da(Y),da(90-ae/2)+xe,da(ae)),new ho);if(bt(Oo,n)){var Oe=[K+te/2,K-te/2].map(function(Ft){return .5-Ft/180}),ke=B0(Oe,2),Ke=ke[0],Ye=ke[1];jP(me.geometry.attributes.uv,Ke,Ye)}U.obj=me}U.loading||(U.loading=!0,new Wg().load(n.tileUrl(j,J,n.level),function(Ft){var mt=U.obj;mt&&(Ft.colorSpace=XA,mt.material.map=Ft,mt.material.color=null,mt.material.needsUpdate=!0,n.add(mt)),U.loading=!1}))})}}function KP(n,e,t=2){const r=e&&e.length,i=r?e[0]*t:n.length;let s=Z4(n,0,i,t,!0);const o=[];if(!s||s.next===s.prev)return o;let a,c,f;if(r&&(s=nB(n,e,s,t)),n.length>80*t){a=n[0],c=n[1];let p=a,g=c;for(let v=t;v<i;v+=t){const x=n[v],T=n[v+1];x<a&&(a=x),T<c&&(c=T),x>p&&(p=x),T>g&&(g=T)}f=Math.max(p-a,g-c),f=f!==0?32767/f:0}return DA(s,o,t,a,c,f,0),o}function Z4(n,e,t,r,i){let s;if(i===fB(n,e,t,r)>0)for(let o=e;o<t;o+=r)s=F3(o/r|0,n[o],n[o+1],s);else for(let o=t-r;o>=e;o-=r)s=F3(o/r|0,n[o],n[o+1],s);return s&&su(s,s.next)&&(OA(s),s=s.next),s}function Wa(n,e){if(!n)return n;e||(e=n);let t=n,r;do if(r=!1,!t.steiner&&(su(t,t.next)||En(t.prev,t,t.next)===0)){if(OA(t),t=e=t.prev,t===t.next)break;r=!0}else t=t.next;while(r||t!==e);return e}function DA(n,e,t,r,i,s,o){if(!n)return;!o&&s&&aB(n,r,i,s);let a=n;for(;n.prev!==n.next;){const c=n.prev,f=n.next;if(s?JP(n,r,i,s):ZP(n)){e.push(c.i,n.i,f.i),OA(n),n=f.next,a=f.next;continue}if(n=f,n===a){o?o===1?(n=eB(Wa(n),e),DA(n,e,t,r,i,s,2)):o===2&&tB(n,e,t,r,i,s):DA(Wa(n),e,t,r,i,s,1);break}}}function ZP(n){const e=n.prev,t=n,r=n.next;if(En(e,t,r)>=0)return!1;const i=e.x,s=t.x,o=r.x,a=e.y,c=t.y,f=r.y,p=Math.min(i,s,o),g=Math.min(a,c,f),v=Math.max(i,s,o),x=Math.max(a,c,f);let T=r.next;for(;T!==e;){if(T.x>=p&&T.x<=v&&T.y>=g&&T.y<=x&&nA(i,a,s,c,o,f,T.x,T.y)&&En(T.prev,T,T.next)>=0)return!1;T=T.next}return!0}function JP(n,e,t,r){const i=n.prev,s=n,o=n.next;if(En(i,s,o)>=0)return!1;const a=i.x,c=s.x,f=o.x,p=i.y,g=s.y,v=o.y,x=Math.min(a,c,f),T=Math.min(p,g,v),S=Math.max(a,c,f),E=Math.max(p,g,v),N=Hm(x,T,e,t,r),P=Hm(S,E,e,t,r);let B=n.prevZ,L=n.nextZ;for(;B&&B.z>=N&&L&&L.z<=P;){if(B.x>=x&&B.x<=S&&B.y>=T&&B.y<=E&&B!==i&&B!==o&&nA(a,p,c,g,f,v,B.x,B.y)&&En(B.prev,B,B.next)>=0||(B=B.prevZ,L.x>=x&&L.x<=S&&L.y>=T&&L.y<=E&&L!==i&&L!==o&&nA(a,p,c,g,f,v,L.x,L.y)&&En(L.prev,L,L.next)>=0))return!1;L=L.nextZ}for(;B&&B.z>=N;){if(B.x>=x&&B.x<=S&&B.y>=T&&B.y<=E&&B!==i&&B!==o&&nA(a,p,c,g,f,v,B.x,B.y)&&En(B.prev,B,B.next)>=0)return!1;B=B.prevZ}for(;L&&L.z<=P;){if(L.x>=x&&L.x<=S&&L.y>=T&&L.y<=E&&L!==i&&L!==o&&nA(a,p,c,g,f,v,L.x,L.y)&&En(L.prev,L,L.next)>=0)return!1;L=L.nextZ}return!0}function eB(n,e){let t=n;do{const r=t.prev,i=t.next.next;!su(r,i)&&eT(r,t,t.next,i)&&LA(r,i)&&LA(i,r)&&(e.push(r.i,t.i,i.i),OA(t),OA(t.next),t=n=i),t=t.next}while(t!==n);return Wa(t)}function tB(n,e,t,r,i,s){let o=n;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&AB(o,a)){let c=tT(o,a);o=Wa(o,o.next),c=Wa(c,c.next),DA(o,e,t,r,i,s,0),DA(c,e,t,r,i,s,0);return}a=a.next}o=o.next}while(o!==n)}function nB(n,e,t,r){const i=[];for(let s=0,o=e.length;s<o;s++){const a=e[s]*r,c=s<o-1?e[s+1]*r:n.length,f=Z4(n,a,c,r,!1);f===f.next&&(f.steiner=!0),i.push(uB(f))}i.sort(rB);for(let s=0;s<i.length;s++)t=iB(i[s],t);return t}function rB(n,e){let t=n.x-e.x;if(t===0&&(t=n.y-e.y,t===0)){const r=(n.next.y-n.y)/(n.next.x-n.x),i=(e.next.y-e.y)/(e.next.x-e.x);t=r-i}return t}function iB(n,e){const t=sB(n,e);if(!t)return e;const r=tT(t,n);return Wa(r,r.next),Wa(t,t.next)}function sB(n,e){let t=e;const r=n.x,i=n.y;let s=-1/0,o;if(su(n,t))return t;do{if(su(n,t.next))return t.next;if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){const g=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(g<=r&&g>s&&(s=g,o=t.x<t.next.x?t:t.next,g===r))return o}t=t.next}while(t!==e);if(!o)return null;const a=o,c=o.x,f=o.y;let p=1/0;t=o;do{if(r>=t.x&&t.x>=c&&r!==t.x&&J4(i<f?r:s,i,c,f,i<f?s:r,i,t.x,t.y)){const g=Math.abs(i-t.y)/(r-t.x);LA(t,n)&&(g<p||g===p&&(t.x>o.x||t.x===o.x&&oB(o,t)))&&(o=t,p=g)}t=t.next}while(t!==a);return o}function oB(n,e){return En(n.prev,n,e.prev)<0&&En(e.next,n,n.next)<0}function aB(n,e,t,r){let i=n;do i.z===0&&(i.z=Hm(i.x,i.y,e,t,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==n);i.prevZ.nextZ=null,i.prevZ=null,lB(i)}function lB(n){let e,t=1;do{let r=n,i;n=null;let s=null;for(e=0;r;){e++;let o=r,a=0;for(let f=0;f<t&&(a++,o=o.nextZ,!!o);f++);let c=t;for(;a>0||c>0&&o;)a!==0&&(c===0||!o||r.z<=o.z)?(i=r,r=r.nextZ,a--):(i=o,o=o.nextZ,c--),s?s.nextZ=i:n=i,i.prevZ=s,s=i;r=o}s.nextZ=null,t*=2}while(e>1);return n}function Hm(n,e,t,r,i){return n=(n-t)*i|0,e=(e-r)*i|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function uB(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function J4(n,e,t,r,i,s,o,a){return(i-o)*(e-a)>=(n-o)*(s-a)&&(n-o)*(r-a)>=(t-o)*(e-a)&&(t-o)*(s-a)>=(i-o)*(r-a)}function nA(n,e,t,r,i,s,o,a){return!(n===o&&e===a)&&J4(n,e,t,r,i,s,o,a)}function AB(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!cB(n,e)&&(LA(n,e)&&LA(e,n)&&hB(n,e)&&(En(n.prev,n,e.prev)||En(n,e.prev,e))||su(n,e)&&En(n.prev,n,n.next)>0&&En(e.prev,e,e.next)>0)}function En(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function su(n,e){return n.x===e.x&&n.y===e.y}function eT(n,e,t,r){const i=Oc(En(n,e,t)),s=Oc(En(n,e,r)),o=Oc(En(t,r,n)),a=Oc(En(t,r,e));return!!(i!==s&&o!==a||i===0&&Lc(n,t,e)||s===0&&Lc(n,r,e)||o===0&&Lc(t,n,r)||a===0&&Lc(t,e,r))}function Lc(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function Oc(n){return n>0?1:n<0?-1:0}function cB(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&eT(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function LA(n,e){return En(n.prev,n,n.next)<0?En(n,e,n.next)>=0&&En(n,n.prev,e)>=0:En(n,e,n.prev)<0||En(n,n.next,e)<0}function hB(n,e){let t=n,r=!1;const i=(n.x+e.x)/2,s=(n.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next;while(t!==n);return r}function tT(n,e){const t=Wm(n.i,n.x,n.y),r=Wm(e.i,e.x,e.y),i=n.next,s=e.prev;return n.next=e,e.prev=n,t.next=i,i.prev=t,r.next=t,t.prev=r,s.next=r,r.prev=s,r}function F3(n,e,t,r){const i=Wm(n,e,t);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function OA(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Wm(n,e,t){return{i:n,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function fB(n,e,t,r){let i=0;for(let s=e,o=t-r;s<t;s+=r)i+=(n[o]-n[s])*(n[s+1]+n[o+1]),o=s;return i}function Eh(n){const e=[],t=[],r=n[0][0].length;let i=0,s=0;for(const o of n){for(const a of o)for(let c=0;c<r;c++)e.push(a[c]);s&&(i+=s,t.push(i)),s=o.length}return{vertices:e,holes:t,dimensions:r}}function Qm(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function dB(n){if(Array.isArray(n))return n}function pB(n){if(Array.isArray(n))return Qm(n)}function mB(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function gB(n,e,t){return e=Rh(e),EB(n,nT()?Reflect.construct(e,[],Rh(n).constructor):e.apply(n,t))}function yB(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function _B(n,e,t){return Object.defineProperty(n,"prototype",{writable:!1}),n}function vB(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=S1(n))||e){t&&(n=t);var r=0,i=function(){};return{s:i,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,o=!0,a=!1;return{s:function(){t=t.call(n)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{o||t.return==null||t.return()}finally{if(a)throw s}}}}function Rh(n){return Rh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Rh(n)}function bB(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Xm(n,e)}function nT(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(nT=function(){return!!n})()}function xB(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function TB(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function wB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function SB(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function EB(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return mB(n)}function Xm(n,e){return Xm=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Xm(n,e)}function Mu(n,e){return dB(n)||TB(n,e)||S1(n,e)||wB()}function RB(n){return pB(n)||xB(n)||S1(n)||SB()}function S1(n,e){if(n){if(typeof n=="string")return Qm(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Qm(n,e):void 0}}var I3=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=[],i=null;return e.forEach(function(s){if(i){var o=Xo(s,i)*180/Math.PI;if(o>t)for(var a=b1(i,s),c=i.length>2||s.length>2?PA(i[2]||0,s[2]||0):null,f=c?function(v){return[].concat(RB(a(v)),[c(v)])}:a,p=1/Math.ceil(o/t),g=p;g<1;)r.push(f(g)),g+=p}r.push(i=s)}),r},Ym=typeof window<"u"&&window.THREE?window.THREE:{BufferGeometry:Hr,Float32BufferAttribute:Cs},CB=new Ym.BufferGeometry().setAttribute?"setAttribute":"addAttribute",rT=(function(n){function e(t){var r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:5;yB(this,e),r=gB(this,e),r.type="GeoJsonGeometry",r.parameters={geoJson:t,radius:i,resolution:s};var o=({Point:p,MultiPoint:g,LineString:v,MultiLineString:x,Polygon:T,MultiPolygon:S}[t.type]||function(){return[]})(t.coordinates,i),a=[],c=[],f=0;o.forEach(function(E){var N=a.length;Pu({indices:a,vertices:c},E),r.addGroup(N,a.length-N,f++)}),a.length&&r.setIndex(a),c.length&&r[CB]("position",new Ym.Float32BufferAttribute(c,3));function p(E,N){var P=$d(E[1],E[0],N+(E[2]||0)),B=[];return[{vertices:P,indices:B}]}function g(E,N){var P={vertices:[],indices:[]};return E.map(function(B){return p(B,N)}).forEach(function(B){var L=Mu(B,1),k=L[0];Pu(P,k)}),[P]}function v(E,N){for(var P=I3(E,s).map(function(U){var j=Mu(U,3),J=j[0],Q=j[1],K=j[2],te=K===void 0?0:K;return $d(Q,J,N+te)}),B=Eh([P]),L=B.vertices,k=Math.round(L.length/3),q=[],I=1;I<k;I++)q.push(I-1,I);return[{vertices:L,indices:q}]}function x(E,N){var P={vertices:[],indices:[]};return E.map(function(B){return v(B,N)}).forEach(function(B){var L=Mu(B,1),k=L[0];Pu(P,k)}),[P]}function T(E,N){for(var P=E.map(function(Y){return I3(Y,s).map(function(ae){var he=Mu(ae,3),xe=he[0],me=he[1],Oe=he[2],ke=Oe===void 0?0:Oe;return $d(me,xe,N+ke)})}),B=Eh(P),L=B.vertices,k=B.holes,q=k[0]||1/0,I=L.slice(0,q*3),U=L.slice(q*3),j=new Set(k),J=Math.round(L.length/3),Q=[],K=[],te=1;te<J;te++)j.has(te)||(te<q?Q.push(te-1,te):K.push(te-1-q,te-q));var oe=[{indices:Q,vertices:I}];return k.length&&oe.push({indices:K,vertices:U}),oe}function S(E,N){var P={vertices:[],indices:[]},B={vertices:[],indices:[]};E.map(function(k){return T(k,N)}).forEach(function(k){var q=Mu(k,2),I=q[0],U=q[1];Pu(P,I),U&&Pu(B,U)});var L=[P];return B.vertices.length&&L.push(B),L}return r}return bB(e,n),_B(e)})(Ym.BufferGeometry);function Pu(n,e){var t=Math.round(n.vertices.length/3);k3(n.vertices,e.vertices),k3(n.indices,e.indices.map(function(r){return r+t}))}function k3(n,e){var t=vB(e),r;try{for(t.s();!(r=t.n()).done;){var i=r.value;n.push(i)}}catch(s){t.e(s)}finally{t.f()}}function $d(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=(90-n)*Math.PI/180,i=(90-e)*Math.PI/180;return[t*Math.sin(r)*Math.cos(i),t*Math.cos(r),t*Math.sin(r)*Math.sin(i)]}function NB(n,e,t=!0){if(!e||!e.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!n.hasAttribute("position")||!n.hasAttribute("normal")||!n.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function r(o){if(o.normalized||o.isInterleavedBufferAttribute){const a=new Float32Array(o.count*o.itemSize);for(let c=0,f=0;c<o.count;c++)a[f++]=o.getX(c),a[f++]=o.getY(c),o.itemSize>2&&(a[f++]=o.getZ(c));return a}return o.array instanceof Float32Array?o.array:new Float32Array(o.array)}const i=n.index?n.toNonIndexed():n,s=e.generateTangents(r(i.attributes.position),r(i.attributes.normal),r(i.attributes.uv));if(t)for(let o=3;o<s.length;o+=4)s[o]*=-1;return i.setAttribute("tangent",new Hi(s,4)),n!==i&&n.copy(i),n}function MB(n,e=!1){const t=n[0].index!==null,r=new Set(Object.keys(n[0].attributes)),i=new Set(Object.keys(n[0].morphAttributes)),s={},o={},a=n[0].morphTargetsRelative,c=new Hr;let f=0;for(let p=0;p<n.length;++p){const g=n[p];let v=0;if(t!==(g.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+p+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const x in g.attributes){if(!r.has(x))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+p+'. All geometries must have compatible attributes; make sure "'+x+'" attribute exists among all geometries, or in none of them.'),null;s[x]===void 0&&(s[x]=[]),s[x].push(g.attributes[x]),v++}if(v!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+p+". Make sure all geometries have the same number of attributes."),null;if(a!==g.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+p+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const x in g.morphAttributes){if(!i.has(x))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+p+".  .morphAttributes must be consistent throughout all geometries."),null;o[x]===void 0&&(o[x]=[]),o[x].push(g.morphAttributes[x])}if(e){let x;if(t)x=g.index.count;else if(g.attributes.position!==void 0)x=g.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+p+". The geometry must have either an index or a position attribute"),null;c.addGroup(f,x,p),f+=x}}if(t){let p=0;const g=[];for(let v=0;v<n.length;++v){const x=n[v].index;for(let T=0;T<x.count;++T)g.push(x.getX(T)+p);p+=n[v].attributes.position.count}c.setIndex(g)}for(const p in s){const g=Km(s[p]);if(!g)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+p+" attribute."),null;c.setAttribute(p,g)}for(const p in o){const g=o[p][0].length;if(g===0)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[p]=[];for(let v=0;v<g;++v){const x=[];for(let S=0;S<o[p].length;++S)x.push(o[p][S][v]);const T=Km(x);if(!T)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+p+" morphAttribute."),null;c.morphAttributes[p].push(T)}}return c}function Km(n){let e,t,r,i=-1,s=0;for(let f=0;f<n.length;++f){const p=n[f];if(e===void 0&&(e=p.array.constructor),e!==p.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=p.itemSize),t!==p.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(r===void 0&&(r=p.normalized),r!==p.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(i===-1&&(i=p.gpuType),i!==p.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;s+=p.count*t}const o=new e(s),a=new Hi(o,t,r);let c=0;for(let f=0;f<n.length;++f){const p=n[f];if(p.isInterleavedBufferAttribute){const g=c/t;for(let v=0,x=p.count;v<x;v++)for(let T=0;T<t;T++){const S=p.getComponent(v,T);a.setComponent(v+g,T,S)}}else o.set(p.array,c);c+=p.count*t}return i!==void 0&&(a.gpuType=i),a}function PB(n){return n.isInstancedInterleavedBufferAttribute||n.isInterleavedBufferAttribute?Ch(n):n.isInstancedBufferAttribute?new zo().copy(n):new Hi().copy(n)}function BB(n){let e,t=0,r=0;for(let f=0,p=n.length;f<p;++f){const g=n[f];if(e===void 0&&(e=g.array.constructor),e!==g.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;t+=g.array.length,r+=g.itemSize}const i=new hx(new e(t),r);let s=0;const o=[],a=["getX","getY","getZ","getW"],c=["setX","setY","setZ","setW"];for(let f=0,p=n.length;f<p;f++){const g=n[f],v=g.itemSize,x=g.count,T=new qo(i,v,s,g.normalized);o.push(T),s+=v;for(let S=0;S<x;S++)for(let E=0;E<v;E++)T[c[E]](S,g[a[E]](S))}return o}function Ch(n){const e=n.data.array.constructor,t=n.count,r=n.itemSize,i=n.normalized,s=new e(t*r);let o;n.isInstancedInterleavedBufferAttribute?o=new zo(s,r,i,n.meshPerAttribute):o=new Hi(s,r,i);for(let a=0;a<t;a++)o.setX(a,n.getX(a)),r>=2&&o.setY(a,n.getY(a)),r>=3&&o.setZ(a,n.getZ(a)),r>=4&&o.setW(a,n.getW(a));return o}function DB(n){const e=n.attributes,t=n.morphTargets,r=new Map;for(const i in e){const s=e[i];s.isInterleavedBufferAttribute&&(r.has(s)||r.set(s,Ch(s)),e[i]=r.get(s))}for(const i in t){const s=t[i];s.isInterleavedBufferAttribute&&(r.has(s)||r.set(s,Ch(s)),t[i]=r.get(s))}}function LB(n){let e=0;for(const r in n.attributes){const i=n.getAttribute(r);e+=i.count*i.itemSize*i.array.BYTES_PER_ELEMENT}const t=n.getIndex();return e+=t?t.count*t.itemSize*t.array.BYTES_PER_ELEMENT:0,e}function OB(n,e=1e-4){e=Math.max(e,Number.EPSILON);const t={},r=n.getIndex(),i=n.getAttribute("position"),s=r?r.count:i.count;let o=0;const a=Object.keys(n.attributes),c={},f={},p=[],g=["getX","getY","getZ","getW"],v=["setX","setY","setZ","setW"];for(let P=0,B=a.length;P<B;P++){const L=a[P],k=n.attributes[L];c[L]=new k.constructor(new k.array.constructor(k.count*k.itemSize),k.itemSize,k.normalized);const q=n.morphAttributes[L];q&&(f[L]||(f[L]=[]),q.forEach((I,U)=>{const j=new I.array.constructor(I.count*I.itemSize);f[L][U]=new I.constructor(j,I.itemSize,I.normalized)}))}const x=e*.5,T=Math.log10(1/e),S=Math.pow(10,T),E=x*S;for(let P=0;P<s;P++){const B=r?r.getX(P):P;let L="";for(let k=0,q=a.length;k<q;k++){const I=a[k],U=n.getAttribute(I),j=U.itemSize;for(let J=0;J<j;J++)L+=`${~~(U[g[J]](B)*S+E)},`}if(L in t)p.push(t[L]);else{for(let k=0,q=a.length;k<q;k++){const I=a[k],U=n.getAttribute(I),j=n.morphAttributes[I],J=U.itemSize,Q=c[I],K=f[I];for(let te=0;te<J;te++){const oe=g[te],Y=v[te];if(Q[Y](o,U[oe](B)),j)for(let ae=0,he=j.length;ae<he;ae++)K[ae][Y](o,j[ae][oe](B))}}t[L]=o,p.push(o),o++}}const N=n.clone();for(const P in n.attributes){const B=c[P];if(N.setAttribute(P,new B.constructor(B.array.slice(0,o*B.itemSize),B.itemSize,B.normalized)),P in f)for(let L=0;L<f[P].length;L++){const k=f[P][L];N.morphAttributes[P][L]=new k.constructor(k.array.slice(0,o*k.itemSize),k.itemSize,k.normalized)}}return N.setIndex(p),N}function FB(n,e){if(e===FR)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===x_||e===IR){let t=n.getIndex();if(t===null){const o=[],a=n.getAttribute("position");if(a!==void 0){for(let c=0;c<a.count;c++)o.push(c);n.setIndex(o),t=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const r=t.count-2,i=[];if(e===x_)for(let o=1;o<=r;o++)i.push(t.getX(0)),i.push(t.getX(o)),i.push(t.getX(o+1));else for(let o=0;o<r;o++)o%2===0?(i.push(t.getX(o)),i.push(t.getX(o+1)),i.push(t.getX(o+2))):(i.push(t.getX(o+2)),i.push(t.getX(o+1)),i.push(t.getX(o)));i.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=n.clone();return s.setIndex(i),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}function IB(n){const e=new ge,t=new ge,r=new ge,i=new ge,s=new ge,o=new ge,a=new ge,c=new ge,f=new ge;function p(me,Oe,ke,Ke,Ye,Ft,mt,Lt){e.fromBufferAttribute(Oe,Ye),t.fromBufferAttribute(Oe,Ft),r.fromBufferAttribute(Oe,mt);const Wt=me.morphTargetInfluences;if(ke&&Wt){a.set(0,0,0),c.set(0,0,0),f.set(0,0,0);for(let Pn=0,Gn=ke.length;Pn<Gn;Pn++){const bn=Wt[Pn],xn=ke[Pn];bn!==0&&(i.fromBufferAttribute(xn,Ye),s.fromBufferAttribute(xn,Ft),o.fromBufferAttribute(xn,mt),Ke?(a.addScaledVector(i,bn),c.addScaledVector(s,bn),f.addScaledVector(o,bn)):(a.addScaledVector(i.sub(e),bn),c.addScaledVector(s.sub(t),bn),f.addScaledVector(o.sub(r),bn)))}e.add(a),t.add(c),r.add(f)}me.isSkinnedMesh&&(me.applyBoneTransform(Ye,e),me.applyBoneTransform(Ft,t),me.applyBoneTransform(mt,r)),Lt[Ye*3+0]=e.x,Lt[Ye*3+1]=e.y,Lt[Ye*3+2]=e.z,Lt[Ft*3+0]=t.x,Lt[Ft*3+1]=t.y,Lt[Ft*3+2]=t.z,Lt[mt*3+0]=r.x,Lt[mt*3+1]=r.y,Lt[mt*3+2]=r.z}const g=n.geometry,v=n.material;let x,T,S;const E=g.index,N=g.attributes.position,P=g.morphAttributes.position,B=g.morphTargetsRelative,L=g.attributes.normal,k=g.morphAttributes.position,q=g.groups,I=g.drawRange;let U,j,J,Q,K,te,oe;const Y=new Float32Array(N.count*N.itemSize),ae=new Float32Array(L.count*L.itemSize);if(E!==null)if(Array.isArray(v))for(U=0,J=q.length;U<J;U++)for(K=q[U],te=Math.max(K.start,I.start),oe=Math.min(K.start+K.count,I.start+I.count),j=te,Q=oe;j<Q;j+=3)x=E.getX(j),T=E.getX(j+1),S=E.getX(j+2),p(n,N,P,B,x,T,S,Y),p(n,L,k,B,x,T,S,ae);else for(te=Math.max(0,I.start),oe=Math.min(E.count,I.start+I.count),U=te,J=oe;U<J;U+=3)x=E.getX(U),T=E.getX(U+1),S=E.getX(U+2),p(n,N,P,B,x,T,S,Y),p(n,L,k,B,x,T,S,ae);else if(Array.isArray(v))for(U=0,J=q.length;U<J;U++)for(K=q[U],te=Math.max(K.start,I.start),oe=Math.min(K.start+K.count,I.start+I.count),j=te,Q=oe;j<Q;j+=3)x=j,T=j+1,S=j+2,p(n,N,P,B,x,T,S,Y),p(n,L,k,B,x,T,S,ae);else for(te=Math.max(0,I.start),oe=Math.min(N.count,I.start+I.count),U=te,J=oe;U<J;U+=3)x=U,T=U+1,S=U+2,p(n,N,P,B,x,T,S,Y),p(n,L,k,B,x,T,S,ae);const he=new Cs(Y,3),xe=new Cs(ae,3);return{positionAttribute:N,normalAttribute:L,morphedPositionAttribute:he,morphedNormalAttribute:xe}}function kB(n){if(n.groups.length===0)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),n;let e=n.groups;if(e=e.sort((o,a)=>o.materialIndex!==a.materialIndex?o.materialIndex-a.materialIndex:o.start-a.start),n.getIndex()===null){const o=n.getAttribute("position"),a=[];for(let c=0;c<o.count;c+=3)a.push(c,c+1,c+2);n.setIndex(a)}const t=n.getIndex(),r=[];for(let o=0;o<e.length;o++){const a=e[o],c=a.start,f=c+a.count;for(let p=c;p<f;p++)r.push(t.getX(p))}n.dispose(),n.setIndex(r);let i=0;for(let o=0;o<e.length;o++){const a=e[o];a.start=i,i+=a.count}let s=e[0];n.groups=[s];for(let o=1;o<e.length;o++){const a=e[o];s.materialIndex===a.materialIndex?s.count+=a.count:(s=a,n.groups.push(s))}return n}function UB(n,e=Math.PI/3){const t=Math.cos(e),r=(1+1e-10)*100,i=[new ge,new ge,new ge],s=new ge,o=new ge,a=new ge,c=new ge;function f(S){const E=~~(S.x*r),N=~~(S.y*r),P=~~(S.z*r);return`${E},${N},${P}`}const p=n.index?n.toNonIndexed():n,g=p.attributes.position,v={};for(let S=0,E=g.count/3;S<E;S++){const N=3*S,P=i[0].fromBufferAttribute(g,N+0),B=i[1].fromBufferAttribute(g,N+1),L=i[2].fromBufferAttribute(g,N+2);s.subVectors(L,B),o.subVectors(P,B);const k=new ge().crossVectors(s,o).normalize();for(let q=0;q<3;q++){const I=i[q],U=f(I);U in v||(v[U]=[]),v[U].push(k)}}const x=new Float32Array(g.count*3),T=new Hi(x,3,!1);for(let S=0,E=g.count/3;S<E;S++){const N=3*S,P=i[0].fromBufferAttribute(g,N+0),B=i[1].fromBufferAttribute(g,N+1),L=i[2].fromBufferAttribute(g,N+2);s.subVectors(L,B),o.subVectors(P,B),a.crossVectors(s,o).normalize();for(let k=0;k<3;k++){const q=i[k],I=f(q),U=v[I];c.set(0,0,0);for(let j=0,J=U.length;j<J;j++){const Q=U[j];a.dot(Q)>t&&c.add(Q)}c.normalize(),T.setXYZ(N+k,c.x,c.y,c.z)}}return p.setAttribute("normal",T),p}const E1=Object.freeze(Object.defineProperty({__proto__:null,computeMikkTSpaceTangents:NB,computeMorphedAttributes:IB,deepCloneAttribute:PB,deinterleaveAttribute:Ch,deinterleaveGeometry:DB,estimateBytesUsed:LB,interleaveAttributes:BB,mergeAttributes:Km,mergeGeometries:MB,mergeGroups:kB,mergeVertices:OB,toCreasedNormals:UB,toTrianglesDrawMode:FB},Symbol.toStringTag,{value:"Module"}));var be=(function(n){return typeof n=="function"?n:typeof n=="string"?function(e){return e[n]}:function(e){return n}});function Nh(n){"@babel/helpers - typeof";return Nh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nh(n)}var qB=/^\s+/,GB=/\s+$/;function Xe(n,e){if(n=n||"",e=e||{},n instanceof Xe)return n;if(!(this instanceof Xe))return new Xe(n,e);var t=VB(n);this._originalInput=n,this._r=t.r,this._g=t.g,this._b=t.b,this._a=t.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||t.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=t.ok}Xe.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},getLuminance:function(){var e=this.toRgb(),t,r,i,s,o,a;return t=e.r/255,r=e.g/255,i=e.b/255,t<=.03928?s=t/12.92:s=Math.pow((t+.055)/1.055,2.4),r<=.03928?o=r/12.92:o=Math.pow((r+.055)/1.055,2.4),i<=.03928?a=i/12.92:a=Math.pow((i+.055)/1.055,2.4),.2126*s+.7152*o+.0722*a},setAlpha:function(e){return this._a=iT(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=q3(this._r,this._g,this._b);return{h:e.h*360,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=q3(this._r,this._g,this._b),t=Math.round(e.h*360),r=Math.round(e.s*100),i=Math.round(e.v*100);return this._a==1?"hsv("+t+", "+r+"%, "+i+"%)":"hsva("+t+", "+r+"%, "+i+"%, "+this._roundA+")"},toHsl:function(){var e=U3(this._r,this._g,this._b);return{h:e.h*360,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=U3(this._r,this._g,this._b),t=Math.round(e.h*360),r=Math.round(e.s*100),i=Math.round(e.l*100);return this._a==1?"hsl("+t+", "+r+"%, "+i+"%)":"hsla("+t+", "+r+"%, "+i+"%, "+this._roundA+")"},toHex:function(e){return G3(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return HB(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(hn(this._r,255)*100)+"%",g:Math.round(hn(this._g,255)*100)+"%",b:Math.round(hn(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(hn(this._r,255)*100)+"%, "+Math.round(hn(this._g,255)*100)+"%, "+Math.round(hn(this._b,255)*100)+"%)":"rgba("+Math.round(hn(this._r,255)*100)+"%, "+Math.round(hn(this._g,255)*100)+"%, "+Math.round(hn(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:iD[G3(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var t="#"+V3(this._r,this._g,this._b,this._a),r=t,i=this._gradientType?"GradientType = 1, ":"";if(e){var s=Xe(e);r="#"+V3(s._r,s._g,s._b,s._a)}return"progid:DXImageTransform.Microsoft.gradient("+i+"startColorstr="+t+",endColorstr="+r+")"},toString:function(e){var t=!!e;e=e||this._format;var r=!1,i=this._a<1&&this._a>=0,s=!t&&i&&(e==="hex"||e==="hex6"||e==="hex3"||e==="hex4"||e==="hex8"||e==="name");return s?e==="name"&&this._a===0?this.toName():this.toRgbString():(e==="rgb"&&(r=this.toRgbString()),e==="prgb"&&(r=this.toPercentageRgbString()),(e==="hex"||e==="hex6")&&(r=this.toHexString()),e==="hex3"&&(r=this.toHexString(!0)),e==="hex4"&&(r=this.toHex8String(!0)),e==="hex8"&&(r=this.toHex8String()),e==="name"&&(r=this.toName()),e==="hsl"&&(r=this.toHslString()),e==="hsv"&&(r=this.toHsvString()),r||this.toHexString())},clone:function(){return Xe(this.toString())},_applyModification:function(e,t){var r=e.apply(null,[this].concat([].slice.call(t)));return this._r=r._r,this._g=r._g,this._b=r._b,this.setAlpha(r._a),this},lighten:function(){return this._applyModification(YB,arguments)},brighten:function(){return this._applyModification(KB,arguments)},darken:function(){return this._applyModification(ZB,arguments)},desaturate:function(){return this._applyModification(WB,arguments)},saturate:function(){return this._applyModification(QB,arguments)},greyscale:function(){return this._applyModification(XB,arguments)},spin:function(){return this._applyModification(JB,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(nD,arguments)},complement:function(){return this._applyCombination(eD,arguments)},monochromatic:function(){return this._applyCombination(rD,arguments)},splitcomplement:function(){return this._applyCombination(tD,arguments)},triad:function(){return this._applyCombination(z3,[3])},tetrad:function(){return this._applyCombination(z3,[4])}};Xe.fromRatio=function(n,e){if(Nh(n)=="object"){var t={};for(var r in n)n.hasOwnProperty(r)&&(r==="a"?t[r]=n[r]:t[r]=rA(n[r]));n=t}return Xe(n,e)};function VB(n){var e={r:0,g:0,b:0},t=1,r=null,i=null,s=null,o=!1,a=!1;return typeof n=="string"&&(n=lD(n)),Nh(n)=="object"&&(Gs(n.r)&&Gs(n.g)&&Gs(n.b)?(e=zB(n.r,n.g,n.b),o=!0,a=String(n.r).substr(-1)==="%"?"prgb":"rgb"):Gs(n.h)&&Gs(n.s)&&Gs(n.v)?(r=rA(n.s),i=rA(n.v),e=$B(n.h,r,i),o=!0,a="hsv"):Gs(n.h)&&Gs(n.s)&&Gs(n.l)&&(r=rA(n.s),s=rA(n.l),e=jB(n.h,r,s),o=!0,a="hsl"),n.hasOwnProperty("a")&&(t=n.a)),t=iT(t),{ok:o,format:n.format||a,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:t}}function zB(n,e,t){return{r:hn(n,255)*255,g:hn(e,255)*255,b:hn(t,255)*255}}function U3(n,e,t){n=hn(n,255),e=hn(e,255),t=hn(t,255);var r=Math.max(n,e,t),i=Math.min(n,e,t),s,o,a=(r+i)/2;if(r==i)s=o=0;else{var c=r-i;switch(o=a>.5?c/(2-r-i):c/(r+i),r){case n:s=(e-t)/c+(e<t?6:0);break;case e:s=(t-n)/c+2;break;case t:s=(n-e)/c+4;break}s/=6}return{h:s,s:o,l:a}}function jB(n,e,t){var r,i,s;n=hn(n,360),e=hn(e,100),t=hn(t,100);function o(f,p,g){return g<0&&(g+=1),g>1&&(g-=1),g<1/6?f+(p-f)*6*g:g<1/2?p:g<2/3?f+(p-f)*(2/3-g)*6:f}if(e===0)r=i=s=t;else{var a=t<.5?t*(1+e):t+e-t*e,c=2*t-a;r=o(c,a,n+1/3),i=o(c,a,n),s=o(c,a,n-1/3)}return{r:r*255,g:i*255,b:s*255}}function q3(n,e,t){n=hn(n,255),e=hn(e,255),t=hn(t,255);var r=Math.max(n,e,t),i=Math.min(n,e,t),s,o,a=r,c=r-i;if(o=r===0?0:c/r,r==i)s=0;else{switch(r){case n:s=(e-t)/c+(e<t?6:0);break;case e:s=(t-n)/c+2;break;case t:s=(n-e)/c+4;break}s/=6}return{h:s,s:o,v:a}}function $B(n,e,t){n=hn(n,360)*6,e=hn(e,100),t=hn(t,100);var r=Math.floor(n),i=n-r,s=t*(1-e),o=t*(1-i*e),a=t*(1-(1-i)*e),c=r%6,f=[t,o,s,s,a,t][c],p=[a,t,t,o,s,s][c],g=[s,s,a,t,t,o][c];return{r:f*255,g:p*255,b:g*255}}function G3(n,e,t,r){var i=[$i(Math.round(n).toString(16)),$i(Math.round(e).toString(16)),$i(Math.round(t).toString(16))];return r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function HB(n,e,t,r,i){var s=[$i(Math.round(n).toString(16)),$i(Math.round(e).toString(16)),$i(Math.round(t).toString(16)),$i(sT(r))];return i&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)&&s[3].charAt(0)==s[3].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0):s.join("")}function V3(n,e,t,r){var i=[$i(sT(r)),$i(Math.round(n).toString(16)),$i(Math.round(e).toString(16)),$i(Math.round(t).toString(16))];return i.join("")}Xe.equals=function(n,e){return!n||!e?!1:Xe(n).toRgbString()==Xe(e).toRgbString()};Xe.random=function(){return Xe.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function WB(n,e){e=e===0?0:e||10;var t=Xe(n).toHsl();return t.s-=e/100,t.s=ff(t.s),Xe(t)}function QB(n,e){e=e===0?0:e||10;var t=Xe(n).toHsl();return t.s+=e/100,t.s=ff(t.s),Xe(t)}function XB(n){return Xe(n).desaturate(100)}function YB(n,e){e=e===0?0:e||10;var t=Xe(n).toHsl();return t.l+=e/100,t.l=ff(t.l),Xe(t)}function KB(n,e){e=e===0?0:e||10;var t=Xe(n).toRgb();return t.r=Math.max(0,Math.min(255,t.r-Math.round(255*-(e/100)))),t.g=Math.max(0,Math.min(255,t.g-Math.round(255*-(e/100)))),t.b=Math.max(0,Math.min(255,t.b-Math.round(255*-(e/100)))),Xe(t)}function ZB(n,e){e=e===0?0:e||10;var t=Xe(n).toHsl();return t.l-=e/100,t.l=ff(t.l),Xe(t)}function JB(n,e){var t=Xe(n).toHsl(),r=(t.h+e)%360;return t.h=r<0?360+r:r,Xe(t)}function eD(n){var e=Xe(n).toHsl();return e.h=(e.h+180)%360,Xe(e)}function z3(n,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var t=Xe(n).toHsl(),r=[Xe(n)],i=360/e,s=1;s<e;s++)r.push(Xe({h:(t.h+s*i)%360,s:t.s,l:t.l}));return r}function tD(n){var e=Xe(n).toHsl(),t=e.h;return[Xe(n),Xe({h:(t+72)%360,s:e.s,l:e.l}),Xe({h:(t+216)%360,s:e.s,l:e.l})]}function nD(n,e,t){e=e||6,t=t||30;var r=Xe(n).toHsl(),i=360/t,s=[Xe(n)];for(r.h=(r.h-(i*e>>1)+720)%360;--e;)r.h=(r.h+i)%360,s.push(Xe(r));return s}function rD(n,e){e=e||6;for(var t=Xe(n).toHsv(),r=t.h,i=t.s,s=t.v,o=[],a=1/e;e--;)o.push(Xe({h:r,s:i,v:s})),s=(s+a)%1;return o}Xe.mix=function(n,e,t){t=t===0?0:t||50;var r=Xe(n).toRgb(),i=Xe(e).toRgb(),s=t/100,o={r:(i.r-r.r)*s+r.r,g:(i.g-r.g)*s+r.g,b:(i.b-r.b)*s+r.b,a:(i.a-r.a)*s+r.a};return Xe(o)};Xe.readability=function(n,e){var t=Xe(n),r=Xe(e);return(Math.max(t.getLuminance(),r.getLuminance())+.05)/(Math.min(t.getLuminance(),r.getLuminance())+.05)};Xe.isReadable=function(n,e,t){var r=Xe.readability(n,e),i,s;switch(s=!1,i=uD(t),i.level+i.size){case"AAsmall":case"AAAlarge":s=r>=4.5;break;case"AAlarge":s=r>=3;break;case"AAAsmall":s=r>=7;break}return s};Xe.mostReadable=function(n,e,t){var r=null,i=0,s,o,a,c;t=t||{},o=t.includeFallbackColors,a=t.level,c=t.size;for(var f=0;f<e.length;f++)s=Xe.readability(n,e[f]),s>i&&(i=s,r=Xe(e[f]));return Xe.isReadable(n,r,{level:a,size:c})||!o?r:(t.includeFallbackColors=!1,Xe.mostReadable(n,["#fff","#000"],t))};var Zm=Xe.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},iD=Xe.hexNames=sD(Zm);function sD(n){var e={};for(var t in n)n.hasOwnProperty(t)&&(e[n[t]]=t);return e}function iT(n){return n=parseFloat(n),(isNaN(n)||n<0||n>1)&&(n=1),n}function hn(n,e){oD(n)&&(n="100%");var t=aD(n);return n=Math.min(e,Math.max(0,parseFloat(n))),t&&(n=parseInt(n*e,10)/100),Math.abs(n-e)<1e-6?1:n%e/parseFloat(e)}function ff(n){return Math.min(1,Math.max(0,n))}function Kr(n){return parseInt(n,16)}function oD(n){return typeof n=="string"&&n.indexOf(".")!=-1&&parseFloat(n)===1}function aD(n){return typeof n=="string"&&n.indexOf("%")!=-1}function $i(n){return n.length==1?"0"+n:""+n}function rA(n){return n<=1&&(n=n*100+"%"),n}function sT(n){return Math.round(parseFloat(n)*255).toString(16)}function j3(n){return Kr(n)/255}var ki=(function(){var n="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",t="(?:"+e+")|(?:"+n+")",r="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?",i="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?";return{CSS_UNIT:new RegExp(t),rgb:new RegExp("rgb"+r),rgba:new RegExp("rgba"+i),hsl:new RegExp("hsl"+r),hsla:new RegExp("hsla"+i),hsv:new RegExp("hsv"+r),hsva:new RegExp("hsva"+i),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}})();function Gs(n){return!!ki.CSS_UNIT.exec(n)}function lD(n){n=n.replace(qB,"").replace(GB,"").toLowerCase();var e=!1;if(Zm[n])n=Zm[n],e=!0;else if(n=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var t;return(t=ki.rgb.exec(n))?{r:t[1],g:t[2],b:t[3]}:(t=ki.rgba.exec(n))?{r:t[1],g:t[2],b:t[3],a:t[4]}:(t=ki.hsl.exec(n))?{h:t[1],s:t[2],l:t[3]}:(t=ki.hsla.exec(n))?{h:t[1],s:t[2],l:t[3],a:t[4]}:(t=ki.hsv.exec(n))?{h:t[1],s:t[2],v:t[3]}:(t=ki.hsva.exec(n))?{h:t[1],s:t[2],v:t[3],a:t[4]}:(t=ki.hex8.exec(n))?{r:Kr(t[1]),g:Kr(t[2]),b:Kr(t[3]),a:j3(t[4]),format:e?"name":"hex8"}:(t=ki.hex6.exec(n))?{r:Kr(t[1]),g:Kr(t[2]),b:Kr(t[3]),format:e?"name":"hex"}:(t=ki.hex4.exec(n))?{r:Kr(t[1]+""+t[1]),g:Kr(t[2]+""+t[2]),b:Kr(t[3]+""+t[3]),a:j3(t[4]+""+t[4]),format:e?"name":"hex8"}:(t=ki.hex3.exec(n))?{r:Kr(t[1]+""+t[1]),g:Kr(t[2]+""+t[2]),b:Kr(t[3]+""+t[3]),format:e?"name":"hex"}:!1}function uD(n){var e,t;return n=n||{level:"AA",size:"small"},e=(n.level||"AA").toUpperCase(),t=(n.size||"small").toLowerCase(),e!=="AA"&&e!=="AAA"&&(e="AA"),t!=="small"&&t!=="large"&&(t="small"),{level:e,size:t}}function Jm(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function AD(n){if(Array.isArray(n))return n}function cD(n){if(Array.isArray(n))return Jm(n)}function oT(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function hD(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function fD(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function fr(n,e){return n.get(oT(n,e))}function fl(n,e,t){hD(n,e),e.set(n,t)}function Fc(n,e,t){return n.set(oT(n,e),t),t}function dD(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,TD(r.key),r)}}function pD(n,e,t){return e&&dD(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function mD(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function gD(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function yD(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _D(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vD(n,e){return AD(n)||gD(n,e)||aT(n,e)||yD()}function bD(n){return cD(n)||mD(n)||aT(n)||_D()}function xD(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}function TD(n){var e=xD(n,"string");return typeof e=="symbol"?e:e+""}function aT(n,e){if(n){if(typeof n=="string")return Jm(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Jm(n,e):void 0}}var dl=new WeakMap,Bu=new WeakMap,pl=new WeakMap,Hd=new WeakMap,Wd=new WeakMap,Qd=new WeakMap,wD=(function(){function n(){fD(this,n),fl(this,dl,new Map),fl(this,Bu,new Map),fl(this,pl,function(e){return e}),fl(this,Hd,function(){return{}}),fl(this,Wd,function(){}),fl(this,Qd,function(){})}return pD(n,[{key:"getObj",value:function(t){return fr(dl,this).get(fr(pl,this).call(this,t))}},{key:"getData",value:function(t){return fr(Bu,this).get(t)}},{key:"entries",value:function(){return bD(fr(Bu,this).entries()).map(function(t){var r=vD(t,2),i=r[0],s=r[1];return[s,i]})}},{key:"id",value:function(t){return Fc(pl,this,be(t)),this}},{key:"onCreateObj",value:function(t){return Fc(Hd,this,t),this}},{key:"onUpdateObj",value:function(t){return Fc(Wd,this,t),this}},{key:"onRemoveObj",value:function(t){return Fc(Qd,this,t),this}},{key:"digest",value:function(t){var r=this;t.filter(function(s){return!fr(dl,r).has(fr(pl,r).call(r,s))}).forEach(function(s){var o=fr(Hd,r).call(r,s);fr(dl,r).set(fr(pl,r).call(r,s),o),fr(Bu,r).set(o,s)});var i=new Map(t.map(function(s){return[fr(pl,r).call(r,s),s]}));return fr(dl,this).forEach(function(s,o){i.has(o)?fr(Wd,r).call(r,s,i.get(o)):(fr(Qd,r).call(r,s,o),fr(dl,r).delete(o),fr(Bu,r).delete(s))}),this}},{key:"clear",value:function(){return this.digest([]),this}}])})(),D0={exports:{}},SD=D0.exports,$3;function ED(){return $3||($3=1,(function(n,e){(function(t,r){n.exports=r()})(SD,function(){return(function(t){function r(s){if(i[s])return i[s].exports;var o=i[s]={exports:{},id:s,loaded:!1};return t[s].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}var i={};return r.m=t,r.c=i,r.p="",r(0)})([function(t,r,i){var s=i(1),o=(function(){function a(c,f,p){c===void 0&&(c=NaN),f===void 0&&(f=NaN),p===void 0&&(p=!1),this._minFPS=f,this._maxFPS=c,this._timeScale=1,this._currentTick=0,this._currentTime=0,this._tickDeltaTime=0,this._isRunning=!1,this._maxInterval=isNaN(this._minFPS)?NaN:1e3/this._minFPS,this._minInterval=isNaN(this._maxFPS)?NaN:1e3/this._maxFPS,this._onResume=new s.default,this._onPause=new s.default,this._onTick=new s.default,this._onTickOncePerFrame=new s.default,p||this.resume()}return a.prototype.updateOnce=function(c){c(this.currentTimeSeconds,this.tickDeltaTimeSeconds,this.currentTick)},a.prototype.resume=function(){this._isRunning||(this._isRunning=!0,this._lastTimeUpdated=this.getTimer(),this._onResume.dispatch(),this.animateOnce())},a.prototype.pause=function(){this._isRunning&&(this._isRunning=!1,this._onPause.dispatch(),window.cancelAnimationFrame(this._animationFrameHandle))},a.prototype.dispose=function(){this.pause(),this._onResume.removeAll(),this._onPause.removeAll(),this._onTick.removeAll()},Object.defineProperty(a.prototype,"currentTick",{get:function(){return this._currentTick},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"currentTimeSeconds",{get:function(){return this._currentTime/1e3},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"tickDeltaTimeSeconds",{get:function(){return this._tickDeltaTime/1e3},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"timeScale",{get:function(){return this._timeScale},set:function(c){this._timeScale!==c&&(this._timeScale=c)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onResume",{get:function(){return this._onResume},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onPause",{get:function(){return this._onPause},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onTick",{get:function(){return this._onTick},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onTickOncePerFrame",{get:function(){return this._onTickOncePerFrame},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isRunning",{get:function(){return this._isRunning},enumerable:!0,configurable:!0}),a.prototype.animateOnce=function(){var c=this;this._animationFrameHandle=window.requestAnimationFrame(function(){return c.onFrame()})},a.prototype.onFrame=function(){if(this._now=this.getTimer(),this._frameDeltaTime=this._now-this._lastTimeUpdated,isNaN(this._minInterval)||this._frameDeltaTime>=this._minInterval)if(isNaN(this._maxInterval))this.update(this._frameDeltaTime*this._timeScale,!0),this._lastTimeUpdated=this._now;else for(this._interval=Math.min(this._frameDeltaTime,this._maxInterval);this._now>=this._lastTimeUpdated+this._interval;)this.update(this._interval*this._timeScale,this._now<=this._lastTimeUpdated+2*this._maxInterval),this._lastTimeUpdated+=this._interval;this._isRunning&&this.animateOnce()},a.prototype.update=function(c,f){f===void 0&&(f=!0),this._currentTick++,this._currentTime+=c,this._tickDeltaTime=c,this._onTick.dispatch(this.currentTimeSeconds,this.tickDeltaTimeSeconds,this.currentTick),f&&this._onTickOncePerFrame.dispatch(this.currentTimeSeconds,this.tickDeltaTimeSeconds,this.currentTick)},a.prototype.getTimer=function(){return Date.now()},a})();Object.defineProperty(r,"__esModule",{value:!0}),r.default=o},function(t,r,i){(function(s,o){t.exports=o()})(this,function(){return(function(s){function o(c){if(a[c])return a[c].exports;var f=a[c]={exports:{},id:c,loaded:!1};return s[c].call(f.exports,f,f.exports,o),f.loaded=!0,f.exports}var a={};return o.m=s,o.c=a,o.p="",o(0)})([function(s,o){var a=(function(){function c(){this.functions=[]}return c.prototype.add=function(f){return this.functions.indexOf(f)===-1&&(this.functions.push(f),!0)},c.prototype.remove=function(f){var p=this.functions.indexOf(f);return p>-1&&(this.functions.splice(p,1),!0)},c.prototype.removeAll=function(){return this.functions.length>0&&(this.functions.length=0,!0)},c.prototype.dispatch=function(){for(var f=[],p=0;p<arguments.length;p++)f[p]=arguments[p];var g=this.functions.concat();g.forEach(function(v){v.apply(void 0,f)})},Object.defineProperty(c.prototype,"numItems",{get:function(){return this.functions.length},enumerable:!0,configurable:!0}),c})();Object.defineProperty(o,"__esModule",{value:!0}),o.default=a}])})}])})})(D0)),D0.exports}var RD=ED();const ou=fx(RD),Zs=11102230246251565e-32,dr=134217729,CD=(3+8*Zs)*Zs;function Xd(n,e,t,r,i){let s,o,a,c,f=e[0],p=r[0],g=0,v=0;p>f==p>-f?(s=f,f=e[++g]):(s=p,p=r[++v]);let x=0;if(g<n&&v<t)for(p>f==p>-f?(o=f+s,a=s-(o-f),f=e[++g]):(o=p+s,a=s-(o-p),p=r[++v]),s=o,a!==0&&(i[x++]=a);g<n&&v<t;)p>f==p>-f?(o=s+f,c=o-s,a=s-(o-c)+(f-c),f=e[++g]):(o=s+p,c=o-s,a=s-(o-c)+(p-c),p=r[++v]),s=o,a!==0&&(i[x++]=a);for(;g<n;)o=s+f,c=o-s,a=s-(o-c)+(f-c),f=e[++g],s=o,a!==0&&(i[x++]=a);for(;v<t;)o=s+p,c=o-s,a=s-(o-c)+(p-c),p=r[++v],s=o,a!==0&&(i[x++]=a);return(s!==0||x===0)&&(i[x++]=s),x}function ND(n,e){let t=e[0];for(let r=1;r<n;r++)t+=e[r];return t}function JA(n){return new Float64Array(n)}const MD=(3+16*Zs)*Zs,PD=(2+12*Zs)*Zs,BD=(9+64*Zs)*Zs*Zs,ml=JA(4),H3=JA(8),W3=JA(12),Q3=JA(16),xr=JA(4);function DD(n,e,t,r,i,s,o){let a,c,f,p,g,v,x,T,S,E,N,P,B,L,k,q,I,U;const j=n-i,J=t-i,Q=e-s,K=r-s;L=j*K,v=dr*j,x=v-(v-j),T=j-x,v=dr*K,S=v-(v-K),E=K-S,k=T*E-(L-x*S-T*S-x*E),q=Q*J,v=dr*Q,x=v-(v-Q),T=Q-x,v=dr*J,S=v-(v-J),E=J-S,I=T*E-(q-x*S-T*S-x*E),N=k-I,g=k-N,ml[0]=k-(N+g)+(g-I),P=L+N,g=P-L,B=L-(P-g)+(N-g),N=B-q,g=B-N,ml[1]=B-(N+g)+(g-q),U=P+N,g=U-P,ml[2]=P-(U-g)+(N-g),ml[3]=U;let te=ND(4,ml),oe=PD*o;if(te>=oe||-te>=oe||(g=n-j,a=n-(j+g)+(g-i),g=t-J,f=t-(J+g)+(g-i),g=e-Q,c=e-(Q+g)+(g-s),g=r-K,p=r-(K+g)+(g-s),a===0&&c===0&&f===0&&p===0)||(oe=BD*o+CD*Math.abs(te),te+=j*p+K*a-(Q*f+J*c),te>=oe||-te>=oe))return te;L=a*K,v=dr*a,x=v-(v-a),T=a-x,v=dr*K,S=v-(v-K),E=K-S,k=T*E-(L-x*S-T*S-x*E),q=c*J,v=dr*c,x=v-(v-c),T=c-x,v=dr*J,S=v-(v-J),E=J-S,I=T*E-(q-x*S-T*S-x*E),N=k-I,g=k-N,xr[0]=k-(N+g)+(g-I),P=L+N,g=P-L,B=L-(P-g)+(N-g),N=B-q,g=B-N,xr[1]=B-(N+g)+(g-q),U=P+N,g=U-P,xr[2]=P-(U-g)+(N-g),xr[3]=U;const Y=Xd(4,ml,4,xr,H3);L=j*p,v=dr*j,x=v-(v-j),T=j-x,v=dr*p,S=v-(v-p),E=p-S,k=T*E-(L-x*S-T*S-x*E),q=Q*f,v=dr*Q,x=v-(v-Q),T=Q-x,v=dr*f,S=v-(v-f),E=f-S,I=T*E-(q-x*S-T*S-x*E),N=k-I,g=k-N,xr[0]=k-(N+g)+(g-I),P=L+N,g=P-L,B=L-(P-g)+(N-g),N=B-q,g=B-N,xr[1]=B-(N+g)+(g-q),U=P+N,g=U-P,xr[2]=P-(U-g)+(N-g),xr[3]=U;const ae=Xd(Y,H3,4,xr,W3);L=a*p,v=dr*a,x=v-(v-a),T=a-x,v=dr*p,S=v-(v-p),E=p-S,k=T*E-(L-x*S-T*S-x*E),q=c*f,v=dr*c,x=v-(v-c),T=c-x,v=dr*f,S=v-(v-f),E=f-S,I=T*E-(q-x*S-T*S-x*E),N=k-I,g=k-N,xr[0]=k-(N+g)+(g-I),P=L+N,g=P-L,B=L-(P-g)+(N-g),N=B-q,g=B-N,xr[1]=B-(N+g)+(g-q),U=P+N,g=U-P,xr[2]=P-(U-g)+(N-g),xr[3]=U;const he=Xd(ae,W3,4,xr,Q3);return Q3[he-1]}function iA(n,e,t,r,i,s){const o=(e-s)*(t-i),a=(n-i)*(r-s),c=o-a,f=Math.abs(o+a);return Math.abs(c)>=MD*f?c:-DD(n,e,t,r,i,s,f)}const X3=Math.pow(2,-52),Ic=new Uint32Array(512);class FA{static from(e,t=kD,r=UD){const i=e.length,s=new Float64Array(i*2);for(let o=0;o<i;o++){const a=e[o];s[2*o]=t(a),s[2*o+1]=r(a)}return new FA(s)}constructor(e){const t=e.length>>1;if(t>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const r=Math.max(2*t-5,0);this._triangles=new Uint32Array(r*3),this._halfedges=new Int32Array(r*3),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:r,_hullTri:i,_hullHash:s}=this,o=e.length>>1;let a=1/0,c=1/0,f=-1/0,p=-1/0;for(let j=0;j<o;j++){const J=e[2*j],Q=e[2*j+1];J<a&&(a=J),Q<c&&(c=Q),J>f&&(f=J),Q>p&&(p=Q),this._ids[j]=j}const g=(a+f)/2,v=(c+p)/2;let x,T,S;for(let j=0,J=1/0;j<o;j++){const Q=Yd(g,v,e[2*j],e[2*j+1]);Q<J&&(x=j,J=Q)}const E=e[2*x],N=e[2*x+1];for(let j=0,J=1/0;j<o;j++){if(j===x)continue;const Q=Yd(E,N,e[2*j],e[2*j+1]);Q<J&&Q>0&&(T=j,J=Q)}let P=e[2*T],B=e[2*T+1],L=1/0;for(let j=0;j<o;j++){if(j===x||j===T)continue;const J=FD(E,N,P,B,e[2*j],e[2*j+1]);J<L&&(S=j,L=J)}let k=e[2*S],q=e[2*S+1];if(L===1/0){for(let Q=0;Q<o;Q++)this._dists[Q]=e[2*Q]-e[0]||e[2*Q+1]-e[1];kl(this._ids,this._dists,0,o-1);const j=new Uint32Array(o);let J=0;for(let Q=0,K=-1/0;Q<o;Q++){const te=this._ids[Q],oe=this._dists[te];oe>K&&(j[J++]=te,K=oe)}this.hull=j.subarray(0,J),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(iA(E,N,P,B,k,q)<0){const j=T,J=P,Q=B;T=S,P=k,B=q,S=j,k=J,q=Q}const I=ID(E,N,P,B,k,q);this._cx=I.x,this._cy=I.y;for(let j=0;j<o;j++)this._dists[j]=Yd(e[2*j],e[2*j+1],I.x,I.y);kl(this._ids,this._dists,0,o-1),this._hullStart=x;let U=3;r[x]=t[S]=T,r[T]=t[x]=S,r[S]=t[T]=x,i[x]=0,i[T]=1,i[S]=2,s.fill(-1),s[this._hashKey(E,N)]=x,s[this._hashKey(P,B)]=T,s[this._hashKey(k,q)]=S,this.trianglesLen=0,this._addTriangle(x,T,S,-1,-1,-1);for(let j=0,J,Q;j<this._ids.length;j++){const K=this._ids[j],te=e[2*K],oe=e[2*K+1];if(j>0&&Math.abs(te-J)<=X3&&Math.abs(oe-Q)<=X3||(J=te,Q=oe,K===x||K===T||K===S))continue;let Y=0;for(let Oe=0,ke=this._hashKey(te,oe);Oe<this._hashSize&&(Y=s[(ke+Oe)%this._hashSize],!(Y!==-1&&Y!==r[Y]));Oe++);Y=t[Y];let ae=Y,he;for(;he=r[ae],iA(te,oe,e[2*ae],e[2*ae+1],e[2*he],e[2*he+1])>=0;)if(ae=he,ae===Y){ae=-1;break}if(ae===-1)continue;let xe=this._addTriangle(ae,K,r[ae],-1,-1,i[ae]);i[K]=this._legalize(xe+2),i[ae]=xe,U++;let me=r[ae];for(;he=r[me],iA(te,oe,e[2*me],e[2*me+1],e[2*he],e[2*he+1])<0;)xe=this._addTriangle(me,K,he,i[K],-1,i[me]),i[K]=this._legalize(xe+2),r[me]=me,U--,me=he;if(ae===Y)for(;he=t[ae],iA(te,oe,e[2*he],e[2*he+1],e[2*ae],e[2*ae+1])<0;)xe=this._addTriangle(he,K,ae,-1,i[ae],i[he]),this._legalize(xe+2),i[he]=xe,r[ae]=ae,U--,ae=he;this._hullStart=t[K]=ae,r[ae]=t[me]=K,r[K]=me,s[this._hashKey(te,oe)]=K,s[this._hashKey(e[2*ae],e[2*ae+1])]=ae}this.hull=new Uint32Array(U);for(let j=0,J=this._hullStart;j<U;j++)this.hull[j]=J,J=r[J];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(LD(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:r,coords:i}=this;let s=0,o=0;for(;;){const a=r[e],c=e-e%3;if(o=c+(e+2)%3,a===-1){if(s===0)break;e=Ic[--s];continue}const f=a-a%3,p=c+(e+1)%3,g=f+(a+2)%3,v=t[o],x=t[e],T=t[p],S=t[g];if(OD(i[2*v],i[2*v+1],i[2*x],i[2*x+1],i[2*T],i[2*T+1],i[2*S],i[2*S+1])){t[e]=S,t[a]=v;const N=r[g];if(N===-1){let B=this._hullStart;do{if(this._hullTri[B]===g){this._hullTri[B]=e;break}B=this._hullPrev[B]}while(B!==this._hullStart)}this._link(e,N),this._link(a,r[o]),this._link(o,g);const P=f+(a+1)%3;s<Ic.length&&(Ic[s++]=P)}else{if(s===0)break;e=Ic[--s]}}return o}_link(e,t){this._halfedges[e]=t,t!==-1&&(this._halfedges[t]=e)}_addTriangle(e,t,r,i,s,o){const a=this.trianglesLen;return this._triangles[a]=e,this._triangles[a+1]=t,this._triangles[a+2]=r,this._link(a,i),this._link(a+1,s),this._link(a+2,o),this.trianglesLen+=3,a}}function LD(n,e){const t=n/(Math.abs(n)+Math.abs(e));return(e>0?3-t:1+t)/4}function Yd(n,e,t,r){const i=n-t,s=e-r;return i*i+s*s}function OD(n,e,t,r,i,s,o,a){const c=n-o,f=e-a,p=t-o,g=r-a,v=i-o,x=s-a,T=c*c+f*f,S=p*p+g*g,E=v*v+x*x;return c*(g*E-S*x)-f*(p*E-S*v)+T*(p*x-g*v)<0}function FD(n,e,t,r,i,s){const o=t-n,a=r-e,c=i-n,f=s-e,p=o*o+a*a,g=c*c+f*f,v=.5/(o*f-a*c),x=(f*p-a*g)*v,T=(o*g-c*p)*v;return x*x+T*T}function ID(n,e,t,r,i,s){const o=t-n,a=r-e,c=i-n,f=s-e,p=o*o+a*a,g=c*c+f*f,v=.5/(o*f-a*c),x=n+(f*p-a*g)*v,T=e+(o*g-c*p)*v;return{x,y:T}}function kl(n,e,t,r){if(r-t<=20)for(let i=t+1;i<=r;i++){const s=n[i],o=e[s];let a=i-1;for(;a>=t&&e[n[a]]>o;)n[a+1]=n[a--];n[a+1]=s}else{const i=t+r>>1;let s=t+1,o=r;Du(n,i,s),e[n[t]]>e[n[r]]&&Du(n,t,r),e[n[s]]>e[n[r]]&&Du(n,s,r),e[n[t]]>e[n[s]]&&Du(n,t,s);const a=n[s],c=e[a];for(;;){do s++;while(e[n[s]]<c);do o--;while(e[n[o]]>c);if(o<s)break;Du(n,s,o)}n[t+1]=n[o],n[o]=a,r-s+1>=o-t?(kl(n,e,s,r),kl(n,e,t,o-1)):(kl(n,e,t,o-1),kl(n,e,s,r))}}function Du(n,e,t){const r=n[e];n[e]=n[t],n[t]=r}function kD(n){return n[0]}function UD(n){return n[1]}function qD(n,e){var t,r,i=0,s,o,a,c,f,p,g,v=n[0],x=n[1],T=e.length;for(t=0;t<T;t++){r=0;var S=e[t],E=S.length-1;if(p=S[0],p[0]!==S[E][0]&&p[1]!==S[E][1])throw new Error("First and last coordinates in a ring must be the same");for(o=p[0]-v,a=p[1]-x,r;r<E;r++){if(g=S[r+1],c=g[0]-v,f=g[1]-x,a===0&&f===0){if(c<=0&&o>=0||o<=0&&c>=0)return 0}else if(f>=0&&a<=0||f<=0&&a>=0){if(s=iA(o,c,a,f,0,0),s===0)return 0;(s>0&&f>0&&a<=0||s<0&&f<=0&&a>0)&&i++}p=g,a=f,o=c}}return i%2!==0}function GD(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function VD(n){return n.type==="Feature"?n.geometry:n}function zD(n,e,t={}){if(!n)throw new Error("point is required");if(!e)throw new Error("polygon is required");const r=GD(n),i=VD(e),s=i.type,o=e.bbox;let a=i.coordinates;if(o&&jD(r,o)===!1)return!1;s==="Polygon"&&(a=[a]);let c=!1;for(var f=0;f<a.length;++f){const p=qD(r,a[f]);if(p===0)return!t.ignoreBoundary;p&&(c=!0)}return c}function jD(n,e){return e[0]<=n[0]&&e[1]<=n[1]&&e[2]>=n[0]&&e[3]>=n[1]}var $D=zD;const Y3=1e-6;class Oa{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,r){e=+e,t=+t,r=+r;const i=e+r,s=t;if(r<0)throw new Error("negative radius");this._x1===null?this._+=`M${i},${s}`:(Math.abs(this._x1-i)>Y3||Math.abs(this._y1-s)>Y3)&&(this._+="L"+i+","+s),r&&(this._+=`A${r},${r},0,1,1,${e-r},${t}A${r},${r},0,1,1,${this._x1=i},${this._y1=s}`)}rect(e,t,r,i){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+r}v${+i}h${-r}Z`}value(){return this._||null}}class eg{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class HD{constructor(e,[t,r,i,s]=[0,0,960,500]){if(!((i=+i)>=(t=+t))||!((s=+s)>=(r=+r)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(e.points.length*2),this.vectors=new Float64Array(e.points.length*2),this.xmax=i,this.xmin=t,this.ymax=s,this.ymin=r,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:r},vectors:i}=this;let s,o;const a=this.circumcenters=this._circumcenters.subarray(0,r.length/3*2);for(let S=0,E=0,N=r.length,P,B;S<N;S+=3,E+=2){const L=r[S]*2,k=r[S+1]*2,q=r[S+2]*2,I=e[L],U=e[L+1],j=e[k],J=e[k+1],Q=e[q],K=e[q+1],te=j-I,oe=J-U,Y=Q-I,ae=K-U,he=(te*ae-oe*Y)*2;if(Math.abs(he)<1e-9){if(s===void 0){s=o=0;for(const me of t)s+=e[me*2],o+=e[me*2+1];s/=t.length,o/=t.length}const xe=1e9*Math.sign((s-I)*ae-(o-U)*Y);P=(I+Q)/2-xe*ae,B=(U+K)/2+xe*Y}else{const xe=1/he,me=te*te+oe*oe,Oe=Y*Y+ae*ae;P=I+(ae*me-oe*Oe)*xe,B=U+(te*Oe-Y*me)*xe}a[E]=P,a[E+1]=B}let c=t[t.length-1],f,p=c*4,g,v=e[2*c],x,T=e[2*c+1];i.fill(0);for(let S=0;S<t.length;++S)c=t[S],f=p,g=v,x=T,p=c*4,v=e[2*c],T=e[2*c+1],i[f+2]=i[p]=x-T,i[f+3]=i[p+1]=v-g}render(e){const t=e==null?e=new Oa:void 0,{delaunay:{halfedges:r,inedges:i,hull:s},circumcenters:o,vectors:a}=this;if(s.length<=1)return null;for(let p=0,g=r.length;p<g;++p){const v=r[p];if(v<p)continue;const x=Math.floor(p/3)*2,T=Math.floor(v/3)*2,S=o[x],E=o[x+1],N=o[T],P=o[T+1];this._renderSegment(S,E,N,P,e)}let c,f=s[s.length-1];for(let p=0;p<s.length;++p){c=f,f=s[p];const g=Math.floor(i[f]/3)*2,v=o[g],x=o[g+1],T=c*4,S=this._project(v,x,a[T+2],a[T+3]);S&&this._renderSegment(v,x,S[0],S[1],e)}return t&&t.value()}renderBounds(e){const t=e==null?e=new Oa:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const r=t==null?t=new Oa:void 0,i=this._clip(e);if(i===null||!i.length)return;t.moveTo(i[0],i[1]);let s=i.length;for(;i[0]===i[s-2]&&i[1]===i[s-1]&&s>1;)s-=2;for(let o=2;o<s;o+=2)(i[o]!==i[o-2]||i[o+1]!==i[o-1])&&t.lineTo(i[o],i[o+1]);return t.closePath(),r&&r.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,r=e.length/2;t<r;++t){const i=this.cellPolygon(t);i&&(i.index=t,yield i)}}cellPolygon(e){const t=new eg;return this.renderCell(e,t),t.value()}_renderSegment(e,t,r,i,s){let o;const a=this._regioncode(e,t),c=this._regioncode(r,i);a===0&&c===0?(s.moveTo(e,t),s.lineTo(r,i)):(o=this._clipSegment(e,t,r,i,a,c))&&(s.moveTo(o[0],o[1]),s.lineTo(o[2],o[3]))}contains(e,t,r){return t=+t,t!==t||(r=+r,r!==r)?!1:this.delaunay._step(e,t,r)===e}*neighbors(e){const t=this._clip(e);if(t)for(const r of this.delaunay.neighbors(e)){const i=this._clip(r);if(i){e:for(let s=0,o=t.length;s<o;s+=2)for(let a=0,c=i.length;a<c;a+=2)if(t[s]===i[a]&&t[s+1]===i[a+1]&&t[(s+2)%o]===i[(a+c-2)%c]&&t[(s+3)%o]===i[(a+c-1)%c]){yield r;break e}}}}_cell(e){const{circumcenters:t,delaunay:{inedges:r,halfedges:i,triangles:s}}=this,o=r[e];if(o===-1)return null;const a=[];let c=o;do{const f=Math.floor(c/3);if(a.push(t[f*2],t[f*2+1]),c=c%3===2?c-2:c+1,s[c]!==e)break;c=i[c]}while(c!==o&&c!==-1);return a}_clip(e){if(e===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(t===null)return null;const{vectors:r}=this,i=e*4;return this._simplify(r[i]||r[i+1]?this._clipInfinite(e,t,r[i],r[i+1],r[i+2],r[i+3]):this._clipFinite(e,t))}_clipFinite(e,t){const r=t.length;let i=null,s,o,a=t[r-2],c=t[r-1],f,p=this._regioncode(a,c),g,v=0;for(let x=0;x<r;x+=2)if(s=a,o=c,a=t[x],c=t[x+1],f=p,p=this._regioncode(a,c),f===0&&p===0)g=v,v=0,i?i.push(a,c):i=[a,c];else{let T,S,E,N,P;if(f===0){if((T=this._clipSegment(s,o,a,c,f,p))===null)continue;[S,E,N,P]=T}else{if((T=this._clipSegment(a,c,s,o,p,f))===null)continue;[N,P,S,E]=T,g=v,v=this._edgecode(S,E),g&&v&&this._edge(e,g,v,i,i.length),i?i.push(S,E):i=[S,E]}g=v,v=this._edgecode(N,P),g&&v&&this._edge(e,g,v,i,i.length),i?i.push(N,P):i=[N,P]}if(i)g=v,v=this._edgecode(i[0],i[1]),g&&v&&this._edge(e,g,v,i,i.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return i}_clipSegment(e,t,r,i,s,o){const a=s<o;for(a&&([e,t,r,i,s,o]=[r,i,e,t,o,s]);;){if(s===0&&o===0)return a?[r,i,e,t]:[e,t,r,i];if(s&o)return null;let c,f,p=s||o;p&8?(c=e+(r-e)*(this.ymax-t)/(i-t),f=this.ymax):p&4?(c=e+(r-e)*(this.ymin-t)/(i-t),f=this.ymin):p&2?(f=t+(i-t)*(this.xmax-e)/(r-e),c=this.xmax):(f=t+(i-t)*(this.xmin-e)/(r-e),c=this.xmin),s?(e=c,t=f,s=this._regioncode(e,t)):(r=c,i=f,o=this._regioncode(r,i))}}_clipInfinite(e,t,r,i,s,o){let a=Array.from(t),c;if((c=this._project(a[0],a[1],r,i))&&a.unshift(c[0],c[1]),(c=this._project(a[a.length-2],a[a.length-1],s,o))&&a.push(c[0],c[1]),a=this._clipFinite(e,a))for(let f=0,p=a.length,g,v=this._edgecode(a[p-2],a[p-1]);f<p;f+=2)g=v,v=this._edgecode(a[f],a[f+1]),g&&v&&(f=this._edge(e,g,v,a,f),p=a.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(e,t,r,i,s){for(;t!==r;){let o,a;switch(t){case 5:t=4;continue;case 4:t=6,o=this.xmax,a=this.ymin;break;case 6:t=2;continue;case 2:t=10,o=this.xmax,a=this.ymax;break;case 10:t=8;continue;case 8:t=9,o=this.xmin,a=this.ymax;break;case 9:t=1;continue;case 1:t=5,o=this.xmin,a=this.ymin;break}(i[s]!==o||i[s+1]!==a)&&this.contains(e,o,a)&&(i.splice(s,0,o,a),s+=2)}return s}_project(e,t,r,i){let s=1/0,o,a,c;if(i<0){if(t<=this.ymin)return null;(o=(this.ymin-t)/i)<s&&(c=this.ymin,a=e+(s=o)*r)}else if(i>0){if(t>=this.ymax)return null;(o=(this.ymax-t)/i)<s&&(c=this.ymax,a=e+(s=o)*r)}if(r>0){if(e>=this.xmax)return null;(o=(this.xmax-e)/r)<s&&(a=this.xmax,c=t+(s=o)*i)}else if(r<0){if(e<=this.xmin)return null;(o=(this.xmin-e)/r)<s&&(a=this.xmin,c=t+(s=o)*i)}return[a,c]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}_simplify(e){if(e&&e.length>4){for(let t=0;t<e.length;t+=2){const r=(t+2)%e.length,i=(t+4)%e.length;(e[t]===e[r]&&e[r]===e[i]||e[t+1]===e[r+1]&&e[r+1]===e[i+1])&&(e.splice(r,2),t-=2)}e.length||(e=null)}return e}}const WD=2*Math.PI,gl=Math.pow;function QD(n){return n[0]}function XD(n){return n[1]}function YD(n){const{triangles:e,coords:t}=n;for(let r=0;r<e.length;r+=3){const i=2*e[r],s=2*e[r+1],o=2*e[r+2];if((t[o]-t[i])*(t[s+1]-t[i+1])-(t[s]-t[i])*(t[o+1]-t[i+1])>1e-10)return!1}return!0}function KD(n,e,t){return[n+Math.sin(n+e)*t,e+Math.cos(n-e)*t]}class R1{static from(e,t=QD,r=XD,i){return new R1("length"in e?ZD(e,t,r,i):Float64Array.from(JD(e,t,r,i)))}constructor(e){this._delaunator=new FA(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&YD(e)){this.collinear=Int32Array.from({length:t.length/2},(v,x)=>x).sort((v,x)=>t[2*v]-t[2*x]||t[2*v+1]-t[2*x+1]);const c=this.collinear[0],f=this.collinear[this.collinear.length-1],p=[t[2*c],t[2*c+1],t[2*f],t[2*f+1]],g=1e-8*Math.hypot(p[3]-p[1],p[2]-p[0]);for(let v=0,x=t.length/2;v<x;++v){const T=KD(t[2*v],t[2*v+1],g);t[2*v]=T[0],t[2*v+1]=T[1]}this._delaunator=new FA(t)}else delete this.collinear;const r=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let c=0,f=r.length;c<f;++c){const p=s[c%3===2?c-2:c+1];(r[c]===-1||o[p]===-1)&&(o[p]=c)}for(let c=0,f=i.length;c<f;++c)a[i[c]]=c;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],o[i[0]]=1,i.length===2&&(o[i[1]]=0,this.triangles[1]=i[1],this.triangles[2]=i[1]))}voronoi(e){return new HD(this,e)}*neighbors(e){const{inedges:t,hull:r,_hullIndex:i,halfedges:s,triangles:o,collinear:a}=this;if(a){const g=a.indexOf(e);g>0&&(yield a[g-1]),g<a.length-1&&(yield a[g+1]);return}const c=t[e];if(c===-1)return;let f=c,p=-1;do{if(yield p=o[f],f=f%3===2?f-2:f+1,o[f]!==e)return;if(f=s[f],f===-1){const g=r[(i[e]+1)%r.length];g!==p&&(yield g);return}}while(f!==c)}find(e,t,r=0){if(e=+e,e!==e||(t=+t,t!==t))return-1;const i=r;let s;for(;(s=this._step(r,e,t))>=0&&s!==r&&s!==i;)r=s;return s}_step(e,t,r){const{inedges:i,hull:s,_hullIndex:o,halfedges:a,triangles:c,points:f}=this;if(i[e]===-1||!f.length)return(e+1)%(f.length>>1);let p=e,g=gl(t-f[e*2],2)+gl(r-f[e*2+1],2);const v=i[e];let x=v;do{let T=c[x];const S=gl(t-f[T*2],2)+gl(r-f[T*2+1],2);if(S<g&&(g=S,p=T),x=x%3===2?x-2:x+1,c[x]!==e)break;if(x=a[x],x===-1){if(x=s[(o[e]+1)%s.length],x!==T&&gl(t-f[x*2],2)+gl(r-f[x*2+1],2)<g)return x;break}}while(x!==v);return p}render(e){const t=e==null?e=new Oa:void 0,{points:r,halfedges:i,triangles:s}=this;for(let o=0,a=i.length;o<a;++o){const c=i[o];if(c<o)continue;const f=s[o]*2,p=s[c]*2;e.moveTo(r[f],r[f+1]),e.lineTo(r[p],r[p+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t){t===void 0&&(!e||typeof e.moveTo!="function")&&(t=e,e=null),t=t==null?2:+t;const r=e==null?e=new Oa:void 0,{points:i}=this;for(let s=0,o=i.length;s<o;s+=2){const a=i[s],c=i[s+1];e.moveTo(a+t,c),e.arc(a,c,t,0,WD)}return r&&r.value()}renderHull(e){const t=e==null?e=new Oa:void 0,{hull:r,points:i}=this,s=r[0]*2,o=r.length;e.moveTo(i[s],i[s+1]);for(let a=1;a<o;++a){const c=2*r[a];e.lineTo(i[c],i[c+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new eg;return this.renderHull(e),e.value()}renderTriangle(e,t){const r=t==null?t=new Oa:void 0,{points:i,triangles:s}=this,o=s[e*=3]*2,a=s[e+1]*2,c=s[e+2]*2;return t.moveTo(i[o],i[o+1]),t.lineTo(i[a],i[a+1]),t.lineTo(i[c],i[c+1]),t.closePath(),r&&r.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,r=e.length/3;t<r;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new eg;return this.renderTriangle(e,t),t.value()}}function ZD(n,e,t,r){const i=n.length,s=new Float64Array(i*2);for(let o=0;o<i;++o){const a=n[o];s[o*2]=e.call(r,a,o,n),s[o*2+1]=t.call(r,a,o,n)}return s}function*JD(n,e,t,r){let i=0;for(const s of n)yield e.call(r,s,i,n),yield t.call(r,s,i,n),++i}const C1=Math.PI,K3=C1/2,Z3=180/C1,J3=C1/180,eL=Math.atan2,ev=Math.cos,tL=Math.max,nL=Math.min,tv=Math.sin,rL=Math.sign||function(n){return n>0?1:n<0?-1:0},lT=Math.sqrt;function iL(n){return n>1?K3:n<-1?-K3:Math.asin(n)}function uT(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function ti(n,e){return[n[1]*e[2]-n[2]*e[1],n[2]*e[0]-n[0]*e[2],n[0]*e[1]-n[1]*e[0]]}function Mh(n,e){return[n[0]+e[0],n[1]+e[1],n[2]+e[2]]}function Ph(n){var e=lT(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);return[n[0]/e,n[1]/e,n[2]/e]}function N1(n){return[eL(n[1],n[0])*Z3,iL(tL(-1,nL(1,n[2])))*Z3]}function bs(n){const e=n[0]*J3,t=n[1]*J3,r=ev(t);return[r*ev(e),r*tv(e),tv(t)]}function M1(n){return n=n.map(e=>bs(e)),uT(n[0],ti(n[2],n[1]))}function sL(n){const e=aL(n),t=uL(e),r=lL(t,n),i=cL(t,n.length),s=oL(i,n),o=AL(t,n),{polygons:a,centers:c}=hL(o,t,n),f=fL(a),p=pL(t,n),g=dL(r,t);return{delaunay:e,edges:r,triangles:t,centers:c,neighbors:i,polygons:a,mesh:f,hull:p,urquhart:g,find:s}}function oL(n,e){function t(r,i){let s=r[0]-i[0],o=r[1]-i[1],a=r[2]-i[2];return s*s+o*o+a*a}return function(i,s,o){o===void 0&&(o=0);let a,c,f=o;const p=bs([i,s]);do a=o,o=null,c=t(p,bs(e[a])),n[a].forEach(g=>{let v=t(p,bs(e[g]));if(v<c){c=v,o=g,f=g;return}});while(o!==null);return f}}function aL(n){if(n.length<2)return{};let e=0;for(;isNaN(n[e][0]+n[e][1])&&e++<n.length;);const t=Q9(n[e]),r=RP().translate([0,0]).scale(1).rotate(t.invert([180,0]));n=n.map(r);const i=[];let s=1;for(let g=0,v=n.length;g<v;g++){let x=n[g][0]**2+n[g][1]**2;!isFinite(x)||x>1e32?i.push(g):x>s&&(s=x)}const o=1e6*lT(s);i.forEach(g=>n[g]=[o,0]),n.push([0,o]),n.push([-o,0]),n.push([0,-o]);const a=R1.from(n);a.projection=r;const{triangles:c,halfedges:f,inedges:p}=a;for(let g=0,v=f.length;g<v;g++)if(f[g]<0){const x=g%3==2?g-2:g+1,T=g%3==0?g+2:g-1,S=f[x],E=f[T];f[S]=E,f[E]=S,f[x]=f[T]=-1,c[g]=c[x]=c[T]=e,p[c[S]]=S%3==0?S+2:S-1,p[c[E]]=E%3==0?E+2:E-1,g+=2-g%3}else c[g]>n.length-3-1&&(c[g]=e);return a}function lL(n,e){const t=new Set;return e.length===2?[[0,1]]:(n.forEach(r=>{if(r[0]!==r[1]&&!(M1(r.map(i=>e[i]))<0))for(let i=0,s;i<3;i++)s=(i+1)%3,t.add(nh([r[i],r[s]]).join("-"))}),Array.from(t,r=>r.split("-").map(Number)))}function uL(n){const{triangles:e}=n;if(!e)return[];const t=[];for(let r=0,i=e.length/3;r<i;r++){const s=e[3*r],o=e[3*r+1],a=e[3*r+2];s!==o&&o!==a&&t.push([s,a,o])}return t}function AL(n,e){return n.map(t=>{const r=t.map(s=>e[s]).map(bs),i=Mh(Mh(ti(r[1],r[0]),ti(r[2],r[1])),ti(r[0],r[2]));return N1(Ph(i))})}function cL(n,e){const t=[];return n.forEach(r=>{for(let i=0;i<3;i++){const s=r[i],o=r[(i+1)%3];t[s]=t[s]||[],t[s].push(o)}}),n.length===0&&(e===2?(t[0]=[1],t[1]=[0]):e===1&&(t[0]=[])),t}function hL(n,e,t){const r=[],i=n.slice();if(e.length===0){if(t.length<2)return{polygons:r,centers:i};if(t.length===2){const a=bs(t[0]),c=bs(t[1]),f=Ph(Mh(a,c)),p=Ph(ti(a,c)),g=ti(f,p),v=[f,ti(f,g),ti(ti(f,g),g),ti(ti(ti(f,g),g),g)].map(N1).map(o);return r.push(v),r.push(v.slice().reverse()),{polygons:r,centers:i}}}e.forEach((a,c)=>{for(let f=0;f<3;f++){const p=a[f],g=a[(f+1)%3],v=a[(f+2)%3];r[p]=r[p]||[],r[p].push([g,v,c,[p,g,v]])}});const s=r.map(a=>{const c=[a[0][2]];let f=a[0][1];for(let p=1;p<a.length;p++)for(let g=0;g<a.length;g++)if(a[g][0]==f){f=a[g][1],c.push(a[g][2]);break}if(c.length>2)return c;if(c.length==2){const p=nv(t[a[0][3][0]],t[a[0][3][1]],i[c[0]]),g=nv(t[a[0][3][2]],t[a[0][3][0]],i[c[0]]),v=o(p),x=o(g);return[c[0],x,c[1],v]}});function o(a){let c=-1;return i.slice(e.length,1/0).forEach((f,p)=>{f[0]===a[0]&&f[1]===a[1]&&(c=p+e.length)}),c<0&&(c=i.length,i.push(a)),c}return{polygons:s,centers:i}}function nv(n,e,t){n=bs(n),e=bs(e),t=bs(t);const r=rL(uT(ti(e,n),t));return N1(Ph(Mh(n,e)).map(i=>r*i))}function fL(n){const e=[];return n.forEach(t=>{if(!t)return;let r=t[t.length-1];for(let i of t)i>r&&e.push([r,i]),r=i}),e}function dL(n,e){return function(t){const r=new Map,i=new Map;return n.forEach((s,o)=>{const a=s.join("-");r.set(a,t[o]),i.set(a,!0)}),e.forEach(s=>{let o=0,a=-1;for(let c=0;c<3;c++){let f=nh([s[c],s[(c+1)%3]]).join("-");r.get(f)>o&&(o=r.get(f),a=f)}i.set(a,!1)}),n.map(s=>i.get(s.join("-")))}}function pL(n,e){const t=new Set,r=[];n.map(a=>{if(!(M1(a.map(c=>e[c>e.length?0:c]))>1e-12))for(let c=0;c<3;c++){let f=[a[c],a[(c+1)%3]],p=`${f[0]}-${f[1]}`;t.has(p)?t.delete(p):t.add(`${f[1]}-${f[0]}`)}});const i=new Map;let s;if(t.forEach(a=>{a=a.split("-").map(Number),i.set(a[0],a[1]),s=a[0]}),s===void 0)return r;let o=s;do{r.push(o);let a=i.get(o);i.set(o,-1),o=a}while(o>-1&&o!==s);return r}function mL(n){const e=function(t){if(e.delaunay=null,e._data=t,typeof e._data=="object"&&e._data.type==="FeatureCollection"&&(e._data=e._data.features),typeof e._data=="object"){const r=e._data.map(i=>[e._vx(i),e._vy(i),i]).filter(i=>isFinite(i[0]+i[1]));e.points=r.map(i=>[i[0],i[1]]),e.valid=r.map(i=>i[2]),e.delaunay=sL(e.points)}return e};return e._vx=function(t){if(typeof t=="object"&&"type"in t)return f3(t)[0];if(0 in t)return t[0]},e._vy=function(t){if(typeof t=="object"&&"type"in t)return f3(t)[1];if(1 in t)return t[1]},e.x=function(t){return t?(e._vx=t,e):e._vx},e.y=function(t){return t?(e._vy=t,e):e._vy},e.polygons=function(t){if(t!==void 0&&e(t),!e.delaunay)return!1;const r={type:"FeatureCollection",features:[]};return e.valid.length===0||(e.delaunay.polygons.forEach((i,s)=>r.features.push({type:"Feature",geometry:i?{type:"Polygon",coordinates:[[...i,i[0]].map(o=>e.delaunay.centers[o])]}:null,properties:{site:e.valid[s],sitecoordinates:e.points[s],neighbours:e.delaunay.neighbors[s]}})),e.valid.length===1&&r.features.push({type:"Feature",geometry:{type:"Sphere"},properties:{site:e.valid[0],sitecoordinates:e.points[0],neighbours:[]}})),r},e.triangles=function(t){return t!==void 0&&e(t),e.delaunay?{type:"FeatureCollection",features:e.delaunay.triangles.map((r,i)=>(r=r.map(s=>e.points[s]),r.center=e.delaunay.centers[i],r)).filter(r=>M1(r)>0).map(r=>({type:"Feature",properties:{circumcenter:r.center},geometry:{type:"Polygon",coordinates:[[...r,r[0]]]}}))}:!1},e.links=function(t){if(t!==void 0&&e(t),!e.delaunay)return!1;const r=e.delaunay.edges.map(s=>Xo(e.points[s[0]],e.points[s[1]])),i=e.delaunay.urquhart(r);return{type:"FeatureCollection",features:e.delaunay.edges.map((s,o)=>({type:"Feature",properties:{source:e.valid[s[0]],target:e.valid[s[1]],length:r[o],urquhart:!!i[o]},geometry:{type:"LineString",coordinates:[e.points[s[0]],e.points[s[1]]]}}))}},e.mesh=function(t){return t!==void 0&&e(t),e.delaunay?{type:"MultiLineString",coordinates:e.delaunay.edges.map(r=>[e.points[r[0]],e.points[r[1]]])}:!1},e.cellMesh=function(t){if(t!==void 0&&e(t),!e.delaunay)return!1;const{centers:r,polygons:i}=e.delaunay,s=[];for(const o of i)if(o)for(let a=o.length,c=o[a-1],f=o[0],p=0;p<a;c=f,f=o[++p])f>c&&s.push([r[c],r[f]]);return{type:"MultiLineString",coordinates:s}},e._found=void 0,e.find=function(t,r,i){if(e._found=e.delaunay.find(t,r,e._found),!i||Xo([t,r],e.points[e._found])<i)return e._found},e.hull=function(t){t!==void 0&&e(t);const r=e.delaunay.hull,i=e.points;return r.length===0?null:{type:"Polygon",coordinates:[[...r.map(s=>i[s]),i[r[0]]]]}},n?e(n):e}function tg(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function gL(n){if(Array.isArray(n))return n}function yL(n){if(Array.isArray(n))return tg(n)}function _L(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function vL(n,e,t){return e=Bh(e),CL(n,AT()?Reflect.construct(e,[],Bh(n).constructor):e.apply(n,t))}function bL(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function xL(n,e,t){return Object.defineProperty(n,"prototype",{writable:!1}),n}function Bh(n){return Bh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Bh(n)}function TL(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&ng(n,e)}function AT(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(AT=function(){return!!n})()}function wL(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function SL(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function EL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RL(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CL(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _L(n)}function ng(n,e){return ng=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},ng(n,e)}function fs(n,e){return gL(n)||SL(n,e)||cT(n,e)||EL()}function Kd(n){return yL(n)||wL(n)||cT(n)||RL()}function cT(n,e){if(n){if(typeof n=="string")return tg(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?tg(n,e):void 0}}function NL(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.resolution,r=t===void 0?1/0:t,i=ML(n,r),s=CA(i),o=PL(n,r),a=[].concat(Kd(s),Kd(o)),c={type:"Polygon",coordinates:n},f=P4(c),p=fs(f,2),g=fs(p[0],2),v=g[0],x=g[1],T=fs(p[1],2),S=T[0],E=T[1],N=v>S||E>=89||x<=-89,P=[];if(N){var B=mL(a).triangles(),L=new Map(a.map(function(he,xe){var me=fs(he,2),Oe=me[0],ke=me[1];return["".concat(Oe,"-").concat(ke),xe]}));B.features.forEach(function(he){var xe,me=he.geometry.coordinates[0].slice(0,3).reverse(),Oe=[];if(me.forEach(function(Ke){var Ye=fs(Ke,2),Ft=Ye[0],mt=Ye[1],Lt="".concat(Ft,"-").concat(mt);L.has(Lt)&&Oe.push(L.get(Lt))}),Oe.length===3){if(Oe.some(function(Ke){return Ke<s.length})){var ke=he.properties.circumcenter;if(!rg(ke,c,N))return}(xe=P).push.apply(xe,Oe)}})}else if(o.length)for(var j=FA.from(a),J=function(xe){var me,Oe=[2,1,0].map(function(Ye){return j.triangles[xe+Ye]}),ke=Oe.map(function(Ye){return a[Ye]});if(Oe.some(function(Ye){return Ye<s.length})){var Ke=[0,1].map(function(Ye){return GM(ke,function(Ft){return Ft[Ye]})});if(!rg(Ke,c,N))return 1}(me=P).push.apply(me,Kd(Oe))},Q=0,K=j.triangles.length;Q<K;Q+=3)J(Q);else{var k=Eh(i),q=k.vertices,I=k.holes,U=I===void 0?[]:I;P=KP(q,U,2)}var te=io(nh(a,function(he){return he[0]}),[0,1]),oe=io(nh(a,function(he){return he[1]}),[0,1]),Y=a.map(function(he){var xe=fs(he,2),me=xe[0],Oe=xe[1];return[te(me),oe(Oe)]}),ae={points:a,indices:P,uvs:Y};return{contour:i,triangles:ae}}function ML(n,e){return n.map(function(t){var r=[],i;return t.forEach(function(s){if(i){var o=Xo(s,i)*180/Math.PI;if(o>e)for(var a=b1(i,s),c=1/Math.ceil(o/e),f=c;f<1;)r.push(a(f)),f+=c}r.push(i=s)}),r})}function PL(n,e){var t={type:"Polygon",coordinates:n},r=P4(t),i=fs(r,2),s=fs(i[0],2),o=s[0],a=s[1],c=fs(i[1],2),f=c[0],p=c[1];if(Math.min(Math.abs(f-o),Math.abs(p-a))<e)return[];var g=o>f||p>=89||a<=-89;return BL(e,{minLng:o,maxLng:f,minLat:a,maxLat:p}).filter(function(v){return rg(v,t,g)})}function BL(n){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.minLng,r=e.maxLng,i=e.minLat,s=e.maxLat,o=Math.round(Math.pow(360/n,2)/Math.PI),a=(1+Math.sqrt(5))/2,c=function(N){return N/a*360%360-180},f=function(N){return Math.acos(2*N/o-1)/Math.PI*180-90},p=function(N){return o*(Math.cos((N+90)*Math.PI/180)+1)/2},g=[s!==void 0?Math.ceil(p(s)):0,i!==void 0?Math.floor(p(i)):o-1],v=t===void 0&&r===void 0?function(){return!0}:t===void 0?function(E){return E<=r}:r===void 0?function(E){return E>=t}:r>=t?function(E){return E>=t&&E<=r}:function(E){return E>=t||E<=r},x=[],T=g[0];T<=g[1];T++){var S=c(T);v(S)&&x.push([S,f(T)])}return x}function rg(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return t?cP(e,n):$D(n,e)}var L0=window.THREE?window.THREE:{BufferGeometry:Hr,Float32BufferAttribute:Cs},rv=new L0.BufferGeometry().setAttribute?"setAttribute":"addAttribute",P1=(function(n){function e(t,r,i,s,o,a,c){var f;bL(this,e),f=vL(this,e),f.type="ConicPolygonGeometry",f.parameters={polygonGeoJson:t,bottomHeight:r,topHeight:i,closedBottom:s,closedTop:o,includeSides:a,curvatureResolution:c},r=r||0,i=i||1,s=s!==void 0?s:!0,o=o!==void 0?o:!0,a=a!==void 0?a:!0,c=c||5;var p=NL(t,{resolution:c}),g=p.contour,v=p.triangles,x=CA(v.uvs),T=[],S=[],E=[],N=0,P=function(I){var U=Math.round(T.length/3),j=E.length;T=T.concat(I.vertices),S=S.concat(I.uvs),E=E.concat(U?I.indices.map(function(J){return J+U}):I.indices),f.addGroup(j,E.length-j,N++)};a&&P(L()),s&&P(k(r,!1)),o&&P(k(i,!0)),f.setIndex(E),f[rv]("position",new L0.Float32BufferAttribute(T,3)),f[rv]("uv",new L0.Float32BufferAttribute(S,2)),f.computeVertexNormals();function B(q,I){var U=typeof I=="function"?I:function(){return I},j=q.map(function(J){return J.map(function(Q){var K=fs(Q,2),te=K[0],oe=K[1];return DL(oe,te,U(te,oe))})});return Eh(j)}function L(){for(var q=B(g,r),I=q.vertices,U=q.holes,j=B(g,i),J=j.vertices,Q=CA([J,I]),K=Math.round(J.length/3),te=new Set(U),oe=0,Y=[],ae=0;ae<K;ae++){var he=ae+1;if(he===K)he=oe;else if(te.has(he)){var xe=he;he=oe,oe=xe}Y.push(ae,ae+K,he+K),Y.push(he+K,he,ae)}for(var me=[],Oe=1;Oe>=0;Oe--)for(var ke=0;ke<K;ke+=1)me.push(ke/(K-1),Oe);return{indices:Y,vertices:Q,uvs:me}}function k(q){var I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return{indices:I?v.indices:v.indices.slice().reverse(),vertices:B([v.points],q).vertices,uvs:x}}return f}return TL(e,n),xL(e)})(L0.BufferGeometry);function DL(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=(90-n)*Math.PI/180,i=(90-e)*Math.PI/180;return[t*Math.sin(r)*Math.cos(i),t*Math.cos(r),t*Math.sin(r)*Math.sin(i)]}function ig(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function LL(n){if(Array.isArray(n))return n}function OL(n){if(Array.isArray(n))return ig(n)}function FL(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function IL(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function kL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function UL(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function qL(n,e){if(n==null)return{};var t,r,i=GL(n,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)t=s[r],e.includes(t)||{}.propertyIsEnumerable.call(n,t)&&(i[t]=n[t])}return i}function GL(n,e){if(n==null)return{};var t={};for(var r in n)if({}.hasOwnProperty.call(n,r)){if(e.includes(r))continue;t[r]=n[r]}return t}function VL(n,e){return LL(n)||IL(n,e)||hT(n,e)||kL()}function zL(n){return OL(n)||FL(n)||hT(n)||UL()}function jL(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}function $L(n){var e=jL(n,"string");return typeof e=="symbol"?e:e+""}function hT(n,e){if(n){if(typeof n=="string")return ig(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?ig(n,e):void 0}}var HL=(function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=(e instanceof Array?e.length?e:[void 0]:[e]).map(function(a){return{keyAccessor:a,isProp:!(a instanceof Function)}}),s=n.reduce(function(a,c){var f=a,p=c;return i.forEach(function(g,v){var x=g.keyAccessor,T=g.isProp,S;if(T){var E=p,N=E[x],P=qL(E,[x].map($L));S=N,p=P}else S=x(p,v);v+1<i.length?(f.hasOwnProperty(S)||(f[S]={}),f=f[S]):t?(f.hasOwnProperty(S)||(f[S]=[]),f[S].push(p)):f[S]=p}),a},{});t instanceof Function&&(function a(c){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;f===i.length?Object.keys(c).forEach(function(p){return c[p]=t(c[p])}):Object.values(c).forEach(function(p){return a(p,f+1)})})(s);var o=s;return r&&(o=[],(function a(c){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];f.length===i.length?o.push({keys:f,vals:c}):Object.entries(c).forEach(function(p){var g=VL(p,2),v=g[0],x=g[1];return a(x,[].concat(zL(f),[v]))})})(s),e instanceof Array&&e.length===0&&o.length===1&&(o[0].keys=[])),o}),Ct=(function(n){n=n||{};var e=typeof n<"u"?n:{},t={},r;for(r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);var i="";function s(fe){return e.locateFile?e.locateFile(fe,i):i+fe}var o;typeof document<"u"&&document.currentScript&&(i=document.currentScript.src),i.indexOf("blob:")!==0?i=i.substr(0,i.lastIndexOf("/")+1):i="",o=function(ve,Fe,Te){var A=new XMLHttpRequest;A.open("GET",ve,!0),A.responseType="arraybuffer",A.onload=function(){if(A.status==200||A.status==0&&A.response){Fe(A.response);return}var Mt=sd(ve);if(Mt){Fe(Mt.buffer);return}Te()},A.onerror=Te,A.send(null)};var a=e.print||console.log.bind(console),c=e.printErr||console.warn.bind(console);for(r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);t=null,e.arguments&&e.arguments;var f=0,p=function(fe){f=fe},g=function(){return f},v=8;function x(fe,ve,Fe,Te){switch(Fe=Fe||"i8",Fe.charAt(Fe.length-1)==="*"&&(Fe="i32"),Fe){case"i1":K[fe>>0]=ve;break;case"i8":K[fe>>0]=ve;break;case"i16":oe[fe>>1]=ve;break;case"i32":Y[fe>>2]=ve;break;case"i64":id=[ve>>>0,(tl=ve,+Vn(tl)>=1?tl>0?(la(+mo(tl/4294967296),4294967295)|0)>>>0:~~+Qr((tl-+(~~tl>>>0))/4294967296)>>>0:0)],Y[fe>>2]=id[0],Y[fe+4>>2]=id[1];break;case"float":ae[fe>>2]=ve;break;case"double":he[fe>>3]=ve;break;default:nl("invalid type for setValue: "+Fe)}}function T(fe,ve,Fe){switch(ve=ve||"i8",ve.charAt(ve.length-1)==="*"&&(ve="i32"),ve){case"i1":return K[fe>>0];case"i8":return K[fe>>0];case"i16":return oe[fe>>1];case"i32":return Y[fe>>2];case"i64":return Y[fe>>2];case"float":return ae[fe>>2];case"double":return he[fe>>3];default:nl("invalid type for getValue: "+ve)}return null}var S=!1;function E(fe,ve){fe||nl("Assertion failed: "+ve)}function N(fe){var ve=e["_"+fe];return E(ve,"Cannot call unknown function "+fe+", make sure it is exported"),ve}function P(fe,ve,Fe,Te,A){var O={string:function(yt){var Ai=0;if(yt!=null&&yt!==0){var dc=(yt.length<<2)+1;Ai=wy(dc),U(yt,Ai,dc)}return Ai},array:function(yt){var Ai=wy(yt.length);return j(yt,Ai),Ai}};function Mt(yt){return ve==="string"?q(yt):ve==="boolean"?!!yt:yt}var Gt=N(fe),Wn=[],gt=0;if(Te)for(var Pt=0;Pt<Te.length;Pt++){var go=O[Fe[Pt]];go?(gt===0&&(gt=U7()),Wn[Pt]=go(Te[Pt])):Wn[Pt]=Te[Pt]}var Ot=Gt.apply(null,Wn);return Ot=Mt(Ot),gt!==0&&k7(gt),Ot}function B(fe,ve,Fe,Te){Fe=Fe||[];var A=Fe.every(function(Mt){return Mt==="number"}),O=ve!=="string";return O&&A&&!Te?N(fe):function(){return P(fe,ve,Fe,arguments)}}var L=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function k(fe,ve,Fe){for(var Te=ve+Fe,A=ve;fe[A]&&!(A>=Te);)++A;if(A-ve>16&&fe.subarray&&L)return L.decode(fe.subarray(ve,A));for(var O="";ve<A;){var Mt=fe[ve++];if(!(Mt&128)){O+=String.fromCharCode(Mt);continue}var Gt=fe[ve++]&63;if((Mt&224)==192){O+=String.fromCharCode((Mt&31)<<6|Gt);continue}var Wn=fe[ve++]&63;if((Mt&240)==224?Mt=(Mt&15)<<12|Gt<<6|Wn:Mt=(Mt&7)<<18|Gt<<12|Wn<<6|fe[ve++]&63,Mt<65536)O+=String.fromCharCode(Mt);else{var gt=Mt-65536;O+=String.fromCharCode(55296|gt>>10,56320|gt&1023)}}return O}function q(fe,ve){return fe?k(te,fe,ve):""}function I(fe,ve,Fe,Te){if(!(Te>0))return 0;for(var A=Fe,O=Fe+Te-1,Mt=0;Mt<fe.length;++Mt){var Gt=fe.charCodeAt(Mt);if(Gt>=55296&&Gt<=57343){var Wn=fe.charCodeAt(++Mt);Gt=65536+((Gt&1023)<<10)|Wn&1023}if(Gt<=127){if(Fe>=O)break;ve[Fe++]=Gt}else if(Gt<=2047){if(Fe+1>=O)break;ve[Fe++]=192|Gt>>6,ve[Fe++]=128|Gt&63}else if(Gt<=65535){if(Fe+2>=O)break;ve[Fe++]=224|Gt>>12,ve[Fe++]=128|Gt>>6&63,ve[Fe++]=128|Gt&63}else{if(Fe+3>=O)break;ve[Fe++]=240|Gt>>18,ve[Fe++]=128|Gt>>12&63,ve[Fe++]=128|Gt>>6&63,ve[Fe++]=128|Gt&63}}return ve[Fe]=0,Fe-A}function U(fe,ve,Fe){return I(fe,te,ve,Fe)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function j(fe,ve){K.set(fe,ve)}function J(fe,ve){return fe%ve>0&&(fe+=ve-fe%ve),fe}var Q,K,te,oe,Y,ae,he;function xe(fe){Q=fe,e.HEAP8=K=new Int8Array(fe),e.HEAP16=oe=new Int16Array(fe),e.HEAP32=Y=new Int32Array(fe),e.HEAPU8=te=new Uint8Array(fe),e.HEAPU16=new Uint16Array(fe),e.HEAPU32=new Uint32Array(fe),e.HEAPF32=ae=new Float32Array(fe),e.HEAPF64=he=new Float64Array(fe)}var me=5271536,Oe=28624,ke=e.TOTAL_MEMORY||33554432;e.buffer?Q=e.buffer:Q=new ArrayBuffer(ke),ke=Q.byteLength,xe(Q),Y[Oe>>2]=me;function Ke(fe){for(;fe.length>0;){var ve=fe.shift();if(typeof ve=="function"){ve();continue}var Fe=ve.func;typeof Fe=="number"?ve.arg===void 0?e.dynCall_v(Fe):e.dynCall_vi(Fe,ve.arg):Fe(ve.arg===void 0?null:ve.arg)}}var Ye=[],Ft=[],mt=[],Lt=[];function Wt(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)xn(e.preRun.shift());Ke(Ye)}function Pn(){Ke(Ft)}function Gn(){Ke(mt)}function bn(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)Bn(e.postRun.shift());Ke(Lt)}function xn(fe){Ye.unshift(fe)}function Bn(fe){Lt.unshift(fe)}var Vn=Math.abs,Qr=Math.ceil,mo=Math.floor,la=Math.min,ui=0,Di=null;function w7(fe){ui++,e.monitorRunDependencies&&e.monitorRunDependencies(ui)}function S7(fe){if(ui--,e.monitorRunDependencies&&e.monitorRunDependencies(ui),ui==0&&Di){var ve=Di;Di=null,ve()}}e.preloadedImages={},e.preloadedAudios={};var ks=null,rd="data:application/octet-stream;base64,";function xy(fe){return String.prototype.startsWith?fe.startsWith(rd):fe.indexOf(rd)===0}var tl,id;ks="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAABAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAEAAAAAAAAAAAEAAAAAAQAAAAAAAAAAAQAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAABAAAAAAAAAAAAAQAAAAAAAAAAAAA6B6FaUp9QQTPXMuL4myJBraiDfBwx9UBYJseitzTIQOL5if9jqZtAnXX+Z+ycb0C3pucbhRBCQG8wJBYqpRRAlWbDCzCY5z/eFWBUEve6P/+qo4Q50Y4/D9YM3iCcYT8fcA2QJSA0P4ADxu0qAAc/BNcGolVJ2j5d9FACqwquPh9z7MthtI9CSUSYJke/YUJQ/64OyjU0Qpi0+HCmFQdCm3GfIVdh2kHsJ11kAyauQYC3UDFJOoFBSJsFV1OwU0FK5fcxX4AmQWhy/zZIt/lACqaCPsBjzUDbdUNIScugQMYQlVJ4MXNANiuq8GTvRUDxTXnulxEZQFZ8QX5kpuw/qmG/JwYFlEAluh3Q6DB+QKn4vyNq0GZAKOXekas+UUB8xabXXhI6QG63C2pLtSNAdDBtyNfLDUDyOcu67ID2P0rCMvRXAeE/Ki2TSVyzyT9Dk+8Sz2uzP5J+w5ARWp0/NQAoOiMuhj9YnP+RyMJwPxgW7TvQVFk/KgsLYF0kQz9g5dAC6IwzQcgHPVvDex1B1XjppodHBkHJq3OMM9fwQNvcmJ7wddlAInGPpQs/w0BRobq5EBmtQJZ2ai7n+ZVAtv2G5E+bgECG+gIfKBlpQK5f8jdI91JAL39sL/WpPEB8rGxhDqklQK6yUf43XhBAxL9y/tK8+D86XyZpgrHiPwAAAAD/////AAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAP////8AAAAAAAAAAAAAAAABAAAAAAAAAAAAAAD/////AAAAAAAAAAABAAAAAQAAAAAAAAAAAAAA/////wAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAP////8FAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQAAAAAAAQABAAABAQAAAAAAAQAAAAEAAAABAAEAAAAAAAAAAAAAAAAAAAAAquJYWJZl+D9jaeZNtj/zPwwdI9KqaeO/qGefXwdHdz+q4lhYlmX4P+OrlPMN3PI/DB0j0qpp47+7SQLV4VIEQKriWFiWZfg/r2kma3tz8T82eQmLqNIGwMRIWXMqSvo/fcCszPux9j+jara6ozTwP6hnn18HR3c/MSoKLequ8r+SabgA2nj0P7jBLbDOHO8/1Ym/ICfH4T+6lxjvlFXHv73m373LRPU/0vXyDVxo7T+ToKRHJXMAQF/33578aPE/pAyy64tD9T8+U/hCvyruPwxv8Y7YYwLAuXYr8NAiCEB4+LDK0Sn0P1Qeuy4j+eo/OMx50n7K7L+TrGB/nyf8v5ehC2fbYPM/aXMKexiT6z8mFRIMjg/zP7yUVwGGBNw/E6opHERf8z/z0wR2g9DqPw4pBpcOhvu/NbA29uWAA8DMaTExyXzyP02biiQ+Ruk/S8jz2/FKBEB1pzZnpbb9P7pQU4wLfPI//7ZcQXeG6D9CqEQvAYoIwDB2VB6sSgRAVyv8H5We8T+EHWF8XNPmPzB2wT8Nrrg/SEi+cX+w4L8of+GtdSDxP1sjk5AdouU/6ZjOVru13r8K0obqI6bxvwVbdNXyhfA/w5GG024n5z+rwmtMzP8BwLw9pSX49QXABe/2uQxP8D+b6wCzCvXkP7uGT87fK+Q/pz/JWw4coj+qoBf2J0nwP/yE3PUo0+I/vFJeHcaC+D96luSIqvntP/bf8sHUYu8/gZNN41mL4z9bhOqVOF4FwO6lmAh1hQhAbCVxbdhk7z+1C8NdDcfiPwG36x/0OQBAx0WJ76c2+D9nlSHXANfuP2HlfZ3gqOE/EwnVlVPg9r96+oHzEH//v5bXzdT1Auw/DM3GwLsA4D9p/8uoKcr+v+U9x5DQVAPAehjSdghb7D9sc1IetODgP8MVwwB1pu6/azPk6OGe978W8t/TUc3rP+0QMvYfP+A/RsG/QpSE8D+l3uwScxzgPwQaifgujuw/k1Vti1I43z8MAwLnSh0GQH5nYnwwZgJAiGUzWC5s6j8WyyI/BbLgPw4iUapGeQJAB3W+imnp/j9BLWR4ssrpP2t+gG5Pstk/cpBsfm6DCMCOpU9dOZsFQEv8nFypHeo/ehJ6i+6S2D9jqlGEmarLv7STC5TRiOa/bC+x8WZD6D9H3yUkWpDZP8gZvmCMuQLAreY19/eRBsCoPOc8UzzpP6KI/QV+y9g/t/MoboyWzT+Hv5q3Zu3Mvy2xROCT4uY/9gQitMMg1T9abAqhWMDkv1oLTavoUfG/PMUJP9CD5j+fHRX3t6fSPz7W2gk6bvs/WRnuHwqN9D8YFturGCTmP1EZczv0b9I/5t4exabB5D/1ESLh5fTEP9X2z6SYweQ/6lv3I2zT0D9zkRGNUNMAQKoSvc4EIfs/Xggt8wQI5T+mJHHg/w/SP4lhT/9t8vQ/DrZ/DbwH7D+XlhbYZrjkP34LIpFt6c4/lwfp8fLX9L+j96CTTf76v3WdNhEv9uM/d8c3o4lV0D/vFdCHVcsFwAHeDq0F1QhApbYqcZiN5D9KoilqByXLPwX0/diA0vq/0fo0GxnxAMBbaTkvlCzjP/RrFrWXrMs/UYTrky7jA0DB9f4FiZYAQEGAk/3QzeE/r/TeqE8t0D/OqjlsnPbvvz8RKU8JOfW/smSEbK/O4T8MzuyPm3DDP/rFtctq9gZAfb1EVEaSA0Dts5dVInnhP18SFMc79MM/7y34cw6LAMDFrRJsZO0DwC2KLvLSYuA/hx5wcUHewz+49SnK/4ruPyeS0PX9a+E/ZxaaLvvZ3z8WPu5T2QS8Pygo4RIvMqa/BJ0Kqsd0279cKW4ay8jdP3b05bmZ364/10/qtdxk2r+Bcz6CDMvpv54qOw+Amdw/qLV71pW7sT/YKc80nIPUP8OfIaBJ77G/LyTuD1un2z+diYu8efWzP1wU7ACkfwjAZroyPL1yBkAmv3lKJJbbPysKSE4W+p0/dIgqY79TA8ATLTOQ3tsGwJ2zweD/Xdg/XO/jXeFUaL8VW2qLFKfov1cA9Aa6XfK/tIa7YGgI2T+f3hu/sxqPv2nXdPpf3Pc/jkw8Jbda8j+tT/z8tGPVP1yBHpJd35k/KYvYOy1s8j/yz+kCQjPrP9+agH7x59g/PZfJ9aBhpr/rDKzvYBb+PwtkiaGCt/c/vb1mVr+f1T/JIHwHc8Govw7aeF6+9vG/Xv7kD6fp979isYioQYHVP7AIQZuSFrG/3z1AdUTnAUDN3XY9O7f9P0AdQ9ljYNQ/dJANJPTOrb8kLECUiiPlP4yF7UgmStA/9xGmXxCG1T9qZzix4W2zv2SGJRJVrPe/Fh9a2M/B/b8IexzFCoPSP9y1QFD2bLe/Q86cWLJe/b+mOOfYm78BwOTjkPAGE9E/8aPCUKu/ub9pPZyLCiUGwBA7Mev/BQlALOmrlRi+0j+AMJ/dKULBv7iLtL6a6QRAEMDV/yajAUDa62dE3crJP1P70RgBUbq/38hVnR6esT/s1tG10Z/Ov/zLwalHPss/dTS9NKTXx78nMcRzCIEHQAabxDsAmQRA0tyLK3gSyT+Aui7nOhDGv5Gs58z3WgHATN3forJuBMCAui7nOhDGP9Lciyt4Esm/WAJyHQ4c7z8UP5HFIs3iP3U0vTSk18c//MvBqUc+y7+cvv8HLg/Kvy1I/mHsI+K/U/vRGAFRuj/a62dE3crJv8p+WV8KlQjAuQ/nOP43B0CAMJ/dKULBPyzpq5UYvtK/ZoU+VoLh4L9etLlRUfvtv/GjwlCrv7k/5OOQ8AYT0b9DfT9FhufXPwUX8hJp+4u/3LVAUPZstz8IexzFCoPSv9+L609E5fQ/q9Fz7X2J7T9qZzix4W2zP/cRpl8QhtW/vtNilqGX+j8MOy7QJoL0P3SQDST0zq0/QB1D2WNg1L8IIjSvGNkDwGB8Jou2GAfAsAhBm5IWsT9isYioQYHVvyS9D3zb6uy/gnwRa7uM9L/JIHwHc8GoP729Zla/n9W/CsAHJZwmAEDEW6OYT1r6Pz2XyfWgYaY/35qAfvHn2L83Tdy4lS30vxf2/gZ0jPq/XIEekl3fmb+tT/z8tGPVvybPr2zJ1/+/K7mJ0ypVAsCf3hu/sxqPPwCGu2BoCNm/5oITrpZn+r+UDUyDP+n/v1zv413hVGg/nbPB4P9d2L9MlmkxNvgCQMtZlKE85v8/KwpIThb6nb8mv3lKJJbbv8+SZsTvOOc/pQCIIOYw0j+diYu8efWzvy8k7g9bp9u/kxYDa+pKtD9XlYvA8HnVv6i1e9aVu7G/nio7D4CZ3L/WR6rNh5EGwCkgQweBkghAdvTluZnfrr9cKW4ay8jdvxbjhr1f1QVAR5C0MzivAkAWPu5T2QS8v2cWmi772d+/cKj4lzLJCEBx2QJfYrMFQIcecHFB3sO/LYou8tJi4L+jr7lhO38BwIcI0Nb7xgTAXxIUxzv0w7/ts5dVInnhv0T+l8DZLfE/MP3FoFvS5D8MzuyPm3DDv7JkhGyvzuG/tzhzRIRc0b9Ovv3/0z7mv6/03qhPLdC/m4CT/dDN4b9dwjU5VCQBQBBJX1ntCv0/9GsWtZesy79baTkvlCzjv1mjYgEz++S/oW6KnOQW8b9KoilqByXLv6W2KnGYjeS/SmaKz3Vx9z+BZB5yxGHwP3fHN6OJVdC/dZ02ES/2478PuaBjLrXaP4/JU81pPaO/fgsikW3pzr+XlhbYZrjkv4tSn7YDbP0/f2LnFKlF9z+mJHHg/w/Sv14ILfMECOW/mfg4qYhR/b+OP+RQDCACwOpb9yNs09C/1fbPpJjB5L9pN2WOVZ3wv3hHy9nxIve/URlzO/Rv0r8YFturGCTmv1d1/KKR8QPA8gsy9qzSB8CfHRX3t6fSvzzFCT/Qg+a/EYStnrzV9r/2QJqI7Lb9v/YEIrTDINW/LbFE4JPi5r/7kQEs5fEDQHunnf4GeQBAooj9BX7L2L+oPOc8Uzzpv+ydYY2SSAfAL4HK6CRTB0BH3yUkWpDZv2wvsfFmQ+i/Ik0Yzruh6T8fM3LoGoDUP3oSeovukti/S/ycXKkd6r9rEv+7UWcHQCRIQe/GfwNAa36Abk+y2b9BLWR4ssrpv9KT87qa0bM/FTyktw823L8WyyI/BbLgv4hlM1gubOq/DizMp9Ki6r8b5ckdjVrzv5NVbYtSON+/BBqJ+C6O7L/dUBFqgyXYv00Wh18r7+q/7RAy9h8/4L8W8t/TUc3rv4RM5DKx3wDAfvWIj94aBcBsc1IetODgv3oY0nYIW+y/oGcTFF54AUDkJqS/FKX6PwzNxsC7AOC/ltfN1PUC7L+5Wrz/zHnzP6688w2rNOc/YeV9neCo4b9nlSHXANfuvw9RsxKjY/s/1V8GteXE8j+1C8NdDcfiv2wlcW3YZO+/IOywaA7Q8b9bFP+4Tg36v4GTTeNZi+O/9t/ywdRi77+tRc3yFR7eP2bkcHXJkLO//ITc9SjT4r+qoBf2J0nwv2YHKoswwfm/iQcLspCjAcCb6wCzCvXkvwXv9rkMT/C/YkuwYAMXBMApCNUai9kIwMORhtNuJ+e/BVt01fKF8L+ZqWEfvIjsP6h693QZYNk/WyOTkB2i5b8of+GtdSDxvwpaaulDSwVADMQAX+lOAECEHWF8XNPmv1cr/B+VnvG/XyFG6opcCMD/mtR32/UEQP+2XEF3hui/ulBTjAt88r/imfCfRP+yP9zbvtc8XeO/TZuKJD5G6b/MaTExyXzyvxiTQeElXOO/rbJRQVGN9L/z0wR2g9DqvxOqKRxEX/O/FDGCEei99j9x8zV4VYTmP2lzCnsYk+u/l6ELZ9tg878pRXacaDT/v3k6GZRqoQXAVB67LiP56r94+LDK0Sn0vwO6pZ9b7wFAvK0nKVcc9j8+U/hCvyruv6QMsuuLQ/W/FPhKFYv46j8MyxaDTOW/v9L18g1caO2/vebfvctE9b/7GD8ZrF3xv3gx1AR9bQDAuMEtsM4c77+SabgA2nj0v5xKFIwxsATArKNSBaKsB0Cjara6ozTwv33ArMz7sfa/dF2U0FcWCcDxL357DJX/P69pJmt7c/G/quJYWJZl+L/YntVJlnrSP4sRLzXM+fe/46uU8w3c8r+q4lhYlmX4v85lu5+QRwRAsI0H/WU8479jaeZNtj/zv6riWFiWZfi/sI0H/WU847/OZbufkEcEQHAoPUBrnss/9exKzDtFtT88wM8kax+gP9OqeKeAYog/MW0ItiZvcj+ph+smvt5bP2lCaV5dEUU/StaUmQDaLz+kK9y22BMYP0O3whZuMwI/IIbgZGWE6z7UkjYaEM3UPuezxwa9cr8+LybxRMnFpz6E1N8DbPiRPsYjySMvK3s+//////8fAAj//////zMQCP////9/MiAI/////28yMAj/////YzJACP///z9iMlAI////N2IyYAj///8zYjJwCP//vzNiMoAI//+rM2IykAj/f6szYjKgCP8PqzNiMrAI/wOrM2IywAi/A6szYjLQCJ8DqzNiMuAImQOrM2Iy8Aj//////z8PCP//////Kx8I/////38pLwj/////Pyk/CP////85KU8I////PzgpXwj///8POClvCP///w44KX8I//8fDjgpjwj//w8OOCmfCP9/DQ44Ka8I/w8NDjgpvwj/DQ0OOCnPCP8MDQ44Kd8IxwwNDjgp7wjEDA0OOCn/CAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAABgtRFT7Ifk/GC1EVPsh+b8YLURU+yEJQBgtRFT7IQnAYWxnb3MuYwBoM05laWdoYm9yUm90YXRpb25zAGNvb3JkaWprLmMAX3VwQXA3Q2hlY2tlZABfdXBBcDdyQ2hlY2tlZABkaXJlY3RlZEVkZ2UuYwBkaXJlY3RlZEVkZ2VUb0JvdW5kYXJ5AGFkamFjZW50RmFjZURpclt0bXBGaWprLmZhY2VdW2ZpamsuZmFjZV0gPT0gS0kAZmFjZWlqay5jAF9mYWNlSWprUGVudFRvQ2VsbEJvdW5kYXJ5AGFkamFjZW50RmFjZURpcltjZW50ZXJJSksuZmFjZV1bZmFjZTJdID09IEtJAF9mYWNlSWprVG9DZWxsQm91bmRhcnkAaDNJbmRleC5jAGNvbXBhY3RDZWxscwBsYXRMbmdUb0NlbGwAY2VsbFRvQ2hpbGRQb3MAdmFsaWRhdGVDaGlsZFBvcwBsYXRMbmcuYwBjZWxsQXJlYVJhZHMyAHBvbHlnb24tPm5leHQgPT0gTlVMTABsaW5rZWRHZW8uYwBhZGROZXdMaW5rZWRQb2x5Z29uAG5leHQgIT0gTlVMTABsb29wICE9IE5VTEwAYWRkTmV3TGlua2VkTG9vcABwb2x5Z29uLT5maXJzdCA9PSBOVUxMAGFkZExpbmtlZExvb3AAY29vcmQgIT0gTlVMTABhZGRMaW5rZWRDb29yZABsb29wLT5maXJzdCA9PSBOVUxMAGlubmVyTG9vcHMgIT0gTlVMTABub3JtYWxpemVNdWx0aVBvbHlnb24AYmJveGVzICE9IE5VTEwAY2FuZGlkYXRlcyAhPSBOVUxMAGZpbmRQb2x5Z29uRm9ySG9sZQBjYW5kaWRhdGVCQm94ZXMgIT0gTlVMTAByZXZEaXIgIT0gSU5WQUxJRF9ESUdJVABsb2NhbGlqLmMAY2VsbFRvTG9jYWxJamsAYmFzZUNlbGwgIT0gb3JpZ2luQmFzZUNlbGwAIShvcmlnaW5PblBlbnQgJiYgaW5kZXhPblBlbnQpAGJhc2VDZWxsID09IG9yaWdpbkJhc2VDZWxsAGJhc2VDZWxsICE9IElOVkFMSURfQkFTRV9DRUxMAGxvY2FsSWprVG9DZWxsACFfaXNCYXNlQ2VsbFBlbnRhZ29uKGJhc2VDZWxsKQBiYXNlQ2VsbFJvdGF0aW9ucyA+PSAwAGdyaWRQYXRoQ2VsbHMAcG9seWZpbGwuYwBpdGVyU3RlcFBvbHlnb25Db21wYWN0ADAAdmVydGV4LmMAdmVydGV4Um90YXRpb25zAGNlbGxUb1ZlcnRleABncmFwaC0+YnVja2V0cyAhPSBOVUxMAHZlcnRleEdyYXBoLmMAaW5pdFZlcnRleEdyYXBoAG5vZGUgIT0gTlVMTABhZGRWZXJ0ZXhOb2Rl";var E7=28640;function R7(fe,ve,Fe,Te){nl("Assertion failed: "+q(fe)+", at: "+[ve?q(ve):"unknown filename",Fe,Te?q(Te):"unknown function"])}function Ty(){return K.length}function C7(fe,ve,Fe){te.set(te.subarray(ve,ve+Fe),fe)}function N7(fe){return e.___errno_location&&(Y[e.___errno_location()>>2]=fe),fe}function M7(fe){nl("OOM")}function P7(fe){try{var ve=new ArrayBuffer(fe);return ve.byteLength!=fe?void 0:(new Int8Array(ve).set(K),I7(ve),xe(ve),1)}catch{}}function B7(fe){var ve=Ty(),Fe=16777216,Te=2147483648-Fe;if(fe>Te)return!1;for(var A=16777216,O=Math.max(ve,A);O<fe;)O<=536870912?O=J(2*O,Fe):O=Math.min(J((3*O+2147483648)/4,Fe),Te);var Mt=P7(O);return!!Mt}var D7=typeof atob=="function"?atob:function(fe){var ve="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Fe="",Te,A,O,Mt,Gt,Wn,gt,Pt=0;fe=fe.replace(/[^A-Za-z0-9\+\/\=]/g,"");do Mt=ve.indexOf(fe.charAt(Pt++)),Gt=ve.indexOf(fe.charAt(Pt++)),Wn=ve.indexOf(fe.charAt(Pt++)),gt=ve.indexOf(fe.charAt(Pt++)),Te=Mt<<2|Gt>>4,A=(Gt&15)<<4|Wn>>2,O=(Wn&3)<<6|gt,Fe=Fe+String.fromCharCode(Te),Wn!==64&&(Fe=Fe+String.fromCharCode(A)),gt!==64&&(Fe=Fe+String.fromCharCode(O));while(Pt<fe.length);return Fe};function L7(fe){try{for(var ve=D7(fe),Fe=new Uint8Array(ve.length),Te=0;Te<ve.length;++Te)Fe[Te]=ve.charCodeAt(Te);return Fe}catch{throw new Error("Converting base64 string to bytes failed.")}}function sd(fe){if(xy(fe))return L7(fe.slice(rd.length))}var O7={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},F7={b:p,c:g,d:R7,e:N7,f:Ty,g:C7,h:B7,i:M7,o:E7,p:Oe},Ee=(function(fe,ve,Fe){"almost asm";var Te=new fe.Int8Array(Fe),A=new fe.Int32Array(Fe);new fe.Uint8Array(Fe),new fe.Float32Array(Fe);var O=new fe.Float64Array(Fe),Mt=ve.o|0,Gt=ve.p|0,Wn=fe.Math.floor,gt=fe.Math.abs,Pt=fe.Math.sqrt,go=fe.Math.pow,Ot=fe.Math.cos,yt=fe.Math.sin,Ai=fe.Math.tan,dc=fe.Math.acos,q7=fe.Math.asin,ld=fe.Math.atan,ci=fe.Math.atan2,rl=fe.Math.ceil,es=fe.Math.imul,ud=fe.Math.min,G7=fe.Math.max,Us=fe.Math.clz32,ut=ve.b,V=ve.c,rt=ve.d,Cy=ve.e,V7=ve.f,z7=ve.g,j7=ve.h,$7=ve.i,F=28656;function H7(u){return Te=new Int8Array(u),A=new Int32Array(u),O=new Float64Array(u),Fe=u,!0}function W7(u){u=u|0;var l=0;return l=F,F=F+u|0,F=F+15&-16,l|0}function Q7(){return F|0}function X7(u){u=u|0,F=u}function Y7(u,l){u=u|0,F=u}function K7(u,l){u=u|0,l=l|0;var h=0,d=0,m=0;return(u|0)<0?(l=2,l|0):(u|0)>13780509?(l=_c(15,l)|0,l|0):(h=((u|0)<0)<<31>>31,m=Yn(u|0,h|0,3,0)|0,d=V()|0,h=We(u|0,h|0,1,0)|0,h=Yn(m|0,d|0,h|0,V()|0)|0,h=We(h|0,V()|0,1,0)|0,u=V()|0,A[l>>2]=h,A[l+4>>2]=u,l=0,l|0)}function Ny(u,l,h,d){return u=u|0,l=l|0,h=h|0,d=d|0,My(u,l,h,d,0)|0}function My(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,b=0,w=0,R=0;if(w=F,F=F+16|0,_=w,!(Py(u,l,h,d,m)|0))return d=0,F=w,d|0;do if((h|0)>=0){if((h|0)>13780509){if(y=_c(15,_)|0,y|0)break;b=_,_=A[b>>2]|0,b=A[b+4>>2]|0}else y=((h|0)<0)<<31>>31,R=Yn(h|0,y|0,3,0)|0,b=V()|0,y=We(h|0,y|0,1,0)|0,y=Yn(R|0,b|0,y|0,V()|0)|0,y=We(y|0,V()|0,1,0)|0,b=V()|0,A[_>>2]=y,A[_+4>>2]=b,_=y;if(xo(d|0,0,_<<3|0)|0,m|0){xo(m|0,0,_<<2|0)|0,y=ts(u,l,h,d,m,_,b,0)|0;break}y=Dr(_,4)|0,y?(R=ts(u,l,h,d,y,_,b,0)|0,Qe(y),y=R):y=13}else y=2;while(!1);return R=y,F=w,R|0}function Py(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0;if(ne=F,F=F+16|0,H=ne,W=ne+8|0,$=H,A[$>>2]=u,A[$+4>>2]=l,(h|0)<0)return W=2,F=ne,W|0;if(y=d,A[y>>2]=u,A[y+4>>2]=l,y=(m|0)!=0,y&&(A[m>>2]=0),Zt(u,l)|0)return W=9,F=ne,W|0;A[W>>2]=0;e:do if((h|0)>=1)if(y)for(M=1,R=0,G=0,$=1,y=u;;){if(!(R|G)){if(y=Qn(y,l,4,W,H)|0,y|0)break e;if(l=H,y=A[l>>2]|0,l=A[l+4>>2]|0,Zt(y,l)|0){y=9;break e}}if(y=Qn(y,l,A[26800+(G<<2)>>2]|0,W,H)|0,y|0)break e;if(l=H,y=A[l>>2]|0,l=A[l+4>>2]|0,u=d+(M<<3)|0,A[u>>2]=y,A[u+4>>2]=l,A[m+(M<<2)>>2]=$,u=R+1|0,_=(u|0)==($|0),b=G+1|0,w=(b|0)==6,Zt(y,l)|0){y=9;break e}if($=$+(w&_&1)|0,($|0)>(h|0)){y=0;break}else M=M+1|0,R=_?0:u,G=_?w?0:b:G}else for(M=1,R=0,G=0,$=1,y=u;;){if(!(R|G)){if(y=Qn(y,l,4,W,H)|0,y|0)break e;if(l=H,y=A[l>>2]|0,l=A[l+4>>2]|0,Zt(y,l)|0){y=9;break e}}if(y=Qn(y,l,A[26800+(G<<2)>>2]|0,W,H)|0,y|0)break e;if(l=H,y=A[l>>2]|0,l=A[l+4>>2]|0,u=d+(M<<3)|0,A[u>>2]=y,A[u+4>>2]=l,u=R+1|0,_=(u|0)==($|0),b=G+1|0,w=(b|0)==6,Zt(y,l)|0){y=9;break e}if($=$+(w&_&1)|0,($|0)>(h|0)){y=0;break}else M=M+1|0,R=_?0:u,G=_?w?0:b:G}else y=0;while(!1);return W=y,F=ne,W|0}function ts(u,l,h,d,m,y,_,b){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0,y=y|0,_=_|0,b=b|0;var w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0;if(ne=F,F=F+16|0,H=ne+8|0,W=ne,w=ul(u|0,l|0,y|0,_|0)|0,M=V()|0,G=d+(w<<3)|0,se=G,ce=A[se>>2]|0,se=A[se+4>>2]|0,R=(ce|0)==(u|0)&(se|0)==(l|0),!((ce|0)==0&(se|0)==0|R))do w=We(w|0,M|0,1,0)|0,w=ll(w|0,V()|0,y|0,_|0)|0,M=V()|0,G=d+(w<<3)|0,ce=G,se=A[ce>>2]|0,ce=A[ce+4>>2]|0,R=(se|0)==(u|0)&(ce|0)==(l|0);while(!((se|0)==0&(ce|0)==0|R));if(w=m+(w<<2)|0,R&&(A[w>>2]|0)<=(b|0)||(ce=G,A[ce>>2]=u,A[ce+4>>2]=l,A[w>>2]=b,(b|0)>=(h|0)))return ce=0,F=ne,ce|0;switch(R=b+1|0,A[H>>2]=0,w=Qn(u,l,2,H,W)|0,w|0){case 9:{$=9;break}case 0:{w=W,w=ts(A[w>>2]|0,A[w+4>>2]|0,h,d,m,y,_,R)|0,w||($=9);break}}e:do if(($|0)==9){switch(A[H>>2]=0,w=Qn(u,l,3,H,W)|0,w|0){case 9:break;case 0:{if(w=W,w=ts(A[w>>2]|0,A[w+4>>2]|0,h,d,m,y,_,R)|0,w|0)break e;break}default:break e}switch(A[H>>2]=0,w=Qn(u,l,1,H,W)|0,w|0){case 9:break;case 0:{if(w=W,w=ts(A[w>>2]|0,A[w+4>>2]|0,h,d,m,y,_,R)|0,w|0)break e;break}default:break e}switch(A[H>>2]=0,w=Qn(u,l,5,H,W)|0,w|0){case 9:break;case 0:{if(w=W,w=ts(A[w>>2]|0,A[w+4>>2]|0,h,d,m,y,_,R)|0,w|0)break e;break}default:break e}switch(A[H>>2]=0,w=Qn(u,l,4,H,W)|0,w|0){case 9:break;case 0:{if(w=W,w=ts(A[w>>2]|0,A[w+4>>2]|0,h,d,m,y,_,R)|0,w|0)break e;break}default:break e}switch(A[H>>2]=0,w=Qn(u,l,6,H,W)|0,w|0){case 9:break;case 0:{if(w=W,w=ts(A[w>>2]|0,A[w+4>>2]|0,h,d,m,y,_,R)|0,w|0)break e;break}default:break e}return ce=0,F=ne,ce|0}while(!1);return ce=w,F=ne,ce|0}function Qn(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0;if(h>>>0>6)return m=1,m|0;if(G=(A[d>>2]|0)%6|0,A[d>>2]=G,(G|0)>0){y=0;do h=ca(h)|0,y=y+1|0;while((y|0)<(A[d>>2]|0))}if(G=_e(u|0,l|0,45)|0,V()|0,M=G&127,M>>>0>121)return m=5,m|0;w=Br(u,l)|0,y=_e(u|0,l|0,52)|0,V()|0,y=y&15;e:do if(!y)R=8;else{for(;;){if(_=(15-y|0)*3|0,b=_e(u|0,l|0,_|0)|0,V()|0,b=b&7,(b|0)==7){l=5;break}if(W=(hi(y)|0)==0,y=y+-1|0,$=Re(7,0,_|0)|0,l=l&~(V()|0),H=Re(A[(W?432:16)+(b*28|0)+(h<<2)>>2]|0,0,_|0)|0,_=V()|0,h=A[(W?640:224)+(b*28|0)+(h<<2)>>2]|0,u=H|u&~$,l=_|l,!h){h=0;break e}if(!y){R=8;break e}}return l|0}while(!1);(R|0)==8&&(W=A[848+(M*28|0)+(h<<2)>>2]|0,H=Re(W|0,0,45)|0,u=H|u,l=V()|0|l&-1040385,h=A[4272+(M*28|0)+(h<<2)>>2]|0,(W&127|0)==127&&(W=Re(A[848+(M*28|0)+20>>2]|0,0,45)|0,l=V()|0|l&-1040385,h=A[4272+(M*28|0)+20>>2]|0,u=ha(W|u,l)|0,l=V()|0,A[d>>2]=(A[d>>2]|0)+1)),b=_e(u|0,l|0,45)|0,V()|0,b=b&127;e:do if(an(b)|0){t:do if((Br(u,l)|0)==1){if((M|0)!=(b|0))if(Oy(b,A[7696+(M*28|0)>>2]|0)|0){u=wd(u,l)|0,_=1,l=V()|0;break}else rt(27795,26864,533,26872);switch(w|0){case 3:{u=ha(u,l)|0,l=V()|0,A[d>>2]=(A[d>>2]|0)+1,_=0;break t}case 5:{u=wd(u,l)|0,l=V()|0,A[d>>2]=(A[d>>2]|0)+5,_=0;break t}case 0:return W=9,W|0;default:return W=1,W|0}}else _=0;while(!1);if((h|0)>0){y=0;do u=Td(u,l)|0,l=V()|0,y=y+1|0;while((y|0)!=(h|0))}if((M|0)!=(b|0)){if(!(cd(b)|0)){if((_|0)!=0|(Br(u,l)|0)!=5)break;A[d>>2]=(A[d>>2]|0)+1;break}switch(G&127){case 8:case 118:break e}(Br(u,l)|0)!=3&&(A[d>>2]=(A[d>>2]|0)+1)}}else if((h|0)>0){y=0;do u=ha(u,l)|0,l=V()|0,y=y+1|0;while((y|0)!=(h|0))}while(!1);return A[d>>2]=((A[d>>2]|0)+h|0)%6|0,W=m,A[W>>2]=u,A[W+4>>2]=l,W=0,W|0}function Z7(u,l,h,d){return u=u|0,l=l|0,h=h|0,d=d|0,By(u,l,h,d)|0?(xo(d|0,0,h*48|0)|0,d=J7(u,l,h,d)|0,d|0):(d=0,d|0)}function By(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0;if(W=F,F=F+16|0,$=W,H=W+8|0,G=$,A[G>>2]=u,A[G+4>>2]=l,(h|0)<0)return H=2,F=W,H|0;if(!h)return H=d,A[H>>2]=u,A[H+4>>2]=l,H=0,F=W,H|0;A[H>>2]=0;e:do if(Zt(u,l)|0)u=9;else{m=0,G=u;do{if(u=Qn(G,l,4,H,$)|0,u|0)break e;if(l=$,G=A[l>>2]|0,l=A[l+4>>2]|0,m=m+1|0,Zt(G,l)|0){u=9;break e}}while((m|0)<(h|0));M=d,A[M>>2]=G,A[M+4>>2]=l,M=h+-1|0,R=0,u=1;do{if(m=26800+(R<<2)|0,(R|0)==5)for(_=A[m>>2]|0,y=0,m=u;;){if(u=$,u=Qn(A[u>>2]|0,A[u+4>>2]|0,_,H,$)|0,u|0)break e;if((y|0)!=(M|0))if(w=$,b=A[w>>2]|0,w=A[w+4>>2]|0,u=d+(m<<3)|0,A[u>>2]=b,A[u+4>>2]=w,!(Zt(b,w)|0))u=m+1|0;else{u=9;break e}else u=m;if(y=y+1|0,(y|0)>=(h|0))break;m=u}else for(_=$,w=A[m>>2]|0,b=0,m=u,y=A[_>>2]|0,_=A[_+4>>2]|0;;){if(u=Qn(y,_,w,H,$)|0,u|0)break e;if(_=$,y=A[_>>2]|0,_=A[_+4>>2]|0,u=d+(m<<3)|0,A[u>>2]=y,A[u+4>>2]=_,u=m+1|0,Zt(y,_)|0){u=9;break e}if(b=b+1|0,(b|0)>=(h|0))break;m=u}R=R+1|0}while(R>>>0<6);u=$,u=(G|0)==(A[u>>2]|0)&&(l|0)==(A[u+4>>2]|0)?0:9}while(!1);return H=u,F=W,H|0}function J7(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0;if(G=F,F=F+16|0,_=G,!h)return A[d>>2]=u,A[d+4>>2]=l,d=0,F=G,d|0;do if((h|0)>=0){if((h|0)>13780509){if(m=_c(15,_)|0,m|0)break;y=_,m=A[y>>2]|0,y=A[y+4>>2]|0}else m=((h|0)<0)<<31>>31,M=Yn(h|0,m|0,3,0)|0,y=V()|0,m=We(h|0,m|0,1,0)|0,m=Yn(M|0,y|0,m|0,V()|0)|0,m=We(m|0,V()|0,1,0)|0,y=V()|0,M=_,A[M>>2]=m,A[M+4>>2]=y;if(R=Dr(m,8)|0,!R)m=13;else{if(M=Dr(m,4)|0,!M){Qe(R),m=13;break}if(m=ts(u,l,h,R,M,m,y,0)|0,m|0){Qe(R),Qe(M);break}if(l=A[_>>2]|0,_=A[_+4>>2]|0,(_|0)>0|(_|0)==0&l>>>0>0){m=0,b=0,w=0;do u=R+(b<<3)|0,y=A[u>>2]|0,u=A[u+4>>2]|0,!((y|0)==0&(u|0)==0)&&(A[M+(b<<2)>>2]|0)==(h|0)&&($=d+(m<<3)|0,A[$>>2]=y,A[$+4>>2]=u,m=m+1|0),b=We(b|0,w|0,1,0)|0,w=V()|0;while((w|0)<(_|0)|(w|0)==(_|0)&b>>>0<l>>>0)}Qe(R),Qe(M),m=0}}else m=2;while(!1);return $=m,F=G,$|0}function Ad(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,b=0,w=0,R=0;for(b=F,F=F+16|0,y=b,_=b+8|0,m=(Zt(u,l)|0)==0,m=m?1:2;;){if(A[_>>2]=0,R=(Qn(u,l,m,_,y)|0)==0,w=y,R&((A[w>>2]|0)==(h|0)?(A[w+4>>2]|0)==(d|0):0)){u=4;break}if(m=m+1|0,m>>>0>=7){m=7,u=4;break}}return(u|0)==4?(F=b,m|0):0}function eE(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,b=0,w=0,R=0;if(b=F,F=F+48|0,m=b+16|0,y=b+8|0,_=b,h=Eu(h)|0,h|0)return _=h,F=b,_|0;if(R=u,w=A[R+4>>2]|0,h=y,A[h>>2]=A[R>>2],A[h+4>>2]=w,a_(y,m),h=Uy(m,l,_)|0,!h){if(l=A[y>>2]|0,y=A[u+8>>2]|0,(y|0)>0){m=A[u+12>>2]|0,h=0;do l=(A[m+(h<<3)>>2]|0)+l|0,h=h+1|0;while((h|0)<(y|0))}h=_,m=A[h>>2]|0,h=A[h+4>>2]|0,y=((l|0)<0)<<31>>31,(h|0)<(y|0)|(h|0)==(y|0)&m>>>0<l>>>0?(h=_,A[h>>2]=l,A[h+4>>2]=y,h=y):l=m,w=We(l|0,h|0,12,0)|0,R=V()|0,h=_,A[h>>2]=w,A[h+4>>2]=R,h=d,A[h>>2]=w,A[h+4>>2]=R,h=0}return R=h,F=b,R|0}function Dy(u,l,h,d,m,y,_){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0,y=y|0,_=_|0;var b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0,ie=0,Ne=0,$e=0,qe=0,lt=0,At=0,vt=0,nt=0,He=0,Ce=0,pt=0,Qt=0,ht=0,Xt=0,br=0,b_=0;if(Qt=F,F=F+64|0,nt=Qt+48|0,He=Qt+32|0,Ce=Qt+24|0,Ne=Qt+8|0,$e=Qt,w=A[u>>2]|0,(w|0)<=0)return pt=0,F=Qt,pt|0;for(qe=u+4|0,lt=nt+8|0,At=He+8|0,vt=Ne+8|0,b=0,le=0;;){R=A[qe>>2]|0,Ae=R+(le<<4)|0,A[nt>>2]=A[Ae>>2],A[nt+4>>2]=A[Ae+4>>2],A[nt+8>>2]=A[Ae+8>>2],A[nt+12>>2]=A[Ae+12>>2],(le|0)==(w+-1|0)?(A[He>>2]=A[R>>2],A[He+4>>2]=A[R+4>>2],A[He+8>>2]=A[R+8>>2],A[He+12>>2]=A[R+12>>2]):(Ae=R+(le+1<<4)|0,A[He>>2]=A[Ae>>2],A[He+4>>2]=A[Ae+4>>2],A[He+8>>2]=A[Ae+8>>2],A[He+12>>2]=A[Ae+12>>2]),w=hE(nt,He,d,Ce)|0;e:do if(w)R=0,b=w;else if(w=Ce,R=A[w>>2]|0,w=A[w+4>>2]|0,(w|0)>0|(w|0)==0&R>>>0>0){ce=0,Ae=0;t:for(;;){if(Xt=1/(+(R>>>0)+4294967296*+(w|0)),b_=+O[nt>>3],w=Xn(R|0,w|0,ce|0,Ae|0)|0,br=+(w>>>0)+4294967296*+(V()|0),ht=+(ce>>>0)+4294967296*+(Ae|0),O[Ne>>3]=Xt*(b_*br)+Xt*(+O[He>>3]*ht),O[vt>>3]=Xt*(+O[lt>>3]*br)+Xt*(+O[At>>3]*ht),w=Sd(Ne,d,$e)|0,w|0){b=w;break}se=$e,ne=A[se>>2]|0,se=A[se+4>>2]|0,$=ul(ne|0,se|0,l|0,h|0)|0,M=V()|0,w=_+($<<3)|0,G=w,R=A[G>>2]|0,G=A[G+4>>2]|0;n:do if((R|0)==0&(G|0)==0)ie=w,pt=16;else for(H=0,W=0;;){if((H|0)>(h|0)|(H|0)==(h|0)&W>>>0>l>>>0){b=1;break t}if((R|0)==(ne|0)&(G|0)==(se|0))break n;if(w=We($|0,M|0,1,0)|0,$=ll(w|0,V()|0,l|0,h|0)|0,M=V()|0,W=We(W|0,H|0,1,0)|0,H=V()|0,w=_+($<<3)|0,G=w,R=A[G>>2]|0,G=A[G+4>>2]|0,(R|0)==0&(G|0)==0){ie=w,pt=16;break}}while(!1);if((pt|0)==16&&(pt=0,!((ne|0)==0&(se|0)==0))&&(W=ie,A[W>>2]=ne,A[W+4>>2]=se,W=y+(A[m>>2]<<3)|0,A[W>>2]=ne,A[W+4>>2]=se,W=m,W=We(A[W>>2]|0,A[W+4>>2]|0,1,0)|0,ne=V()|0,se=m,A[se>>2]=W,A[se+4>>2]=ne),ce=We(ce|0,Ae|0,1,0)|0,Ae=V()|0,w=Ce,R=A[w>>2]|0,w=A[w+4>>2]|0,!((w|0)>(Ae|0)|(w|0)==(Ae|0)&R>>>0>ce>>>0)){R=1;break e}}R=0}else R=1;while(!1);if(le=le+1|0,!R){pt=21;break}if(w=A[u>>2]|0,(le|0)>=(w|0)){b=0,pt=21;break}}return(pt|0)==21?(F=Qt,b|0):0}function tE(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0,ie=0,Ne=0,$e=0,qe=0,lt=0,At=0,vt=0,nt=0,He=0,Ce=0,pt=0,Qt=0,ht=0,Xt=0,br=0;if(br=F,F=F+112|0,pt=br+80|0,w=br+72|0,Qt=br,ht=br+56|0,m=Eu(h)|0,m|0)return Xt=m,F=br,Xt|0;if(R=u+8|0,Xt=ns((A[R>>2]<<5)+32|0)|0,!Xt)return Xt=13,F=br,Xt|0;if(Bd(u,Xt),m=Eu(h)|0,!m){if(He=u,Ce=A[He+4>>2]|0,m=w,A[m>>2]=A[He>>2],A[m+4>>2]=Ce,a_(w,pt),m=Uy(pt,l,Qt)|0,m)He=0,Ce=0;else{if(m=A[w>>2]|0,y=A[R>>2]|0,(y|0)>0){_=A[u+12>>2]|0,h=0;do m=(A[_+(h<<3)>>2]|0)+m|0,h=h+1|0;while((h|0)!=(y|0));h=m}else h=m;m=Qt,y=A[m>>2]|0,m=A[m+4>>2]|0,_=((h|0)<0)<<31>>31,(m|0)<(_|0)|(m|0)==(_|0)&y>>>0<h>>>0?(m=Qt,A[m>>2]=h,A[m+4>>2]=_,m=_):h=y,He=We(h|0,m|0,12,0)|0,Ce=V()|0,m=Qt,A[m>>2]=He,A[m+4>>2]=Ce,m=0}if(!m){if(h=Dr(He,8)|0,!h)return Qe(Xt),Xt=13,F=br,Xt|0;if(b=Dr(He,8)|0,!b)return Qe(Xt),Qe(h),Xt=13,F=br,Xt|0;vt=pt,A[vt>>2]=0,A[vt+4>>2]=0,vt=u,nt=A[vt+4>>2]|0,m=w,A[m>>2]=A[vt>>2],A[m+4>>2]=nt,m=Dy(w,He,Ce,l,pt,h,b)|0;e:do if(m)Qe(h),Qe(b),Qe(Xt);else{t:do if((A[R>>2]|0)>0){for(_=u+12|0,y=0;m=Dy((A[_>>2]|0)+(y<<3)|0,He,Ce,l,pt,h,b)|0,y=y+1|0,!(m|0);)if((y|0)>=(A[R>>2]|0))break t;Qe(h),Qe(b),Qe(Xt);break e}while(!1);(Ce|0)>0|(Ce|0)==0&He>>>0>0&&xo(b|0,0,He<<3|0)|0,nt=pt,vt=A[nt+4>>2]|0;t:do if((vt|0)>0|(vt|0)==0&(A[nt>>2]|0)>>>0>0){qe=h,lt=b,At=h,vt=b,nt=h,m=h,ie=h,Ne=b,$e=b,h=b;n:for(;;){for(se=0,ce=0,Ae=0,le=0,y=0,_=0;;){b=Qt,w=b+56|0;do A[b>>2]=0,b=b+4|0;while((b|0)<(w|0));if(l=qe+(se<<3)|0,R=A[l>>2]|0,l=A[l+4>>2]|0,Py(R,l,1,Qt,0)|0){b=Qt,w=b+56|0;do A[b>>2]=0,b=b+4|0;while((b|0)<(w|0));b=Dr(7,4)|0,b|0&&(ts(R,l,1,Qt,b,7,0,0)|0,Qe(b))}for(ne=0;;){W=Qt+(ne<<3)|0,H=A[W>>2]|0,W=A[W+4>>2]|0;r:do if((H|0)==0&(W|0)==0)b=y,w=_;else{if(M=ul(H|0,W|0,He|0,Ce|0)|0,R=V()|0,b=d+(M<<3)|0,l=b,w=A[l>>2]|0,l=A[l+4>>2]|0,!((w|0)==0&(l|0)==0)){G=0,$=0;do{if((G|0)>(Ce|0)|(G|0)==(Ce|0)&$>>>0>He>>>0)break n;if((w|0)==(H|0)&(l|0)==(W|0)){b=y,w=_;break r}b=We(M|0,R|0,1,0)|0,M=ll(b|0,V()|0,He|0,Ce|0)|0,R=V()|0,$=We($|0,G|0,1,0)|0,G=V()|0,b=d+(M<<3)|0,l=b,w=A[l>>2]|0,l=A[l+4>>2]|0}while(!((w|0)==0&(l|0)==0))}if((H|0)==0&(W|0)==0){b=y,w=_;break}fa(H,W,ht)|0,Dd(u,Xt,ht)|0&&($=We(y|0,_|0,1,0)|0,_=V()|0,G=b,A[G>>2]=H,A[G+4>>2]=W,y=lt+(y<<3)|0,A[y>>2]=H,A[y+4>>2]=W,y=$),b=y,w=_}while(!1);if(ne=ne+1|0,ne>>>0>=7)break;y=b,_=w}if(se=We(se|0,ce|0,1,0)|0,ce=V()|0,Ae=We(Ae|0,le|0,1,0)|0,le=V()|0,_=pt,y=A[_>>2]|0,_=A[_+4>>2]|0,(le|0)<(_|0)|(le|0)==(_|0)&Ae>>>0<y>>>0)y=b,_=w;else break}if((_|0)>0|(_|0)==0&y>>>0>0){y=0,_=0;do le=qe+(y<<3)|0,A[le>>2]=0,A[le+4>>2]=0,y=We(y|0,_|0,1,0)|0,_=V()|0,le=pt,Ae=A[le+4>>2]|0;while((_|0)<(Ae|0)|((_|0)==(Ae|0)?y>>>0<(A[le>>2]|0)>>>0:0))}if(le=pt,A[le>>2]=b,A[le+4>>2]=w,(w|0)>0|(w|0)==0&b>>>0>0)ne=h,se=$e,ce=nt,Ae=Ne,le=lt,h=ie,$e=m,Ne=At,ie=ne,m=se,nt=vt,vt=ce,At=Ae,lt=qe,qe=le;else break t}Qe(At),Qe(vt),Qe(Xt),m=1;break e}else m=b;while(!1);Qe(Xt),Qe(h),Qe(m),m=0}while(!1);return Xt=m,F=br,Xt|0}}return Qe(Xt),Xt=m,F=br,Xt|0}function nE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,b=0,w=0,R=0,M=0;if(M=F,F=F+176|0,w=M,(l|0)<1)return f_(h,0,0),R=0,F=M,R|0;for(b=u,b=_e(A[b>>2]|0,A[b+4>>2]|0,52)|0,V()|0,f_(h,(l|0)>6?l:6,b&15),b=0;d=u+(b<<3)|0,d=ol(A[d>>2]|0,A[d+4>>2]|0,w)|0,!(d|0);){if(d=A[w>>2]|0,(d|0)>0){_=0;do y=w+8+(_<<4)|0,_=_+1|0,d=w+8+(((_|0)%(d|0)|0)<<4)|0,m=PR(h,d,y)|0,m?m_(h,m)|0:MR(h,y,d)|0,d=A[w>>2]|0;while((_|0)<(d|0))}if(b=b+1|0,(b|0)>=(l|0)){d=0,R=13;break}}return(R|0)==13?(F=M,d|0):(d_(h),R=d,F=M,R|0)}function rE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0;if(y=F,F=F+32|0,d=y,m=y+16|0,u=nE(u,l,m)|0,u|0)return h=u,F=y,h|0;if(A[h>>2]=0,A[h+4>>2]=0,A[h+8>>2]=0,u=p_(m)|0,u|0)do{l=oR(h)|0;do aR(l,u)|0,_=u+16|0,A[d>>2]=A[_>>2],A[d+4>>2]=A[_+4>>2],A[d+8>>2]=A[_+8>>2],A[d+12>>2]=A[_+12>>2],m_(m,u)|0,u=BR(m,d)|0;while((u|0)!=0);u=p_(m)|0}while((u|0)!=0);return d_(m),u=lR(h)|0,u?(r_(h),_=u,F=y,_|0):(_=0,F=y,_|0)}function an(u){return u=u|0,u>>>0>121?(u=0,u|0):(u=A[7696+(u*28|0)+16>>2]|0,u|0)}function cd(u){return u=u|0,(u|0)==4|(u|0)==117|0}function Ly(u){return u=u|0,A[11120+((A[u>>2]|0)*216|0)+((A[u+4>>2]|0)*72|0)+((A[u+8>>2]|0)*24|0)+(A[u+12>>2]<<3)>>2]|0}function iE(u){return u=u|0,A[11120+((A[u>>2]|0)*216|0)+((A[u+4>>2]|0)*72|0)+((A[u+8>>2]|0)*24|0)+(A[u+12>>2]<<3)+4>>2]|0}function sE(u,l){u=u|0,l=l|0,u=7696+(u*28|0)|0,A[l>>2]=A[u>>2],A[l+4>>2]=A[u+4>>2],A[l+8>>2]=A[u+8>>2],A[l+12>>2]=A[u+12>>2]}function oE(u,l){u=u|0,l=l|0;var h=0,d=0;if(l>>>0>20)return l=-1,l|0;do if((A[11120+(l*216|0)>>2]|0)!=(u|0))if((A[11120+(l*216|0)+8>>2]|0)!=(u|0))if((A[11120+(l*216|0)+16>>2]|0)!=(u|0))if((A[11120+(l*216|0)+24>>2]|0)!=(u|0))if((A[11120+(l*216|0)+32>>2]|0)!=(u|0))if((A[11120+(l*216|0)+40>>2]|0)!=(u|0))if((A[11120+(l*216|0)+48>>2]|0)!=(u|0))if((A[11120+(l*216|0)+56>>2]|0)!=(u|0))if((A[11120+(l*216|0)+64>>2]|0)!=(u|0))if((A[11120+(l*216|0)+72>>2]|0)!=(u|0))if((A[11120+(l*216|0)+80>>2]|0)!=(u|0))if((A[11120+(l*216|0)+88>>2]|0)!=(u|0))if((A[11120+(l*216|0)+96>>2]|0)!=(u|0))if((A[11120+(l*216|0)+104>>2]|0)!=(u|0))if((A[11120+(l*216|0)+112>>2]|0)!=(u|0))if((A[11120+(l*216|0)+120>>2]|0)!=(u|0))if((A[11120+(l*216|0)+128>>2]|0)!=(u|0))if((A[11120+(l*216|0)+136>>2]|0)==(u|0))u=2,h=1,d=2;else{if((A[11120+(l*216|0)+144>>2]|0)==(u|0)){u=0,h=2,d=0;break}if((A[11120+(l*216|0)+152>>2]|0)==(u|0)){u=0,h=2,d=1;break}if((A[11120+(l*216|0)+160>>2]|0)==(u|0)){u=0,h=2,d=2;break}if((A[11120+(l*216|0)+168>>2]|0)==(u|0)){u=1,h=2,d=0;break}if((A[11120+(l*216|0)+176>>2]|0)==(u|0)){u=1,h=2,d=1;break}if((A[11120+(l*216|0)+184>>2]|0)==(u|0)){u=1,h=2,d=2;break}if((A[11120+(l*216|0)+192>>2]|0)==(u|0)){u=2,h=2,d=0;break}if((A[11120+(l*216|0)+200>>2]|0)==(u|0)){u=2,h=2,d=1;break}if((A[11120+(l*216|0)+208>>2]|0)==(u|0)){u=2,h=2,d=2;break}else u=-1;return u|0}else u=2,h=1,d=1;else u=2,h=1,d=0;else u=1,h=1,d=2;else u=1,h=1,d=1;else u=1,h=1,d=0;else u=0,h=1,d=2;else u=0,h=1,d=1;else u=0,h=1,d=0;else u=2,h=0,d=2;else u=2,h=0,d=1;else u=2,h=0,d=0;else u=1,h=0,d=2;else u=1,h=0,d=1;else u=1,h=0,d=0;else u=0,h=0,d=2;else u=0,h=0,d=1;else u=0,h=0,d=0;while(!1);return l=A[11120+(l*216|0)+(h*72|0)+(u*24|0)+(d<<3)+4>>2]|0,l|0}function Oy(u,l){return u=u|0,l=l|0,(A[7696+(u*28|0)+20>>2]|0)==(l|0)?(l=1,l|0):(l=(A[7696+(u*28|0)+24>>2]|0)==(l|0),l|0)}function hd(u,l){return u=u|0,l=l|0,A[848+(u*28|0)+(l<<2)>>2]|0}function fd(u,l){return u=u|0,l=l|0,(A[848+(u*28|0)>>2]|0)==(l|0)?(l=0,l|0):(A[848+(u*28|0)+4>>2]|0)==(l|0)?(l=1,l|0):(A[848+(u*28|0)+8>>2]|0)==(l|0)?(l=2,l|0):(A[848+(u*28|0)+12>>2]|0)==(l|0)?(l=3,l|0):(A[848+(u*28|0)+16>>2]|0)==(l|0)?(l=4,l|0):(A[848+(u*28|0)+20>>2]|0)==(l|0)?(l=5,l|0):((A[848+(u*28|0)+24>>2]|0)==(l|0)?6:7)|0}function aE(){return 122}function lE(u){u=u|0;var l=0,h=0,d=0;l=0;do Re(l|0,0,45)|0,d=V()|0|134225919,h=u+(l<<3)|0,A[h>>2]=-1,A[h+4>>2]=d,l=l+1|0;while((l|0)!=122);return 0}function uE(u){u=u|0;var l=0,h=0,d=0;return d=+O[u+16>>3],h=+O[u+24>>3],l=d-h,+(d<h?l+6.283185307179586:l)}function Fy(u){return u=u|0,+O[u+16>>3]<+O[u+24>>3]|0}function AE(u){return u=u|0,+(+O[u>>3]-+O[u+8>>3])}function dd(u,l){u=u|0,l=l|0;var h=0,d=0,m=0;return h=+O[l>>3],!(h>=+O[u+8>>3])||!(h<=+O[u>>3])?(l=0,l|0):(d=+O[u+16>>3],h=+O[u+24>>3],m=+O[l+8>>3],l=m>=h,u=m<=d&1,d<h?l&&(u=1):l||(u=0),l=(u|0)!=0,l|0)}function pd(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,b=0,w=0,R=0,M=0;return+O[u>>3]<+O[l+8>>3]||+O[u+8>>3]>+O[l>>3]?(d=0,d|0):(y=+O[u+16>>3],h=u+24|0,M=+O[h>>3],_=y<M,d=l+16|0,R=+O[d>>3],m=l+24|0,w=+O[m>>3],b=R<w,l=M-R<w-y,u=_?b|l?1:2:0,l=b?_?1:l?2:1:0,y=+Xr(y,u),y<+Xr(+O[m>>3],l)||(M=+Xr(+O[h>>3],u),M>+Xr(+O[d>>3],l))?(b=0,b|0):(b=1,b|0))}function cE(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,b=0,w=0;y=+O[u+16>>3],w=+O[u+24>>3],u=y<w,b=+O[l+16>>3],_=+O[l+24>>3],m=b<_,l=w-b<_-y,A[h>>2]=u?m|l?1:2:0,A[d>>2]=m?u?1:l?2:1:0}function Iy(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,b=0,w=0,R=0,M=0;return+O[u>>3]<+O[l>>3]||+O[u+8>>3]>+O[l+8>>3]?(d=0,d|0):(d=u+16|0,w=+O[d>>3],y=+O[u+24>>3],_=w<y,h=l+16|0,M=+O[h>>3],m=l+24|0,R=+O[m>>3],b=M<R,l=y-M<R-w,u=_?b|l?1:2:0,l=b?_?1:l?2:1:0,y=+Xr(y,u),y<=+Xr(+O[m>>3],l)?(M=+Xr(+O[d>>3],u),b=M>=+Xr(+O[h>>3],l),b|0):(b=0,b|0))}function ky(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,b=0;m=F,F=F+176|0,d=m,A[d>>2]=4,b=+O[l>>3],O[d+8>>3]=b,y=+O[l+16>>3],O[d+16>>3]=y,O[d+24>>3]=b,b=+O[l+24>>3],O[d+32>>3]=b,_=+O[l+8>>3],O[d+40>>3]=_,O[d+48>>3]=b,O[d+56>>3]=_,O[d+64>>3]=y,l=d+72|0,h=l+96|0;do A[l>>2]=0,l=l+4|0;while((l|0)<(h|0));Al(u|0,d|0,168)|0,F=m}function Uy(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0;W=F,F=F+288|0,M=W+264|0,G=W+96|0,R=W,b=R,w=b+96|0;do A[b>>2]=0,b=b+4|0;while((b|0)<(w|0));return l=Rd(l,R)|0,l|0?(H=l,F=W,H|0):(w=R,R=A[w>>2]|0,w=A[w+4>>2]|0,fa(R,w,M)|0,ol(R,w,G)|0,_=+wu(M,G+8|0),O[M>>3]=+O[u>>3],w=M+8|0,O[w>>3]=+O[u+16>>3],O[G>>3]=+O[u+8>>3],R=G+8|0,O[R>>3]=+O[u+24>>3],m=+wu(M,G),se=+O[w>>3]-+O[R>>3],y=+gt(+se),ne=+O[M>>3]-+O[G>>3],d=+gt(+ne),!(se==0|ne==0)&&(se=+__(+y,+d),se=+rl(+(m*m/+xc(+(se/+xc(+y,+d)),3)/(_*(_*2.59807621135)*.8))),O[Mt>>3]=se,$=~~se>>>0,H=+gt(se)>=1?se>0?~~+ud(+Wn(se/4294967296),4294967295)>>>0:~~+rl((se-+(~~se>>>0))/4294967296)>>>0:0,(A[Mt+4>>2]&2146435072|0)!=2146435072)?(G=($|0)==0&(H|0)==0,l=h,A[l>>2]=G?1:$,A[l+4>>2]=G?0:H,l=0):l=1,H=l,F=W,H|0)}function hE(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,b=0,w=0,R=0,M=0;R=F,F=F+288|0,_=R+264|0,b=R+96|0,w=R,m=w,y=m+96|0;do A[m>>2]=0,m=m+4|0;while((m|0)<(y|0));return h=Rd(h,w)|0,h|0?(d=h,F=R,d|0):(h=w,m=A[h>>2]|0,h=A[h+4>>2]|0,fa(m,h,_)|0,ol(m,h,b)|0,M=+wu(_,b+8|0),M=+rl(+(+wu(u,l)/(M*2))),O[Mt>>3]=M,h=~~M>>>0,m=+gt(M)>=1?M>0?~~+ud(+Wn(M/4294967296),4294967295)>>>0:~~+rl((M-+(~~M>>>0))/4294967296)>>>0:0,(A[Mt+4>>2]&2146435072|0)==2146435072?(d=1,F=R,d|0):(w=(h|0)==0&(m|0)==0,A[d>>2]=w?1:h,A[d+4>>2]=w?0:m,d=0,F=R,d|0))}function fE(u,l){u=u|0,l=+l;var h=0,d=0,m=0,y=0,_=0,b=0,w=0,R=0,M=0;y=u+16|0,_=+O[y>>3],h=u+24|0,m=+O[h>>3],d=_-m,d=_<m?d+6.283185307179586:d,R=+O[u>>3],b=u+8|0,w=+O[b>>3],M=R-w,d=(d*l-d)*.5,l=(M*l-M)*.5,R=R+l,O[u>>3]=R>1.5707963267948966?1.5707963267948966:R,l=w-l,O[b>>3]=l<-1.5707963267948966?-1.5707963267948966:l,l=_+d,l=l>3.141592653589793?l+-6.283185307179586:l,O[y>>3]=l<-3.141592653589793?l+6.283185307179586:l,l=m-d,l=l>3.141592653589793?l+-6.283185307179586:l,O[h>>3]=l<-3.141592653589793?l+6.283185307179586:l}function dE(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0,A[u>>2]=l,A[u+4>>2]=h,A[u+8>>2]=d}function pE(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0;G=l+8|0,A[G>>2]=0,w=+O[u>>3],_=+gt(+w),R=+O[u+8>>3],b=+gt(+R)*1.1547005383792515,_=_+b*.5,h=~~_,u=~~b,_=_-+(h|0),b=b-+(u|0);do if(_<.5)if(_<.3333333333333333)if(A[l>>2]=h,b<(_+1)*.5){A[l+4>>2]=u;break}else{u=u+1|0,A[l+4>>2]=u;break}else if($=1-_,u=(!(b<$)&1)+u|0,A[l+4>>2]=u,$<=b&b<_*2){h=h+1|0,A[l>>2]=h;break}else{A[l>>2]=h;break}else{if(!(_<.6666666666666666))if(h=h+1|0,A[l>>2]=h,b<_*.5){A[l+4>>2]=u;break}else{u=u+1|0,A[l+4>>2]=u;break}if(b<1-_){if(A[l+4>>2]=u,_*2+-1<b){A[l>>2]=h;break}}else u=u+1|0,A[l+4>>2]=u;h=h+1|0,A[l>>2]=h}while(!1);do if(w<0)if(u&1){M=(u+1|0)/2|0,M=Xn(h|0,((h|0)<0)<<31>>31|0,M|0,((M|0)<0)<<31>>31|0)|0,h=~~(+(h|0)-((+(M>>>0)+4294967296*+(V()|0))*2+1)),A[l>>2]=h;break}else{M=(u|0)/2|0,M=Xn(h|0,((h|0)<0)<<31>>31|0,M|0,((M|0)<0)<<31>>31|0)|0,h=~~(+(h|0)-(+(M>>>0)+4294967296*+(V()|0))*2),A[l>>2]=h;break}while(!1);M=l+4|0,R<0&&(h=h-((u<<1|1|0)/2|0)|0,A[l>>2]=h,u=0-u|0,A[M>>2]=u),d=u-h|0,(h|0)<0?(m=0-h|0,A[M>>2]=d,A[G>>2]=m,A[l>>2]=0,u=d,h=0):m=0,(u|0)<0&&(h=h-u|0,A[l>>2]=h,m=m-u|0,A[G>>2]=m,A[M>>2]=0,u=0),y=h-m|0,d=u-m|0,(m|0)<0&&(A[l>>2]=y,A[M>>2]=d,A[G>>2]=0,u=d,h=y,m=0),d=(u|0)<(h|0)?u:h,d=(m|0)<(d|0)?m:d,!((d|0)<=0)&&(A[l>>2]=h-d,A[M>>2]=u-d,A[G>>2]=m-d)}function hr(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0;l=A[u>>2]|0,_=u+4|0,h=A[_>>2]|0,(l|0)<0&&(h=h-l|0,A[_>>2]=h,y=u+8|0,A[y>>2]=(A[y>>2]|0)-l,A[u>>2]=0,l=0),(h|0)<0?(l=l-h|0,A[u>>2]=l,y=u+8|0,m=(A[y>>2]|0)-h|0,A[y>>2]=m,A[_>>2]=0,h=0):(m=u+8|0,y=m,m=A[m>>2]|0),(m|0)<0&&(l=l-m|0,A[u>>2]=l,h=h-m|0,A[_>>2]=h,A[y>>2]=0,m=0),d=(h|0)<(l|0)?h:l,d=(m|0)<(d|0)?m:d,!((d|0)<=0)&&(A[u>>2]=l-d,A[_>>2]=h-d,A[y>>2]=m-d)}function ua(u,l){u=u|0,l=l|0;var h=0,d=0;d=A[u+8>>2]|0,h=+((A[u+4>>2]|0)-d|0),O[l>>3]=+((A[u>>2]|0)-d|0)-h*.5,O[l+8>>3]=h*.8660254037844386}function vr(u,l,h){u=u|0,l=l|0,h=h|0,A[h>>2]=(A[l>>2]|0)+(A[u>>2]|0),A[h+4>>2]=(A[l+4>>2]|0)+(A[u+4>>2]|0),A[h+8>>2]=(A[l+8>>2]|0)+(A[u+8>>2]|0)}function md(u,l,h){u=u|0,l=l|0,h=h|0,A[h>>2]=(A[u>>2]|0)-(A[l>>2]|0),A[h+4>>2]=(A[u+4>>2]|0)-(A[l+4>>2]|0),A[h+8>>2]=(A[u+8>>2]|0)-(A[l+8>>2]|0)}function qy(u,l){u=u|0,l=l|0;var h=0,d=0;h=es(A[u>>2]|0,l)|0,A[u>>2]=h,h=u+4|0,d=es(A[h>>2]|0,l)|0,A[h>>2]=d,u=u+8|0,l=es(A[u>>2]|0,l)|0,A[u>>2]=l}function pc(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,b=0;_=A[u>>2]|0,b=(_|0)<0,d=(A[u+4>>2]|0)-(b?_:0)|0,y=(d|0)<0,m=(y?0-d|0:0)+((A[u+8>>2]|0)-(b?_:0))|0,h=(m|0)<0,u=h?0:m,l=(y?0:d)-(h?m:0)|0,m=(b?0:_)-(y?d:0)-(h?m:0)|0,h=(l|0)<(m|0)?l:m,h=(u|0)<(h|0)?u:h,d=(h|0)>0,u=u-(d?h:0)|0,l=l-(d?h:0)|0;e:do switch(m-(d?h:0)|0){case 0:switch(l|0){case 0:return b=(u|0)==0?0:(u|0)==1?1:7,b|0;case 1:return b=(u|0)==0?2:(u|0)==1?3:7,b|0;default:break e}case 1:switch(l|0){case 0:return b=(u|0)==0?4:(u|0)==1?5:7,b|0;case 1:{if(!u)u=6;else break e;return u|0}default:break e}}while(!1);return b=7,b|0}function mE(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,b=0,w=0,R=0;if(w=u+8|0,_=A[w>>2]|0,b=(A[u>>2]|0)-_|0,R=u+4|0,_=(A[R>>2]|0)-_|0,b>>>0>715827881|_>>>0>715827881){if(d=(b|0)>0,m=2147483647-b|0,y=-2147483648-b|0,(d?(m|0)<(b|0):(y|0)>(b|0))||(h=b<<1,d?(2147483647-h|0)<(b|0):(-2147483648-h|0)>(b|0))||((_|0)>0?(2147483647-_|0)<(_|0):(-2147483648-_|0)>(_|0))||(l=b*3|0,h=_<<1,(d?(m|0)<(h|0):(y|0)>(h|0))||((b|0)>-1?(l|-2147483648|0)>=(_|0):(l^-2147483648|0)<(_|0))))return R=1,R|0}else h=_<<1,l=b*3|0;return d=vo(+(l-_|0)*.14285714285714285)|0,A[u>>2]=d,m=vo(+(h+b|0)*.14285714285714285)|0,A[R>>2]=m,A[w>>2]=0,h=(m|0)<(d|0),l=h?d:m,h=h?m:d,(h|0)<0&&(((h|0)==-2147483648||((l|0)>0?(2147483647-l|0)<(h|0):(-2147483648-l|0)>(h|0)))&&rt(27795,26892,354,26903),((l|0)>-1?(l|-2147483648|0)>=(h|0):(l^-2147483648|0)<(h|0))&&rt(27795,26892,354,26903)),l=m-d|0,(d|0)<0?(h=0-d|0,A[R>>2]=l,A[w>>2]=h,A[u>>2]=0,d=0):(l=m,h=0),(l|0)<0&&(d=d-l|0,A[u>>2]=d,h=h-l|0,A[w>>2]=h,A[R>>2]=0,l=0),y=d-h|0,m=l-h|0,(h|0)<0?(A[u>>2]=y,A[R>>2]=m,A[w>>2]=0,l=m,m=y,h=0):m=d,d=(l|0)<(m|0)?l:m,d=(h|0)<(d|0)?h:d,(d|0)<=0?(R=0,R|0):(A[u>>2]=m-d,A[R>>2]=l-d,A[w>>2]=h-d,R=0,R|0)}function gE(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,b=0,w=0;if(_=u+8|0,m=A[_>>2]|0,y=(A[u>>2]|0)-m|0,b=u+4|0,m=(A[b>>2]|0)-m|0,y>>>0>715827881|m>>>0>715827881){if(h=(y|0)>0,(h?(2147483647-y|0)<(y|0):(-2147483648-y|0)>(y|0))||(l=y<<1,d=(m|0)>0,d?(2147483647-m|0)<(m|0):(-2147483648-m|0)>(m|0)))return b=1,b|0;if(w=m<<1,(d?(2147483647-w|0)<(m|0):(-2147483648-w|0)>(m|0))||(h?(2147483647-l|0)<(m|0):(-2147483648-l|0)>(m|0))||(h=m*3|0,(m|0)>-1?(h|-2147483648|0)>=(y|0):(h^-2147483648|0)<(y|0)))return w=1,w|0}else h=m*3|0,l=y<<1;return d=vo(+(l+m|0)*.14285714285714285)|0,A[u>>2]=d,m=vo(+(h-y|0)*.14285714285714285)|0,A[b>>2]=m,A[_>>2]=0,h=(m|0)<(d|0),l=h?d:m,h=h?m:d,(h|0)<0&&(((h|0)==-2147483648||((l|0)>0?(2147483647-l|0)<(h|0):(-2147483648-l|0)>(h|0)))&&rt(27795,26892,402,26917),((l|0)>-1?(l|-2147483648|0)>=(h|0):(l^-2147483648|0)<(h|0))&&rt(27795,26892,402,26917)),l=m-d|0,(d|0)<0?(h=0-d|0,A[b>>2]=l,A[_>>2]=h,A[u>>2]=0,d=0):(l=m,h=0),(l|0)<0&&(d=d-l|0,A[u>>2]=d,h=h-l|0,A[_>>2]=h,A[b>>2]=0,l=0),y=d-h|0,m=l-h|0,(h|0)<0?(A[u>>2]=y,A[b>>2]=m,A[_>>2]=0,l=m,m=y,h=0):m=d,d=(l|0)<(m|0)?l:m,d=(h|0)<(d|0)?h:d,(d|0)<=0?(w=0,w|0):(A[u>>2]=m-d,A[b>>2]=l-d,A[_>>2]=h-d,w=0,w|0)}function yE(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,b=0;_=u+8|0,h=A[_>>2]|0,l=(A[u>>2]|0)-h|0,b=u+4|0,h=(A[b>>2]|0)-h|0,d=vo(+((l*3|0)-h|0)*.14285714285714285)|0,A[u>>2]=d,l=vo(+((h<<1)+l|0)*.14285714285714285)|0,A[b>>2]=l,A[_>>2]=0,h=l-d|0,(d|0)<0?(y=0-d|0,A[b>>2]=h,A[_>>2]=y,A[u>>2]=0,l=h,d=0,h=y):h=0,(l|0)<0&&(d=d-l|0,A[u>>2]=d,h=h-l|0,A[_>>2]=h,A[b>>2]=0,l=0),y=d-h|0,m=l-h|0,(h|0)<0?(A[u>>2]=y,A[b>>2]=m,A[_>>2]=0,l=m,m=y,h=0):m=d,d=(l|0)<(m|0)?l:m,d=(h|0)<(d|0)?h:d,!((d|0)<=0)&&(A[u>>2]=m-d,A[b>>2]=l-d,A[_>>2]=h-d)}function Gy(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,b=0;_=u+8|0,h=A[_>>2]|0,l=(A[u>>2]|0)-h|0,b=u+4|0,h=(A[b>>2]|0)-h|0,d=vo(+((l<<1)+h|0)*.14285714285714285)|0,A[u>>2]=d,l=vo(+((h*3|0)-l|0)*.14285714285714285)|0,A[b>>2]=l,A[_>>2]=0,h=l-d|0,(d|0)<0?(y=0-d|0,A[b>>2]=h,A[_>>2]=y,A[u>>2]=0,l=h,d=0,h=y):h=0,(l|0)<0&&(d=d-l|0,A[u>>2]=d,h=h-l|0,A[_>>2]=h,A[b>>2]=0,l=0),y=d-h|0,m=l-h|0,(h|0)<0?(A[u>>2]=y,A[b>>2]=m,A[_>>2]=0,l=m,m=y,h=0):m=d,d=(l|0)<(m|0)?l:m,d=(h|0)<(d|0)?h:d,!((d|0)<=0)&&(A[u>>2]=m-d,A[b>>2]=l-d,A[_>>2]=h-d)}function mc(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,b=0;l=A[u>>2]|0,_=u+4|0,h=A[_>>2]|0,b=u+8|0,d=A[b>>2]|0,m=h+(l*3|0)|0,A[u>>2]=m,h=d+(h*3|0)|0,A[_>>2]=h,l=(d*3|0)+l|0,A[b>>2]=l,d=h-m|0,(m|0)<0?(l=l-m|0,A[_>>2]=d,A[b>>2]=l,A[u>>2]=0,h=d,d=0):d=m,(h|0)<0&&(d=d-h|0,A[u>>2]=d,l=l-h|0,A[b>>2]=l,A[_>>2]=0,h=0),y=d-l|0,m=h-l|0,(l|0)<0?(A[u>>2]=y,A[_>>2]=m,A[b>>2]=0,d=y,l=0):m=h,h=(m|0)<(d|0)?m:d,h=(l|0)<(h|0)?l:h,!((h|0)<=0)&&(A[u>>2]=d-h,A[_>>2]=m-h,A[b>>2]=l-h)}function Aa(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,b=0;m=A[u>>2]|0,_=u+4|0,l=A[_>>2]|0,b=u+8|0,h=A[b>>2]|0,d=(l*3|0)+m|0,m=h+(m*3|0)|0,A[u>>2]=m,A[_>>2]=d,l=(h*3|0)+l|0,A[b>>2]=l,h=d-m|0,(m|0)<0?(l=l-m|0,A[_>>2]=h,A[b>>2]=l,A[u>>2]=0,m=0):h=d,(h|0)<0&&(m=m-h|0,A[u>>2]=m,l=l-h|0,A[b>>2]=l,A[_>>2]=0,h=0),y=m-l|0,d=h-l|0,(l|0)<0?(A[u>>2]=y,A[_>>2]=d,A[b>>2]=0,m=y,l=0):d=h,h=(d|0)<(m|0)?d:m,h=(l|0)<(h|0)?l:h,!((h|0)<=0)&&(A[u>>2]=m-h,A[_>>2]=d-h,A[b>>2]=l-h)}function Vy(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,b=0;(l+-1|0)>>>0>=6||(m=(A[15440+(l*12|0)>>2]|0)+(A[u>>2]|0)|0,A[u>>2]=m,b=u+4|0,d=(A[15440+(l*12|0)+4>>2]|0)+(A[b>>2]|0)|0,A[b>>2]=d,_=u+8|0,l=(A[15440+(l*12|0)+8>>2]|0)+(A[_>>2]|0)|0,A[_>>2]=l,h=d-m|0,(m|0)<0?(l=l-m|0,A[b>>2]=h,A[_>>2]=l,A[u>>2]=0,d=0):(h=d,d=m),(h|0)<0&&(d=d-h|0,A[u>>2]=d,l=l-h|0,A[_>>2]=l,A[b>>2]=0,h=0),y=d-l|0,m=h-l|0,(l|0)<0?(A[u>>2]=y,A[b>>2]=m,A[_>>2]=0,d=y,l=0):m=h,h=(m|0)<(d|0)?m:d,h=(l|0)<(h|0)?l:h,!((h|0)<=0)&&(A[u>>2]=d-h,A[b>>2]=m-h,A[_>>2]=l-h))}function zy(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,b=0;m=A[u>>2]|0,_=u+4|0,l=A[_>>2]|0,b=u+8|0,h=A[b>>2]|0,d=l+m|0,m=h+m|0,A[u>>2]=m,A[_>>2]=d,l=h+l|0,A[b>>2]=l,h=d-m|0,(m|0)<0?(l=l-m|0,A[_>>2]=h,A[b>>2]=l,A[u>>2]=0,d=0):(h=d,d=m),(h|0)<0&&(d=d-h|0,A[u>>2]=d,l=l-h|0,A[b>>2]=l,A[_>>2]=0,h=0),y=d-l|0,m=h-l|0,(l|0)<0?(A[u>>2]=y,A[_>>2]=m,A[b>>2]=0,d=y,l=0):m=h,h=(m|0)<(d|0)?m:d,h=(l|0)<(h|0)?l:h,!((h|0)<=0)&&(A[u>>2]=d-h,A[_>>2]=m-h,A[b>>2]=l-h)}function gc(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,b=0;l=A[u>>2]|0,_=u+4|0,d=A[_>>2]|0,b=u+8|0,h=A[b>>2]|0,m=d+l|0,A[u>>2]=m,d=h+d|0,A[_>>2]=d,l=h+l|0,A[b>>2]=l,h=d-m|0,(m|0)<0?(l=l-m|0,A[_>>2]=h,A[b>>2]=l,A[u>>2]=0,d=0):(h=d,d=m),(h|0)<0&&(d=d-h|0,A[u>>2]=d,l=l-h|0,A[b>>2]=l,A[_>>2]=0,h=0),y=d-l|0,m=h-l|0,(l|0)<0?(A[u>>2]=y,A[_>>2]=m,A[b>>2]=0,d=y,l=0):m=h,h=(m|0)<(d|0)?m:d,h=(l|0)<(h|0)?l:h,!((h|0)<=0)&&(A[u>>2]=d-h,A[_>>2]=m-h,A[b>>2]=l-h)}function ca(u){switch(u=u|0,u|0){case 1:{u=5;break}case 5:{u=4;break}case 4:{u=6;break}case 6:{u=2;break}case 2:{u=3;break}case 3:{u=1;break}}return u|0}function yo(u){switch(u=u|0,u|0){case 1:{u=3;break}case 3:{u=2;break}case 2:{u=6;break}case 6:{u=4;break}case 4:{u=5;break}case 5:{u=1;break}}return u|0}function jy(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,b=0;l=A[u>>2]|0,_=u+4|0,h=A[_>>2]|0,b=u+8|0,d=A[b>>2]|0,m=h+(l<<1)|0,A[u>>2]=m,h=d+(h<<1)|0,A[_>>2]=h,l=(d<<1)+l|0,A[b>>2]=l,d=h-m|0,(m|0)<0?(l=l-m|0,A[_>>2]=d,A[b>>2]=l,A[u>>2]=0,h=d,d=0):d=m,(h|0)<0&&(d=d-h|0,A[u>>2]=d,l=l-h|0,A[b>>2]=l,A[_>>2]=0,h=0),y=d-l|0,m=h-l|0,(l|0)<0?(A[u>>2]=y,A[_>>2]=m,A[b>>2]=0,d=y,l=0):m=h,h=(m|0)<(d|0)?m:d,h=(l|0)<(h|0)?l:h,!((h|0)<=0)&&(A[u>>2]=d-h,A[_>>2]=m-h,A[b>>2]=l-h)}function $y(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,b=0;m=A[u>>2]|0,_=u+4|0,l=A[_>>2]|0,b=u+8|0,h=A[b>>2]|0,d=(l<<1)+m|0,m=h+(m<<1)|0,A[u>>2]=m,A[_>>2]=d,l=(h<<1)+l|0,A[b>>2]=l,h=d-m|0,(m|0)<0?(l=l-m|0,A[_>>2]=h,A[b>>2]=l,A[u>>2]=0,m=0):h=d,(h|0)<0&&(m=m-h|0,A[u>>2]=m,l=l-h|0,A[b>>2]=l,A[_>>2]=0,h=0),y=m-l|0,d=h-l|0,(l|0)<0?(A[u>>2]=y,A[_>>2]=d,A[b>>2]=0,m=y,l=0):d=h,h=(d|0)<(m|0)?d:m,h=(l|0)<(h|0)?l:h,!((h|0)<=0)&&(A[u>>2]=m-h,A[_>>2]=d-h,A[b>>2]=l-h)}function gd(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,b=0;return _=(A[u>>2]|0)-(A[l>>2]|0)|0,b=(_|0)<0,d=(A[u+4>>2]|0)-(A[l+4>>2]|0)-(b?_:0)|0,y=(d|0)<0,m=(b?0-_|0:0)+(A[u+8>>2]|0)-(A[l+8>>2]|0)+(y?0-d|0:0)|0,u=(m|0)<0,l=u?0:m,h=(y?0:d)-(u?m:0)|0,m=(b?0:_)-(y?d:0)-(u?m:0)|0,u=(h|0)<(m|0)?h:m,u=(l|0)<(u|0)?l:u,d=(u|0)>0,l=l-(d?u:0)|0,h=h-(d?u:0)|0,u=m-(d?u:0)|0,u=(u|0)>-1?u:0-u|0,h=(h|0)>-1?h:0-h|0,l=(l|0)>-1?l:0-l|0,l=(h|0)>(l|0)?h:l,((u|0)>(l|0)?u:l)|0}function _E(u,l){u=u|0,l=l|0;var h=0;h=A[u+8>>2]|0,A[l>>2]=(A[u>>2]|0)-h,A[l+4>>2]=(A[u+4>>2]|0)-h}function vE(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,b=0;return d=A[u>>2]|0,A[l>>2]=d,m=A[u+4>>2]|0,_=l+4|0,A[_>>2]=m,b=l+8|0,A[b>>2]=0,h=(m|0)<(d|0),u=h?d:m,h=h?m:d,(h|0)<0&&((h|0)==-2147483648||((u|0)>0?(2147483647-u|0)<(h|0):(-2147483648-u|0)>(h|0))||((u|0)>-1?(u|-2147483648|0)>=(h|0):(u^-2147483648|0)<(h|0)))?(l=1,l|0):(u=m-d|0,(d|0)<0?(h=0-d|0,A[_>>2]=u,A[b>>2]=h,A[l>>2]=0,d=0):(u=m,h=0),(u|0)<0&&(d=d-u|0,A[l>>2]=d,h=h-u|0,A[b>>2]=h,A[_>>2]=0,u=0),y=d-h|0,m=u-h|0,(h|0)<0?(A[l>>2]=y,A[_>>2]=m,A[b>>2]=0,u=m,m=y,h=0):m=d,d=(u|0)<(m|0)?u:m,d=(h|0)<(d|0)?h:d,(d|0)<=0?(l=0,l|0):(A[l>>2]=m-d,A[_>>2]=u-d,A[b>>2]=h-d,l=0,l|0))}function Hy(u){u=u|0;var l=0,h=0,d=0,m=0;l=u+8|0,m=A[l>>2]|0,h=m-(A[u>>2]|0)|0,A[u>>2]=h,d=u+4|0,u=(A[d>>2]|0)-m|0,A[d>>2]=u,A[l>>2]=0-(u+h)}function bE(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,b=0;h=A[u>>2]|0,l=0-h|0,A[u>>2]=l,_=u+8|0,A[_>>2]=0,b=u+4|0,d=A[b>>2]|0,m=d+h|0,(h|0)>0?(A[b>>2]=m,A[_>>2]=h,A[u>>2]=0,l=0,d=m):h=0,(d|0)<0?(y=l-d|0,A[u>>2]=y,h=h-d|0,A[_>>2]=h,A[b>>2]=0,m=y-h|0,l=0-h|0,(h|0)<0?(A[u>>2]=m,A[b>>2]=l,A[_>>2]=0,d=l,h=0):(d=0,m=y)):m=l,l=(d|0)<(m|0)?d:m,l=(h|0)<(l|0)?h:l,!((l|0)<=0)&&(A[u>>2]=m-l,A[b>>2]=d-l,A[_>>2]=h-l)}function xE(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,b=0,w=0,R=0,M=0,G=0;if(G=F,F=F+64|0,M=G,b=G+56|0,!(!0&(l&2013265920|0)==134217728&(!0&(d&2013265920|0)==134217728)))return m=5,F=G,m|0;if((u|0)==(h|0)&(l|0)==(d|0))return A[m>>2]=0,m=0,F=G,m|0;if(_=_e(u|0,l|0,52)|0,V()|0,_=_&15,R=_e(h|0,d|0,52)|0,V()|0,(_|0)!=(R&15|0))return m=12,F=G,m|0;if(y=_+-1|0,_>>>0>1){xd(u,l,y,M)|0,xd(h,d,y,b)|0,R=M,w=A[R>>2]|0,R=A[R+4>>2]|0;e:do if((w|0)==(A[b>>2]|0)&&(R|0)==(A[b+4>>2]|0)){_=(_^15)*3|0,y=_e(u|0,l|0,_|0)|0,V()|0,y=y&7,_=_e(h|0,d|0,_|0)|0,V()|0,_=_&7;do if((y|0)==0|(_|0)==0)A[m>>2]=1,y=0;else if((y|0)==7)y=5;else{if((y|0)==1|(_|0)==1&&Zt(w,R)|0){y=5;break}if((A[15536+(y<<2)>>2]|0)!=(_|0)&&(A[15568+(y<<2)>>2]|0)!=(_|0))break e;A[m>>2]=1,y=0}while(!1);return m=y,F=G,m|0}while(!1)}y=M,_=y+56|0;do A[y>>2]=0,y=y+4|0;while((y|0)<(_|0));return Ny(u,l,1,M)|0,l=M,!((A[l>>2]|0)==(h|0)&&(A[l+4>>2]|0)==(d|0))&&(l=M+8|0,!((A[l>>2]|0)==(h|0)&&(A[l+4>>2]|0)==(d|0)))&&(l=M+16|0,!((A[l>>2]|0)==(h|0)&&(A[l+4>>2]|0)==(d|0)))&&(l=M+24|0,!((A[l>>2]|0)==(h|0)&&(A[l+4>>2]|0)==(d|0)))&&(l=M+32|0,!((A[l>>2]|0)==(h|0)&&(A[l+4>>2]|0)==(d|0)))&&(l=M+40|0,!((A[l>>2]|0)==(h|0)&&(A[l+4>>2]|0)==(d|0)))?(y=M+48|0,y=((A[y>>2]|0)==(h|0)?(A[y+4>>2]|0)==(d|0):0)&1):y=1,A[m>>2]=y,m=0,F=G,m|0}function TE(u,l,h,d,m){return u=u|0,l=l|0,h=h|0,d=d|0,m=m|0,h=Ad(u,l,h,d)|0,(h|0)==7?(m=11,m|0):(d=Re(h|0,0,56)|0,l=l&-2130706433|(V()|0)|268435456,A[m>>2]=u|d,A[m+4>>2]=l,m=0,m|0)}function wE(u,l,h){return u=u|0,l=l|0,h=h|0,!0&(l&2013265920|0)==268435456?(A[h>>2]=u,A[h+4>>2]=l&-2130706433|134217728,h=0,h|0):(h=6,h|0)}function SE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0;return m=F,F=F+16|0,d=m,A[d>>2]=0,!0&(l&2013265920|0)==268435456?(y=_e(u|0,l|0,56)|0,V()|0,d=Qn(u,l&-2130706433|134217728,y&7,d,h)|0,F=m,d|0):(d=6,F=m,d|0)}function Wy(u,l){u=u|0,l=l|0;var h=0;switch(h=_e(u|0,l|0,56)|0,V()|0,h&7){case 0:case 7:return h=0,h|0}return h=l&-2130706433|134217728,!(!0&(l&2013265920|0)==268435456)||!0&(l&117440512|0)==16777216&(Zt(u,h)|0)!=0?(h=0,h|0):(h=vd(u,h)|0,h|0)}function EE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0;return m=F,F=F+16|0,d=m,!0&(l&2013265920|0)==268435456?(y=l&-2130706433|134217728,_=h,A[_>>2]=u,A[_+4>>2]=y,A[d>>2]=0,l=_e(u|0,l|0,56)|0,V()|0,d=Qn(u,y,l&7,d,h+8|0)|0,F=m,d|0):(d=6,F=m,d|0)}function RE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0;return m=(Zt(u,l)|0)==0,l=l&-2130706433,d=h,A[d>>2]=m?u:0,A[d+4>>2]=m?l|285212672:0,d=h+8|0,A[d>>2]=u,A[d+4>>2]=l|301989888,d=h+16|0,A[d>>2]=u,A[d+4>>2]=l|318767104,d=h+24|0,A[d>>2]=u,A[d+4>>2]=l|335544320,d=h+32|0,A[d>>2]=u,A[d+4>>2]=l|352321536,h=h+40|0,A[h>>2]=u,A[h+4>>2]=l|369098752,0}function yc(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0;return _=F,F=F+16|0,m=_,y=l&-2130706433|134217728,!0&(l&2013265920|0)==268435456?(d=_e(u|0,l|0,56)|0,V()|0,d=RR(u,y,d&7)|0,(d|0)==-1?(A[h>>2]=0,y=6,F=_,y|0):(sl(u,y,m)|0&&rt(27795,26932,282,26947),l=_e(u|0,l|0,52)|0,V()|0,l=l&15,Zt(u,y)|0?yd(m,l,d,2,h):_d(m,l,d,2,h),y=0,F=_,y|0)):(y=6,F=_,y|0)}function CE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0;d=F,F=F+16|0,m=d,NE(u,l,h,m),pE(m,h+4|0),F=d}function NE(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,b=0,w=0;if(b=F,F=F+16|0,w=b,ME(u,h,w),y=+dc(+(1-+O[w>>3]*.5)),y<1e-16){A[d>>2]=0,A[d+4>>2]=0,A[d+8>>2]=0,A[d+12>>2]=0,F=b;return}if(w=A[h>>2]|0,m=+O[15920+(w*24|0)>>3],m=+Tu(m-+Tu(+YE(15600+(w<<4)|0,u))),hi(l)|0?_=+Tu(m+-.3334731722518321):_=m,m=+Ai(+y)*2.618033988749896,(l|0)>0){u=0;do m=m*2.6457513110645907,u=u+1|0;while((u|0)!=(l|0))}y=+Ot(+_)*m,O[d>>3]=y,_=+yt(+_)*m,O[d+8>>3]=_,F=b}function ME(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0;if(y=F,F=F+32|0,m=y,ER(u,m),A[l>>2]=0,O[h>>3]=5,d=+Fn(16400,m),d<+O[h>>3]&&(A[l>>2]=0,O[h>>3]=d),d=+Fn(16424,m),d<+O[h>>3]&&(A[l>>2]=1,O[h>>3]=d),d=+Fn(16448,m),d<+O[h>>3]&&(A[l>>2]=2,O[h>>3]=d),d=+Fn(16472,m),d<+O[h>>3]&&(A[l>>2]=3,O[h>>3]=d),d=+Fn(16496,m),d<+O[h>>3]&&(A[l>>2]=4,O[h>>3]=d),d=+Fn(16520,m),d<+O[h>>3]&&(A[l>>2]=5,O[h>>3]=d),d=+Fn(16544,m),d<+O[h>>3]&&(A[l>>2]=6,O[h>>3]=d),d=+Fn(16568,m),d<+O[h>>3]&&(A[l>>2]=7,O[h>>3]=d),d=+Fn(16592,m),d<+O[h>>3]&&(A[l>>2]=8,O[h>>3]=d),d=+Fn(16616,m),d<+O[h>>3]&&(A[l>>2]=9,O[h>>3]=d),d=+Fn(16640,m),d<+O[h>>3]&&(A[l>>2]=10,O[h>>3]=d),d=+Fn(16664,m),d<+O[h>>3]&&(A[l>>2]=11,O[h>>3]=d),d=+Fn(16688,m),d<+O[h>>3]&&(A[l>>2]=12,O[h>>3]=d),d=+Fn(16712,m),d<+O[h>>3]&&(A[l>>2]=13,O[h>>3]=d),d=+Fn(16736,m),d<+O[h>>3]&&(A[l>>2]=14,O[h>>3]=d),d=+Fn(16760,m),d<+O[h>>3]&&(A[l>>2]=15,O[h>>3]=d),d=+Fn(16784,m),d<+O[h>>3]&&(A[l>>2]=16,O[h>>3]=d),d=+Fn(16808,m),d<+O[h>>3]&&(A[l>>2]=17,O[h>>3]=d),d=+Fn(16832,m),d<+O[h>>3]&&(A[l>>2]=18,O[h>>3]=d),d=+Fn(16856,m),!(d<+O[h>>3])){F=y;return}A[l>>2]=19,O[h>>3]=d,F=y}function bu(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,b=0;if(y=+SR(u),y<1e-16){l=15600+(l<<4)|0,A[m>>2]=A[l>>2],A[m+4>>2]=A[l+4>>2],A[m+8>>2]=A[l+8>>2],A[m+12>>2]=A[l+12>>2];return}if(_=+ci(+ +O[u+8>>3],+ +O[u>>3]),(h|0)>0){u=0;do y=y*.37796447300922725,u=u+1|0;while((u|0)!=(h|0))}b=y*.3333333333333333,d?(h=(hi(h)|0)==0,y=+ld(+((h?b:b*.37796447300922725)*.381966011250105))):(y=+ld(+(y*.381966011250105)),hi(h)|0&&(_=+Tu(_+.3334731722518321))),KE(15600+(l<<4)|0,+Tu(+O[15920+(l*24|0)>>3]-_),y,m)}function PE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0;d=F,F=F+16|0,m=d,ua(u+4|0,m),bu(m,A[u>>2]|0,l,0,h),F=d}function yd(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0,ie=0,Ne=0,$e=0,qe=0,lt=0,At=0,vt=0,nt=0,He=0,Ce=0,pt=0,Qt=0,ht=0;if(pt=F,F=F+272|0,y=pt+256|0,Ae=pt+240|0,nt=pt,He=pt+224|0,Ce=pt+208|0,le=pt+176|0,ie=pt+160|0,Ne=pt+192|0,$e=pt+144|0,qe=pt+128|0,lt=pt+112|0,At=pt+96|0,vt=pt+80|0,A[y>>2]=l,A[Ae>>2]=A[u>>2],A[Ae+4>>2]=A[u+4>>2],A[Ae+8>>2]=A[u+8>>2],A[Ae+12>>2]=A[u+12>>2],Qy(Ae,y,nt),A[m>>2]=0,Ae=d+h+((d|0)==5&1)|0,(Ae|0)<=(h|0)){F=pt;return}w=A[y>>2]|0,R=He+4|0,M=le+4|0,G=h+5|0,$=16880+(w<<2)|0,H=16960+(w<<2)|0,W=qe+8|0,ne=lt+8|0,se=At+8|0,ce=Ce+4|0,b=h;e:for(;;){_=nt+(((b|0)%5|0)<<4)|0,A[Ce>>2]=A[_>>2],A[Ce+4>>2]=A[_+4>>2],A[Ce+8>>2]=A[_+8>>2],A[Ce+12>>2]=A[_+12>>2];do;while((il(Ce,w,0,1)|0)==2);if((b|0)>(h|0)&(hi(l)|0)!=0){if(A[le>>2]=A[Ce>>2],A[le+4>>2]=A[Ce+4>>2],A[le+8>>2]=A[Ce+8>>2],A[le+12>>2]=A[Ce+12>>2],ua(R,ie),d=A[le>>2]|0,y=A[17040+(d*80|0)+(A[He>>2]<<2)>>2]|0,A[le>>2]=A[18640+(d*80|0)+(y*20|0)>>2],_=A[18640+(d*80|0)+(y*20|0)+16>>2]|0,(_|0)>0){u=0;do zy(M),u=u+1|0;while((u|0)<(_|0))}switch(_=18640+(d*80|0)+(y*20|0)+4|0,A[Ne>>2]=A[_>>2],A[Ne+4>>2]=A[_+4>>2],A[Ne+8>>2]=A[_+8>>2],qy(Ne,(A[$>>2]|0)*3|0),vr(M,Ne,M),hr(M),ua(M,$e),Qt=+(A[H>>2]|0),O[qe>>3]=Qt*3,O[W>>3]=0,ht=Qt*-1.5,O[lt>>3]=ht,O[ne>>3]=Qt*2.598076211353316,O[At>>3]=ht,O[se>>3]=Qt*-2.598076211353316,A[17040+((A[le>>2]|0)*80|0)+(A[Ce>>2]<<2)>>2]|0){case 1:{u=lt,d=qe;break}case 3:{u=At,d=lt;break}case 2:{u=qe,d=At;break}default:{u=12;break e}}A_(ie,$e,d,u,vt),bu(vt,A[le>>2]|0,w,1,m+8+(A[m>>2]<<4)|0),A[m>>2]=(A[m>>2]|0)+1}if((b|0)<(G|0)&&(ua(ce,le),bu(le,A[Ce>>2]|0,w,1,m+8+(A[m>>2]<<4)|0),A[m>>2]=(A[m>>2]|0)+1),A[He>>2]=A[Ce>>2],A[He+4>>2]=A[Ce+4>>2],A[He+8>>2]=A[Ce+8>>2],A[He+12>>2]=A[Ce+12>>2],b=b+1|0,(b|0)>=(Ae|0)){u=3;break}}if((u|0)==3){F=pt;return}else(u|0)==12&&rt(26970,27017,572,27027)}function Qy(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,b=0,w=0;w=F,F=F+128|0,d=w+64|0,m=w,y=d,_=20240,b=y+60|0;do A[y>>2]=A[_>>2],y=y+4|0,_=_+4|0;while((y|0)<(b|0));y=m,_=20304,b=y+60|0;do A[y>>2]=A[_>>2],y=y+4|0,_=_+4|0;while((y|0)<(b|0));b=(hi(A[l>>2]|0)|0)==0,d=b?d:m,m=u+4|0,jy(m),$y(m),hi(A[l>>2]|0)|0&&(Aa(m),A[l>>2]=(A[l>>2]|0)+1),A[h>>2]=A[u>>2],l=h+4|0,vr(m,d,l),hr(l),A[h+16>>2]=A[u>>2],l=h+20|0,vr(m,d+12|0,l),hr(l),A[h+32>>2]=A[u>>2],l=h+36|0,vr(m,d+24|0,l),hr(l),A[h+48>>2]=A[u>>2],l=h+52|0,vr(m,d+36|0,l),hr(l),A[h+64>>2]=A[u>>2],h=h+68|0,vr(m,d+48|0,h),hr(h),F=w}function il(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0;if(W=F,F=F+32|0,$=W+12|0,b=W,H=u+4|0,G=A[16960+(l<<2)>>2]|0,M=(d|0)!=0,G=M?G*3|0:G,m=A[H>>2]|0,R=u+8|0,_=A[R>>2]|0,M){if(y=u+12|0,d=A[y>>2]|0,m=_+m+d|0,(m|0)==(G|0))return H=1,F=W,H|0;w=y}else w=u+12|0,d=A[w>>2]|0,m=_+m+d|0;if((m|0)<=(G|0))return H=0,F=W,H|0;do if((d|0)>0){if(d=A[u>>2]|0,(_|0)>0){y=18640+(d*80|0)+60|0,d=u;break}d=18640+(d*80|0)+40|0,h?(dE($,G,0,0),md(H,$,b),gc(b),vr(b,$,H),y=d,d=u):(y=d,d=u)}else y=18640+((A[u>>2]|0)*80|0)+20|0,d=u;while(!1);if(A[d>>2]=A[y>>2],m=y+16|0,(A[m>>2]|0)>0){d=0;do zy(H),d=d+1|0;while((d|0)<(A[m>>2]|0))}return u=y+4|0,A[$>>2]=A[u>>2],A[$+4>>2]=A[u+4>>2],A[$+8>>2]=A[u+8>>2],l=A[16880+(l<<2)>>2]|0,qy($,M?l*3|0:l),vr(H,$,H),hr(H),M?d=((A[R>>2]|0)+(A[H>>2]|0)+(A[w>>2]|0)|0)==(G|0)?1:2:d=2,H=d,F=W,H|0}function BE(u,l){u=u|0,l=l|0;var h=0;do h=il(u,l,0,1)|0;while((h|0)==2);return h|0}function _d(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0,ie=0,Ne=0,$e=0,qe=0,lt=0,At=0,vt=0,nt=0;if(At=F,F=F+240|0,y=At+224|0,Ne=At+208|0,$e=At,qe=At+192|0,lt=At+176|0,se=At+160|0,ce=At+144|0,Ae=At+128|0,le=At+112|0,ie=At+96|0,A[y>>2]=l,A[Ne>>2]=A[u>>2],A[Ne+4>>2]=A[u+4>>2],A[Ne+8>>2]=A[u+8>>2],A[Ne+12>>2]=A[u+12>>2],Xy(Ne,y,$e),A[m>>2]=0,ne=d+h+((d|0)==6&1)|0,(ne|0)<=(h|0)){F=At;return}w=A[y>>2]|0,R=h+6|0,M=16960+(w<<2)|0,G=ce+8|0,$=Ae+8|0,H=le+8|0,W=qe+4|0,_=0,b=h,d=-1;e:for(;;){if(y=(b|0)%6|0,u=$e+(y<<4)|0,A[qe>>2]=A[u>>2],A[qe+4>>2]=A[u+4>>2],A[qe+8>>2]=A[u+8>>2],A[qe+12>>2]=A[u+12>>2],u=_,_=il(qe,w,0,1)|0,(b|0)>(h|0)&(hi(l)|0)!=0&&(u|0)!=1&&(A[qe>>2]|0)!=(d|0)){switch(ua($e+(((y+5|0)%6|0)<<4)+4|0,lt),ua($e+(y<<4)+4|0,se),vt=+(A[M>>2]|0),O[ce>>3]=vt*3,O[G>>3]=0,nt=vt*-1.5,O[Ae>>3]=nt,O[$>>3]=vt*2.598076211353316,O[le>>3]=nt,O[H>>3]=vt*-2.598076211353316,y=A[Ne>>2]|0,A[17040+(y*80|0)+(((d|0)==(y|0)?A[qe>>2]|0:d)<<2)>>2]|0){case 1:{u=Ae,d=ce;break}case 3:{u=le,d=Ae;break}case 2:{u=ce,d=le;break}default:{u=8;break e}}A_(lt,se,d,u,ie),!(c_(lt,ie)|0)&&!(c_(se,ie)|0)&&(bu(ie,A[Ne>>2]|0,w,1,m+8+(A[m>>2]<<4)|0),A[m>>2]=(A[m>>2]|0)+1)}if((b|0)<(R|0)&&(ua(W,lt),bu(lt,A[qe>>2]|0,w,1,m+8+(A[m>>2]<<4)|0),A[m>>2]=(A[m>>2]|0)+1),b=b+1|0,(b|0)>=(ne|0)){u=3;break}else d=A[qe>>2]|0}if((u|0)==3){F=At;return}else(u|0)==8&&rt(27054,27017,737,27099)}function Xy(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,b=0,w=0;w=F,F=F+160|0,d=w+80|0,m=w,y=d,_=20368,b=y+72|0;do A[y>>2]=A[_>>2],y=y+4|0,_=_+4|0;while((y|0)<(b|0));y=m,_=20448,b=y+72|0;do A[y>>2]=A[_>>2],y=y+4|0,_=_+4|0;while((y|0)<(b|0));b=(hi(A[l>>2]|0)|0)==0,d=b?d:m,m=u+4|0,jy(m),$y(m),hi(A[l>>2]|0)|0&&(Aa(m),A[l>>2]=(A[l>>2]|0)+1),A[h>>2]=A[u>>2],l=h+4|0,vr(m,d,l),hr(l),A[h+16>>2]=A[u>>2],l=h+20|0,vr(m,d+12|0,l),hr(l),A[h+32>>2]=A[u>>2],l=h+36|0,vr(m,d+24|0,l),hr(l),A[h+48>>2]=A[u>>2],l=h+52|0,vr(m,d+36|0,l),hr(l),A[h+64>>2]=A[u>>2],l=h+68|0,vr(m,d+48|0,l),hr(l),A[h+80>>2]=A[u>>2],h=h+84|0,vr(m,d+60|0,h),hr(h),F=w}function DE(u,l){return u=u|0,l=l|0,l=_e(u|0,l|0,52)|0,V()|0,l&15|0}function Yy(u,l){return u=u|0,l=l|0,l=_e(u|0,l|0,45)|0,V()|0,l&127|0}function LE(u,l,h,d){return u=u|0,l=l|0,h=h|0,d=d|0,(h+-1|0)>>>0>14?(d=4,d|0):(h=_e(u|0,l|0,(15-h|0)*3|0)|0,V()|0,A[d>>2]=h&7,d=0,d|0)}function OE(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,b=0,w=0,R=0;if(u>>>0>15)return d=4,d|0;if(l>>>0>121)return d=17,d|0;_=Re(u|0,0,52)|0,m=V()|0,b=Re(l|0,0,45)|0,m=m|(V()|0)|134225919;e:do if((u|0)>=1){for(b=1,_=(Te[20528+l>>0]|0)!=0,y=-1;;){if(l=A[h+(b+-1<<2)>>2]|0,l>>>0>6){m=18,l=10;break}if(!((l|0)==0|_^1))if((l|0)==1){m=19,l=10;break}else _=0;if(R=(15-b|0)*3|0,w=Re(7,0,R|0)|0,m=m&~(V()|0),l=Re(l|0,((l|0)<0)<<31>>31|0,R|0)|0,y=l|y&~w,m=V()|0|m,(b|0)<(u|0))b=b+1|0;else break e}if((l|0)==10)return m|0}else y=-1;while(!1);return R=d,A[R>>2]=y,A[R+4>>2]=m,R=0,R|0}function vd(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0;return!(!0&(l&-16777216|0)==134217728)||(d=_e(u|0,l|0,52)|0,V()|0,d=d&15,h=_e(u|0,l|0,45)|0,V()|0,h=h&127,h>>>0>121)?(u=0,u|0):(_=(d^15)*3|0,m=_e(u|0,l|0,_|0)|0,_=Re(m|0,V()|0,_|0)|0,m=V()|0,y=Xn(-1227133514,-1171,_|0,m|0)|0,!((_&613566756&y|0)==0&(m&4681&(V()|0)|0)==0)||(_=(d*3|0)+19|0,y=Re(~u|0,~l|0,_|0)|0,_=_e(y|0,V()|0,_|0)|0,!((d|0)==15|(_|0)==0&(V()|0)==0))?(_=0,_|0):!(Te[20528+h>>0]|0)||(l=l&8191,(u|0)==0&(l|0)==0)?(_=1,_|0):(_=Od(u|0,l|0)|0,V()|0,((63-_|0)%3|0|0)!=0|0))}function FE(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0;return!0&(l&-16777216|0)==134217728&&(d=_e(u|0,l|0,52)|0,V()|0,d=d&15,h=_e(u|0,l|0,45)|0,V()|0,h=h&127,h>>>0<=121)&&(_=(d^15)*3|0,m=_e(u|0,l|0,_|0)|0,_=Re(m|0,V()|0,_|0)|0,m=V()|0,y=Xn(-1227133514,-1171,_|0,m|0)|0,(_&613566756&y|0)==0&(m&4681&(V()|0)|0)==0)&&(_=(d*3|0)+19|0,y=Re(~u|0,~l|0,_|0)|0,_=_e(y|0,V()|0,_|0)|0,(d|0)==15|(_|0)==0&(V()|0)==0)&&(!(Te[20528+h>>0]|0)||(h=l&8191,(u|0)==0&(h|0)==0)||(_=Od(u|0,h|0)|0,V()|0,(63-_|0)%3|0|0))||Wy(u,l)|0?(_=1,_|0):(_=(h_(u,l)|0)!=0&1,_|0)}function bd(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,b=0;if(m=Re(l|0,0,52)|0,y=V()|0,h=Re(h|0,0,45)|0,h=y|(V()|0)|134225919,(l|0)<1){y=-1,d=h,l=u,A[l>>2]=y,u=u+4|0,A[u>>2]=d;return}for(y=1,m=-1;_=(15-y|0)*3|0,b=Re(7,0,_|0)|0,h=h&~(V()|0),_=Re(d|0,0,_|0)|0,m=m&~b|_,h=h|(V()|0),(y|0)!=(l|0);)y=y+1|0;b=u,_=b,A[_>>2]=m,b=b+4|0,A[b>>2]=h}function xd(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0;if(y=_e(u|0,l|0,52)|0,V()|0,y=y&15,h>>>0>15)return d=4,d|0;if((y|0)<(h|0))return d=12,d|0;if((y|0)==(h|0))return A[d>>2]=u,A[d+4>>2]=l,d=0,d|0;if(m=Re(h|0,0,52)|0,m=m|u,u=V()|0|l&-15728641,(y|0)>(h|0))do l=Re(7,0,(14-h|0)*3|0)|0,h=h+1|0,m=l|m,u=V()|0|u;while((h|0)<(y|0));return A[d>>2]=m,A[d+4>>2]=u,d=0,d|0}function xu(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0;if(y=_e(u|0,l|0,52)|0,V()|0,y=y&15,!((h|0)<16&(y|0)<=(h|0)))return d=4,d|0;m=h-y|0,h=_e(u|0,l|0,45)|0,V()|0;e:do if(!(an(h&127)|0))h=_o(7,0,m,((m|0)<0)<<31>>31)|0,m=V()|0;else{t:do if(y|0){for(h=1;_=Re(7,0,(15-h|0)*3|0)|0,!!((_&u|0)==0&((V()|0)&l|0)==0);)if(h>>>0<y>>>0)h=h+1|0;else break t;h=_o(7,0,m,((m|0)<0)<<31>>31)|0,m=V()|0;break e}while(!1);h=_o(7,0,m,((m|0)<0)<<31>>31)|0,h=Yn(h|0,V()|0,5,0)|0,h=We(h|0,V()|0,-5,-1)|0,h=bo(h|0,V()|0,6,0)|0,h=We(h|0,V()|0,1,0)|0,m=V()|0}while(!1);return _=d,A[_>>2]=h,A[_+4>>2]=m,_=0,_|0}function Zt(u,l){u=u|0,l=l|0;var h=0,d=0,m=0;if(m=_e(u|0,l|0,45)|0,V()|0,!(an(m&127)|0))return m=0,m|0;m=_e(u|0,l|0,52)|0,V()|0,m=m&15;e:do if(!m)h=0;else for(d=1;;){if(h=_e(u|0,l|0,(15-d|0)*3|0)|0,V()|0,h=h&7,h|0)break e;if(d>>>0<m>>>0)d=d+1|0;else{h=0;break}}while(!1);return m=(h|0)==0&1,m|0}function IE(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,b=0;if(_=F,F=F+16|0,y=_,Cd(y,u,l,h),l=y,u=A[l>>2]|0,l=A[l+4>>2]|0,(u|0)==0&(l|0)==0)return F=_,0;m=0,h=0;do b=d+(m<<3)|0,A[b>>2]=u,A[b+4>>2]=l,m=We(m|0,h|0,1,0)|0,h=V()|0,Nd(y),b=y,u=A[b>>2]|0,l=A[b+4>>2]|0;while(!((u|0)==0&(l|0)==0));return F=_,0}function Ky(u,l,h,d){return u=u|0,l=l|0,h=h|0,d=d|0,(d|0)<(h|0)?(h=l,d=u,ut(h|0),d|0):(h=Re(-1,-1,((d-h|0)*3|0)+3|0)|0,d=Re(~h|0,~(V()|0)|0,(15-d|0)*3|0)|0,h=~(V()|0)&l,d=~d&u,ut(h|0),d|0)}function Zy(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0;return m=_e(u|0,l|0,52)|0,V()|0,m=m&15,(h|0)<16&(m|0)<=(h|0)?((m|0)<(h|0)&&(m=Re(-1,-1,((h+-1-m|0)*3|0)+3|0)|0,m=Re(~m|0,~(V()|0)|0,(15-h|0)*3|0)|0,l=~(V()|0)&l,u=~m&u),m=Re(h|0,0,52)|0,h=l&-15728641|(V()|0),A[d>>2]=u|m,A[d+4>>2]=h,d=0,d|0):(d=4,d|0)}function kE(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0,ie=0,Ne=0,$e=0,qe=0,lt=0,At=0,vt=0,nt=0,He=0,Ce=0;if((h|0)==0&(d|0)==0)return Ce=0,Ce|0;if(m=u,y=A[m>>2]|0,m=A[m+4>>2]|0,!0&(m&15728640|0)==0){if(!((d|0)>0|(d|0)==0&h>>>0>0)||(Ce=l,A[Ce>>2]=y,A[Ce+4>>2]=m,(h|0)==1&(d|0)==0))return Ce=0,Ce|0;m=1,y=0;do nt=u+(m<<3)|0,He=A[nt+4>>2]|0,Ce=l+(m<<3)|0,A[Ce>>2]=A[nt>>2],A[Ce+4>>2]=He,m=We(m|0,y|0,1,0)|0,y=V()|0;while((y|0)<(d|0)|(y|0)==(d|0)&m>>>0<h>>>0);return m=0,m|0}if(vt=h<<3,He=ns(vt)|0,!He)return Ce=13,Ce|0;if(Al(He|0,u|0,vt|0)|0,nt=Dr(h,8)|0,!nt)return Qe(He),Ce=13,Ce|0;e:for(;;){m=He,R=A[m>>2]|0,m=A[m+4>>2]|0,lt=_e(R|0,m|0,52)|0,V()|0,lt=lt&15,At=lt+-1|0,qe=(lt|0)!=0,$e=(d|0)>0|(d|0)==0&h>>>0>0;t:do if(qe&$e){if(Ae=Re(At|0,0,52)|0,le=V()|0,At>>>0>15){if(!((R|0)==0&(m|0)==0)){Ce=16;break e}for(y=0,u=0;;){if(y=We(y|0,u|0,1,0)|0,u=V()|0,!((u|0)<(d|0)|(u|0)==(d|0)&y>>>0<h>>>0))break t;if(_=He+(y<<3)|0,Ne=A[_>>2]|0,_=A[_+4>>2]|0,!((Ne|0)==0&(_|0)==0)){m=_,Ce=16;break e}}}for(b=R,u=m,y=0,_=0;;){if(!((b|0)==0&(u|0)==0)){if(!(!0&(u&117440512|0)==0)){Ce=21;break e}if(M=_e(b|0,u|0,52)|0,V()|0,M=M&15,(M|0)<(At|0)){m=12,Ce=27;break e}if((M|0)!=(At|0)&&(b=b|Ae,u=u&-15728641|le,M>>>0>=lt>>>0)){w=At;do Ne=Re(7,0,(14-w|0)*3|0)|0,w=w+1|0,b=Ne|b,u=V()|0|u;while(w>>>0<M>>>0)}if($=ul(b|0,u|0,h|0,d|0)|0,H=V()|0,w=nt+($<<3)|0,M=w,G=A[M>>2]|0,M=A[M+4>>2]|0,!((G|0)==0&(M|0)==0)){se=0,ce=0;do{if((se|0)>(d|0)|(se|0)==(d|0)&ce>>>0>h>>>0){Ce=31;break e}if((G|0)==(b|0)&(M&-117440513|0)==(u|0)){W=_e(G|0,M|0,56)|0,V()|0,W=W&7,ne=W+1|0,Ne=_e(G|0,M|0,45)|0,V()|0;n:do if(!(an(Ne&127)|0))M=7;else{if(G=_e(G|0,M|0,52)|0,V()|0,G=G&15,!G){M=6;break}for(M=1;;){if(Ne=Re(7,0,(15-M|0)*3|0)|0,!((Ne&b|0)==0&((V()|0)&u|0)==0)){M=7;break n}if(M>>>0<G>>>0)M=M+1|0;else{M=6;break}}}while(!1);if((W+2|0)>>>0>M>>>0){Ce=41;break e}Ne=Re(ne|0,0,56)|0,u=V()|0|u&-117440513,ie=w,A[ie>>2]=0,A[ie+4>>2]=0,b=Ne|b}else $=We($|0,H|0,1,0)|0,$=ll($|0,V()|0,h|0,d|0)|0,H=V()|0;ce=We(ce|0,se|0,1,0)|0,se=V()|0,w=nt+($<<3)|0,M=w,G=A[M>>2]|0,M=A[M+4>>2]|0}while(!((G|0)==0&(M|0)==0))}Ne=w,A[Ne>>2]=b,A[Ne+4>>2]=u}if(y=We(y|0,_|0,1,0)|0,_=V()|0,!((_|0)<(d|0)|(_|0)==(d|0)&y>>>0<h>>>0))break t;u=He+(y<<3)|0,b=A[u>>2]|0,u=A[u+4>>2]|0}}while(!1);if(Ne=We(h|0,d|0,5,0)|0,ie=V()|0,ie>>>0<0|(ie|0)==0&Ne>>>0<11){Ce=85;break}if(Ne=bo(h|0,d|0,6,0)|0,V()|0,Ne=Dr(Ne,8)|0,!Ne){Ce=48;break}do if($e){for(ne=0,u=0,W=0,se=0;;){if(M=nt+(ne<<3)|0,_=M,y=A[_>>2]|0,_=A[_+4>>2]|0,(y|0)==0&(_|0)==0)ie=W;else{G=_e(y|0,_|0,56)|0,V()|0,G=G&7,b=G+1|0,$=_&-117440513,ie=_e(y|0,_|0,45)|0,V()|0;t:do if(an(ie&127)|0){if(H=_e(y|0,_|0,52)|0,V()|0,H=H&15,H|0)for(w=1;;){if(ie=Re(7,0,(15-w|0)*3|0)|0,!((y&ie|0)==0&($&(V()|0)|0)==0))break t;if(w>>>0<H>>>0)w=w+1|0;else break}_=Re(b|0,0,56)|0,y=_|y,_=V()|0|$,b=M,A[b>>2]=y,A[b+4>>2]=_,b=G+2|0}while(!1);(b|0)==7?(ie=Ne+(u<<3)|0,A[ie>>2]=y,A[ie+4>>2]=_&-117440513,u=We(u|0,W|0,1,0)|0,ie=V()|0):ie=W}if(ne=We(ne|0,se|0,1,0)|0,se=V()|0,(se|0)<(d|0)|(se|0)==(d|0)&ne>>>0<h>>>0)W=ie;else break}if($e){if(ce=At>>>0>15,Ae=Re(At|0,0,52)|0,le=V()|0,!qe){for(y=0,w=0,b=0,_=0;(R|0)==0&(m|0)==0||(At=l+(y<<3)|0,A[At>>2]=R,A[At+4>>2]=m,y=We(y|0,w|0,1,0)|0,w=V()|0),b=We(b|0,_|0,1,0)|0,_=V()|0,!!((_|0)<(d|0)|(_|0)==(d|0)&b>>>0<h>>>0);)m=He+(b<<3)|0,R=A[m>>2]|0,m=A[m+4>>2]|0;m=ie;break}for(y=0,w=0,_=0,b=0;;){do if(!((R|0)==0&(m|0)==0)){if(H=_e(R|0,m|0,52)|0,V()|0,H=H&15,ce|(H|0)<(At|0)){Ce=80;break e}if((H|0)!=(At|0)){if(M=R|Ae,G=m&-15728641|le,H>>>0>=lt>>>0){$=At;do qe=Re(7,0,(14-$|0)*3|0)|0,$=$+1|0,M=qe|M,G=V()|0|G;while($>>>0<H>>>0)}}else M=R,G=m;W=ul(M|0,G|0,h|0,d|0)|0,$=0,H=0,se=V()|0;do{if(($|0)>(d|0)|($|0)==(d|0)&H>>>0>h>>>0){Ce=81;break e}if(qe=nt+(W<<3)|0,ne=A[qe+4>>2]|0,(ne&-117440513|0)==(G|0)&&(A[qe>>2]|0)==(M|0)){Ce=65;break}qe=We(W|0,se|0,1,0)|0,W=ll(qe|0,V()|0,h|0,d|0)|0,se=V()|0,H=We(H|0,$|0,1,0)|0,$=V()|0,qe=nt+(W<<3)|0}while(!((A[qe>>2]|0)==(M|0)&&(A[qe+4>>2]|0)==(G|0)));if((Ce|0)==65&&(Ce=0,!0&(ne&117440512|0)==100663296))break;qe=l+(y<<3)|0,A[qe>>2]=R,A[qe+4>>2]=m,y=We(y|0,w|0,1,0)|0,w=V()|0}while(!1);if(_=We(_|0,b|0,1,0)|0,b=V()|0,!((b|0)<(d|0)|(b|0)==(d|0)&_>>>0<h>>>0))break;m=He+(_<<3)|0,R=A[m>>2]|0,m=A[m+4>>2]|0}m=ie}else y=0,m=ie}else y=0,u=0,m=0;while(!1);if(xo(nt|0,0,vt|0)|0,Al(He|0,Ne|0,u<<3|0)|0,Qe(Ne),(u|0)==0&(m|0)==0){Ce=89;break}else l=l+(y<<3)|0,d=m,h=u}if((Ce|0)==16)!0&(m&117440512|0)==0?(m=4,Ce=27):Ce=21;else if((Ce|0)==31)rt(27795,27122,620,27132);else{if((Ce|0)==41)return Qe(He),Qe(nt),Ce=10,Ce|0;if((Ce|0)==48)return Qe(He),Qe(nt),Ce=13,Ce|0;(Ce|0)==80?rt(27795,27122,711,27132):(Ce|0)==81?rt(27795,27122,723,27132):(Ce|0)==85&&(Al(l|0,He|0,h<<3|0)|0,Ce=89)}return(Ce|0)==21?(Qe(He),Qe(nt),Ce=5,Ce|0):(Ce|0)==27?(Qe(He),Qe(nt),Ce=m,Ce|0):(Ce|0)==89?(Qe(He),Qe(nt),Ce=0,Ce|0):0}function UE(u,l,h,d,m,y,_){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0,y=y|0,_=_|0;var b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0;if(ne=F,F=F+16|0,W=ne,!((h|0)>0|(h|0)==0&l>>>0>0))return W=0,F=ne,W|0;if((_|0)>=16)return W=12,F=ne,W|0;$=0,H=0,G=0,b=0;e:for(;;){if(R=u+($<<3)|0,w=A[R>>2]|0,R=A[R+4>>2]|0,M=_e(w|0,R|0,52)|0,V()|0,(M&15|0)>(_|0)){b=12,w=11;break}if(Cd(W,w,R,_),M=W,R=A[M>>2]|0,M=A[M+4>>2]|0,(R|0)==0&(M|0)==0)w=G;else{w=G;do{if(!((b|0)<(y|0)|(b|0)==(y|0)&w>>>0<m>>>0)){w=10;break e}G=d+(w<<3)|0,A[G>>2]=R,A[G+4>>2]=M,w=We(w|0,b|0,1,0)|0,b=V()|0,Nd(W),G=W,R=A[G>>2]|0,M=A[G+4>>2]|0}while(!((R|0)==0&(M|0)==0))}if($=We($|0,H|0,1,0)|0,H=V()|0,(H|0)<(h|0)|(H|0)==(h|0)&$>>>0<l>>>0)G=w;else{b=0,w=11;break}}return(w|0)==10?(W=14,F=ne,W|0):(w|0)==11?(F=ne,b|0):0}function qE(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0;$=F,F=F+16|0,G=$;e:do if((h|0)>0|(h|0)==0&l>>>0>0){for(R=0,_=0,y=0,M=0;;){if(w=u+(R<<3)|0,b=A[w>>2]|0,w=A[w+4>>2]|0,!((b|0)==0&(w|0)==0)&&(w=(xu(b,w,d,G)|0)==0,b=G,_=We(A[b>>2]|0,A[b+4>>2]|0,_|0,y|0)|0,y=V()|0,!w)){y=12;break}if(R=We(R|0,M|0,1,0)|0,M=V()|0,!((M|0)<(h|0)|(M|0)==(h|0)&R>>>0<l>>>0))break e}return F=$,y|0}else _=0,y=0;while(!1);return A[m>>2]=_,A[m+4>>2]=y,m=0,F=$,m|0}function GE(u,l){return u=u|0,l=l|0,l=_e(u|0,l|0,52)|0,V()|0,l&1|0}function Br(u,l){u=u|0,l=l|0;var h=0,d=0,m=0;if(m=_e(u|0,l|0,52)|0,V()|0,m=m&15,!m)return m=0,m|0;for(d=1;;){if(h=_e(u|0,l|0,(15-d|0)*3|0)|0,V()|0,h=h&7,h|0){d=5;break}if(d>>>0<m>>>0)d=d+1|0;else{h=0,d=5;break}}return(d|0)==5?h|0:0}function Td(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,b=0,w=0;if(w=_e(u|0,l|0,52)|0,V()|0,w=w&15,!w)return b=l,w=u,ut(b|0),w|0;for(b=1,h=0;;){y=(15-b|0)*3|0,d=Re(7,0,y|0)|0,m=V()|0,_=_e(u|0,l|0,y|0)|0,V()|0,y=Re(ca(_&7)|0,0,y|0)|0,_=V()|0,u=y|u&~d,l=_|l&~m;e:do if(!h)if((y&d|0)==0&(_&m|0)==0)h=0;else if(d=_e(u|0,l|0,52)|0,V()|0,d=d&15,!d)h=1;else{h=1;t:for(;;){switch(_=_e(u|0,l|0,(15-h|0)*3|0)|0,V()|0,_&7){case 1:break t;case 0:break;default:{h=1;break e}}if(h>>>0<d>>>0)h=h+1|0;else{h=1;break e}}for(h=1;;)if(_=(15-h|0)*3|0,m=_e(u|0,l|0,_|0)|0,V()|0,y=Re(7,0,_|0)|0,l=l&~(V()|0),_=Re(ca(m&7)|0,0,_|0)|0,u=u&~y|_,l=l|(V()|0),h>>>0<d>>>0)h=h+1|0;else{h=1;break}}while(!1);if(b>>>0<w>>>0)b=b+1|0;else break}return ut(l|0),u|0}function ha(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0;if(d=_e(u|0,l|0,52)|0,V()|0,d=d&15,!d)return h=l,d=u,ut(h|0),d|0;for(h=1;y=(15-h|0)*3|0,_=_e(u|0,l|0,y|0)|0,V()|0,m=Re(7,0,y|0)|0,l=l&~(V()|0),y=Re(ca(_&7)|0,0,y|0)|0,u=y|u&~m,l=V()|0|l,h>>>0<d>>>0;)h=h+1|0;return ut(l|0),u|0}function VE(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,b=0,w=0;if(w=_e(u|0,l|0,52)|0,V()|0,w=w&15,!w)return b=l,w=u,ut(b|0),w|0;for(b=1,h=0;;){y=(15-b|0)*3|0,d=Re(7,0,y|0)|0,m=V()|0,_=_e(u|0,l|0,y|0)|0,V()|0,y=Re(yo(_&7)|0,0,y|0)|0,_=V()|0,u=y|u&~d,l=_|l&~m;e:do if(!h)if((y&d|0)==0&(_&m|0)==0)h=0;else if(d=_e(u|0,l|0,52)|0,V()|0,d=d&15,!d)h=1;else{h=1;t:for(;;){switch(_=_e(u|0,l|0,(15-h|0)*3|0)|0,V()|0,_&7){case 1:break t;case 0:break;default:{h=1;break e}}if(h>>>0<d>>>0)h=h+1|0;else{h=1;break e}}for(h=1;;)if(m=(15-h|0)*3|0,y=Re(7,0,m|0)|0,_=l&~(V()|0),l=_e(u|0,l|0,m|0)|0,V()|0,l=Re(yo(l&7)|0,0,m|0)|0,u=u&~y|l,l=_|(V()|0),h>>>0<d>>>0)h=h+1|0;else{h=1;break}}while(!1);if(b>>>0<w>>>0)b=b+1|0;else break}return ut(l|0),u|0}function wd(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0;if(d=_e(u|0,l|0,52)|0,V()|0,d=d&15,!d)return h=l,d=u,ut(h|0),d|0;for(h=1;_=(15-h|0)*3|0,y=Re(7,0,_|0)|0,m=l&~(V()|0),l=_e(u|0,l|0,_|0)|0,V()|0,l=Re(yo(l&7)|0,0,_|0)|0,u=l|u&~y,l=V()|0|m,h>>>0<d>>>0;)h=h+1|0;return ut(l|0),u|0}function zE(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,b=0,w=0,R=0,M=0;if(w=F,F=F+64|0,b=w+40|0,d=w+24|0,m=w+12|0,y=w,Re(l|0,0,52)|0,h=V()|0|134225919,!l)return(A[u+4>>2]|0)>2||(A[u+8>>2]|0)>2||(A[u+12>>2]|0)>2?(_=0,b=0,ut(_|0),F=w,b|0):(Re(Ly(u)|0,0,45)|0,_=V()|0|h,b=-1,ut(_|0),F=w,b|0);if(A[b>>2]=A[u>>2],A[b+4>>2]=A[u+4>>2],A[b+8>>2]=A[u+8>>2],A[b+12>>2]=A[u+12>>2],_=b+4|0,(l|0)>0)for(u=-1;A[d>>2]=A[_>>2],A[d+4>>2]=A[_+4>>2],A[d+8>>2]=A[_+8>>2],l&1?(yE(_),A[m>>2]=A[_>>2],A[m+4>>2]=A[_+4>>2],A[m+8>>2]=A[_+8>>2],mc(m)):(Gy(_),A[m>>2]=A[_>>2],A[m+4>>2]=A[_+4>>2],A[m+8>>2]=A[_+8>>2],Aa(m)),md(d,m,y),hr(y),M=(15-l|0)*3|0,R=Re(7,0,M|0)|0,h=h&~(V()|0),M=Re(pc(y)|0,0,M|0)|0,u=M|u&~R,h=V()|0|h,(l|0)>1;)l=l+-1|0;else u=-1;e:do if((A[_>>2]|0)<=2&&(A[b+8>>2]|0)<=2&&(A[b+12>>2]|0)<=2){if(d=Ly(b)|0,l=Re(d|0,0,45)|0,l=l|u,u=V()|0|h&-1040385,y=iE(b)|0,!(an(d)|0)){if((y|0)<=0)break;for(m=0;;){if(d=_e(l|0,u|0,52)|0,V()|0,d=d&15,d)for(h=1;M=(15-h|0)*3|0,b=_e(l|0,u|0,M|0)|0,V()|0,R=Re(7,0,M|0)|0,u=u&~(V()|0),M=Re(ca(b&7)|0,0,M|0)|0,l=l&~R|M,u=u|(V()|0),h>>>0<d>>>0;)h=h+1|0;if(m=m+1|0,(m|0)==(y|0))break e}}m=_e(l|0,u|0,52)|0,V()|0,m=m&15;t:do if(m){h=1;n:for(;;){switch(M=_e(l|0,u|0,(15-h|0)*3|0)|0,V()|0,M&7){case 1:break n;case 0:break;default:break t}if(h>>>0<m>>>0)h=h+1|0;else break t}if(Oy(d,A[b>>2]|0)|0)for(h=1;b=(15-h|0)*3|0,R=Re(7,0,b|0)|0,M=u&~(V()|0),u=_e(l|0,u|0,b|0)|0,V()|0,u=Re(yo(u&7)|0,0,b|0)|0,l=l&~R|u,u=M|(V()|0),h>>>0<m>>>0;)h=h+1|0;else for(h=1;M=(15-h|0)*3|0,b=_e(l|0,u|0,M|0)|0,V()|0,R=Re(7,0,M|0)|0,u=u&~(V()|0),M=Re(ca(b&7)|0,0,M|0)|0,l=l&~R|M,u=u|(V()|0),h>>>0<m>>>0;)h=h+1|0}while(!1);if((y|0)>0){h=0;do l=Td(l,u)|0,u=V()|0,h=h+1|0;while((h|0)!=(y|0))}}else l=0,u=0;while(!1);return R=u,M=l,ut(R|0),F=w,M|0}function hi(u){return u=u|0,(u|0)%2|0|0}function Sd(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0;return m=F,F=F+16|0,d=m,l>>>0>15?(d=4,F=m,d|0):(A[u+4>>2]&2146435072|0)==2146435072||(A[u+8+4>>2]&2146435072|0)==2146435072?(d=3,F=m,d|0):(CE(u,l,d),l=zE(d,l)|0,d=V()|0,A[h>>2]=l,A[h+4>>2]=d,(l|0)==0&(d|0)==0&&rt(27795,27122,1050,27145),d=0,F=m,d|0)}function Ed(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0;if(m=h+4|0,y=_e(u|0,l|0,52)|0,V()|0,y=y&15,_=_e(u|0,l|0,45)|0,V()|0,d=(y|0)==0,an(_&127)|0){if(d)return _=1,_|0;d=1}else{if(d)return _=0,_|0;(A[m>>2]|0)==0&&(A[h+8>>2]|0)==0?d=(A[h+12>>2]|0)!=0&1:d=1}for(h=1;h&1?mc(m):Aa(m),_=_e(u|0,l|0,(15-h|0)*3|0)|0,V()|0,Vy(m,_&7),h>>>0<y>>>0;)h=h+1|0;return d|0}function sl(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,b=0,w=0,R=0,M=0;if(M=F,F=F+16|0,w=M,R=_e(u|0,l|0,45)|0,V()|0,R=R&127,R>>>0>121)return A[h>>2]=0,A[h+4>>2]=0,A[h+8>>2]=0,A[h+12>>2]=0,R=5,F=M,R|0;e:do if((an(R)|0)!=0&&(y=_e(u|0,l|0,52)|0,V()|0,y=y&15,(y|0)!=0)){d=1;t:for(;;){switch(b=_e(u|0,l|0,(15-d|0)*3|0)|0,V()|0,b&7){case 5:break t;case 0:break;default:{d=l;break e}}if(d>>>0<y>>>0)d=d+1|0;else{d=l;break e}}for(m=1,d=l;l=(15-m|0)*3|0,_=Re(7,0,l|0)|0,b=d&~(V()|0),d=_e(u|0,d|0,l|0)|0,V()|0,d=Re(yo(d&7)|0,0,l|0)|0,u=u&~_|d,d=b|(V()|0),m>>>0<y>>>0;)m=m+1|0}else d=l;while(!1);if(b=7696+(R*28|0)|0,A[h>>2]=A[b>>2],A[h+4>>2]=A[b+4>>2],A[h+8>>2]=A[b+8>>2],A[h+12>>2]=A[b+12>>2],!(Ed(u,d,h)|0))return R=0,F=M,R|0;if(_=h+4|0,A[w>>2]=A[_>>2],A[w+4>>2]=A[_+4>>2],A[w+8>>2]=A[_+8>>2],y=_e(u|0,d|0,52)|0,V()|0,b=y&15,y&1?(Aa(_),y=b+1|0):y=b,!(an(R)|0))d=0;else{e:do if(!b)d=0;else for(l=1;;){if(m=_e(u|0,d|0,(15-l|0)*3|0)|0,V()|0,m=m&7,m|0){d=m;break e}if(l>>>0<b>>>0)l=l+1|0;else{d=0;break}}while(!1);d=(d|0)==4&1}if(!(il(h,y,d,0)|0))(y|0)!=(b|0)&&(A[_>>2]=A[w>>2],A[_+4>>2]=A[w+4>>2],A[_+8>>2]=A[w+8>>2]);else{if(an(R)|0)do;while((il(h,y,0,0)|0)!=0);(y|0)!=(b|0)&&Gy(_)}return R=0,F=M,R|0}function fa(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0;return y=F,F=F+16|0,d=y,m=sl(u,l,d)|0,m|0?(F=y,m|0):(m=_e(u|0,l|0,52)|0,V()|0,PE(d,m&15,h),m=0,F=y,m|0)}function ol(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,b=0;if(_=F,F=F+16|0,y=_,d=sl(u,l,y)|0,d|0)return y=d,F=_,y|0;d=_e(u|0,l|0,45)|0,V()|0,d=(an(d&127)|0)==0,m=_e(u|0,l|0,52)|0,V()|0,m=m&15;e:do if(!d){if(m|0)for(d=1;;){if(b=Re(7,0,(15-d|0)*3|0)|0,!((b&u|0)==0&((V()|0)&l|0)==0))break e;if(d>>>0<m>>>0)d=d+1|0;else break}return yd(y,m,0,5,h),b=0,F=_,b|0}while(!1);return _d(y,m,0,6,h),b=0,F=_,b|0}function jE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0;if(m=_e(u|0,l|0,45)|0,V()|0,!(an(m&127)|0))return m=2,A[h>>2]=m,0;if(m=_e(u|0,l|0,52)|0,V()|0,m=m&15,!m)return m=5,A[h>>2]=m,0;for(d=1;;){if(y=Re(7,0,(15-d|0)*3|0)|0,!((y&u|0)==0&((V()|0)&l|0)==0)){d=2,u=6;break}if(d>>>0<m>>>0)d=d+1|0;else{d=5,u=6;break}}return(u|0)==6&&(A[h>>2]=d),0}function Jy(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,b=0,w=0,R=0,M=0,G=0;G=F,F=F+128|0,R=G+112|0,y=G+96|0,M=G,m=_e(u|0,l|0,52)|0,V()|0,b=m&15,A[R>>2]=b,_=_e(u|0,l|0,45)|0,V()|0,_=_&127;e:do if(an(_)|0){if(b|0)for(d=1;;){if(w=Re(7,0,(15-d|0)*3|0)|0,!((w&u|0)==0&((V()|0)&l|0)==0)){m=0;break e}if(d>>>0<b>>>0)d=d+1|0;else break}if(m&1)m=1;else return w=Re(b+1|0,0,52)|0,M=V()|0|l&-15728641,R=Re(7,0,(14-b|0)*3|0)|0,M=Jy((w|u)&~R,M&~(V()|0),h)|0,F=G,M|0}else m=0;while(!1);if(d=sl(u,l,y)|0,!d){m?(Qy(y,R,M),w=5):(Xy(y,R,M),w=6);e:do if(an(_)|0)if(!b)u=5;else for(d=1;;){if(_=Re(7,0,(15-d|0)*3|0)|0,!((_&u|0)==0&((V()|0)&l|0)==0)){u=2;break e}if(d>>>0<b>>>0)d=d+1|0;else{u=5;break}}else u=2;while(!1);xo(h|0,-1,u<<2|0)|0;e:do if(m)for(y=0;;){if(_=M+(y<<4)|0,BE(_,A[R>>2]|0)|0,_=A[_>>2]|0,b=A[h>>2]|0,(b|0)==-1|(b|0)==(_|0))d=h;else{m=0;do{if(m=m+1|0,m>>>0>=u>>>0){d=1;break e}d=h+(m<<2)|0,b=A[d>>2]|0}while(!((b|0)==-1|(b|0)==(_|0)))}if(A[d>>2]=_,y=y+1|0,y>>>0>=w>>>0){d=0;break}}else for(y=0;;){if(_=M+(y<<4)|0,il(_,A[R>>2]|0,0,1)|0,_=A[_>>2]|0,b=A[h>>2]|0,(b|0)==-1|(b|0)==(_|0))d=h;else{m=0;do{if(m=m+1|0,m>>>0>=u>>>0){d=1;break e}d=h+(m<<2)|0,b=A[d>>2]|0}while(!((b|0)==-1|(b|0)==(_|0)))}if(A[d>>2]=_,y=y+1|0,y>>>0>=w>>>0){d=0;break}}while(!1)}return M=d,F=G,M|0}function $E(){return 12}function Rd(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,b=0,w=0;if(u>>>0>15)return b=4,b|0;if(Re(u|0,0,52)|0,b=V()|0|134225919,!u){h=0,d=0;do an(d)|0&&(Re(d|0,0,45)|0,_=b|(V()|0),u=l+(h<<3)|0,A[u>>2]=-1,A[u+4>>2]=_,h=h+1|0),d=d+1|0;while((d|0)!=122);return h=0,h|0}h=0,_=0;do{if(an(_)|0){for(Re(_|0,0,45)|0,d=1,m=-1,y=b|(V()|0);w=Re(7,0,(15-d|0)*3|0)|0,m=m&~w,y=y&~(V()|0),(d|0)!=(u|0);)d=d+1|0;w=l+(h<<3)|0,A[w>>2]=m,A[w+4>>2]=y,h=h+1|0}_=_+1|0}while((_|0)!=122);return h=0,h|0}function HE(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0;if(Ae=F,F=F+16|0,se=Ae,ce=_e(u|0,l|0,52)|0,V()|0,ce=ce&15,h>>>0>15)return ce=4,F=Ae,ce|0;if((ce|0)<(h|0))return ce=12,F=Ae,ce|0;if((ce|0)!=(h|0))if(y=Re(h|0,0,52)|0,y=y|u,b=V()|0|l&-15728641,(ce|0)>(h|0)){w=h;do ne=Re(7,0,(14-w|0)*3|0)|0,w=w+1|0,y=ne|y,b=V()|0|b;while((w|0)<(ce|0));ne=y}else ne=y;else ne=u,b=l;W=_e(ne|0,b|0,45)|0,V()|0;e:do if(an(W&127)|0){if(w=_e(ne|0,b|0,52)|0,V()|0,w=w&15,w|0)for(y=1;;){if(W=Re(7,0,(15-y|0)*3|0)|0,!((W&ne|0)==0&((V()|0)&b|0)==0)){R=33;break e}if(y>>>0<w>>>0)y=y+1|0;else break}if(W=d,A[W>>2]=0,A[W+4>>2]=0,(ce|0)>(h|0)){for(W=l&-15728641,H=ce;;){if($=H,H=H+-1|0,H>>>0>15|(ce|0)<(H|0)){R=19;break}if((ce|0)!=(H|0))if(y=Re(H|0,0,52)|0,y=y|u,w=V()|0|W,(ce|0)<($|0))G=y;else{R=H;do G=Re(7,0,(14-R|0)*3|0)|0,R=R+1|0,y=G|y,w=V()|0|w;while((R|0)<(ce|0));G=y}else G=u,w=l;if(M=_e(G|0,w|0,45)|0,V()|0,!(an(M&127)|0))y=0;else{M=_e(G|0,w|0,52)|0,V()|0,M=M&15;t:do if(!M)y=0;else for(R=1;;){if(y=_e(G|0,w|0,(15-R|0)*3|0)|0,V()|0,y=y&7,y|0)break t;if(R>>>0<M>>>0)R=R+1|0;else{y=0;break}}while(!1);y=(y|0)==0&1}if(w=_e(u|0,l|0,(15-$|0)*3|0)|0,V()|0,w=w&7,(w|0)==7){m=5,R=42;break}if(y=(y|0)!=0,(w|0)==1&y){m=5,R=42;break}if(G=w+(((w|0)!=0&y)<<31>>31)|0,G|0&&(R=ce-$|0,R=_o(7,0,R,((R|0)<0)<<31>>31)|0,M=V()|0,y?(y=Yn(R|0,M|0,5,0)|0,y=We(y|0,V()|0,-5,-1)|0,y=bo(y|0,V()|0,6,0)|0,y=We(y|0,V()|0,1,0)|0,w=V()|0):(y=R,w=M),$=G+-1|0,$=Yn(R|0,M|0,$|0,(($|0)<0)<<31>>31|0)|0,$=We(y|0,w|0,$|0,V()|0)|0,G=V()|0,M=d,M=We($|0,G|0,A[M>>2]|0,A[M+4>>2]|0)|0,G=V()|0,$=d,A[$>>2]=M,A[$+4>>2]=G),(H|0)<=(h|0)){R=37;break}}if((R|0)==19)rt(27795,27122,1367,27158);else if((R|0)==37){_=d,m=A[_+4>>2]|0,_=A[_>>2]|0;break}else if((R|0)==42)return F=Ae,m|0}else m=0,_=0}else R=33;while(!1);e:do if((R|0)==33)if(W=d,A[W>>2]=0,A[W+4>>2]=0,(ce|0)>(h|0)){for(y=ce;;){if(m=_e(u|0,l|0,(15-y|0)*3|0)|0,V()|0,m=m&7,(m|0)==7){m=5;break}if(_=ce-y|0,_=_o(7,0,_,((_|0)<0)<<31>>31)|0,m=Yn(_|0,V()|0,m|0,0)|0,_=V()|0,W=d,_=We(A[W>>2]|0,A[W+4>>2]|0,m|0,_|0)|0,m=V()|0,W=d,A[W>>2]=_,A[W+4>>2]=m,y=y+-1|0,(y|0)<=(h|0))break e}return F=Ae,m|0}else m=0,_=0;while(!1);return xu(ne,b,ce,se)|0&&rt(27795,27122,1327,27173),ce=se,se=A[ce+4>>2]|0,((m|0)>-1|(m|0)==-1&_>>>0>4294967295)&((se|0)>(m|0)|((se|0)==(m|0)?(A[ce>>2]|0)>>>0>_>>>0:0))?(ce=0,F=Ae,ce|0):(rt(27795,27122,1407,27158),0)}function WE(u,l,h,d,m,y){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0,y=y|0;var _=0,b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0;if(G=F,F=F+16|0,_=G,m>>>0>15)return y=4,F=G,y|0;if(b=_e(h|0,d|0,52)|0,V()|0,b=b&15,(b|0)>(m|0))return y=12,F=G,y|0;if(xu(h,d,m,_)|0&&rt(27795,27122,1327,27173),M=_,R=A[M+4>>2]|0,!(((l|0)>-1|(l|0)==-1&u>>>0>4294967295)&((R|0)>(l|0)|((R|0)==(l|0)?(A[M>>2]|0)>>>0>u>>>0:0))))return y=2,F=G,y|0;M=m-b|0,m=Re(m|0,0,52)|0,w=V()|0|d&-15728641,R=y,A[R>>2]=m|h,A[R+4>>2]=w,R=_e(h|0,d|0,45)|0,V()|0;e:do if(an(R&127)|0){if(b|0)for(_=1;;){if(R=Re(7,0,(15-_|0)*3|0)|0,!((R&h|0)==0&((V()|0)&d|0)==0))break e;if(_>>>0<b>>>0)_=_+1|0;else break}if((M|0)<1)return y=0,F=G,y|0;for(R=b^15,d=-1,w=1,_=1;;){b=M-w|0,b=_o(7,0,b,((b|0)<0)<<31>>31)|0,h=V()|0;do if(_)if(_=Yn(b|0,h|0,5,0)|0,_=We(_|0,V()|0,-5,-1)|0,_=bo(_|0,V()|0,6,0)|0,m=V()|0,(l|0)>(m|0)|(l|0)==(m|0)&u>>>0>_>>>0){l=We(u|0,l|0,-1,-1)|0,l=Xn(l|0,V()|0,_|0,m|0)|0,_=V()|0,$=y,W=A[$>>2]|0,$=A[$+4>>2]|0,ne=(R+d|0)*3|0,H=Re(7,0,ne|0)|0,$=$&~(V()|0),d=bo(l|0,_|0,b|0,h|0)|0,u=V()|0,m=We(d|0,u|0,2,0)|0,ne=Re(m|0,V()|0,ne|0)|0,$=V()|0|$,m=y,A[m>>2]=ne|W&~H,A[m+4>>2]=$,u=Yn(d|0,u|0,b|0,h|0)|0,u=Xn(l|0,_|0,u|0,V()|0)|0,_=0,l=V()|0;break}else{ne=y,H=A[ne>>2]|0,ne=A[ne+4>>2]|0,W=Re(7,0,(R+d|0)*3|0)|0,ne=ne&~(V()|0),_=y,A[_>>2]=H&~W,A[_+4>>2]=ne,_=1;break}else H=y,m=A[H>>2]|0,H=A[H+4>>2]|0,d=(R+d|0)*3|0,$=Re(7,0,d|0)|0,H=H&~(V()|0),ne=bo(u|0,l|0,b|0,h|0)|0,_=V()|0,d=Re(ne|0,_|0,d|0)|0,H=V()|0|H,W=y,A[W>>2]=d|m&~$,A[W+4>>2]=H,_=Yn(ne|0,_|0,b|0,h|0)|0,u=Xn(u|0,l|0,_|0,V()|0)|0,_=0,l=V()|0;while(!1);if((M|0)>(w|0))d=~w,w=w+1|0;else{l=0;break}}return F=G,l|0}while(!1);if((M|0)<1)return ne=0,F=G,ne|0;for(m=b^15,_=1;;)if(W=M-_|0,W=_o(7,0,W,((W|0)<0)<<31>>31)|0,ne=V()|0,w=y,h=A[w>>2]|0,w=A[w+4>>2]|0,b=(m-_|0)*3|0,d=Re(7,0,b|0)|0,w=w&~(V()|0),$=bo(u|0,l|0,W|0,ne|0)|0,H=V()|0,b=Re($|0,H|0,b|0)|0,w=V()|0|w,R=y,A[R>>2]=b|h&~d,A[R+4>>2]=w,ne=Yn($|0,H|0,W|0,ne|0)|0,u=Xn(u|0,l|0,ne|0,V()|0)|0,l=V()|0,(M|0)<=(_|0)){l=0;break}else _=_+1|0;return F=G,l|0}function Cd(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0;m=_e(l|0,h|0,52)|0,V()|0,m=m&15,(l|0)==0&(h|0)==0|((d|0)>15|(m|0)>(d|0))?(y=-1,l=-1,h=0,m=0):(l=Ky(l,h,m+1|0,d)|0,_=(V()|0)&-15728641,h=Re(d|0,0,52)|0,h=l|h,_=_|(V()|0),l=(Zt(h,_)|0)==0,y=m,l=l?-1:d,m=_),_=u,A[_>>2]=h,A[_+4>>2]=m,A[u+8>>2]=y,A[u+12>>2]=l}function e_(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0;if(m=_e(u|0,l|0,52)|0,V()|0,m=m&15,y=d+8|0,A[y>>2]=m,(u|0)==0&(l|0)==0|((h|0)>15|(m|0)>(h|0))){h=d,A[h>>2]=0,A[h+4>>2]=0,A[y>>2]=-1,A[d+12>>2]=-1;return}if(u=Ky(u,l,m+1|0,h)|0,y=(V()|0)&-15728641,m=Re(h|0,0,52)|0,m=u|m,y=y|(V()|0),u=d,A[u>>2]=m,A[u+4>>2]=y,u=d+12|0,Zt(m,y)|0){A[u>>2]=h;return}else{A[u>>2]=-1;return}}function Nd(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,b=0,w=0,R=0;if(h=u,l=A[h>>2]|0,h=A[h+4>>2]|0,!((l|0)==0&(h|0)==0)&&(d=_e(l|0,h|0,52)|0,V()|0,d=d&15,b=Re(1,0,(d^15)*3|0)|0,l=We(b|0,V()|0,l|0,h|0)|0,h=V()|0,b=u,A[b>>2]=l,A[b+4>>2]=h,b=u+8|0,_=A[b>>2]|0,!((d|0)<(_|0)))){for(w=u+12|0,y=d;;){if((y|0)==(_|0)){d=5;break}if(R=(y|0)==(A[w>>2]|0),m=(15-y|0)*3|0,d=_e(l|0,h|0,m|0)|0,V()|0,d=d&7,R&((d|0)==1&!0)){d=7;break}if(!((d|0)==7&!0)){d=10;break}if(R=Re(1,0,m|0)|0,l=We(l|0,h|0,R|0,V()|0)|0,h=V()|0,R=u,A[R>>2]=l,A[R+4>>2]=h,(y|0)>(_|0))y=y+-1|0;else{d=10;break}}if((d|0)==5){R=u,A[R>>2]=0,A[R+4>>2]=0,A[b>>2]=-1,A[w>>2]=-1;return}else if((d|0)==7){_=Re(1,0,m|0)|0,_=We(l|0,h|0,_|0,V()|0)|0,b=V()|0,R=u,A[R>>2]=_,A[R+4>>2]=b,A[w>>2]=y+-1;return}else if((d|0)==10)return}}function Tu(u){u=+u;var l=0;return l=u<0?u+6.283185307179586:u,+(u>=6.283185307179586?l+-6.283185307179586:l)}function al(u,l){return u=u|0,l=l|0,+gt(+(+O[u>>3]-+O[l>>3]))<17453292519943298e-27?(l=+gt(+(+O[u+8>>3]-+O[l+8>>3]))<17453292519943298e-27,l|0):(l=0,l|0)}function Xr(u,l){switch(u=+u,l=l|0,l|0){case 1:{u=u<0?u+6.283185307179586:u;break}case 2:{u=u>0?u+-6.283185307179586:u;break}}return+u}function QE(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0;return m=+O[l>>3],d=+O[u>>3],y=+yt(+((m-d)*.5)),h=+yt(+((+O[l+8>>3]-+O[u+8>>3])*.5)),h=y*y+h*(+Ot(+m)*+Ot(+d)*h),+(+ci(+ +Pt(+h),+ +Pt(+(1-h)))*2)}function wu(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0;return m=+O[l>>3],d=+O[u>>3],y=+yt(+((m-d)*.5)),h=+yt(+((+O[l+8>>3]-+O[u+8>>3])*.5)),h=y*y+h*(+Ot(+m)*+Ot(+d)*h),+(+ci(+ +Pt(+h),+ +Pt(+(1-h)))*2*6371.007180918475)}function XE(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0;return m=+O[l>>3],d=+O[u>>3],y=+yt(+((m-d)*.5)),h=+yt(+((+O[l+8>>3]-+O[u+8>>3])*.5)),h=y*y+h*(+Ot(+m)*+Ot(+d)*h),+(+ci(+ +Pt(+h),+ +Pt(+(1-h)))*2*6371.007180918475*1e3)}function YE(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0;return y=+O[l>>3],d=+Ot(+y),m=+O[l+8>>3]-+O[u+8>>3],_=d*+yt(+m),h=+O[u>>3],+ +ci(+_,+(+yt(+y)*+Ot(+h)-+Ot(+m)*(d*+yt(+h))))}function KE(u,l,h,d){u=u|0,l=+l,h=+h,d=d|0;var m=0,y=0,_=0,b=0;if(h<1e-16){A[d>>2]=A[u>>2],A[d+4>>2]=A[u+4>>2],A[d+8>>2]=A[u+8>>2],A[d+12>>2]=A[u+12>>2];return}y=l<0?l+6.283185307179586:l,y=l>=6.283185307179586?y+-6.283185307179586:y;do if(y<1e-16)l=+O[u>>3]+h,O[d>>3]=l,m=d;else{if(m=+gt(+(y+-3.141592653589793))<1e-16,l=+O[u>>3],m){l=l-h,O[d>>3]=l,m=d;break}if(_=+Ot(+h),h=+yt(+h),l=_*+yt(+l)+ +Ot(+y)*(h*+Ot(+l)),l=l>1?1:l,l=+q7(+(l<-1?-1:l)),O[d>>3]=l,+gt(+(l+-1.5707963267948966))<1e-16){O[d>>3]=1.5707963267948966,O[d+8>>3]=0;return}if(+gt(+(l+1.5707963267948966))<1e-16){O[d>>3]=-1.5707963267948966,O[d+8>>3]=0;return}if(b=1/+Ot(+l),y=h*+yt(+y)*b,h=+O[u>>3],l=b*((_-+yt(+l)*+yt(+h))/+Ot(+h)),_=y>1?1:y,l=l>1?1:l,l=+O[u+8>>3]+ +ci(+(_<-1?-1:_),+(l<-1?-1:l)),l>3.141592653589793)do l=l+-6.283185307179586;while(l>3.141592653589793);if(l<-3.141592653589793)do l=l+6.283185307179586;while(l<-3.141592653589793);O[d+8>>3]=l;return}while(!1);if(+gt(+(l+-1.5707963267948966))<1e-16){O[m>>3]=1.5707963267948966,O[d+8>>3]=0;return}if(+gt(+(l+1.5707963267948966))<1e-16){O[m>>3]=-1.5707963267948966,O[d+8>>3]=0;return}if(l=+O[u+8>>3],l>3.141592653589793)do l=l+-6.283185307179586;while(l>3.141592653589793);if(l<-3.141592653589793)do l=l+6.283185307179586;while(l<-3.141592653589793);O[d+8>>3]=l}function t_(u,l){return u=u|0,l=l|0,u>>>0>15?(l=4,l|0):(O[l>>3]=+O[20656+(u<<3)>>3],l=0,l|0)}function ZE(u,l){return u=u|0,l=l|0,u>>>0>15?(l=4,l|0):(O[l>>3]=+O[20784+(u<<3)>>3],l=0,l|0)}function JE(u,l){return u=u|0,l=l|0,u>>>0>15?(l=4,l|0):(O[l>>3]=+O[20912+(u<<3)>>3],l=0,l|0)}function eR(u,l){return u=u|0,l=l|0,u>>>0>15?(l=4,l|0):(O[l>>3]=+O[21040+(u<<3)>>3],l=0,l|0)}function _c(u,l){u=u|0,l=l|0;var h=0;return u>>>0>15?(l=4,l|0):(h=_o(7,0,u,((u|0)<0)<<31>>31)|0,h=Yn(h|0,V()|0,120,0)|0,u=V()|0,A[l>>2]=h|2,A[l+4>>2]=u,l=0,l|0)}function n_(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0;return $=+O[l>>3],M=+O[u>>3],w=+yt(+(($-M)*.5)),y=+O[l+8>>3],R=+O[u+8>>3],_=+yt(+((y-R)*.5)),b=+Ot(+M),G=+Ot(+$),_=w*w+_*(G*b*_),_=+ci(+ +Pt(+_),+ +Pt(+(1-_)))*2,w=+O[h>>3],$=+yt(+((w-$)*.5)),d=+O[h+8>>3],y=+yt(+((d-y)*.5)),m=+Ot(+w),y=$*$+y*(G*m*y),y=+ci(+ +Pt(+y),+ +Pt(+(1-y)))*2,w=+yt(+((M-w)*.5)),d=+yt(+((R-d)*.5)),d=w*w+d*(b*m*d),d=+ci(+ +Pt(+d),+ +Pt(+(1-d)))*2,m=(_+y+d)*.5,+(+ld(+ +Pt(+(+Ai(+(m*.5))*+Ai(+((m-_)*.5))*+Ai(+((m-y)*.5))*+Ai(+((m-d)*.5)))))*4)}function Md(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,b=0;if(b=F,F=F+192|0,y=b+168|0,_=b,m=fa(u,l,y)|0,m|0)return h=m,F=b,h|0;if(ol(u,l,_)|0&&rt(27795,27190,415,27199),l=A[_>>2]|0,(l|0)>0){if(d=+n_(_+8|0,_+8+(((l|0)!=1&1)<<4)|0,y)+0,(l|0)!=1){u=1;do m=u,u=u+1|0,d=d+ +n_(_+8+(m<<4)|0,_+8+(((u|0)%(l|0)|0)<<4)|0,y);while((u|0)<(l|0))}}else d=0;return O[h>>3]=d,h=0,F=b,h|0}function tR(u,l,h){return u=u|0,l=l|0,h=h|0,u=Md(u,l,h)|0,u|0||(O[h>>3]=+O[h>>3]*6371.007180918475*6371.007180918475),u|0}function nR(u,l,h){return u=u|0,l=l|0,h=h|0,u=Md(u,l,h)|0,u|0||(O[h>>3]=+O[h>>3]*6371.007180918475*6371.007180918475*1e3*1e3),u|0}function rR(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,b=0,w=0,R=0,M=0;if(b=F,F=F+176|0,_=b,u=yc(u,l,_)|0,u|0)return _=u,F=b,_|0;if(O[h>>3]=0,u=A[_>>2]|0,(u|0)<=1)return _=0,F=b,_|0;l=u+-1|0,u=0,d=+O[_+8>>3],m=+O[_+16>>3],y=0;do u=u+1|0,R=d,d=+O[_+8+(u<<4)>>3],M=+yt(+((d-R)*.5)),w=m,m=+O[_+8+(u<<4)+8>>3],w=+yt(+((m-w)*.5)),w=M*M+w*(+Ot(+d)*+Ot(+R)*w),y=y+ +ci(+ +Pt(+w),+ +Pt(+(1-w)))*2;while((u|0)<(l|0));return O[h>>3]=y,_=0,F=b,_|0}function iR(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,b=0,w=0,R=0,M=0;if(b=F,F=F+176|0,_=b,u=yc(u,l,_)|0,u|0)return _=u,y=+O[h>>3],y=y*6371.007180918475,O[h>>3]=y,F=b,_|0;if(O[h>>3]=0,u=A[_>>2]|0,(u|0)<=1)return _=0,y=0,y=y*6371.007180918475,O[h>>3]=y,F=b,_|0;l=u+-1|0,u=0,d=+O[_+8>>3],m=+O[_+16>>3],y=0;do u=u+1|0,R=d,d=+O[_+8+(u<<4)>>3],M=+yt(+((d-R)*.5)),w=m,m=+O[_+8+(u<<4)+8>>3],w=+yt(+((m-w)*.5)),w=M*M+w*(+Ot(+R)*+Ot(+d)*w),y=y+ +ci(+ +Pt(+w),+ +Pt(+(1-w)))*2;while((u|0)!=(l|0));return O[h>>3]=y,_=0,M=y,M=M*6371.007180918475,O[h>>3]=M,F=b,_|0}function sR(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,b=0,w=0,R=0,M=0;if(b=F,F=F+176|0,_=b,u=yc(u,l,_)|0,u|0)return _=u,y=+O[h>>3],y=y*6371.007180918475,y=y*1e3,O[h>>3]=y,F=b,_|0;if(O[h>>3]=0,u=A[_>>2]|0,(u|0)<=1)return _=0,y=0,y=y*6371.007180918475,y=y*1e3,O[h>>3]=y,F=b,_|0;l=u+-1|0,u=0,d=+O[_+8>>3],m=+O[_+16>>3],y=0;do u=u+1|0,R=d,d=+O[_+8+(u<<4)>>3],M=+yt(+((d-R)*.5)),w=m,m=+O[_+8+(u<<4)+8>>3],w=+yt(+((m-w)*.5)),w=M*M+w*(+Ot(+R)*+Ot(+d)*w),y=y+ +ci(+ +Pt(+w),+ +Pt(+(1-w)))*2;while((u|0)!=(l|0));return O[h>>3]=y,_=0,M=y,M=M*6371.007180918475,M=M*1e3,O[h>>3]=M,F=b,_|0}function oR(u){u=u|0;var l=0,h=0,d=0;return l=Dr(1,12)|0,l||rt(27280,27235,49,27293),h=u+4|0,d=A[h>>2]|0,d|0?(d=d+8|0,A[d>>2]=l,A[h>>2]=l,l|0):(A[u>>2]|0&&rt(27310,27235,61,27333),d=u,A[d>>2]=l,A[h>>2]=l,l|0)}function aR(u,l){u=u|0,l=l|0;var h=0,d=0;return d=ns(24)|0,d||rt(27347,27235,78,27361),A[d>>2]=A[l>>2],A[d+4>>2]=A[l+4>>2],A[d+8>>2]=A[l+8>>2],A[d+12>>2]=A[l+12>>2],A[d+16>>2]=0,l=u+4|0,h=A[l>>2]|0,h|0?(A[h+16>>2]=d,A[l>>2]=d,d|0):(A[u>>2]|0&&rt(27376,27235,82,27361),A[u>>2]=d,A[l>>2]=d,d|0)}function r_(u){u=u|0;var l=0,h=0,d=0,m=0;if(u)for(d=1;;){if(l=A[u>>2]|0,l|0)do{if(h=A[l>>2]|0,h|0)do m=h,h=A[h+16>>2]|0,Qe(m);while((h|0)!=0);m=l,l=A[l+8>>2]|0,Qe(m)}while((l|0)!=0);if(l=u,u=A[u+8>>2]|0,d||Qe(l),u)d=0;else break}}function lR(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0,ie=0,Ne=0,$e=0,qe=0,lt=0,At=0,vt=0,nt=0,He=0,Ce=0,pt=0,Qt=0,ht=0;if(m=u+8|0,A[m>>2]|0)return ht=1,ht|0;if(d=A[u>>2]|0,!d)return ht=0,ht|0;l=d,h=0;do h=h+1|0,l=A[l+8>>2]|0;while((l|0)!=0);if(h>>>0<2)return ht=0,ht|0;pt=ns(h<<2)|0,pt||rt(27396,27235,317,27415),Ce=ns(h<<5)|0,Ce||rt(27437,27235,321,27415),A[u>>2]=0,$e=u+4|0,A[$e>>2]=0,A[m>>2]=0,h=0,He=0,Ne=0,G=0;e:for(;;){if(M=A[d>>2]|0,M){y=0,_=M;do{if(w=+O[_+8>>3],l=_,_=A[_+16>>2]|0,R=(_|0)==0,m=R?M:_,b=+O[m+8>>3],+gt(+(w-b))>3.141592653589793){ht=14;break}y=y+(b-w)*(+O[l>>3]+ +O[m>>3])}while(!R);if((ht|0)==14){ht=0,y=0,l=M;do ie=+O[l+8>>3],nt=l+16|0,vt=A[nt>>2]|0,vt=(vt|0)==0?M:vt,le=+O[vt+8>>3],y=y+(+O[l>>3]+ +O[vt>>3])*((le<0?le+6.283185307179586:le)-(ie<0?ie+6.283185307179586:ie)),l=A[((l|0)==0?d:nt)>>2]|0;while((l|0)!=0)}y>0?(A[pt+(He<<2)>>2]=d,He=He+1|0,m=Ne,l=G):ht=19}else ht=19;if((ht|0)==19){ht=0;do if(h){if(l=h+8|0,A[l>>2]|0){ht=21;break e}if(h=Dr(1,12)|0,!h){ht=23;break e}A[l>>2]=h,m=h+4|0,_=h,l=G}else if(G){m=$e,_=G+8|0,l=d,h=u;break}else if(A[u>>2]|0){ht=27;break e}else{m=$e,_=u,l=d,h=u;break}while(!1);if(A[_>>2]=d,A[m>>2]=d,_=Ce+(Ne<<5)|0,R=A[d>>2]|0,R){for(M=Ce+(Ne<<5)+8|0,O[M>>3]=17976931348623157e292,G=Ce+(Ne<<5)+24|0,O[G>>3]=17976931348623157e292,O[_>>3]=-17976931348623157e292,$=Ce+(Ne<<5)+16|0,O[$>>3]=-17976931348623157e292,ce=17976931348623157e292,Ae=-17976931348623157e292,m=0,H=R,w=17976931348623157e292,ne=17976931348623157e292,se=-17976931348623157e292,b=-17976931348623157e292;y=+O[H>>3],ie=+O[H+8>>3],H=A[H+16>>2]|0,W=(H|0)==0,le=+O[(W?R:H)+8>>3],y<w&&(O[M>>3]=y,w=y),ie<ne&&(O[G>>3]=ie,ne=ie),y>se?O[_>>3]=y:y=se,ie>b&&(O[$>>3]=ie,b=ie),ce=ie>0&ie<ce?ie:ce,Ae=ie<0&ie>Ae?ie:Ae,m=m|+gt(+(ie-le))>3.141592653589793,!W;)se=y;m&&(O[$>>3]=Ae,O[G>>3]=ce)}else A[_>>2]=0,A[_+4>>2]=0,A[_+8>>2]=0,A[_+12>>2]=0,A[_+16>>2]=0,A[_+20>>2]=0,A[_+24>>2]=0,A[_+28>>2]=0;m=Ne+1|0}if(nt=d+8|0,d=A[nt>>2]|0,A[nt>>2]=0,d)Ne=m,G=l;else{ht=45;break}}if((ht|0)==21)rt(27213,27235,35,27247);else if((ht|0)==23)rt(27267,27235,37,27247);else if((ht|0)==27)rt(27310,27235,61,27333);else if((ht|0)==45){e:do if((He|0)>0){for(nt=(m|0)==0,At=m<<2,vt=(u|0)==0,lt=0,l=0;;){if(qe=A[pt+(lt<<2)>>2]|0,nt)ht=73;else{if(Ne=ns(At)|0,!Ne){ht=50;break}if($e=ns(At)|0,!$e){ht=52;break}t:do if(vt)h=0;else{for(m=0,h=0,_=u;d=Ce+(m<<5)|0,i_(A[_>>2]|0,d,A[qe>>2]|0)|0?(A[Ne+(h<<2)>>2]=_,A[$e+(h<<2)>>2]=d,W=h+1|0):W=h,_=A[_+8>>2]|0,_;)m=m+1|0,h=W;if((W|0)>0)if(d=A[Ne>>2]|0,(W|0)==1)h=d;else for($=0,H=-1,h=d,G=d;;){for(R=A[G>>2]|0,d=0,_=0;m=A[A[Ne+(_<<2)>>2]>>2]|0,(m|0)==(R|0)?M=d:M=d+((i_(m,A[$e+(_<<2)>>2]|0,A[R>>2]|0)|0)&1)|0,_=_+1|0,(_|0)!=(W|0);)d=M;if(m=(M|0)>(H|0),h=m?G:h,d=$+1|0,(d|0)==(W|0))break t;$=d,H=m?M:H,G=A[Ne+(d<<2)>>2]|0}else h=0}while(!1);if(Qe(Ne),Qe($e),h){if(m=h+4|0,d=A[m>>2]|0,d)h=d+8|0;else if(A[h>>2]|0){ht=70;break}A[h>>2]=qe,A[m>>2]=qe}else ht=73}if((ht|0)==73){if(ht=0,l=A[qe>>2]|0,l|0)do $e=l,l=A[l+16>>2]|0,Qe($e);while((l|0)!=0);Qe(qe),l=1}if(lt=lt+1|0,(lt|0)>=(He|0)){Qt=l;break e}}(ht|0)==50?rt(27452,27235,249,27471):(ht|0)==52?rt(27490,27235,252,27471):(ht|0)==70&&rt(27310,27235,61,27333)}else Qt=0;while(!1);return Qe(pt),Qe(Ce),ht=Qt,ht|0}return 0}function i_(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,b=0,w=0,R=0,M=0;if(!(dd(l,h)|0)||(l=Fy(l)|0,d=+O[h>>3],m=+O[h+8>>3],m=l&m<0?m+6.283185307179586:m,u=A[u>>2]|0,!u))return u=0,u|0;if(l){l=0,R=m,h=u;e:for(;;){for(;_=+O[h>>3],m=+O[h+8>>3],h=h+16|0,M=A[h>>2]|0,M=(M|0)==0?u:M,y=+O[M>>3],b=+O[M+8>>3],_>y?(w=_,_=b):(w=y,y=_,_=m,m=b),d=d==y|d==w?d+2220446049250313e-31:d,!!(d<y|d>w);)if(h=A[h>>2]|0,!h){h=22;break e}if(b=_<0?_+6.283185307179586:_,_=m<0?m+6.283185307179586:m,R=b==R|_==R?R+-2220446049250313e-31:R,w=b+(_-b)*((d-y)/(w-y)),(w<0?w+6.283185307179586:w)>R&&(l=l^1),h=A[h>>2]|0,!h){h=22;break}}if((h|0)==22)return l|0}else{l=0,R=m,h=u;e:for(;;){for(;_=+O[h>>3],m=+O[h+8>>3],h=h+16|0,M=A[h>>2]|0,M=(M|0)==0?u:M,y=+O[M>>3],b=+O[M+8>>3],_>y?(w=_,_=b):(w=y,y=_,_=m,m=b),d=d==y|d==w?d+2220446049250313e-31:d,!!(d<y|d>w);)if(h=A[h>>2]|0,!h){h=22;break e}if(R=_==R|m==R?R+-2220446049250313e-31:R,_+(m-_)*((d-y)/(w-y))>R&&(l=l^1),h=A[h>>2]|0,!h){h=22;break}}if((h|0)==22)return l|0}return 0}function qs(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0;if(Ae=F,F=F+32|0,ce=Ae+16|0,se=Ae,y=_e(u|0,l|0,52)|0,V()|0,y=y&15,H=_e(h|0,d|0,52)|0,V()|0,(y|0)!=(H&15|0))return ce=12,F=Ae,ce|0;if(R=_e(u|0,l|0,45)|0,V()|0,R=R&127,M=_e(h|0,d|0,45)|0,V()|0,M=M&127,R>>>0>121|M>>>0>121)return ce=5,F=Ae,ce|0;if(H=(R|0)!=(M|0),H){if(b=fd(R,M)|0,(b|0)==7)return ce=1,F=Ae,ce|0;w=fd(M,R)|0,(w|0)==7?rt(27514,27538,161,27548):(W=b,_=w)}else W=0,_=0;G=an(R)|0,$=an(M)|0,A[ce>>2]=0,A[ce+4>>2]=0,A[ce+8>>2]=0,A[ce+12>>2]=0;do if(W){if(M=A[4272+(R*28|0)+(W<<2)>>2]|0,b=(M|0)>0,$)if(b){R=0,w=h,b=d;do w=VE(w,b)|0,b=V()|0,_=yo(_)|0,(_|0)==1&&(_=yo(1)|0),R=R+1|0;while((R|0)!=(M|0));M=_,R=w,w=b}else M=_,R=h,w=d;else if(b){R=0,w=h,b=d;do w=wd(w,b)|0,b=V()|0,_=yo(_)|0,R=R+1|0;while((R|0)!=(M|0));M=_,R=w,w=b}else M=_,R=h,w=d;if(Ed(R,w,ce)|0,H||rt(27563,27538,191,27548),b=(G|0)!=0,_=($|0)!=0,b&_&&rt(27590,27538,192,27548),b){if(_=Br(u,l)|0,(_|0)==7){y=5;break}if(Te[22e3+(_*7|0)+W>>0]|0){y=1;break}w=A[21168+(_*28|0)+(W<<2)>>2]|0,R=w}else if(_){if(_=Br(R,w)|0,(_|0)==7){y=5;break}if(Te[22e3+(_*7|0)+M>>0]|0){y=1;break}R=0,w=A[21168+(M*28|0)+(_<<2)>>2]|0}else R=0,w=0;if((R|w|0)<0)y=5;else{if((w|0)>0){b=ce+4|0,_=0;do gc(b),_=_+1|0;while((_|0)!=(w|0))}if(A[se>>2]=0,A[se+4>>2]=0,A[se+8>>2]=0,Vy(se,W),y|0)for(;hi(y)|0?mc(se):Aa(se),(y|0)>1;)y=y+-1|0;if((R|0)>0){y=0;do gc(se),y=y+1|0;while((y|0)!=(R|0))}ne=ce+4|0,vr(ne,se,ne),hr(ne),ne=51}}else if(Ed(h,d,ce)|0,(G|0)!=0&($|0)!=0)if((M|0)!=(R|0)&&rt(27621,27538,261,27548),_=Br(u,l)|0,y=Br(h,d)|0,(_|0)==7|(y|0)==7)y=5;else if(Te[22e3+(_*7|0)+y>>0]|0)y=1;else if(_=A[21168+(_*28|0)+(y<<2)>>2]|0,(_|0)>0){b=ce+4|0,y=0;do gc(b),y=y+1|0;while((y|0)!=(_|0));ne=51}else ne=51;else ne=51;while(!1);return(ne|0)==51&&(y=ce+4|0,A[m>>2]=A[y>>2],A[m+4>>2]=A[y+4>>2],A[m+8>>2]=A[y+8>>2],y=0),ce=y,F=Ae,ce|0}function s_(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0;if(ne=F,F=F+48|0,R=ne+36|0,_=ne+24|0,b=ne+12|0,w=ne,m=_e(u|0,l|0,52)|0,V()|0,m=m&15,$=_e(u|0,l|0,45)|0,V()|0,$=$&127,$>>>0>121)return d=5,F=ne,d|0;if(M=an($)|0,Re(m|0,0,52)|0,se=V()|0|134225919,y=d,A[y>>2]=-1,A[y+4>>2]=se,!m)return m=pc(h)|0,(m|0)==7||(m=hd($,m)|0,(m|0)==127)?(se=1,F=ne,se|0):(H=Re(m|0,0,45)|0,W=V()|0,$=d,W=A[$+4>>2]&-1040385|W,se=d,A[se>>2]=A[$>>2]|H,A[se+4>>2]=W,se=0,F=ne,se|0);for(A[R>>2]=A[h>>2],A[R+4>>2]=A[h+4>>2],A[R+8>>2]=A[h+8>>2],h=m;;){if(y=h,h=h+-1|0,A[_>>2]=A[R>>2],A[_+4>>2]=A[R+4>>2],A[_+8>>2]=A[R+8>>2],hi(y)|0){if(m=mE(R)|0,m|0){h=13;break}A[b>>2]=A[R>>2],A[b+4>>2]=A[R+4>>2],A[b+8>>2]=A[R+8>>2],mc(b)}else{if(m=gE(R)|0,m|0){h=13;break}A[b>>2]=A[R>>2],A[b+4>>2]=A[R+4>>2],A[b+8>>2]=A[R+8>>2],Aa(b)}if(md(_,b,w),hr(w),m=d,Ae=A[m>>2]|0,m=A[m+4>>2]|0,le=(15-y|0)*3|0,ce=Re(7,0,le|0)|0,m=m&~(V()|0),le=Re(pc(w)|0,0,le|0)|0,m=V()|0|m,se=d,A[se>>2]=le|Ae&~ce,A[se+4>>2]=m,(y|0)<=1){h=14;break}}e:do if((h|0)!=13&&(h|0)==14)if((A[R>>2]|0)<=1&&(A[R+4>>2]|0)<=1&&(A[R+8>>2]|0)<=1){h=pc(R)|0,m=hd($,h)|0,(m|0)==127?w=0:w=an(m)|0;t:do if(h){if(M){if(m=Br(u,l)|0,(m|0)==7){m=5;break e}if(y=A[21376+(m*28|0)+(h<<2)>>2]|0,(y|0)>0){m=h,h=0;do m=ca(m)|0,h=h+1|0;while((h|0)!=(y|0))}else m=h;if((m|0)==1){m=9;break e}h=hd($,m)|0,(h|0)==127&&rt(27648,27538,411,27678),an(h)|0?rt(27693,27538,412,27678):(W=h,H=y,G=m)}else W=m,H=0,G=h;if(b=A[4272+($*28|0)+(G<<2)>>2]|0,(b|0)<=-1&&rt(27724,27538,419,27678),!w){if((H|0)<0){m=5;break e}if(H|0){y=d,m=0,h=A[y>>2]|0,y=A[y+4>>2]|0;do h=ha(h,y)|0,y=V()|0,le=d,A[le>>2]=h,A[le+4>>2]=y,m=m+1|0;while((m|0)<(H|0))}if((b|0)<=0){m=W,h=58;break}for(y=d,m=0,h=A[y>>2]|0,y=A[y+4>>2]|0;;)if(h=ha(h,y)|0,y=V()|0,le=d,A[le>>2]=h,A[le+4>>2]=y,m=m+1|0,(m|0)==(b|0)){m=W,h=58;break t}}if(_=fd(W,$)|0,(_|0)==7&&rt(27514,27538,428,27678),m=d,h=A[m>>2]|0,m=A[m+4>>2]|0,(b|0)>0){y=0;do h=ha(h,m)|0,m=V()|0,le=d,A[le>>2]=h,A[le+4>>2]=m,y=y+1|0;while((y|0)!=(b|0))}if(m=Br(h,m)|0,(m|0)==7&&rt(27795,27538,440,27678),h=cd(W)|0,h=A[(h?21792:21584)+(_*28|0)+(m<<2)>>2]|0,(h|0)<0&&rt(27795,27538,454,27678),!h)m=W,h=58;else{_=d,m=0,y=A[_>>2]|0,_=A[_+4>>2]|0;do y=Td(y,_)|0,_=V()|0,le=d,A[le>>2]=y,A[le+4>>2]=_,m=m+1|0;while((m|0)<(h|0));m=W,h=58}}else if((M|0)!=0&(w|0)!=0){if(h=Br(u,l)|0,y=d,y=Br(A[y>>2]|0,A[y+4>>2]|0)|0,(h|0)==7|(y|0)==7){m=5;break e}if(y=A[21376+(h*28|0)+(y<<2)>>2]|0,(y|0)<0){m=5;break e}if(!y)h=59;else{b=d,h=0,_=A[b>>2]|0,b=A[b+4>>2]|0;do _=ha(_,b)|0,b=V()|0,le=d,A[le>>2]=_,A[le+4>>2]=b,h=h+1|0;while((h|0)<(y|0));h=58}}else h=58;while(!1);if((h|0)==58&&w&&(h=59),(h|0)==59&&(le=d,(Br(A[le>>2]|0,A[le+4>>2]|0)|0)==1)){m=9;break}le=d,ce=A[le>>2]|0,le=A[le+4>>2]&-1040385,Ae=Re(m|0,0,45)|0,le=le|(V()|0),m=d,A[m>>2]=ce|Ae,A[m+4>>2]=le,m=0}else m=1;while(!1);return le=m,F=ne,le|0}function uR(u,l,h,d,m,y){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0,y=y|0;var _=0,b=0;return b=F,F=F+16|0,_=b,m?u=15:(u=qs(u,l,h,d,_)|0,u||(_E(_,y),u=0)),F=b,u|0}function AR(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0;return _=F,F=F+16|0,y=_,d?h=15:(h=vE(h,y)|0,h||(h=s_(u,l,y,m)|0)),F=_,h|0}function cR(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,b=0,w=0;return w=F,F=F+32|0,_=w+12|0,b=w,y=qs(u,l,u,l,_)|0,y|0?(b=y,F=w,b|0):(u=qs(u,l,h,d,b)|0,u|0?(b=u,F=w,b|0):(_=gd(_,b)|0,b=m,A[b>>2]=_,A[b+4>>2]=((_|0)<0)<<31>>31,b=0,F=w,b|0))}function hR(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,b=0,w=0;return w=F,F=F+32|0,_=w+12|0,b=w,y=qs(u,l,u,l,_)|0,!y&&(y=qs(u,l,h,d,b)|0,!y)?(d=gd(_,b)|0,d=We(d|0,((d|0)<0)<<31>>31|0,1,0)|0,_=V()|0,b=m,A[b>>2]=d,A[b+4>>2]=_,b=0,F=w,b|0):(b=y,F=w,b|0)}function fR(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0,ie=0,Ne=0,$e=0,qe=0,lt=0;if(qe=F,F=F+48|0,Ne=qe+24|0,_=qe+12|0,$e=qe,y=qs(u,l,u,l,Ne)|0,!y&&(y=qs(u,l,h,d,_)|0,!y)){le=gd(Ne,_)|0,ie=((le|0)<0)<<31>>31,A[Ne>>2]=0,A[Ne+4>>2]=0,A[Ne+8>>2]=0,A[_>>2]=0,A[_+4>>2]=0,A[_+8>>2]=0,qs(u,l,u,l,Ne)|0&&rt(27795,27538,692,27747),qs(u,l,h,d,_)|0&&rt(27795,27538,697,27747),Hy(Ne),Hy(_),M=(le|0)==0?0:1/+(le|0),h=A[Ne>>2]|0,ne=M*+((A[_>>2]|0)-h|0),se=Ne+4|0,d=A[se>>2]|0,ce=M*+((A[_+4>>2]|0)-d|0),Ae=Ne+8|0,y=A[Ae>>2]|0,M=M*+((A[_+8>>2]|0)-y|0),A[$e>>2]=h,G=$e+4|0,A[G>>2]=d,$=$e+8|0,A[$>>2]=y;e:do if((le|0)<0)y=0;else for(H=0,W=0;;){w=+(W>>>0)+4294967296*+(H|0),lt=ne*w+ +(h|0),b=ce*w+ +(d|0),w=M*w+ +(y|0),h=~~+Tc(+lt),_=~~+Tc(+b),y=~~+Tc(+w),lt=+gt(+(+(h|0)-lt)),b=+gt(+(+(_|0)-b)),w=+gt(+(+(y|0)-w));do if(lt>b&lt>w)h=0-(_+y)|0,d=_;else if(R=0-h|0,b>w){d=R-y|0;break}else{d=_,y=R-_|0;break}while(!1);if(A[$e>>2]=h,A[G>>2]=d,A[$>>2]=y,bE($e),y=s_(u,l,$e,m+(W<<3)|0)|0,y|0)break e;if(!((H|0)<(ie|0)|(H|0)==(ie|0)&W>>>0<le>>>0)){y=0;break e}h=We(W|0,H|0,1,0)|0,d=V()|0,H=d,W=h,h=A[Ne>>2]|0,d=A[se>>2]|0,y=A[Ae>>2]|0}while(!1);return $e=y,F=qe,$e|0}return $e=y,F=qe,$e|0}function _o(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0;if((h|0)==0&(d|0)==0)return m=0,y=1,ut(m|0),y|0;y=u,m=l,u=1,l=0;do _=(h&1|0)==0&!0,u=Yn((_?1:y)|0,(_?0:m)|0,u|0,l|0)|0,l=V()|0,h=y_(h|0,d|0,1)|0,d=V()|0,y=Yn(y|0,m|0,y|0,m|0)|0,m=V()|0;while(!((h|0)==0&(d|0)==0));return ut(l|0),u|0}function Pd(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,b=0,w=0,R=0,M=0;b=F,F=F+16|0,y=b,_=_e(u|0,l|0,52)|0,V()|0,_=_&15;do if(_){if(m=fa(u,l,y)|0,!m){R=+O[y>>3],w=1/+Ot(+R),M=+O[25968+(_<<3)>>3],O[h>>3]=R+M,O[h+8>>3]=R-M,R=+O[y+8>>3],w=M*w,O[h+16>>3]=w+R,O[h+24>>3]=R-w;break}return _=m,F=b,_|0}else{if(m=_e(u|0,l|0,45)|0,V()|0,m=m&127,m>>>0>121)return _=5,F=b,_|0;y=22064+(m<<5)|0,A[h>>2]=A[y>>2],A[h+4>>2]=A[y+4>>2],A[h+8>>2]=A[y+8>>2],A[h+12>>2]=A[y+12>>2],A[h+16>>2]=A[y+16>>2],A[h+20>>2]=A[y+20>>2],A[h+24>>2]=A[y+24>>2],A[h+28>>2]=A[y+28>>2];break}while(!1);return fE(h,d?1.4:1.1),d=26096+(_<<3)|0,(A[d>>2]|0)==(u|0)&&(A[d+4>>2]|0)==(l|0)&&(O[h>>3]=1.5707963267948966),_=26224+(_<<3)|0,(A[_>>2]|0)==(u|0)&&(A[_+4>>2]|0)==(l|0)&&(O[h+8>>3]=-1.5707963267948966),+O[h>>3]!=1.5707963267948966&&+O[h+8>>3]!=-1.5707963267948966?(_=0,F=b,_|0):(O[h+16>>3]=3.141592653589793,O[h+24>>3]=-3.141592653589793,_=0,F=b,_|0)}function dR(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,b=0,w=0,R=0,M=0;R=F,F=F+48|0,_=R+32|0,y=R+40|0,b=R,bd(_,0,0,0),w=A[_>>2]|0,_=A[_+4>>2]|0;do if(h>>>0<=15){if(m=Eu(d)|0,m|0){d=b,A[d>>2]=0,A[d+4>>2]=0,A[b+8>>2]=m,A[b+12>>2]=-1,d=b+16|0,w=b+29|0,A[d>>2]=0,A[d+4>>2]=0,A[d+8>>2]=0,Te[d+12>>0]=0,Te[w>>0]=Te[y>>0]|0,Te[w+1>>0]=Te[y+1>>0]|0,Te[w+2>>0]=Te[y+2>>0]|0;break}if(m=Dr((A[l+8>>2]|0)+1|0,32)|0,m){Bd(l,m),M=b,A[M>>2]=w,A[M+4>>2]=_,A[b+8>>2]=0,A[b+12>>2]=h,A[b+16>>2]=d,A[b+20>>2]=l,A[b+24>>2]=m,Te[b+28>>0]=0,w=b+29|0,Te[w>>0]=Te[y>>0]|0,Te[w+1>>0]=Te[y+1>>0]|0,Te[w+2>>0]=Te[y+2>>0]|0;break}else{d=b,A[d>>2]=0,A[d+4>>2]=0,A[b+8>>2]=13,A[b+12>>2]=-1,d=b+16|0,w=b+29|0,A[d>>2]=0,A[d+4>>2]=0,A[d+8>>2]=0,Te[d+12>>0]=0,Te[w>>0]=Te[y>>0]|0,Te[w+1>>0]=Te[y+1>>0]|0,Te[w+2>>0]=Te[y+2>>0]|0;break}}else w=b,A[w>>2]=0,A[w+4>>2]=0,A[b+8>>2]=4,A[b+12>>2]=-1,w=b+16|0,M=b+29|0,A[w>>2]=0,A[w+4>>2]=0,A[w+8>>2]=0,Te[w+12>>0]=0,Te[M>>0]=Te[y>>0]|0,Te[M+1>>0]=Te[y+1>>0]|0,Te[M+2>>0]=Te[y+2>>0]|0;while(!1);vc(b),A[u>>2]=A[b>>2],A[u+4>>2]=A[b+4>>2],A[u+8>>2]=A[b+8>>2],A[u+12>>2]=A[b+12>>2],A[u+16>>2]=A[b+16>>2],A[u+20>>2]=A[b+20>>2],A[u+24>>2]=A[b+24>>2],A[u+28>>2]=A[b+28>>2],F=R}function vc(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0,ie=0;if(ie=F,F=F+336|0,H=ie+168|0,W=ie,d=u,h=A[d>>2]|0,d=A[d+4>>2]|0,(h|0)==0&(d|0)==0){F=ie;return}if(l=u+28|0,Te[l>>0]|0?(h=o_(h,d)|0,d=V()|0):Te[l>>0]=1,le=u+20|0,!(A[A[le>>2]>>2]|0)){l=u+24|0,h=A[l>>2]|0,h|0&&Qe(h),Ae=u,A[Ae>>2]=0,A[Ae+4>>2]=0,A[u+8>>2]=0,A[le>>2]=0,A[u+12>>2]=-1,A[u+16>>2]=0,A[l>>2]=0,F=ie;return}Ae=u+16|0,l=A[Ae>>2]|0,m=l&15;e:do if((h|0)==0&(d|0)==0)ce=u+24|0;else{ne=u+12|0,G=(m|0)==3,M=l&255,w=(m|1|0)==3,$=u+24|0,R=(m+-1|0)>>>0<3,_=(m|2|0)==3,b=W+8|0;t:for(;;){if(y=_e(h|0,d|0,52)|0,V()|0,y=y&15,(y|0)==(A[ne>>2]|0)){switch(M&15){case 0:case 2:case 3:{if(m=fa(h,d,H)|0,m|0){se=15;break t}if(Dd(A[le>>2]|0,A[$>>2]|0,H)|0){se=19;break t}break}}if(w&&(m=A[(A[le>>2]|0)+4>>2]|0,A[H>>2]=A[m>>2],A[H+4>>2]=A[m+4>>2],A[H+8>>2]=A[m+8>>2],A[H+12>>2]=A[m+12>>2],dd(26832,H)|0)){if(Sd(A[(A[le>>2]|0)+4>>2]|0,y,W)|0){se=25;break}if(m=W,(A[m>>2]|0)==(h|0)&&(A[m+4>>2]|0)==(d|0)){se=29;break}}if(R){if(m=ol(h,d,H)|0,m|0){se=32;break}if(Pd(h,d,W,0)|0){se=36;break}if(_&&l_(A[le>>2]|0,A[$>>2]|0,H,W)|0){se=42;break}if(w&&u_(A[le>>2]|0,A[$>>2]|0,H,W)|0){se=42;break}}if(G){if(l=Pd(h,d,H,1)|0,m=A[$>>2]|0,l|0){se=45;break}if(pd(m,H)|0){if(ky(W,H),Iy(H,A[$>>2]|0)|0){se=53;break}if(Dd(A[le>>2]|0,A[$>>2]|0,b)|0){se=53;break}if(u_(A[le>>2]|0,A[$>>2]|0,W,H)|0){se=53;break}}}}do if((y|0)<(A[ne>>2]|0)){if(l=Pd(h,d,H,1)|0,m=A[$>>2]|0,l|0){se=58;break t}if(!(pd(m,H)|0)){se=73;break}if(Iy(A[$>>2]|0,H)|0&&(ky(W,H),l_(A[le>>2]|0,A[$>>2]|0,W,H)|0)){se=65;break t}if(h=Zy(h,d,y+1|0,W)|0,h|0){se=67;break t}d=W,h=A[d>>2]|0,d=A[d+4>>2]|0}else se=73;while(!1);if((se|0)==73&&(se=0,h=o_(h,d)|0,d=V()|0),(h|0)==0&(d|0)==0){ce=$;break e}}switch(se|0){case 15:{l=A[$>>2]|0,l|0&&Qe(l),se=u,A[se>>2]=0,A[se+4>>2]=0,A[le>>2]=0,A[ne>>2]=-1,A[Ae>>2]=0,A[$>>2]=0,A[u+8>>2]=m,se=20;break}case 19:{A[u>>2]=h,A[u+4>>2]=d,se=20;break}case 25:{rt(27795,27761,470,27772);break}case 29:{A[u>>2]=h,A[u+4>>2]=d,F=ie;return}case 32:{l=A[$>>2]|0,l|0&&Qe(l),ce=u,A[ce>>2]=0,A[ce+4>>2]=0,A[le>>2]=0,A[ne>>2]=-1,A[Ae>>2]=0,A[$>>2]=0,A[u+8>>2]=m,F=ie;return}case 36:{rt(27795,27761,493,27772);break}case 42:{A[u>>2]=h,A[u+4>>2]=d,F=ie;return}case 45:{m|0&&Qe(m),se=u,A[se>>2]=0,A[se+4>>2]=0,A[le>>2]=0,A[ne>>2]=-1,A[Ae>>2]=0,A[$>>2]=0,A[u+8>>2]=l,se=55;break}case 53:{A[u>>2]=h,A[u+4>>2]=d,se=55;break}case 58:{m|0&&Qe(m),se=u,A[se>>2]=0,A[se+4>>2]=0,A[le>>2]=0,A[ne>>2]=-1,A[Ae>>2]=0,A[$>>2]=0,A[u+8>>2]=l,se=71;break}case 65:{A[u>>2]=h,A[u+4>>2]=d,se=71;break}case 67:{l=A[$>>2]|0,l|0&&Qe(l),ce=u,A[ce>>2]=0,A[ce+4>>2]=0,A[le>>2]=0,A[ne>>2]=-1,A[Ae>>2]=0,A[$>>2]=0,A[u+8>>2]=h,F=ie;return}}if((se|0)==20){F=ie;return}else if((se|0)==55){F=ie;return}else if((se|0)==71){F=ie;return}}while(!1);l=A[ce>>2]|0,l|0&&Qe(l),se=u,A[se>>2]=0,A[se+4>>2]=0,A[u+8>>2]=0,A[le>>2]=0,A[u+12>>2]=-1,A[Ae>>2]=0,A[ce>>2]=0,F=ie}function o_(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,b=0,w=0,R=0,M=0,G=0;G=F,F=F+16|0,M=G,d=_e(u|0,l|0,52)|0,V()|0,d=d&15,h=_e(u|0,l|0,45)|0,V()|0;do if(d){for(;h=Re(d+4095|0,0,52)|0,m=V()|0|l&-15728641,y=(15-d|0)*3|0,_=Re(7,0,y|0)|0,b=V()|0,h=h|u|_,m=m|b,w=_e(u|0,l|0,y|0)|0,V()|0,w=w&7,d=d+-1|0,!(w>>>0<6);)if(d)l=m,u=h;else{R=4;break}if((R|0)==4){h=_e(h|0,m|0,45)|0,V()|0;break}return M=(w|0)==0&(Zt(h,m)|0)!=0,M=Re((M?2:1)+w|0,0,y|0)|0,R=V()|0|l&~b,M=M|u&~_,ut(R|0),F=G,M|0}while(!1);return h=h&127,h>>>0>120?(R=0,M=0,ut(R|0),F=G,M|0):(bd(M,0,h+1|0,0),R=A[M+4>>2]|0,M=A[M>>2]|0,ut(R|0),F=G,M|0)}function pR(u,l,h,d,m,y){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0,y=y|0;var _=0,b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0;se=F,F=F+160|0,G=se+80|0,b=se+64|0,$=se+112|0,ne=se,dR(G,u,l,h),R=G,Cd(b,A[R>>2]|0,A[R+4>>2]|0,l),R=b,w=A[R>>2]|0,R=A[R+4>>2]|0,_=A[G+8>>2]|0,H=$+4|0,A[H>>2]=A[G>>2],A[H+4>>2]=A[G+4>>2],A[H+8>>2]=A[G+8>>2],A[H+12>>2]=A[G+12>>2],A[H+16>>2]=A[G+16>>2],A[H+20>>2]=A[G+20>>2],A[H+24>>2]=A[G+24>>2],A[H+28>>2]=A[G+28>>2],H=ne,A[H>>2]=w,A[H+4>>2]=R,H=ne+8|0,A[H>>2]=_,u=ne+12|0,l=$,h=u+36|0;do A[u>>2]=A[l>>2],u=u+4|0,l=l+4|0;while((u|0)<(h|0));if($=ne+48|0,A[$>>2]=A[b>>2],A[$+4>>2]=A[b+4>>2],A[$+8>>2]=A[b+8>>2],A[$+12>>2]=A[b+12>>2],(w|0)==0&(R|0)==0)return ne=_,F=se,ne|0;h=ne+16|0,M=ne+24|0,G=ne+28|0,_=0,b=0,l=w,u=R;do{if(!((_|0)<(m|0)|(_|0)==(m|0)&b>>>0<d>>>0)){W=4;break}if(R=b,b=We(b|0,_|0,1,0)|0,_=V()|0,R=y+(R<<3)|0,A[R>>2]=l,A[R+4>>2]=u,Nd($),u=$,l=A[u>>2]|0,u=A[u+4>>2]|0,(l|0)==0&(u|0)==0){if(vc(h),l=h,u=A[l>>2]|0,l=A[l+4>>2]|0,(u|0)==0&(l|0)==0){W=10;break}e_(u,l,A[G>>2]|0,$),u=$,l=A[u>>2]|0,u=A[u+4>>2]|0}R=ne,A[R>>2]=l,A[R+4>>2]=u}while(!((l|0)==0&(u|0)==0));return(W|0)==4?(u=ne+40|0,l=A[u>>2]|0,l|0&&Qe(l),W=ne+16|0,A[W>>2]=0,A[W+4>>2]=0,A[M>>2]=0,A[ne+36>>2]=0,A[G>>2]=-1,A[ne+32>>2]=0,A[u>>2]=0,e_(0,0,0,$),A[ne>>2]=0,A[ne+4>>2]=0,A[H>>2]=0,ne=14,F=se,ne|0):((W|0)==10&&(A[ne>>2]=0,A[ne+4>>2]=0,A[H>>2]=A[M>>2]),ne=A[H>>2]|0,F=se,ne|0)}function mR(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0,H=0;if(G=F,F=F+48|0,w=G+32|0,b=G+40|0,R=G,!(A[u>>2]|0))return M=d,A[M>>2]=0,A[M+4>>2]=0,M=0,F=G,M|0;bd(w,0,0,0),_=w,m=A[_>>2]|0,_=A[_+4>>2]|0;do if(l>>>0>15)M=R,A[M>>2]=0,A[M+4>>2]=0,A[R+8>>2]=4,A[R+12>>2]=-1,M=R+16|0,h=R+29|0,A[M>>2]=0,A[M+4>>2]=0,A[M+8>>2]=0,Te[M+12>>0]=0,Te[h>>0]=Te[b>>0]|0,Te[h+1>>0]=Te[b+1>>0]|0,Te[h+2>>0]=Te[b+2>>0]|0,h=4,M=9;else{if(h=Eu(h)|0,h|0){w=R,A[w>>2]=0,A[w+4>>2]=0,A[R+8>>2]=h,A[R+12>>2]=-1,w=R+16|0,M=R+29|0,A[w>>2]=0,A[w+4>>2]=0,A[w+8>>2]=0,Te[w+12>>0]=0,Te[M>>0]=Te[b>>0]|0,Te[M+1>>0]=Te[b+1>>0]|0,Te[M+2>>0]=Te[b+2>>0]|0,M=9;break}if(h=Dr((A[u+8>>2]|0)+1|0,32)|0,!h){M=R,A[M>>2]=0,A[M+4>>2]=0,A[R+8>>2]=13,A[R+12>>2]=-1,M=R+16|0,h=R+29|0,A[M>>2]=0,A[M+4>>2]=0,A[M+8>>2]=0,Te[M+12>>0]=0,Te[h>>0]=Te[b>>0]|0,Te[h+1>>0]=Te[b+1>>0]|0,Te[h+2>>0]=Te[b+2>>0]|0,h=13,M=9;break}Bd(u,h),H=R,A[H>>2]=m,A[H+4>>2]=_,_=R+8|0,A[_>>2]=0,A[R+12>>2]=l,A[R+20>>2]=u,A[R+24>>2]=h,Te[R+28>>0]=0,m=R+29|0,Te[m>>0]=Te[b>>0]|0,Te[m+1>>0]=Te[b+1>>0]|0,Te[m+2>>0]=Te[b+2>>0]|0,A[R+16>>2]=3,$=+AE(h),$=$*+uE(h),y=+gt(+ +O[h>>3]),y=$/+Ot(+ +xc(+y,+ +gt(+ +O[h+8>>3])))*6371.007180918475*6371.007180918475,m=R+12|0,h=A[m>>2]|0;e:do if((h|0)>0)do{if(t_(h+-1|0,w)|0,!(y/+O[w>>3]>10))break e;H=A[m>>2]|0,h=H+-1|0,A[m>>2]=h}while((H|0)>1);while(!1);if(vc(R),m=d,A[m>>2]=0,A[m+4>>2]=0,m=R,h=A[m>>2]|0,m=A[m+4>>2]|0,!((h|0)==0&(m|0)==0))do xu(h,m,l,w)|0,b=w,u=d,b=We(A[u>>2]|0,A[u+4>>2]|0,A[b>>2]|0,A[b+4>>2]|0)|0,u=V()|0,H=d,A[H>>2]=b,A[H+4>>2]=u,vc(R),H=R,h=A[H>>2]|0,m=A[H+4>>2]|0;while(!((h|0)==0&(m|0)==0));h=A[_>>2]|0}while(!1);return H=h,F=G,H|0}function Su(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0;if(!(dd(l,h)|0)||(l=Fy(l)|0,d=+O[h>>3],m=+O[h+8>>3],m=l&m<0?m+6.283185307179586:m,$=A[u>>2]|0,($|0)<=0))return $=0,$|0;if(G=A[u+4>>2]|0,l){l=0,M=m,h=-1,u=0;e:for(;;){for(R=u;_=+O[G+(R<<4)>>3],m=+O[G+(R<<4)+8>>3],u=(h+2|0)%($|0)|0,y=+O[G+(u<<4)>>3],b=+O[G+(u<<4)+8>>3],_>y?(w=_,_=b):(w=y,y=_,_=m,m=b),d=d==y|d==w?d+2220446049250313e-31:d,!!(d<y|d>w);)if(h=R+1|0,(h|0)>=($|0)){h=22;break e}else u=R,R=h,h=u;if(b=_<0?_+6.283185307179586:_,_=m<0?m+6.283185307179586:m,M=b==M|_==M?M+-2220446049250313e-31:M,w=b+(_-b)*((d-y)/(w-y)),(w<0?w+6.283185307179586:w)>M&&(l=l^1),u=R+1|0,(u|0)>=($|0)){h=22;break}else h=R}if((h|0)==22)return l|0}else{l=0,M=m,h=-1,u=0;e:for(;;){for(R=u;_=+O[G+(R<<4)>>3],m=+O[G+(R<<4)+8>>3],u=(h+2|0)%($|0)|0,y=+O[G+(u<<4)>>3],b=+O[G+(u<<4)+8>>3],_>y?(w=_,_=b):(w=y,y=_,_=m,m=b),d=d==y|d==w?d+2220446049250313e-31:d,!!(d<y|d>w);)if(h=R+1|0,(h|0)>=($|0)){h=22;break e}else u=R,R=h,h=u;if(M=_==M|m==M?M+-2220446049250313e-31:M,_+(m-_)*((d-y)/(w-y))>M&&(l=l^1),u=R+1|0,(u|0)>=($|0)){h=22;break}else h=R}if((h|0)==22)return l|0}return 0}function a_(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0;if(W=A[u>>2]|0,!W){A[l>>2]=0,A[l+4>>2]=0,A[l+8>>2]=0,A[l+12>>2]=0,A[l+16>>2]=0,A[l+20>>2]=0,A[l+24>>2]=0,A[l+28>>2]=0;return}if(ne=l+8|0,O[ne>>3]=17976931348623157e292,se=l+24|0,O[se>>3]=17976931348623157e292,O[l>>3]=-17976931348623157e292,ce=l+16|0,O[ce>>3]=-17976931348623157e292,!((W|0)<=0)){for($=A[u+4>>2]|0,R=17976931348623157e292,M=-17976931348623157e292,G=0,u=-1,y=17976931348623157e292,_=17976931348623157e292,w=-17976931348623157e292,d=-17976931348623157e292,H=0;h=+O[$+(H<<4)>>3],b=+O[$+(H<<4)+8>>3],u=u+2|0,m=+O[$+(((u|0)==(W|0)?0:u)<<4)+8>>3],h<y&&(O[ne>>3]=h,y=h),b<_&&(O[se>>3]=b,_=b),h>w?O[l>>3]=h:h=w,b>d&&(O[ce>>3]=b,d=b),R=b>0&b<R?b:R,M=b<0&b>M?b:M,G=G|+gt(+(b-m))>3.141592653589793,u=H+1|0,(u|0)!=(W|0);)Ae=H,w=h,H=u,u=Ae;G&&(O[ce>>3]=M,O[se>>3]=R)}}function Eu(u){return u=u|0,(u>>>0<4?0:15)|0}function Bd(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0,ie=0,Ne=0,$e=0,qe=0;if(W=A[u>>2]|0,W){if(ne=l+8|0,O[ne>>3]=17976931348623157e292,se=l+24|0,O[se>>3]=17976931348623157e292,O[l>>3]=-17976931348623157e292,ce=l+16|0,O[ce>>3]=-17976931348623157e292,(W|0)>0){for(m=A[u+4>>2]|0,$=17976931348623157e292,H=-17976931348623157e292,d=0,h=-1,w=17976931348623157e292,R=17976931348623157e292,G=-17976931348623157e292,_=-17976931348623157e292,Ae=0;y=+O[m+(Ae<<4)>>3],M=+O[m+(Ae<<4)+8>>3],$e=h+2|0,b=+O[m+((($e|0)==(W|0)?0:$e)<<4)+8>>3],y<w&&(O[ne>>3]=y,w=y),M<R&&(O[se>>3]=M,R=M),y>G?O[l>>3]=y:y=G,M>_&&(O[ce>>3]=M,_=M),$=M>0&M<$?M:$,H=M<0&M>H?M:H,d=d|+gt(+(M-b))>3.141592653589793,h=Ae+1|0,(h|0)!=(W|0);)$e=Ae,G=y,Ae=h,h=$e;d&&(O[ce>>3]=H,O[se>>3]=$)}}else A[l>>2]=0,A[l+4>>2]=0,A[l+8>>2]=0,A[l+12>>2]=0,A[l+16>>2]=0,A[l+20>>2]=0,A[l+24>>2]=0,A[l+28>>2]=0;if($e=u+8|0,h=A[$e>>2]|0,!((h|0)<=0)){Ne=u+12|0,ie=0;do if(m=A[Ne>>2]|0,d=ie,ie=ie+1|0,se=l+(ie<<5)|0,ce=A[m+(d<<3)>>2]|0,ce){if(Ae=l+(ie<<5)+8|0,O[Ae>>3]=17976931348623157e292,u=l+(ie<<5)+24|0,O[u>>3]=17976931348623157e292,O[se>>3]=-17976931348623157e292,le=l+(ie<<5)+16|0,O[le>>3]=-17976931348623157e292,(ce|0)>0){for(W=A[m+(d<<3)+4>>2]|0,$=17976931348623157e292,H=-17976931348623157e292,m=0,d=-1,ne=0,w=17976931348623157e292,R=17976931348623157e292,M=-17976931348623157e292,_=-17976931348623157e292;y=+O[W+(ne<<4)>>3],G=+O[W+(ne<<4)+8>>3],d=d+2|0,b=+O[W+(((d|0)==(ce|0)?0:d)<<4)+8>>3],y<w&&(O[Ae>>3]=y,w=y),G<R&&(O[u>>3]=G,R=G),y>M?O[se>>3]=y:y=M,G>_&&(O[le>>3]=G,_=G),$=G>0&G<$?G:$,H=G<0&G>H?G:H,m=m|+gt(+(G-b))>3.141592653589793,d=ne+1|0,(d|0)!=(ce|0);)qe=ne,ne=d,M=y,d=qe;m&&(O[le>>3]=H,O[u>>3]=$)}}else A[se>>2]=0,A[se+4>>2]=0,A[se+8>>2]=0,A[se+12>>2]=0,A[se+16>>2]=0,A[se+20>>2]=0,A[se+24>>2]=0,A[se+28>>2]=0,h=A[$e>>2]|0;while((ie|0)<(h|0))}}function Dd(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0;if(!(Su(u,l,h)|0))return m=0,m|0;if(m=u+8|0,(A[m>>2]|0)<=0)return m=1,m|0;for(d=u+12|0,u=0;;){if(y=u,u=u+1|0,Su((A[d>>2]|0)+(y<<3)|0,l+(u<<5)|0,h)|0){u=0,d=6;break}if((u|0)>=(A[m>>2]|0)){u=1,d=6;break}}return(d|0)==6?u|0:0}function l_(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,b=0,w=0,R=0,M=0;if(R=F,F=F+16|0,b=R,_=h+8|0,!(Su(u,l,_)|0))return w=0,F=R,w|0;w=u+8|0;e:do if((A[w>>2]|0)>0){for(y=u+12|0,m=0;;){if(M=m,m=m+1|0,Su((A[y>>2]|0)+(M<<3)|0,l+(m<<5)|0,_)|0){m=0;break}if((m|0)>=(A[w>>2]|0))break e}return F=R,m|0}while(!1);if(bc(u,l,h,d)|0)return M=0,F=R,M|0;A[b>>2]=A[h>>2],A[b+4>>2]=_,m=A[w>>2]|0;e:do if((m|0)>0)for(u=u+12|0,_=0,y=m;;){if(m=A[u>>2]|0,(A[m+(_<<3)>>2]|0)>0){if(Su(b,d,A[m+(_<<3)+4>>2]|0)|0){m=0;break e}if(m=_+1|0,bc((A[u>>2]|0)+(_<<3)|0,l+(m<<5)|0,h,d)|0){m=0;break e}y=A[w>>2]|0}else m=_+1|0;if((m|0)<(y|0))_=m;else{m=1;break}}else m=1;while(!1);return M=m,F=R,M|0}function bc(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0,ie=0,Ne=0,$e=0,qe=0,lt=0;if($e=F,F=F+176|0,Ae=$e+172|0,m=$e+168|0,le=$e,!(pd(l,d)|0))return u=0,F=$e,u|0;if(cE(l,d,Ae,m),Al(le|0,h|0,168)|0,(A[h>>2]|0)>0){l=0;do qe=le+8+(l<<4)+8|0,ce=+Xr(+O[qe>>3],A[m>>2]|0),O[qe>>3]=ce,l=l+1|0;while((l|0)<(A[h>>2]|0))}ne=+O[d>>3],se=+O[d+8>>3],ce=+Xr(+O[d+16>>3],A[m>>2]|0),H=+Xr(+O[d+24>>3],A[m>>2]|0);e:do if((A[u>>2]|0)>0){if(d=u+4|0,m=A[le>>2]|0,(m|0)<=0){for(l=0;;)if(l=l+1|0,(l|0)>=(A[u>>2]|0)){l=0;break e}}for(h=0;;){if(l=A[d>>2]|0,$=+O[l+(h<<4)>>3],W=+Xr(+O[l+(h<<4)+8>>3],A[Ae>>2]|0),l=A[d>>2]|0,h=h+1|0,qe=(h|0)%(A[u>>2]|0)|0,y=+O[l+(qe<<4)>>3],_=+Xr(+O[l+(qe<<4)+8>>3],A[Ae>>2]|0),!($>=ne)|!(y>=ne)&&!($<=se)|!(y<=se)&&!(W<=H)|!(_<=H)&&!(W>=ce)|!(_>=ce)){G=y-$,R=_-W,l=0;do if(lt=l,l=l+1|0,qe=(l|0)==(m|0)?0:l,y=+O[le+8+(lt<<4)+8>>3],_=+O[le+8+(qe<<4)+8>>3]-y,b=+O[le+8+(lt<<4)>>3],w=+O[le+8+(qe<<4)>>3]-b,M=G*_-R*w,M!=0&&(ie=W-y,Ne=$-b,w=(ie*w-_*Ne)/M,!(w<0|w>1))&&(M=(G*ie-R*Ne)/M,M>=0&M<=1)){l=1;break e}while((l|0)<(m|0))}if((h|0)>=(A[u>>2]|0)){l=0;break}}}else l=0;while(!1);return lt=l,F=$e,lt|0}function u_(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0;if(bc(u,l,h,d)|0)return y=1,y|0;if(y=u+8|0,(A[y>>2]|0)<=0)return y=0,y|0;for(m=u+12|0,u=0;;){if(_=u,u=u+1|0,bc((A[m>>2]|0)+(_<<3)|0,l+(u<<5)|0,h,d)|0){u=1,m=6;break}if((u|0)>=(A[y>>2]|0)){u=0,m=6;break}}return(m|0)==6?u|0:0}function gR(){return 8}function yR(){return 16}function _R(){return 168}function vR(){return 8}function bR(){return 16}function xR(){return 12}function TR(){return 8}function wR(u){return u=u|0,+(+((A[u>>2]|0)>>>0)+4294967296*+(A[u+4>>2]|0))}function SR(u){u=u|0;var l=0,h=0;return h=+O[u>>3],l=+O[u+8>>3],+ +Pt(+(h*h+l*l))}function A_(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0;R=+O[u>>3],w=+O[l>>3]-R,b=+O[u+8>>3],_=+O[l+8>>3]-b,G=+O[h>>3],y=+O[d>>3]-G,$=+O[h+8>>3],M=+O[d+8>>3]-$,y=(y*(b-$)-(R-G)*M)/(w*M-_*y),O[m>>3]=R+w*y,O[m+8>>3]=b+_*y}function c_(u,l){return u=u|0,l=l|0,+gt(+(+O[u>>3]-+O[l>>3]))<11920928955078125e-23?(l=+gt(+(+O[u+8>>3]-+O[l+8>>3]))<11920928955078125e-23,l|0):(l=0,l|0)}function Fn(u,l){u=u|0,l=l|0;var h=0,d=0,m=0;return m=+O[u>>3]-+O[l>>3],d=+O[u+8>>3]-+O[l+8>>3],h=+O[u+16>>3]-+O[l+16>>3],+(m*m+d*d+h*h)}function ER(u,l){u=u|0,l=l|0;var h=0,d=0,m=0;h=+O[u>>3],d=+Ot(+h),h=+yt(+h),O[l+16>>3]=h,h=+O[u+8>>3],m=d*+Ot(+h),O[l>>3]=m,h=d*+yt(+h),O[l+8>>3]=h}function RR(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0;if(y=F,F=F+16|0,m=y,d=Zt(u,l)|0,(h+-1|0)>>>0>5||(d=(d|0)!=0,(h|0)==1&d))return m=-1,F=y,m|0;do if(Ru(u,l,m)|0)d=-1;else if(d){d=((A[26352+(h<<2)>>2]|0)+5-(A[m>>2]|0)|0)%5|0;break}else{d=((A[26384+(h<<2)>>2]|0)+6-(A[m>>2]|0)|0)%6|0;break}while(!1);return m=d,F=y,m|0}function Ru(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,b=0,w=0,R=0,M=0;if(M=F,F=F+32|0,b=M+16|0,w=M,d=sl(u,l,b)|0,d|0)return h=d,F=M,h|0;y=Yy(u,l)|0,R=Br(u,l)|0,sE(y,w),d=oE(y,A[b>>2]|0)|0;do if(an(y)|0){do switch(y|0){case 4:{m=0;break}case 14:{m=1;break}case 24:{m=2;break}case 38:{m=3;break}case 49:{m=4;break}case 58:{m=5;break}case 63:{m=6;break}case 72:{m=7;break}case 83:{m=8;break}case 97:{m=9;break}case 107:{m=10;break}case 117:{m=11;break}default:rt(27795,27797,75,27806)}while(!1);if(_=A[26416+(m*24|0)+8>>2]|0,l=A[26416+(m*24|0)+16>>2]|0,u=A[b>>2]|0,(u|0)!=(A[w>>2]|0)&&(w=cd(y)|0,u=A[b>>2]|0,w|(u|0)==(l|0)&&(d=(d+1|0)%6|0)),(R|0)==3&(u|0)==(l|0)){d=(d+5|0)%6|0;break}(R|0)==5&(u|0)==(_|0)&&(d=(d+1|0)%6|0)}while(!1);return A[h>>2]=d,h=0,F=M,h|0}function fi(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0;if(le=F,F=F+32|0,Ae=le+24|0,se=le+20|0,W=le+8|0,H=le+16|0,$=le,w=(Zt(u,l)|0)==0,w=w?6:5,M=_e(u|0,l|0,52)|0,V()|0,M=M&15,w>>>0<=h>>>0)return d=2,F=le,d|0;G=(M|0)==0,!G&&(ne=Re(7,0,(M^15)*3|0)|0,(ne&u|0)==0&((V()|0)&l|0)==0)?m=h:y=4;e:do if((y|0)==4){if(m=(Zt(u,l)|0)!=0,((m?4:5)|0)<(h|0)||Ru(u,l,Ae)|0||(y=(A[Ae>>2]|0)+h|0,m?m=26704+(((y|0)%5|0)<<2)|0:m=26736+(((y|0)%6|0)<<2)|0,ne=A[m>>2]|0,(ne|0)==7))return d=1,F=le,d|0;A[se>>2]=0,m=Qn(u,l,ne,se,W)|0;do if(!m){if(b=W,R=A[b>>2]|0,b=A[b+4>>2]|0,_=b>>>0<l>>>0|(b|0)==(l|0)&R>>>0<u>>>0,y=_?R:u,_=_?b:l,!G&&(G=Re(7,0,(M^15)*3|0)|0,(R&G|0)==0&(b&(V()|0)|0)==0))m=h;else{if(b=(h+-1+w|0)%(w|0)|0,m=Zt(u,l)|0,(b|0)<0&&rt(27795,27797,248,27822),w=(m|0)!=0,((w?4:5)|0)<(b|0)&&rt(27795,27797,248,27822),Ru(u,l,Ae)|0&&rt(27795,27797,248,27822),m=(A[Ae>>2]|0)+b|0,w?m=26704+(((m|0)%5|0)<<2)|0:m=26736+(((m|0)%6|0)<<2)|0,b=A[m>>2]|0,(b|0)==7&&rt(27795,27797,248,27822),A[H>>2]=0,m=Qn(u,l,b,H,$)|0,m|0)break;R=$,w=A[R>>2]|0,R=A[R+4>>2]|0;do if(R>>>0<_>>>0|(R|0)==(_|0)&w>>>0<y>>>0){if(Zt(w,R)|0?y=Ad(w,R,u,l)|0:y=A[26800+((((A[H>>2]|0)+(A[26768+(b<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,m=Zt(w,R)|0,(y+-1|0)>>>0>5){m=-1,y=w,_=R;break}if(m=(m|0)!=0,(y|0)==1&m){m=-1,y=w,_=R;break}do if(Ru(w,R,Ae)|0)m=-1;else if(m){m=((A[26352+(y<<2)>>2]|0)+5-(A[Ae>>2]|0)|0)%5|0;break}else{m=((A[26384+(y<<2)>>2]|0)+6-(A[Ae>>2]|0)|0)%6|0;break}while(!1);y=w,_=R}else m=h;while(!1);b=W,R=A[b>>2]|0,b=A[b+4>>2]|0}if((y|0)==(R|0)&(_|0)==(b|0)){if(w=(Zt(R,b)|0)!=0,w?u=Ad(R,b,u,l)|0:u=A[26800+((((A[se>>2]|0)+(A[26768+(ne<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,m=Zt(R,b)|0,(u+-1|0)>>>0<=5&&(ce=(m|0)!=0,!((u|0)==1&ce)))do if(Ru(R,b,Ae)|0)m=-1;else if(ce){m=((A[26352+(u<<2)>>2]|0)+5-(A[Ae>>2]|0)|0)%5|0;break}else{m=((A[26384+(u<<2)>>2]|0)+6-(A[Ae>>2]|0)|0)%6|0;break}while(!1);else m=-1;m=m+1|0,m=(m|0)==6|w&(m|0)==5?0:m}l=_,u=y;break e}while(!1);return d=m,F=le,d|0}while(!1);return ce=Re(m|0,0,56)|0,Ae=V()|0|l&-2130706433|536870912,A[d>>2]=ce|u,A[d+4>>2]=Ae,d=0,F=le,d|0}function CR(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0;return y=(Zt(u,l)|0)==0,d=fi(u,l,0,h)|0,m=(d|0)==0,y?!m||(d=fi(u,l,1,h+8|0)|0,d|0)||(d=fi(u,l,2,h+16|0)|0,d|0)||(d=fi(u,l,3,h+24|0)|0,d|0)||(d=fi(u,l,4,h+32|0)|0,d)?(y=d,y|0):fi(u,l,5,h+40|0)|0:!m||(d=fi(u,l,1,h+8|0)|0,d|0)||(d=fi(u,l,2,h+16|0)|0,d|0)||(d=fi(u,l,3,h+24|0)|0,d|0)||(d=fi(u,l,4,h+32|0)|0,d|0)?(y=d,y|0):(y=h+40|0,A[y>>2]=0,A[y+4>>2]=0,y=0,y|0)}function NR(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,b=0,w=0;return w=F,F=F+192|0,m=w,y=w+168|0,_=_e(u|0,l|0,56)|0,V()|0,_=_&7,b=l&-2130706433|134217728,d=sl(u,b,y)|0,d|0?(b=d,F=w,b|0):(l=_e(u|0,l|0,52)|0,V()|0,l=l&15,Zt(u,b)|0?yd(y,l,_,1,m):_d(y,l,_,1,m),b=m+8|0,A[h>>2]=A[b>>2],A[h+4>>2]=A[b+4>>2],A[h+8>>2]=A[b+8>>2],A[h+12>>2]=A[b+12>>2],b=0,F=w,b|0)}function h_(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0;return m=F,F=F+16|0,h=m,!(!0&(l&2013265920|0)==536870912)||(d=l&-2130706433|134217728,!(vd(u,d)|0))?(d=0,F=m,d|0):(y=_e(u|0,l|0,56)|0,V()|0,y=(fi(u,d,y&7,h)|0)==0,d=h,d=y&((A[d>>2]|0)==(u|0)?(A[d+4>>2]|0)==(l|0):0)&1,F=m,d|0)}function f_(u,l,h){u=u|0,l=l|0,h=h|0;var d=0;(l|0)>0?(d=Dr(l,4)|0,A[u>>2]=d,d||rt(27835,27858,40,27872)):A[u>>2]=0,A[u+4>>2]=l,A[u+8>>2]=0,A[u+12>>2]=h}function d_(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,b=0;m=u+4|0,y=u+12|0,_=u+8|0;e:for(;;){for(h=A[m>>2]|0,l=0;;){if((l|0)>=(h|0))break e;if(d=A[u>>2]|0,b=A[d+(l<<2)>>2]|0,!b)l=l+1|0;else break}l=d+(~~(+gt(+(+go(10,+ +(15-(A[y>>2]|0)|0))*(+O[b>>3]+ +O[b+8>>3])))%+(h|0))>>>0<<2)|0,h=A[l>>2]|0;t:do if(h|0){if(d=b+32|0,(h|0)==(b|0))A[l>>2]=A[d>>2];else{if(h=h+32|0,l=A[h>>2]|0,!l)break;for(;(l|0)!=(b|0);)if(h=l+32|0,l=A[h>>2]|0,!l)break t;A[h>>2]=A[d>>2]}Qe(b),A[_>>2]=(A[_>>2]|0)+-1}while(!1)}Qe(A[u>>2]|0)}function p_(u){u=u|0;var l=0,h=0,d=0;for(d=A[u+4>>2]|0,h=0;;){if((h|0)>=(d|0)){l=0,h=4;break}if(l=A[(A[u>>2]|0)+(h<<2)>>2]|0,!l)h=h+1|0;else{h=4;break}}return(h|0)==4?l|0:0}function m_(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0;if(h=~~(+gt(+(+go(10,+ +(15-(A[u+12>>2]|0)|0))*(+O[l>>3]+ +O[l+8>>3])))%+(A[u+4>>2]|0))>>>0,h=(A[u>>2]|0)+(h<<2)|0,d=A[h>>2]|0,!d)return y=1,y|0;y=l+32|0;do if((d|0)!=(l|0)){if(h=A[d+32>>2]|0,!h)return y=1,y|0;for(m=h;;){if((m|0)==(l|0)){m=8;break}if(h=A[m+32>>2]|0,h)d=m,m=h;else{h=1,m=10;break}}if((m|0)==8){A[d+32>>2]=A[y>>2];break}else if((m|0)==10)return h|0}else A[h>>2]=A[y>>2];while(!1);return Qe(l),y=u+8|0,A[y>>2]=(A[y>>2]|0)+-1,y=0,y|0}function MR(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0;y=ns(40)|0,y||rt(27888,27858,98,27901),A[y>>2]=A[l>>2],A[y+4>>2]=A[l+4>>2],A[y+8>>2]=A[l+8>>2],A[y+12>>2]=A[l+12>>2],m=y+16|0,A[m>>2]=A[h>>2],A[m+4>>2]=A[h+4>>2],A[m+8>>2]=A[h+8>>2],A[m+12>>2]=A[h+12>>2],A[y+32>>2]=0,m=~~(+gt(+(+go(10,+ +(15-(A[u+12>>2]|0)|0))*(+O[l>>3]+ +O[l+8>>3])))%+(A[u+4>>2]|0))>>>0,m=(A[u>>2]|0)+(m<<2)|0,d=A[m>>2]|0;do if(!d)A[m>>2]=y;else{for(;!(al(d,l)|0&&al(d+16|0,h)|0);)if(m=A[d+32>>2]|0,d=(m|0)==0?d:m,!(A[d+32>>2]|0)){_=10;break}if((_|0)==10){A[d+32>>2]=y;break}return Qe(y),_=d,_|0}while(!1);return _=u+8|0,A[_>>2]=(A[_>>2]|0)+1,_=y,_|0}function PR(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0;if(m=~~(+gt(+(+go(10,+ +(15-(A[u+12>>2]|0)|0))*(+O[l>>3]+ +O[l+8>>3])))%+(A[u+4>>2]|0))>>>0,m=A[(A[u>>2]|0)+(m<<2)>>2]|0,!m)return h=0,h|0;if(!h){for(u=m;;){if(al(u,l)|0){d=10;break}if(u=A[u+32>>2]|0,!u){u=0,d=10;break}}if((d|0)==10)return u|0}for(u=m;;){if(al(u,l)|0&&al(u+16|0,h)|0){d=10;break}if(u=A[u+32>>2]|0,!u){u=0,d=10;break}}return(d|0)==10?u|0:0}function BR(u,l){u=u|0,l=l|0;var h=0;if(h=~~(+gt(+(+go(10,+ +(15-(A[u+12>>2]|0)|0))*(+O[l>>3]+ +O[l+8>>3])))%+(A[u+4>>2]|0))>>>0,u=A[(A[u>>2]|0)+(h<<2)>>2]|0,!u)return h=0,h|0;for(;;){if(al(u,l)|0){l=5;break}if(u=A[u+32>>2]|0,!u){u=0,l=5;break}}return(l|0)==5?u|0:0}function DR(){return 27920}function vo(u){return u=+u,~~+v_(+u)|0}function ns(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0,ie=0,Ne=0;Ne=F,F=F+16|0,$=Ne;do if(u>>>0<245){if(R=u>>>0<11?16:u+11&-8,u=R>>>3,G=A[6981]|0,h=G>>>u,h&3|0)return l=(h&1^1)+u|0,u=27964+(l<<1<<2)|0,h=u+8|0,d=A[h>>2]|0,m=d+8|0,y=A[m>>2]|0,(y|0)==(u|0)?A[6981]=G&~(1<<l):(A[y+12>>2]=u,A[h>>2]=y),ie=l<<3,A[d+4>>2]=ie|3,ie=d+ie+4|0,A[ie>>2]=A[ie>>2]|1,ie=m,F=Ne,ie|0;if(M=A[6983]|0,R>>>0>M>>>0){if(h|0)return l=2<<u,l=h<<u&(l|0-l),l=(l&0-l)+-1|0,b=l>>>12&16,l=l>>>b,h=l>>>5&8,l=l>>>h,y=l>>>2&4,l=l>>>y,u=l>>>1&2,l=l>>>u,d=l>>>1&1,d=(h|b|y|u|d)+(l>>>d)|0,l=27964+(d<<1<<2)|0,u=l+8|0,y=A[u>>2]|0,b=y+8|0,h=A[b>>2]|0,(h|0)==(l|0)?(u=G&~(1<<d),A[6981]=u):(A[h+12>>2]=l,A[u>>2]=h,u=G),ie=d<<3,_=ie-R|0,A[y+4>>2]=R|3,m=y+R|0,A[m+4>>2]=_|1,A[y+ie>>2]=_,M|0&&(d=A[6986]|0,l=M>>>3,h=27964+(l<<1<<2)|0,l=1<<l,u&l?(u=h+8|0,l=A[u>>2]|0):(A[6981]=u|l,l=h,u=h+8|0),A[u>>2]=d,A[l+12>>2]=d,A[d+8>>2]=l,A[d+12>>2]=h),A[6983]=_,A[6986]=m,ie=b,F=Ne,ie|0;if(y=A[6982]|0,y){for(h=(y&0-y)+-1|0,m=h>>>12&16,h=h>>>m,d=h>>>5&8,h=h>>>d,_=h>>>2&4,h=h>>>_,b=h>>>1&2,h=h>>>b,w=h>>>1&1,w=A[28228+((d|m|_|b|w)+(h>>>w)<<2)>>2]|0,h=w,b=w,w=(A[w+4>>2]&-8)-R|0;u=A[h+16>>2]|0,!(!u&&(u=A[h+20>>2]|0,!u));)_=(A[u+4>>2]&-8)-R|0,m=_>>>0<w>>>0,h=u,b=m?u:b,w=m?_:w;if(_=b+R|0,_>>>0>b>>>0){m=A[b+24>>2]|0,l=A[b+12>>2]|0;do if((l|0)==(b|0)){if(u=b+20|0,l=A[u>>2]|0,!l&&(u=b+16|0,l=A[u>>2]|0,!l)){h=0;break}for(;;)if(d=l+20|0,h=A[d>>2]|0,h)l=h,u=d;else if(d=l+16|0,h=A[d>>2]|0,h)l=h,u=d;else break;A[u>>2]=0,h=l}else h=A[b+8>>2]|0,A[h+12>>2]=l,A[l+8>>2]=h,h=l;while(!1);do if(m|0){if(l=A[b+28>>2]|0,u=28228+(l<<2)|0,(b|0)==(A[u>>2]|0)){if(A[u>>2]=h,!h){A[6982]=y&~(1<<l);break}}else if(ie=m+16|0,A[((A[ie>>2]|0)==(b|0)?ie:m+20|0)>>2]=h,!h)break;A[h+24>>2]=m,l=A[b+16>>2]|0,l|0&&(A[h+16>>2]=l,A[l+24>>2]=h),l=A[b+20>>2]|0,l|0&&(A[h+20>>2]=l,A[l+24>>2]=h)}while(!1);return w>>>0<16?(ie=w+R|0,A[b+4>>2]=ie|3,ie=b+ie+4|0,A[ie>>2]=A[ie>>2]|1):(A[b+4>>2]=R|3,A[_+4>>2]=w|1,A[_+w>>2]=w,M|0&&(d=A[6986]|0,l=M>>>3,h=27964+(l<<1<<2)|0,l=1<<l,l&G?(u=h+8|0,l=A[u>>2]|0):(A[6981]=l|G,l=h,u=h+8|0),A[u>>2]=d,A[l+12>>2]=d,A[d+8>>2]=l,A[d+12>>2]=h),A[6983]=w,A[6986]=_),ie=b+8|0,F=Ne,ie|0}else G=R}else G=R}else G=R}else if(u>>>0<=4294967231)if(u=u+11|0,R=u&-8,d=A[6982]|0,d){m=0-R|0,u=u>>>8,u?R>>>0>16777215?w=31:(G=(u+1048320|0)>>>16&8,ne=u<<G,b=(ne+520192|0)>>>16&4,ne=ne<<b,w=(ne+245760|0)>>>16&2,w=14-(b|G|w)+(ne<<w>>>15)|0,w=R>>>(w+7|0)&1|w<<1):w=0,h=A[28228+(w<<2)>>2]|0;e:do if(!h)h=0,u=0,ne=61;else for(u=0,b=R<<((w|0)==31?0:25-(w>>>1)|0),y=0;;){if(_=(A[h+4>>2]&-8)-R|0,_>>>0<m>>>0)if(_)u=h,m=_;else{u=h,m=0,ne=65;break e}if(ne=A[h+20>>2]|0,h=A[h+16+(b>>>31<<2)>>2]|0,y=(ne|0)==0|(ne|0)==(h|0)?y:ne,h)b=b<<1;else{h=y,ne=61;break}}while(!1);if((ne|0)==61){if((h|0)==0&(u|0)==0){if(u=2<<w,u=(u|0-u)&d,!u){G=R;break}G=(u&0-u)+-1|0,_=G>>>12&16,G=G>>>_,y=G>>>5&8,G=G>>>y,b=G>>>2&4,G=G>>>b,w=G>>>1&2,G=G>>>w,h=G>>>1&1,u=0,h=A[28228+((y|_|b|w|h)+(G>>>h)<<2)>>2]|0}h?ne=65:(b=u,_=m)}if((ne|0)==65)for(y=h;;)if(G=(A[y+4>>2]&-8)-R|0,h=G>>>0<m>>>0,m=h?G:m,u=h?y:u,h=A[y+16>>2]|0,h||(h=A[y+20>>2]|0),h)y=h;else{b=u,_=m;break}if((b|0)!=0&&_>>>0<((A[6983]|0)-R|0)>>>0&&(M=b+R|0,M>>>0>b>>>0)){y=A[b+24>>2]|0,l=A[b+12>>2]|0;do if((l|0)==(b|0)){if(u=b+20|0,l=A[u>>2]|0,!l&&(u=b+16|0,l=A[u>>2]|0,!l)){l=0;break}for(;;)if(m=l+20|0,h=A[m>>2]|0,h)l=h,u=m;else if(m=l+16|0,h=A[m>>2]|0,h)l=h,u=m;else break;A[u>>2]=0}else ie=A[b+8>>2]|0,A[ie+12>>2]=l,A[l+8>>2]=ie;while(!1);do if(y){if(u=A[b+28>>2]|0,h=28228+(u<<2)|0,(b|0)==(A[h>>2]|0)){if(A[h>>2]=l,!l){d=d&~(1<<u),A[6982]=d;break}}else if(ie=y+16|0,A[((A[ie>>2]|0)==(b|0)?ie:y+20|0)>>2]=l,!l)break;A[l+24>>2]=y,u=A[b+16>>2]|0,u|0&&(A[l+16>>2]=u,A[u+24>>2]=l),u=A[b+20>>2]|0,u&&(A[l+20>>2]=u,A[u+24>>2]=l)}while(!1);e:do if(_>>>0<16)ie=_+R|0,A[b+4>>2]=ie|3,ie=b+ie+4|0,A[ie>>2]=A[ie>>2]|1;else{if(A[b+4>>2]=R|3,A[M+4>>2]=_|1,A[M+_>>2]=_,l=_>>>3,_>>>0<256){h=27964+(l<<1<<2)|0,u=A[6981]|0,l=1<<l,u&l?(u=h+8|0,l=A[u>>2]|0):(A[6981]=u|l,l=h,u=h+8|0),A[u>>2]=M,A[l+12>>2]=M,A[M+8>>2]=l,A[M+12>>2]=h;break}if(l=_>>>8,l?_>>>0>16777215?h=31:(le=(l+1048320|0)>>>16&8,ie=l<<le,Ae=(ie+520192|0)>>>16&4,ie=ie<<Ae,h=(ie+245760|0)>>>16&2,h=14-(Ae|le|h)+(ie<<h>>>15)|0,h=_>>>(h+7|0)&1|h<<1):h=0,l=28228+(h<<2)|0,A[M+28>>2]=h,u=M+16|0,A[u+4>>2]=0,A[u>>2]=0,u=1<<h,!(d&u)){A[6982]=d|u,A[l>>2]=M,A[M+24>>2]=l,A[M+12>>2]=M,A[M+8>>2]=M;break}l=A[l>>2]|0;t:do if((A[l+4>>2]&-8|0)!=(_|0)){for(d=_<<((h|0)==31?0:25-(h>>>1)|0);h=l+16+(d>>>31<<2)|0,u=A[h>>2]|0,!!u;)if((A[u+4>>2]&-8|0)==(_|0)){l=u;break t}else d=d<<1,l=u;A[h>>2]=M,A[M+24>>2]=l,A[M+12>>2]=M,A[M+8>>2]=M;break e}while(!1);le=l+8|0,ie=A[le>>2]|0,A[ie+12>>2]=M,A[le>>2]=M,A[M+8>>2]=ie,A[M+12>>2]=l,A[M+24>>2]=0}while(!1);return ie=b+8|0,F=Ne,ie|0}else G=R}else G=R;else G=-1;while(!1);if(h=A[6983]|0,h>>>0>=G>>>0)return l=h-G|0,u=A[6986]|0,l>>>0>15?(ie=u+G|0,A[6986]=ie,A[6983]=l,A[ie+4>>2]=l|1,A[u+h>>2]=l,A[u+4>>2]=G|3):(A[6983]=0,A[6986]=0,A[u+4>>2]=h|3,ie=u+h+4|0,A[ie>>2]=A[ie>>2]|1),ie=u+8|0,F=Ne,ie|0;if(_=A[6984]|0,_>>>0>G>>>0)return Ae=_-G|0,A[6984]=Ae,ie=A[6987]|0,le=ie+G|0,A[6987]=le,A[le+4>>2]=Ae|1,A[ie+4>>2]=G|3,ie=ie+8|0,F=Ne,ie|0;if(A[7099]|0?u=A[7101]|0:(A[7101]=4096,A[7100]=4096,A[7102]=-1,A[7103]=-1,A[7104]=0,A[7092]=0,A[7099]=$&-16^1431655768,u=4096),b=G+48|0,w=G+47|0,y=u+w|0,m=0-u|0,R=y&m,R>>>0<=G>>>0||(u=A[7091]|0,u|0&&(M=A[7089]|0,$=M+R|0,$>>>0<=M>>>0|$>>>0>u>>>0)))return ie=0,F=Ne,ie|0;e:do if(A[7092]&4)l=0,ne=143;else{h=A[6987]|0;t:do if(h){for(d=28372;$=A[d>>2]|0,!($>>>0<=h>>>0&&($+(A[d+4>>2]|0)|0)>>>0>h>>>0);)if(u=A[d+8>>2]|0,u)d=u;else{ne=128;break t}if(l=y-_&m,l>>>0<2147483647)if(u=To(l|0)|0,(u|0)==((A[d>>2]|0)+(A[d+4>>2]|0)|0)){if((u|0)!=-1){_=l,y=u,ne=145;break e}}else d=u,ne=136;else l=0}else ne=128;while(!1);do if((ne|0)==128)if(h=To(0)|0,(h|0)!=-1&&(l=h,H=A[7100]|0,W=H+-1|0,l=((W&l|0)==0?0:(W+l&0-H)-l|0)+R|0,H=A[7089]|0,W=l+H|0,l>>>0>G>>>0&l>>>0<2147483647)){if($=A[7091]|0,$|0&&W>>>0<=H>>>0|W>>>0>$>>>0){l=0;break}if(u=To(l|0)|0,(u|0)==(h|0)){_=l,y=h,ne=145;break e}else d=u,ne=136}else l=0;while(!1);do if((ne|0)==136){if(h=0-l|0,!(b>>>0>l>>>0&(l>>>0<2147483647&(d|0)!=-1)))if((d|0)==-1){l=0;break}else{_=l,y=d,ne=145;break e}if(u=A[7101]|0,u=w-l+u&0-u,u>>>0>=2147483647){_=l,y=d,ne=145;break e}if((To(u|0)|0)==-1){To(h|0)|0,l=0;break}else{_=u+l|0,y=d,ne=145;break e}}while(!1);A[7092]=A[7092]|4,ne=143}while(!1);if((ne|0)==143&&R>>>0<2147483647&&(Ae=To(R|0)|0,W=To(0)|0,se=W-Ae|0,ce=se>>>0>(G+40|0)>>>0,!((Ae|0)==-1|ce^1|Ae>>>0<W>>>0&((Ae|0)!=-1&(W|0)!=-1)^1))&&(_=ce?se:l,y=Ae,ne=145),(ne|0)==145){l=(A[7089]|0)+_|0,A[7089]=l,l>>>0>(A[7090]|0)>>>0&&(A[7090]=l),w=A[6987]|0;e:do if(w){for(l=28372;;){if(u=A[l>>2]|0,h=A[l+4>>2]|0,(y|0)==(u+h|0)){ne=154;break}if(d=A[l+8>>2]|0,d)l=d;else break}if((ne|0)==154&&(le=l+4|0,(A[l+12>>2]&8|0)==0)&&y>>>0>w>>>0&u>>>0<=w>>>0){A[le>>2]=h+_,ie=(A[6984]|0)+_|0,Ae=w+8|0,Ae=(Ae&7|0)==0?0:0-Ae&7,le=w+Ae|0,Ae=ie-Ae|0,A[6987]=le,A[6984]=Ae,A[le+4>>2]=Ae|1,A[w+ie+4>>2]=40,A[6988]=A[7103];break}for(y>>>0<(A[6985]|0)>>>0&&(A[6985]=y),h=y+_|0,l=28372;;){if((A[l>>2]|0)==(h|0)){ne=162;break}if(u=A[l+8>>2]|0,u)l=u;else break}if((ne|0)==162&&(A[l+12>>2]&8|0)==0){A[l>>2]=y,M=l+4|0,A[M>>2]=(A[M>>2]|0)+_,M=y+8|0,M=y+((M&7|0)==0?0:0-M&7)|0,l=h+8|0,l=h+((l&7|0)==0?0:0-l&7)|0,R=M+G|0,b=l-M-G|0,A[M+4>>2]=G|3;t:do if((w|0)==(l|0))ie=(A[6984]|0)+b|0,A[6984]=ie,A[6987]=R,A[R+4>>2]=ie|1;else{if((A[6986]|0)==(l|0)){ie=(A[6983]|0)+b|0,A[6983]=ie,A[6986]=R,A[R+4>>2]=ie|1,A[R+ie>>2]=ie;break}if(u=A[l+4>>2]|0,(u&3|0)==1){_=u&-8,d=u>>>3;n:do if(u>>>0<256)if(u=A[l+8>>2]|0,h=A[l+12>>2]|0,(h|0)==(u|0)){A[6981]=A[6981]&~(1<<d);break}else{A[u+12>>2]=h,A[h+8>>2]=u;break}else{y=A[l+24>>2]|0,u=A[l+12>>2]|0;do if((u|0)==(l|0)){if(h=l+16|0,d=h+4|0,u=A[d>>2]|0,u)h=d;else if(u=A[h>>2]|0,!u){u=0;break}for(;;)if(m=u+20|0,d=A[m>>2]|0,d)u=d,h=m;else if(m=u+16|0,d=A[m>>2]|0,d)u=d,h=m;else break;A[h>>2]=0}else ie=A[l+8>>2]|0,A[ie+12>>2]=u,A[u+8>>2]=ie;while(!1);if(!y)break;h=A[l+28>>2]|0,d=28228+(h<<2)|0;do if((A[d>>2]|0)!=(l|0)){if(ie=y+16|0,A[((A[ie>>2]|0)==(l|0)?ie:y+20|0)>>2]=u,!u)break n}else{if(A[d>>2]=u,u|0)break;A[6982]=A[6982]&~(1<<h);break n}while(!1);if(A[u+24>>2]=y,h=l+16|0,d=A[h>>2]|0,d|0&&(A[u+16>>2]=d,A[d+24>>2]=u),h=A[h+4>>2]|0,!h)break;A[u+20>>2]=h,A[h+24>>2]=u}while(!1);l=l+_|0,m=_+b|0}else m=b;if(l=l+4|0,A[l>>2]=A[l>>2]&-2,A[R+4>>2]=m|1,A[R+m>>2]=m,l=m>>>3,m>>>0<256){h=27964+(l<<1<<2)|0,u=A[6981]|0,l=1<<l,u&l?(u=h+8|0,l=A[u>>2]|0):(A[6981]=u|l,l=h,u=h+8|0),A[u>>2]=R,A[l+12>>2]=R,A[R+8>>2]=l,A[R+12>>2]=h;break}l=m>>>8;do if(!l)d=0;else{if(m>>>0>16777215){d=31;break}le=(l+1048320|0)>>>16&8,ie=l<<le,Ae=(ie+520192|0)>>>16&4,ie=ie<<Ae,d=(ie+245760|0)>>>16&2,d=14-(Ae|le|d)+(ie<<d>>>15)|0,d=m>>>(d+7|0)&1|d<<1}while(!1);if(l=28228+(d<<2)|0,A[R+28>>2]=d,u=R+16|0,A[u+4>>2]=0,A[u>>2]=0,u=A[6982]|0,h=1<<d,!(u&h)){A[6982]=u|h,A[l>>2]=R,A[R+24>>2]=l,A[R+12>>2]=R,A[R+8>>2]=R;break}l=A[l>>2]|0;n:do if((A[l+4>>2]&-8|0)!=(m|0)){for(d=m<<((d|0)==31?0:25-(d>>>1)|0);h=l+16+(d>>>31<<2)|0,u=A[h>>2]|0,!!u;)if((A[u+4>>2]&-8|0)==(m|0)){l=u;break n}else d=d<<1,l=u;A[h>>2]=R,A[R+24>>2]=l,A[R+12>>2]=R,A[R+8>>2]=R;break t}while(!1);le=l+8|0,ie=A[le>>2]|0,A[ie+12>>2]=R,A[le>>2]=R,A[R+8>>2]=ie,A[R+12>>2]=l,A[R+24>>2]=0}while(!1);return ie=M+8|0,F=Ne,ie|0}for(l=28372;u=A[l>>2]|0,!(u>>>0<=w>>>0&&(ie=u+(A[l+4>>2]|0)|0,ie>>>0>w>>>0));)l=A[l+8>>2]|0;m=ie+-47|0,u=m+8|0,u=m+((u&7|0)==0?0:0-u&7)|0,m=w+16|0,u=u>>>0<m>>>0?w:u,l=u+8|0,h=_+-40|0,Ae=y+8|0,Ae=(Ae&7|0)==0?0:0-Ae&7,le=y+Ae|0,Ae=h-Ae|0,A[6987]=le,A[6984]=Ae,A[le+4>>2]=Ae|1,A[y+h+4>>2]=40,A[6988]=A[7103],h=u+4|0,A[h>>2]=27,A[l>>2]=A[7093],A[l+4>>2]=A[7094],A[l+8>>2]=A[7095],A[l+12>>2]=A[7096],A[7093]=y,A[7094]=_,A[7096]=0,A[7095]=l,l=u+24|0;do le=l,l=l+4|0,A[l>>2]=7;while((le+8|0)>>>0<ie>>>0);if((u|0)!=(w|0)){if(y=u-w|0,A[h>>2]=A[h>>2]&-2,A[w+4>>2]=y|1,A[u>>2]=y,l=y>>>3,y>>>0<256){h=27964+(l<<1<<2)|0,u=A[6981]|0,l=1<<l,u&l?(u=h+8|0,l=A[u>>2]|0):(A[6981]=u|l,l=h,u=h+8|0),A[u>>2]=w,A[l+12>>2]=w,A[w+8>>2]=l,A[w+12>>2]=h;break}if(l=y>>>8,l?y>>>0>16777215?d=31:(le=(l+1048320|0)>>>16&8,ie=l<<le,Ae=(ie+520192|0)>>>16&4,ie=ie<<Ae,d=(ie+245760|0)>>>16&2,d=14-(Ae|le|d)+(ie<<d>>>15)|0,d=y>>>(d+7|0)&1|d<<1):d=0,h=28228+(d<<2)|0,A[w+28>>2]=d,A[w+20>>2]=0,A[m>>2]=0,l=A[6982]|0,u=1<<d,!(l&u)){A[6982]=l|u,A[h>>2]=w,A[w+24>>2]=h,A[w+12>>2]=w,A[w+8>>2]=w;break}l=A[h>>2]|0;t:do if((A[l+4>>2]&-8|0)!=(y|0)){for(d=y<<((d|0)==31?0:25-(d>>>1)|0);h=l+16+(d>>>31<<2)|0,u=A[h>>2]|0,!!u;)if((A[u+4>>2]&-8|0)==(y|0)){l=u;break t}else d=d<<1,l=u;A[h>>2]=w,A[w+24>>2]=l,A[w+12>>2]=w,A[w+8>>2]=w;break e}while(!1);le=l+8|0,ie=A[le>>2]|0,A[ie+12>>2]=w,A[le>>2]=w,A[w+8>>2]=ie,A[w+12>>2]=l,A[w+24>>2]=0}}else ie=A[6985]|0,(ie|0)==0|y>>>0<ie>>>0&&(A[6985]=y),A[7093]=y,A[7094]=_,A[7096]=0,A[6990]=A[7099],A[6989]=-1,A[6994]=27964,A[6993]=27964,A[6996]=27972,A[6995]=27972,A[6998]=27980,A[6997]=27980,A[7e3]=27988,A[6999]=27988,A[7002]=27996,A[7001]=27996,A[7004]=28004,A[7003]=28004,A[7006]=28012,A[7005]=28012,A[7008]=28020,A[7007]=28020,A[7010]=28028,A[7009]=28028,A[7012]=28036,A[7011]=28036,A[7014]=28044,A[7013]=28044,A[7016]=28052,A[7015]=28052,A[7018]=28060,A[7017]=28060,A[7020]=28068,A[7019]=28068,A[7022]=28076,A[7021]=28076,A[7024]=28084,A[7023]=28084,A[7026]=28092,A[7025]=28092,A[7028]=28100,A[7027]=28100,A[7030]=28108,A[7029]=28108,A[7032]=28116,A[7031]=28116,A[7034]=28124,A[7033]=28124,A[7036]=28132,A[7035]=28132,A[7038]=28140,A[7037]=28140,A[7040]=28148,A[7039]=28148,A[7042]=28156,A[7041]=28156,A[7044]=28164,A[7043]=28164,A[7046]=28172,A[7045]=28172,A[7048]=28180,A[7047]=28180,A[7050]=28188,A[7049]=28188,A[7052]=28196,A[7051]=28196,A[7054]=28204,A[7053]=28204,A[7056]=28212,A[7055]=28212,ie=_+-40|0,Ae=y+8|0,Ae=(Ae&7|0)==0?0:0-Ae&7,le=y+Ae|0,Ae=ie-Ae|0,A[6987]=le,A[6984]=Ae,A[le+4>>2]=Ae|1,A[y+ie+4>>2]=40,A[6988]=A[7103];while(!1);if(l=A[6984]|0,l>>>0>G>>>0)return Ae=l-G|0,A[6984]=Ae,ie=A[6987]|0,le=ie+G|0,A[6987]=le,A[le+4>>2]=Ae|1,A[ie+4>>2]=G|3,ie=ie+8|0,F=Ne,ie|0}return ie=DR()|0,A[ie>>2]=12,ie=0,F=Ne,ie|0}function Qe(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,b=0,w=0;if(u){h=u+-8|0,m=A[6985]|0,u=A[u+-4>>2]|0,l=u&-8,w=h+l|0;do if(u&1)b=h,_=h;else{if(d=A[h>>2]|0,!(u&3)||(_=h+(0-d)|0,y=d+l|0,_>>>0<m>>>0))return;if((A[6986]|0)==(_|0)){if(u=w+4|0,l=A[u>>2]|0,(l&3|0)!=3){b=_,l=y;break}A[6983]=y,A[u>>2]=l&-2,A[_+4>>2]=y|1,A[_+y>>2]=y;return}if(h=d>>>3,d>>>0<256)if(u=A[_+8>>2]|0,l=A[_+12>>2]|0,(l|0)==(u|0)){A[6981]=A[6981]&~(1<<h),b=_,l=y;break}else{A[u+12>>2]=l,A[l+8>>2]=u,b=_,l=y;break}m=A[_+24>>2]|0,u=A[_+12>>2]|0;do if((u|0)==(_|0)){if(l=_+16|0,h=l+4|0,u=A[h>>2]|0,u)l=h;else if(u=A[l>>2]|0,!u){u=0;break}for(;;)if(d=u+20|0,h=A[d>>2]|0,h)u=h,l=d;else if(d=u+16|0,h=A[d>>2]|0,h)u=h,l=d;else break;A[l>>2]=0}else b=A[_+8>>2]|0,A[b+12>>2]=u,A[u+8>>2]=b;while(!1);if(m){if(l=A[_+28>>2]|0,h=28228+(l<<2)|0,(A[h>>2]|0)==(_|0)){if(A[h>>2]=u,!u){A[6982]=A[6982]&~(1<<l),b=_,l=y;break}}else if(b=m+16|0,A[((A[b>>2]|0)==(_|0)?b:m+20|0)>>2]=u,!u){b=_,l=y;break}A[u+24>>2]=m,l=_+16|0,h=A[l>>2]|0,h|0&&(A[u+16>>2]=h,A[h+24>>2]=u),l=A[l+4>>2]|0,l?(A[u+20>>2]=l,A[l+24>>2]=u,b=_,l=y):(b=_,l=y)}else b=_,l=y}while(!1);if(!(_>>>0>=w>>>0)&&(u=w+4|0,d=A[u>>2]|0,!!(d&1))){if(d&2)A[u>>2]=d&-2,A[b+4>>2]=l|1,A[_+l>>2]=l,m=l;else{if((A[6987]|0)==(w|0)){if(w=(A[6984]|0)+l|0,A[6984]=w,A[6987]=b,A[b+4>>2]=w|1,(b|0)!=(A[6986]|0))return;A[6986]=0,A[6983]=0;return}if((A[6986]|0)==(w|0)){w=(A[6983]|0)+l|0,A[6983]=w,A[6986]=_,A[b+4>>2]=w|1,A[_+w>>2]=w;return}m=(d&-8)+l|0,h=d>>>3;do if(d>>>0<256)if(l=A[w+8>>2]|0,u=A[w+12>>2]|0,(u|0)==(l|0)){A[6981]=A[6981]&~(1<<h);break}else{A[l+12>>2]=u,A[u+8>>2]=l;break}else{y=A[w+24>>2]|0,u=A[w+12>>2]|0;do if((u|0)==(w|0)){if(l=w+16|0,h=l+4|0,u=A[h>>2]|0,u)l=h;else if(u=A[l>>2]|0,!u){h=0;break}for(;;)if(d=u+20|0,h=A[d>>2]|0,h)u=h,l=d;else if(d=u+16|0,h=A[d>>2]|0,h)u=h,l=d;else break;A[l>>2]=0,h=u}else h=A[w+8>>2]|0,A[h+12>>2]=u,A[u+8>>2]=h,h=u;while(!1);if(y|0){if(u=A[w+28>>2]|0,l=28228+(u<<2)|0,(A[l>>2]|0)==(w|0)){if(A[l>>2]=h,!h){A[6982]=A[6982]&~(1<<u);break}}else if(d=y+16|0,A[((A[d>>2]|0)==(w|0)?d:y+20|0)>>2]=h,!h)break;A[h+24>>2]=y,u=w+16|0,l=A[u>>2]|0,l|0&&(A[h+16>>2]=l,A[l+24>>2]=h),u=A[u+4>>2]|0,u|0&&(A[h+20>>2]=u,A[u+24>>2]=h)}}while(!1);if(A[b+4>>2]=m|1,A[_+m>>2]=m,(b|0)==(A[6986]|0)){A[6983]=m;return}}if(u=m>>>3,m>>>0<256){h=27964+(u<<1<<2)|0,l=A[6981]|0,u=1<<u,l&u?(l=h+8|0,u=A[l>>2]|0):(A[6981]=l|u,u=h,l=h+8|0),A[l>>2]=b,A[u+12>>2]=b,A[b+8>>2]=u,A[b+12>>2]=h;return}u=m>>>8,u?m>>>0>16777215?d=31:(_=(u+1048320|0)>>>16&8,w=u<<_,y=(w+520192|0)>>>16&4,w=w<<y,d=(w+245760|0)>>>16&2,d=14-(y|_|d)+(w<<d>>>15)|0,d=m>>>(d+7|0)&1|d<<1):d=0,u=28228+(d<<2)|0,A[b+28>>2]=d,A[b+20>>2]=0,A[b+16>>2]=0,l=A[6982]|0,h=1<<d;e:do if(!(l&h))A[6982]=l|h,A[u>>2]=b,A[b+24>>2]=u,A[b+12>>2]=b,A[b+8>>2]=b;else{u=A[u>>2]|0;t:do if((A[u+4>>2]&-8|0)!=(m|0)){for(d=m<<((d|0)==31?0:25-(d>>>1)|0);h=u+16+(d>>>31<<2)|0,l=A[h>>2]|0,!!l;)if((A[l+4>>2]&-8|0)==(m|0)){u=l;break t}else d=d<<1,u=l;A[h>>2]=b,A[b+24>>2]=u,A[b+12>>2]=b,A[b+8>>2]=b;break e}while(!1);_=u+8|0,w=A[_>>2]|0,A[w+12>>2]=b,A[_>>2]=b,A[b+8>>2]=w,A[b+12>>2]=u,A[b+24>>2]=0}while(!1);if(w=(A[6989]|0)+-1|0,A[6989]=w,!(w|0)){for(u=28380;u=A[u>>2]|0,u;)u=u+8|0;A[6989]=-1}}}}function Dr(u,l){u=u|0,l=l|0;var h=0;return u?(h=es(l,u)|0,(l|u)>>>0>65535&&(h=((h>>>0)/(u>>>0)|0|0)==(l|0)?h:-1)):h=0,u=ns(h)|0,!u||!(A[u+-4>>2]&3)||xo(u|0,0,h|0)|0,u|0}function We(u,l,h,d){return u=u|0,l=l|0,h=h|0,d=d|0,h=u+h>>>0,ut(l+d+(h>>>0<u>>>0|0)>>>0|0),h|0|0}function Xn(u,l,h,d){return u=u|0,l=l|0,h=h|0,d=d|0,d=l-d-(h>>>0>u>>>0|0)>>>0,ut(d|0),u-h>>>0|0|0}function g_(u){return u=u|0,(u?31-(Us(u^u-1)|0)|0:32)|0}function Ld(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,b=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0;if(M=u,w=l,R=w,_=h,$=d,b=$,!R)return y=(m|0)!=0,b?y?(A[m>>2]=u|0,A[m+4>>2]=l&0,$=0,m=0,ut($|0),m|0):($=0,m=0,ut($|0),m|0):(y&&(A[m>>2]=(M>>>0)%(_>>>0),A[m+4>>2]=0),$=0,m=(M>>>0)/(_>>>0)>>>0,ut($|0),m|0);y=(b|0)==0;do if(_){if(!y){if(y=(Us(b|0)|0)-(Us(R|0)|0)|0,y>>>0<=31){G=y+1|0,b=31-y|0,l=y-31>>31,_=G,u=M>>>(G>>>0)&l|R<<b,l=R>>>(G>>>0)&l,y=0,b=M<<b;break}return m?(A[m>>2]=u|0,A[m+4>>2]=w|l&0,$=0,m=0,ut($|0),m|0):($=0,m=0,ut($|0),m|0)}if(y=_-1|0,y&_|0){b=(Us(_|0)|0)+33-(Us(R|0)|0)|0,W=64-b|0,G=32-b|0,w=G>>31,H=b-32|0,l=H>>31,_=b,u=G-1>>31&R>>>(H>>>0)|(R<<G|M>>>(b>>>0))&l,l=l&R>>>(b>>>0),y=M<<W&w,b=(R<<W|M>>>(H>>>0))&w|M<<G&b-33>>31;break}return m|0&&(A[m>>2]=y&M,A[m+4>>2]=0),(_|0)==1?(H=w|l&0,W=u|0|0,ut(H|0),W|0):(W=g_(_|0)|0,H=R>>>(W>>>0)|0,W=R<<32-W|M>>>(W>>>0)|0,ut(H|0),W|0)}else{if(y)return m|0&&(A[m>>2]=(R>>>0)%(_>>>0),A[m+4>>2]=0),H=0,W=(R>>>0)/(_>>>0)>>>0,ut(H|0),W|0;if(!M)return m|0&&(A[m>>2]=0,A[m+4>>2]=(R>>>0)%(b>>>0)),H=0,W=(R>>>0)/(b>>>0)>>>0,ut(H|0),W|0;if(y=b-1|0,!(y&b))return m|0&&(A[m>>2]=u|0,A[m+4>>2]=y&R|l&0),H=0,W=R>>>((g_(b|0)|0)>>>0),ut(H|0),W|0;if(y=(Us(b|0)|0)-(Us(R|0)|0)|0,y>>>0<=30){l=y+1|0,b=31-y|0,_=l,u=R<<b|M>>>(l>>>0),l=R>>>(l>>>0),y=0,b=M<<b;break}return m?(A[m>>2]=u|0,A[m+4>>2]=w|l&0,H=0,W=0,ut(H|0),W|0):(H=0,W=0,ut(H|0),W|0)}while(!1);if(!_)R=b,w=0,b=0;else{G=h|0|0,M=$|d&0,R=We(G|0,M|0,-1,-1)|0,h=V()|0,w=b,b=0;do d=w,w=y>>>31|w<<1,y=b|y<<1,d=u<<1|d>>>31|0,$=u>>>31|l<<1|0,Xn(R|0,h|0,d|0,$|0)|0,W=V()|0,H=W>>31|((W|0)<0?-1:0)<<1,b=H&1,u=Xn(d|0,$|0,H&G|0,(((W|0)<0?-1:0)>>31|((W|0)<0?-1:0)<<1)&M|0)|0,l=V()|0,_=_-1|0;while((_|0)!=0);R=w,w=0}return _=0,m|0&&(A[m>>2]=u,A[m+4>>2]=l),H=(y|0)>>>31|(R|_)<<1|(_<<1|y>>>31)&0|w,W=(y<<1|0)&-2|b,ut(H|0),W|0}function bo(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,b=0,w=0,R=0;return R=l>>31|((l|0)<0?-1:0)<<1,w=((l|0)<0?-1:0)>>31|((l|0)<0?-1:0)<<1,y=d>>31|((d|0)<0?-1:0)<<1,m=((d|0)<0?-1:0)>>31|((d|0)<0?-1:0)<<1,b=Xn(R^u|0,w^l|0,R|0,w|0)|0,_=V()|0,u=y^R,l=m^w,Xn((Ld(b,_,Xn(y^h|0,m^d|0,y|0,m|0)|0,V()|0,0)|0)^u|0,(V()|0)^l|0,u|0,l|0)|0}function LR(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0;return y=u&65535,m=l&65535,h=es(m,y)|0,d=u>>>16,u=(h>>>16)+(es(m,d)|0)|0,m=l>>>16,l=es(m,y)|0,ut((u>>>16)+(es(m,d)|0)+(((u&65535)+l|0)>>>16)|0),u+l<<16|h&65535|0|0}function Yn(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0;return m=u,y=h,h=LR(m,y)|0,u=V()|0,ut((es(l,y)|0)+(es(d,m)|0)+u|u&0|0),h|0|0|0}function ll(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,b=0,w=0,R=0;return m=F,F=F+16|0,b=m|0,_=l>>31|((l|0)<0?-1:0)<<1,y=((l|0)<0?-1:0)>>31|((l|0)<0?-1:0)<<1,R=d>>31|((d|0)<0?-1:0)<<1,w=((d|0)<0?-1:0)>>31|((d|0)<0?-1:0)<<1,u=Xn(_^u|0,y^l|0,_|0,y|0)|0,l=V()|0,Ld(u,l,Xn(R^h|0,w^d|0,R|0,w|0)|0,V()|0,b)|0,d=Xn(A[b>>2]^_|0,A[b+4>>2]^y|0,_|0,y|0)|0,h=V()|0,F=m,ut(h|0),d|0}function ul(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0;return y=F,F=F+16|0,m=y|0,Ld(u,l,h,d,m)|0,F=y,ut(A[m+4>>2]|0),A[m>>2]|0|0}function y_(u,l,h){return u=u|0,l=l|0,h=h|0,(h|0)<32?(ut(l>>h|0),u>>>h|(l&(1<<h)-1)<<32-h):(ut(((l|0)<0?-1:0)|0),l>>h-32|0)}function _e(u,l,h){return u=u|0,l=l|0,h=h|0,(h|0)<32?(ut(l>>>h|0),u>>>h|(l&(1<<h)-1)<<32-h):(ut(0),l>>>h-32|0)}function Re(u,l,h){return u=u|0,l=l|0,h=h|0,(h|0)<32?(ut(l<<h|(u&(1<<h)-1<<32-h)>>>32-h|0),u<<h):(ut(u<<h-32|0),0)}function Od(u,l,h){return u=u|0,l=l|0,l=Us(l)|0,(l|0)==32&&(l=l+(Us(u)|0)|0),ut(0),l|0}function __(u,l){return u=+u,l=+l,u!=u?+l:l!=l?+u:+G7(+u,+l)}function xc(u,l){return u=+u,l=+l,u!=u?+l:l!=l?+u:+ud(+u,+l)}function Tc(u){return u=+u,u>=0?+Wn(u+.5):+rl(u-.5)}function Al(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0;if((h|0)>=8192)return z7(u|0,l|0,h|0)|0,u|0;if(y=u|0,m=u+h|0,(u&3)==(l&3)){for(;u&3;){if(!h)return y|0;Te[u>>0]=Te[l>>0]|0,u=u+1|0,l=l+1|0,h=h-1|0}for(h=m&-4|0,d=h-64|0;(u|0)<=(d|0);)A[u>>2]=A[l>>2],A[u+4>>2]=A[l+4>>2],A[u+8>>2]=A[l+8>>2],A[u+12>>2]=A[l+12>>2],A[u+16>>2]=A[l+16>>2],A[u+20>>2]=A[l+20>>2],A[u+24>>2]=A[l+24>>2],A[u+28>>2]=A[l+28>>2],A[u+32>>2]=A[l+32>>2],A[u+36>>2]=A[l+36>>2],A[u+40>>2]=A[l+40>>2],A[u+44>>2]=A[l+44>>2],A[u+48>>2]=A[l+48>>2],A[u+52>>2]=A[l+52>>2],A[u+56>>2]=A[l+56>>2],A[u+60>>2]=A[l+60>>2],u=u+64|0,l=l+64|0;for(;(u|0)<(h|0);)A[u>>2]=A[l>>2],u=u+4|0,l=l+4|0}else for(h=m-4|0;(u|0)<(h|0);)Te[u>>0]=Te[l>>0]|0,Te[u+1>>0]=Te[l+1>>0]|0,Te[u+2>>0]=Te[l+2>>0]|0,Te[u+3>>0]=Te[l+3>>0]|0,u=u+4|0,l=l+4|0;for(;(u|0)<(m|0);)Te[u>>0]=Te[l>>0]|0,u=u+1|0,l=l+1|0;return y|0}function xo(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0;if(y=u+h|0,l=l&255,(h|0)>=67){for(;u&3;)Te[u>>0]=l,u=u+1|0;for(d=y&-4|0,_=l|l<<8|l<<16|l<<24,m=d-64|0;(u|0)<=(m|0);)A[u>>2]=_,A[u+4>>2]=_,A[u+8>>2]=_,A[u+12>>2]=_,A[u+16>>2]=_,A[u+20>>2]=_,A[u+24>>2]=_,A[u+28>>2]=_,A[u+32>>2]=_,A[u+36>>2]=_,A[u+40>>2]=_,A[u+44>>2]=_,A[u+48>>2]=_,A[u+52>>2]=_,A[u+56>>2]=_,A[u+60>>2]=_,u=u+64|0;for(;(u|0)<(d|0);)A[u>>2]=_,u=u+4|0}for(;(u|0)<(y|0);)Te[u>>0]=l,u=u+1|0;return y-h|0}function v_(u){return u=+u,u>=0?+Wn(u+.5):+rl(u-.5)}function To(u){u=u|0;var l=0,h=0,d=0;return d=V7()|0,h=A[Gt>>2]|0,l=h+u|0,(u|0)>0&(l|0)<(h|0)|(l|0)<0?($7(l|0)|0,Cy(12),-1):(l|0)>(d|0)&&!(j7(l|0)|0)?(Cy(12),-1):(A[Gt>>2]=l,h|0)}return{___divdi3:bo,___muldi3:Yn,___remdi3:ll,___uremdi3:ul,_areNeighborCells:xE,_bitshift64Ashr:y_,_bitshift64Lshr:_e,_bitshift64Shl:Re,_calloc:Dr,_cellAreaKm2:tR,_cellAreaM2:nR,_cellAreaRads2:Md,_cellToBoundary:ol,_cellToCenterChild:Zy,_cellToChildPos:HE,_cellToChildren:IE,_cellToChildrenSize:xu,_cellToLatLng:fa,_cellToLocalIj:uR,_cellToParent:xd,_cellToVertex:fi,_cellToVertexes:CR,_cellsToDirectedEdge:TE,_cellsToLinkedMultiPolygon:rE,_childPosToCell:WE,_compactCells:kE,_constructCell:OE,_destroyLinkedMultiPolygon:r_,_directedEdgeToBoundary:yc,_directedEdgeToCells:EE,_edgeLengthKm:iR,_edgeLengthM:sR,_edgeLengthRads:rR,_emscripten_replace_memory:H7,_free:Qe,_getBaseCellNumber:Yy,_getDirectedEdgeDestination:SE,_getDirectedEdgeOrigin:wE,_getHexagonAreaAvgKm2:t_,_getHexagonAreaAvgM2:ZE,_getHexagonEdgeLengthAvgKm:JE,_getHexagonEdgeLengthAvgM:eR,_getIcosahedronFaces:Jy,_getIndexDigit:LE,_getNumCells:_c,_getPentagons:Rd,_getRes0Cells:lE,_getResolution:DE,_greatCircleDistanceKm:wu,_greatCircleDistanceM:XE,_greatCircleDistanceRads:QE,_gridDisk:Ny,_gridDiskDistances:My,_gridDistance:cR,_gridPathCells:fR,_gridPathCellsSize:hR,_gridRing:Z7,_gridRingUnsafe:By,_i64Add:We,_i64Subtract:Xn,_isPentagon:Zt,_isResClassIII:GE,_isValidCell:vd,_isValidDirectedEdge:Wy,_isValidIndex:FE,_isValidVertex:h_,_latLngToCell:Sd,_llvm_ctlz_i64:Od,_llvm_maxnum_f64:__,_llvm_minnum_f64:xc,_llvm_round_f64:Tc,_localIjToCell:AR,_malloc:ns,_maxFaceCount:jE,_maxGridDiskSize:K7,_maxPolygonToCellsSize:eE,_maxPolygonToCellsSizeExperimental:mR,_memcpy:Al,_memset:xo,_originToDirectedEdges:RE,_pentagonCount:$E,_polygonToCells:tE,_polygonToCellsExperimental:pR,_readInt64AsDoubleFromPointer:wR,_res0CellCount:aE,_round:v_,_sbrk:To,_sizeOfCellBoundary:_R,_sizeOfCoordIJ:TR,_sizeOfGeoLoop:vR,_sizeOfGeoPolygon:bR,_sizeOfH3Index:gR,_sizeOfLatLng:yR,_sizeOfLinkedGeoPolygon:xR,_uncompactCells:UE,_uncompactCellsSize:qE,_vertexToLatLng:NR,establishStackSpace:Y7,stackAlloc:W7,stackRestore:X7,stackSave:Q7}})(O7,F7,Q);e.___divdi3=Ee.___divdi3,e.___muldi3=Ee.___muldi3,e.___remdi3=Ee.___remdi3,e.___uremdi3=Ee.___uremdi3,e._areNeighborCells=Ee._areNeighborCells,e._bitshift64Ashr=Ee._bitshift64Ashr,e._bitshift64Lshr=Ee._bitshift64Lshr,e._bitshift64Shl=Ee._bitshift64Shl,e._calloc=Ee._calloc,e._cellAreaKm2=Ee._cellAreaKm2,e._cellAreaM2=Ee._cellAreaM2,e._cellAreaRads2=Ee._cellAreaRads2,e._cellToBoundary=Ee._cellToBoundary,e._cellToCenterChild=Ee._cellToCenterChild,e._cellToChildPos=Ee._cellToChildPos,e._cellToChildren=Ee._cellToChildren,e._cellToChildrenSize=Ee._cellToChildrenSize,e._cellToLatLng=Ee._cellToLatLng,e._cellToLocalIj=Ee._cellToLocalIj,e._cellToParent=Ee._cellToParent,e._cellToVertex=Ee._cellToVertex,e._cellToVertexes=Ee._cellToVertexes,e._cellsToDirectedEdge=Ee._cellsToDirectedEdge,e._cellsToLinkedMultiPolygon=Ee._cellsToLinkedMultiPolygon,e._childPosToCell=Ee._childPosToCell,e._compactCells=Ee._compactCells,e._constructCell=Ee._constructCell,e._destroyLinkedMultiPolygon=Ee._destroyLinkedMultiPolygon,e._directedEdgeToBoundary=Ee._directedEdgeToBoundary,e._directedEdgeToCells=Ee._directedEdgeToCells,e._edgeLengthKm=Ee._edgeLengthKm,e._edgeLengthM=Ee._edgeLengthM,e._edgeLengthRads=Ee._edgeLengthRads;var I7=e._emscripten_replace_memory=Ee._emscripten_replace_memory;e._free=Ee._free,e._getBaseCellNumber=Ee._getBaseCellNumber,e._getDirectedEdgeDestination=Ee._getDirectedEdgeDestination,e._getDirectedEdgeOrigin=Ee._getDirectedEdgeOrigin,e._getHexagonAreaAvgKm2=Ee._getHexagonAreaAvgKm2,e._getHexagonAreaAvgM2=Ee._getHexagonAreaAvgM2,e._getHexagonEdgeLengthAvgKm=Ee._getHexagonEdgeLengthAvgKm,e._getHexagonEdgeLengthAvgM=Ee._getHexagonEdgeLengthAvgM,e._getIcosahedronFaces=Ee._getIcosahedronFaces,e._getIndexDigit=Ee._getIndexDigit,e._getNumCells=Ee._getNumCells,e._getPentagons=Ee._getPentagons,e._getRes0Cells=Ee._getRes0Cells,e._getResolution=Ee._getResolution,e._greatCircleDistanceKm=Ee._greatCircleDistanceKm,e._greatCircleDistanceM=Ee._greatCircleDistanceM,e._greatCircleDistanceRads=Ee._greatCircleDistanceRads,e._gridDisk=Ee._gridDisk,e._gridDiskDistances=Ee._gridDiskDistances,e._gridDistance=Ee._gridDistance,e._gridPathCells=Ee._gridPathCells,e._gridPathCellsSize=Ee._gridPathCellsSize,e._gridRing=Ee._gridRing,e._gridRingUnsafe=Ee._gridRingUnsafe,e._i64Add=Ee._i64Add,e._i64Subtract=Ee._i64Subtract,e._isPentagon=Ee._isPentagon,e._isResClassIII=Ee._isResClassIII,e._isValidCell=Ee._isValidCell,e._isValidDirectedEdge=Ee._isValidDirectedEdge,e._isValidIndex=Ee._isValidIndex,e._isValidVertex=Ee._isValidVertex,e._latLngToCell=Ee._latLngToCell,e._llvm_ctlz_i64=Ee._llvm_ctlz_i64,e._llvm_maxnum_f64=Ee._llvm_maxnum_f64,e._llvm_minnum_f64=Ee._llvm_minnum_f64,e._llvm_round_f64=Ee._llvm_round_f64,e._localIjToCell=Ee._localIjToCell,e._malloc=Ee._malloc,e._maxFaceCount=Ee._maxFaceCount,e._maxGridDiskSize=Ee._maxGridDiskSize,e._maxPolygonToCellsSize=Ee._maxPolygonToCellsSize,e._maxPolygonToCellsSizeExperimental=Ee._maxPolygonToCellsSizeExperimental,e._memcpy=Ee._memcpy,e._memset=Ee._memset,e._originToDirectedEdges=Ee._originToDirectedEdges,e._pentagonCount=Ee._pentagonCount,e._polygonToCells=Ee._polygonToCells,e._polygonToCellsExperimental=Ee._polygonToCellsExperimental,e._readInt64AsDoubleFromPointer=Ee._readInt64AsDoubleFromPointer,e._res0CellCount=Ee._res0CellCount,e._round=Ee._round,e._sbrk=Ee._sbrk,e._sizeOfCellBoundary=Ee._sizeOfCellBoundary,e._sizeOfCoordIJ=Ee._sizeOfCoordIJ,e._sizeOfGeoLoop=Ee._sizeOfGeoLoop,e._sizeOfGeoPolygon=Ee._sizeOfGeoPolygon,e._sizeOfH3Index=Ee._sizeOfH3Index,e._sizeOfLatLng=Ee._sizeOfLatLng,e._sizeOfLinkedGeoPolygon=Ee._sizeOfLinkedGeoPolygon,e._uncompactCells=Ee._uncompactCells,e._uncompactCellsSize=Ee._uncompactCellsSize,e._vertexToLatLng=Ee._vertexToLatLng,e.establishStackSpace=Ee.establishStackSpace;var wy=e.stackAlloc=Ee.stackAlloc,k7=e.stackRestore=Ee.stackRestore,U7=e.stackSave=Ee.stackSave;if(e.asm=Ee,e.cwrap=B,e.setValue=x,e.getValue=T,ks){xy(ks)||(ks=s(ks));{w7();var od=function(fe){fe.byteLength&&(fe=new Uint8Array(fe)),te.set(fe,v),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,S7()},Sy=function(){o(ks,od,function(){throw"could not load memory initializer "+ks})},Ey=sd(ks);if(Ey)od(Ey.buffer);else if(e.memoryInitializerRequest){var Ry=function(){var fe=e.memoryInitializerRequest,ve=fe.response;if(fe.status!==200&&fe.status!==0){var Fe=sd(e.memoryInitializerRequestURL);if(Fe)ve=Fe.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+fe.status+", retrying "+ks),Sy();return}}od(ve)};e.memoryInitializerRequest.response?setTimeout(Ry,0):e.memoryInitializerRequest.addEventListener("load",Ry)}else Sy()}}var fc;Di=function fe(){fc||ad(),fc||(Di=fe)};function ad(fe){if(ui>0||(Wt(),ui>0))return;function ve(){fc||(fc=!0,!S&&(Pn(),Gn(),e.onRuntimeInitialized&&e.onRuntimeInitialized(),bn()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),ve()},1)):ve()}e.run=ad;function nl(fe){throw e.onAbort&&e.onAbort(fe),fe+="",a(fe),c(fe),S=!0,"abort("+fe+"). Build with -s ASSERTIONS=1 for more info."}if(e.abort=nl,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return ad(),n})(typeof Ct=="object"?Ct:{}),Je="number",Ze=Je,yl=Je,it=Je,st=Je,Kn=Je,Ue=Je,WL=[["sizeOfH3Index",Je],["sizeOfLatLng",Je],["sizeOfCellBoundary",Je],["sizeOfGeoLoop",Je],["sizeOfGeoPolygon",Je],["sizeOfLinkedGeoPolygon",Je],["sizeOfCoordIJ",Je],["readInt64AsDoubleFromPointer",Je],["isValidCell",yl,[it,st]],["isValidIndex",yl,[it,st]],["latLngToCell",Ze,[Je,Je,Kn,Ue]],["cellToLatLng",Ze,[it,st,Ue]],["cellToBoundary",Ze,[it,st,Ue]],["maxGridDiskSize",Ze,[Je,Ue]],["gridDisk",Ze,[it,st,Je,Ue]],["gridDiskDistances",Ze,[it,st,Je,Ue,Ue]],["gridRing",Ze,[it,st,Je,Ue]],["gridRingUnsafe",Ze,[it,st,Je,Ue]],["maxPolygonToCellsSize",Ze,[Ue,Kn,Je,Ue]],["polygonToCells",Ze,[Ue,Kn,Je,Ue]],["maxPolygonToCellsSizeExperimental",Ze,[Ue,Kn,Je,Ue]],["polygonToCellsExperimental",Ze,[Ue,Kn,Je,Je,Je,Ue]],["cellsToLinkedMultiPolygon",Ze,[Ue,Je,Ue]],["destroyLinkedMultiPolygon",null,[Ue]],["compactCells",Ze,[Ue,Ue,Je,Je]],["uncompactCells",Ze,[Ue,Je,Je,Ue,Je,Kn]],["uncompactCellsSize",Ze,[Ue,Je,Je,Kn,Ue]],["isPentagon",yl,[it,st]],["isResClassIII",yl,[it,st]],["getBaseCellNumber",Je,[it,st]],["getResolution",Je,[it,st]],["getIndexDigit",Je,[it,st,Je]],["constructCell",Ze,[Je,Je,Ue,Ue]],["maxFaceCount",Ze,[it,st,Ue]],["getIcosahedronFaces",Ze,[it,st,Ue]],["cellToParent",Ze,[it,st,Kn,Ue]],["cellToChildren",Ze,[it,st,Kn,Ue]],["cellToCenterChild",Ze,[it,st,Kn,Ue]],["cellToChildrenSize",Ze,[it,st,Kn,Ue]],["cellToChildPos",Ze,[it,st,Kn,Ue]],["childPosToCell",Ze,[Je,Je,it,st,Kn,Ue]],["areNeighborCells",Ze,[it,st,it,st,Ue]],["cellsToDirectedEdge",Ze,[it,st,it,st,Ue]],["getDirectedEdgeOrigin",Ze,[it,st,Ue]],["getDirectedEdgeDestination",Ze,[it,st,Ue]],["isValidDirectedEdge",yl,[it,st]],["directedEdgeToCells",Ze,[it,st,Ue]],["originToDirectedEdges",Ze,[it,st,Ue]],["directedEdgeToBoundary",Ze,[it,st,Ue]],["gridDistance",Ze,[it,st,it,st,Ue]],["gridPathCells",Ze,[it,st,it,st,Ue]],["gridPathCellsSize",Ze,[it,st,it,st,Ue]],["cellToLocalIj",Ze,[it,st,it,st,Je,Ue]],["localIjToCell",Ze,[it,st,Ue,Je,Ue]],["getHexagonAreaAvgM2",Ze,[Kn,Ue]],["getHexagonAreaAvgKm2",Ze,[Kn,Ue]],["getHexagonEdgeLengthAvgM",Ze,[Kn,Ue]],["getHexagonEdgeLengthAvgKm",Ze,[Kn,Ue]],["greatCircleDistanceM",Je,[Ue,Ue]],["greatCircleDistanceKm",Je,[Ue,Ue]],["greatCircleDistanceRads",Je,[Ue,Ue]],["cellAreaM2",Ze,[it,st,Ue]],["cellAreaKm2",Ze,[it,st,Ue]],["cellAreaRads2",Ze,[it,st,Ue]],["edgeLengthM",Ze,[it,st,Ue]],["edgeLengthKm",Ze,[it,st,Ue]],["edgeLengthRads",Ze,[it,st,Ue]],["getNumCells",Ze,[Kn,Ue]],["getRes0Cells",Ze,[Ue]],["res0CellCount",Je],["getPentagons",Ze,[Je,Ue]],["pentagonCount",Je],["cellToVertex",Ze,[it,st,Je,Ue]],["cellToVertexes",Ze,[it,st,Ue]],["vertexToLatLng",Ze,[it,st,Ue]],["isValidVertex",yl,[it,st]]],QL=0,XL=1,YL=2,KL=3,fT=4,ZL=5,JL=6,eO=7,tO=8,nO=9,rO=10,iO=11,sO=12,oO=13,aO=14,lO=15,uO=16,AO=17,cO=18,hO=19,On={};On[QL]="Success";On[XL]="The operation failed but a more specific error is not available";On[YL]="Argument was outside of acceptable range";On[KL]="Latitude or longitude arguments were outside of acceptable range";On[fT]="Resolution argument was outside of acceptable range";On[ZL]="Cell argument was not valid";On[JL]="Directed edge argument was not valid";On[eO]="Undirected edge argument was not valid";On[tO]="Vertex argument was not valid";On[nO]="Pentagon distortion was encountered";On[rO]="Duplicate input";On[iO]="Cell arguments were not neighbors";On[sO]="Cell arguments had incompatible resolutions";On[oO]="Memory allocation failed";On[aO]="Bounds of provided memory were insufficient";On[lO]="Mode or flags argument was not valid";On[uO]="Index argument was not valid";On[AO]="Base cell number was outside of acceptable range";On[cO]="Child indexing digits invalid";On[hO]="Child indexing digits refer to a deleted subsequence";var fO=1e3,dT=1001,pT=1002,df={};df[fO]="Unknown unit";df[dT]="Array length out of bounds";df[pT]="Got unexpected null value for H3 index";var dO="Unknown error";function mT(n,e,t){var r=t&&"value"in t,i=new Error((n[e]||dO)+" (code: "+e+(r?", value: "+t.value:"")+")");return i.code=e,i}function gT(n,e){var t=arguments.length===2?{value:e}:{};return mT(On,n,t)}function yT(n,e){var t=arguments.length===2?{value:e}:{};return mT(df,n,t)}function IA(n){if(n!==0)throw gT(n)}var Vr={};WL.forEach(function(e){Vr[e[0]]=Ct.cwrap.apply(Ct,e)});var Ul=16,kA=4,au=8,pO=8,Dh=Vr.sizeOfH3Index(),B1=Vr.sizeOfLatLng(),mO=Vr.sizeOfCellBoundary(),gO=Vr.sizeOfGeoPolygon(),pA=Vr.sizeOfGeoLoop();Vr.sizeOfLinkedGeoPolygon();Vr.sizeOfCoordIJ();function yO(n){if(typeof n!="number"||n<0||n>15||Math.floor(n)!==n)throw gT(fT,n);return n}function _O(n){if(!n)throw yT(pT);return n}var vO=Math.pow(2,32)-1;function bO(n){if(n>vO)throw yT(dT,n);return n}var xO=/[^0-9a-fA-F]/;function _T(n){if(Array.isArray(n)&&n.length===2&&Number.isInteger(n[0])&&Number.isInteger(n[1]))return n;if(typeof n!="string"||xO.test(n))return[0,0];var e=parseInt(n.substring(0,n.length-8),Ul),t=parseInt(n.substring(n.length-8),Ul);return[t,e]}function iv(n){if(n>=0)return n.toString(Ul);n=n&2147483647;var e=vT(8,n.toString(Ul)),t=(parseInt(e[0],Ul)+8).toString(Ul);return e=t+e.substring(1),e}function TO(n,e){return iv(e)+vT(8,iv(n))}function vT(n,e){for(var t=n-e.length,r="",i=0;i<t;i++)r+="0";return r=r+e,r}function sv(n,e,t){for(var r=n.length,i=Ct._calloc(r,B1),s=t?1:0,o=t?0:1,a=0;a<r*2;a+=2)Ct.HEAPF64.set([n[a/2][s],n[a/2][o]].map(wT),i/au+a);return Ct.HEAPU32.set([r,i],e/kA),e}function wO(n,e){var t=n.length-1,r=Ct._calloc(gO),i=0,s=i+pA,o=s+kA;sv(n[0],r+i,e);var a;if(t>0){a=Ct._calloc(t,pA);for(var c=0;c<t;c++)sv(n[c+1],a+pA*c,e)}return Ct.setValue(r+s,t,"i32"),Ct.setValue(r+o,a,"i32"),r}function SO(n){var e=0,t=e+pA,r=t+kA,i=kA;Ct._free(Ct.getValue(n+e+i,"i8*"));var s=Ct.getValue(n+t,"i32");if(s>0){for(var o=Ct.getValue(n+r,"i32"),a=0;a<s;a++)Ct._free(Ct.getValue(o+pA*a+i,"i8*"));Ct._free(o)}Ct._free(n)}function bT(n,e){e===void 0&&(e=0);var t=Ct.getValue(n+Dh*e,"i32"),r=Ct.getValue(n+Dh*e+kA,"i32");return r?TO(t,r):null}function EO(n){return Vr.readInt64AsDoubleFromPointer(n)}function RO(n,e){for(var t=[],r=0;r<e;r++){var i=bT(n,r);i!==null&&t.push(i)}return t}function Lh(n){return BO(Ct.getValue(n,"double"))}function CO(n){return[Lh(n),Lh(n+au)]}function NO(n){return[Lh(n+au),Lh(n)]}function MO(n,e,t){for(var r=Ct.getValue(n,"i32"),i=n+au,s=[],o=NO,a=0;a<r*2;a+=2)s.push(o(i+au*a));return s.push(s[0]),s}function PO(n,e,t){var r=Ct._malloc(B1);Ct.HEAPF64.set([n,e].map(wT),r/au);var i=Ct._malloc(Dh);try{return IA(Vr.latLngToCell(r,t,i)),_O(bT(i))}finally{Ct._free(i),Ct._free(r)}}function xT(n){var e=Ct._malloc(B1),t=_T(n),r=t[0],i=t[1];try{return IA(Vr.cellToLatLng(r,i,e)),CO(e)}finally{Ct._free(e)}}function TT(n,e){var t=Ct._malloc(mO),r=_T(n),i=r[0],s=r[1];try{return IA(Vr.cellToBoundary(i,s,t)),MO(t,e,e)}finally{Ct._free(t)}}function ov(n,e,t){if(yO(e),t=!!t,n.length===0||n[0].length===0)return[];var r=typeof n[0][0]=="number"?[n]:n,i=wO(r,t),s=Ct._malloc(pO);try{IA(Vr.maxPolygonToCellsSize(i,e,0,s));var o=bO(EO(s)),a=Ct._calloc(o,Dh);try{return IA(Vr.polygonToCells(i,e,0,a)),RO(a,o)}finally{Ct._free(a)}}finally{Ct._free(s),SO(i)}}function wT(n){return n*Math.PI/180}function BO(n){return n*180/Math.PI}function DO(n){return n=Math.max(0,Math.min(1,n)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+n*(1172.33-n*(10793.56-n*(33300.12-n*(38394.49-n*14825.05)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+n*(557.33+n*(1225.33-n*(3574.96-n*(1073.77+n*707.56)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+n*(3211.1-n*(15327.97-n*(27814-n*(22569.18-n*6838.66)))))))+")"}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const LO=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"],Zd=new WeakMap;class OO{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=LO,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}needsVelocity(e){const t=e.getMRT();return t!==null&&t.has("velocity")}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){const{geometry:r,material:i,object:s}=e;if(t={material:this.getMaterialData(i),geometry:{id:r.id,attributes:this.getAttributesData(r.attributes),indexVersion:r.index?r.index.version:null,drawRange:{start:r.drawRange.start,count:r.drawRange.count}},worldMatrix:s.matrixWorld.clone()},s.center&&(t.center=s.center.clone()),s.morphTargetInfluences&&(t.morphTargetInfluences=s.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){const{width:o,height:a}=e.context;t.bufferWidth=o,t.bufferHeight=a}t.lights=this.getLightsData(e.lightsNode.getLights()),this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const r in e){const i=e[r];t[r]={version:i.version}}return t}containsNode(e){const t=e.material;for(const r in t)if(t[r]&&t[r].isNode)return!0;return!!(e.context.modelViewMatrix||e.context.modelNormalViewMatrix||e.context.getAO||e.context.getShadow)}getMaterialData(e){const t={};for(const r of this.refreshUniforms){const i=e[r];i!=null&&(typeof i=="object"&&i.clone!==void 0?i.isTexture===!0?t[r]={id:i.id,version:i.version}:t[r]=i.clone():t[r]=i)}return t}equals(e,t){const{object:r,material:i,geometry:s}=e,o=this.getRenderObjectData(e);if(o.worldMatrix.equals(r.matrixWorld)!==!0)return o.worldMatrix.copy(r.matrixWorld),!1;const a=o.material;for(const E in a){const N=a[E],P=i[E];if(N.equals!==void 0){if(N.equals(P)===!1)return N.copy(P),!1}else if(P.isTexture===!0){if(N.id!==P.id||N.version!==P.version)return N.id=P.id,N.version=P.version,!1}else if(N!==P)return a[E]=P,!1}if(a.transmission>0){const{width:E,height:N}=e.context;if(o.bufferWidth!==E||o.bufferHeight!==N)return o.bufferWidth=E,o.bufferHeight=N,!1}const c=o.geometry,f=s.attributes,p=c.attributes,g=Object.keys(p),v=Object.keys(f);if(c.id!==s.id)return c.id=s.id,!1;if(g.length!==v.length)return o.geometry.attributes=this.getAttributesData(f),!1;for(const E of g){const N=p[E],P=f[E];if(P===void 0)return delete p[E],!1;if(N.version!==P.version)return N.version=P.version,!1}const x=s.index,T=c.indexVersion,S=x?x.version:null;if(T!==S)return c.indexVersion=S,!1;if(c.drawRange.start!==s.drawRange.start||c.drawRange.count!==s.drawRange.count)return c.drawRange.start=s.drawRange.start,c.drawRange.count=s.drawRange.count,!1;if(o.morphTargetInfluences){let E=!1;for(let N=0;N<o.morphTargetInfluences.length;N++)o.morphTargetInfluences[N]!==r.morphTargetInfluences[N]&&(o.morphTargetInfluences[N]=r.morphTargetInfluences[N],E=!0);if(E)return!1}if(o.lights){for(let E=0;E<t.length;E++)if(o.lights[E].map!==t[E].map)return!1}return o.center&&o.center.equals(r.center)===!1?(o.center.copy(r.center),!0):(e.bundle!==null&&(o.version=e.bundle.version),!0)}getLightsData(e){const t=[];for(const r of e)r.isSpotLight===!0&&r.map!==null&&t.push({map:r.map.version});return t}getLights(e,t){if(Zd.has(e)){const i=Zd.get(e);if(i.renderId===t)return i.lightsData}const r=this.getLightsData(e.getLights());return Zd.set(e,{renderId:t,lightsData:r}),r}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e)||this.needsVelocity(t.renderer))return!0;const{renderId:r}=t;if(this.renderId!==r)return this.renderId=r,!0;const i=e.object.static===!0,s=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;if(i||s)return!1;const o=this.getLights(e.lightsNode,r);return this.equals(e,o)!==!0}}function D1(n,e=0){let t=3735928559^e,r=1103547991^e;if(n instanceof Array)for(let i=0,s;i<n.length;i++)s=n[i],t=Math.imul(t^s,2654435761),r=Math.imul(r^s,1597334677);else for(let i=0,s;i<n.length;i++)s=n.charCodeAt(i),t=Math.imul(t^s,2654435761),r=Math.imul(r^s,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(r^r>>>13,3266489909),r=Math.imul(r^r>>>16,2246822507),r^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&r)+(t>>>0)}const ec=n=>D1(n),pu=n=>D1(n),mA=(...n)=>D1(n),FO=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),av=new WeakMap;function ST(n){return FO.get(n)}function Oh(n){if(/[iu]?vec\d/.test(n))return n.startsWith("ivec")?Int32Array:n.startsWith("uvec")?Uint32Array:Float32Array;if(/mat\d/.test(n)||/float/.test(n))return Float32Array;if(/uint/.test(n))return Uint32Array;if(/int/.test(n))return Int32Array;throw new Error(`THREE.NodeUtils: Unsupported type: ${n}`)}function ET(n){if(/float|int|uint/.test(n))return 1;if(/vec2/.test(n))return 2;if(/vec3/.test(n))return 3;if(/vec4/.test(n)||/mat2/.test(n))return 4;if(/mat3/.test(n))return 9;if(/mat4/.test(n))return 16;Be("TSL: Unsupported type:",n)}function IO(n){if(/float|int|uint/.test(n))return 1;if(/vec2/.test(n))return 2;if(/vec3/.test(n))return 3;if(/vec4/.test(n)||/mat2/.test(n))return 4;if(/mat3/.test(n))return 12;if(/mat4/.test(n))return 16;Be("TSL: Unsupported type:",n)}function kO(n){if(/float|int|uint/.test(n))return 4;if(/vec2/.test(n))return 8;if(/vec3/.test(n)||/vec4/.test(n))return 16;if(/mat2/.test(n))return 8;if(/mat3/.test(n)||/mat4/.test(n))return 16;Be("TSL: Unsupported type:",n)}function Go(n){if(n==null)return null;const e=typeof n;return n.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":n.isVector2===!0?"vec2":n.isVector3===!0?"vec3":n.isVector4===!0?"vec4":n.isMatrix2===!0?"mat2":n.isMatrix3===!0?"mat3":n.isMatrix4===!0?"mat4":n.isColor===!0?"color":n instanceof ArrayBuffer?"ArrayBuffer":null}function L1(n,...e){const t=n?n.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),n==="color"?new jn(...e):t==="vec2"?new _t(...e):t==="vec3"?new ge(...e):t==="vec4"?new $t(...e):t==="mat2"?new Yx(...e):t==="mat3"?new YA(...e):t==="mat4"?new dn(...e):n==="bool"?e[0]||!1:n==="float"||n==="int"||n==="uint"?e[0]||0:n==="string"?e[0]||"":n==="ArrayBuffer"?NT(e[0]):null}function RT(n){let e=av.get(n);return e===void 0&&(e={},av.set(n,e)),e}function CT(n){let e="";const t=new Uint8Array(n);for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function NT(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0)).buffer}const sA={VERTEX:"vertex",FRAGMENT:"fragment"},ot={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},UO={BOOLEAN:"bool",INTEGER:"int",FLOAT:"float",VECTOR2:"vec2",VECTOR3:"vec3",VECTOR4:"vec4",MATRIX2:"mat2",MATRIX3:"mat3",MATRIX4:"mat4"},ar={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},MT=["fragment","vertex"],sg=["setup","analyze","generate"],og=[...MT,"compute"],Ya=["x","y","z","w"],qO={analyze:"setup",generate:"analyze"};let GO=0;class Ie extends sf{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=ot.NONE,this.updateBeforeType=ot.NONE,this.updateAfterType=ot.NONE,this.uuid=Jl.generateUUID(),this.version=0,this.name="",this.global=!1,this.parents=!1,this.isNode=!0,this._beforeNodes=null,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:GO++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this),this}onFrameUpdate(e){return this.onUpdate(e,ot.FRAME)}onRenderUpdate(e){return this.onUpdate(e,ot.RENDER)}onObjectUpdate(e){return this.onUpdate(e,ot.OBJECT)}onReference(e){return this.updateReference=e.bind(this),this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of this._getChildren())yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}_getChildren(e=new Set){const t=[];e.add(this);for(const r of Object.getOwnPropertyNames(this)){const i=this[r];if(!(r.startsWith("_")===!0||e.has(i))){if(Array.isArray(i)===!0)for(let s=0;s<i.length;s++){const o=i[s];o&&o.isNode===!0&&t.push({property:r,index:s,childNode:o})}else if(i&&i.isNode===!0)t.push({property:r,childNode:i});else if(i&&Object.getPrototypeOf(i)===Object.prototype)for(const s in i){if(s.startsWith("_")===!0)continue;const o=i[s];o&&o.isNode===!0&&t.push({property:r,index:s,childNode:o})}}}return t}getCacheKey(e=!1,t=null){if(e=e||this.version!==this._cacheKeyVersion,e===!0||this._cacheKey===null){t===null&&(t=new Set);const r=[];for(const{property:i,childNode:s}of this._getChildren(t))r.push(ec(i.slice(0,-4)),s.getCacheKey(e,t));this._cacheKey=mA(pu(r),this.customCacheKey()),this._cacheKeyVersion=this.version}return this._cacheKey}customCacheKey(){return this.id}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}getArrayCount(){return null}setup(e){const t=e.getNodeProperties(this);let r=0;for(const i of this.getChildren())t["node"+r++]=i;return t.outputNode||null}analyze(e,t=null){const r=e.increaseUsage(this);if(this.parents===!0){const i=e.getDataFromNode(this,"any");i.stages=i.stages||{},i.stages[e.shaderStage]=i.stages[e.shaderStage]||[],i.stages[e.shaderStage].push(t)}if(r===1){const i=e.getNodeProperties(this);for(const s of Object.values(i))s&&s.isNode===!0&&s.build(e,this)}}generate(e,t){const{outputNode:r}=e.getNodeProperties(this);if(r&&r.isNode===!0)return r.build(e,t)}updateBefore(){De("Abstract function.")}updateAfter(){De("Abstract function.")}update(){De("Abstract function.")}before(e){return this._beforeNodes===null&&(this._beforeNodes=[]),this._beforeNodes.push(e),this}build(e,t=null){const r=this.getShared(e);if(this!==r)return r.build(e,t);if(this._beforeNodes!==null){const c=this._beforeNodes;this._beforeNodes=null;for(const f of c)f.build(e,t);this._beforeNodes=c}const i=e.getDataFromNode(this);i.buildStages=i.buildStages||{},i.buildStages[e.buildStage]=!0;const s=qO[e.buildStage];if(s&&i.buildStages[s]!==!0){const c=e.getBuildStage();e.setBuildStage(s),this.build(e),e.setBuildStage(c)}e.addNode(this),e.addChain(this);let o=null;const a=e.getBuildStage();if(a==="setup"){this.updateReference(e);const c=e.getNodeProperties(this);if(c.initialized!==!0){c.initialized=!0,c.outputNode=this.setup(e)||c.outputNode||null;for(const f of Object.values(c))if(f&&f.isNode===!0){if(f.parents===!0){const p=e.getNodeProperties(f);p.parents=p.parents||[],p.parents.push(this)}f.build(e)}}o=c.outputNode}else if(a==="analyze")this.analyze(e,t);else if(a==="generate"){if(this.generate.length<2){const f=this.getNodeType(e),p=e.getDataFromNode(this);o=p.snippet,o===void 0?p.generated===void 0?(p.generated=!0,o=this.generate(e)||"",p.snippet=o):(De("Node: Recursion detected.",this),o="/* Recursion detected. */"):p.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),o=e.format(o,f,t)}else o=this.generate(e,t)||"";o===""&&t!==null&&t!=="void"&&t!=="OutputType"&&(Be(`TSL: Invalid generated code, expected a "${t}".`),o=e.generateConst(t))}return e.removeChain(this),e.addSequentialNode(this),o}getSerializeChildren(){return this._getChildren()}serialize(e){const t=this.getSerializeChildren(),r={};for(const{property:i,index:s,childNode:o}of t)s!==void 0?(r[i]===void 0&&(r[i]=Number.isInteger(s)?[]:{}),r[i][s]=o.toJSON(e.meta).uuid):r[i]=o.toJSON(e.meta).uuid;Object.keys(r).length>0&&(e.inputNodes=r)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const r in e.inputNodes)if(Array.isArray(e.inputNodes[r])){const i=[];for(const s of e.inputNodes[r])i.push(t[s]);this[r]=i}else if(typeof e.inputNodes[r]=="object"){const i={};for(const s in e.inputNodes[r]){const o=e.inputNodes[r][s];i[s]=t[o]}this[r]=i}else{const i=e.inputNodes[r];this[r]=t[i]}}}toJSON(e){const{uuid:t,type:r}=this,i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{},nodes:{}});let s=e.nodes[t];s===void 0&&(s={uuid:t,type:r,meta:e,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},i!==!0&&(e.nodes[s.uuid]=s),this.serialize(s),delete s.meta);function o(a){const c=[];for(const f in a){const p=a[f];delete p.metadata,c.push(p)}return c}if(i){const a=o(e.textures),c=o(e.images),f=o(e.nodes);a.length>0&&(s.textures=a),c.length>0&&(s.images=c),f.length>0&&(s.nodes=f)}return s}}class Ka extends Ie{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}getMemberType(e,t){return this.node.getMemberType(e,t)}generate(e){const t=this.indexNode.getNodeType(e),r=this.node.build(e),i=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return`${r}[ ${i} ]`}}class PT extends Ie{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let r=null;for(const i of this.convertTo.split("|"))(r===null||e.getTypeLength(t)===e.getTypeLength(i))&&(r=i);return r}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const r=this.node,i=this.getNodeType(e),s=r.build(e,i);return e.format(s,i,t)}}class vn extends Ie{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const i=e.getVectorType(this.getNodeType(e,t)),s=e.getDataFromNode(this);if(s.propertyName!==void 0)return e.format(s.propertyName,i,t);if(i!=="void"&&t!=="void"&&this.hasDependencies(e)){const o=super.build(e,i),a=e.getVarFromNode(this,null,i),c=e.getPropertyName(a);return e.addLineFlowCode(`${c} = ${o}`,this),s.snippet=o,s.propertyName=c,e.format(s.propertyName,i,t)}}return super.build(e,t)}}class VO extends vn{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,r)=>t+e.getTypeLength(r.getNodeType(e)),0))}generate(e,t){const r=this.getNodeType(e),i=e.getTypeLength(r),s=this.nodes,o=e.getComponentType(r),a=[];let c=0;for(const p of s){if(c>=i){Be(`TSL: Length of parameters exceeds maximum length of function '${r}()' type.`);break}let g=p.getNodeType(e),v=e.getTypeLength(g),x;if(c+v>i&&(Be(`TSL: Length of '${r}()' data exceeds maximum length of output type.`),v=i-c,g=e.getTypeFromLength(v)),c+=v,x=p.build(e,g),e.getComponentType(g)!==o){const S=e.getTypeFromLength(v,o);x=e.format(x,g,S)}a.push(x)}const f=`${e.getType(r)}( ${a.join(", ")} )`;return e.format(f,r,t)}}const zO=Ya.join("");class BT extends Ie{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(Ya.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}getScope(){return this.node.getScope()}generate(e,t){const r=this.node,i=e.getTypeLength(r.getNodeType(e));let s=null;if(i>1){let o=null;this.getVectorLength()>=i&&(o=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const c=r.build(e,o);this.components.length===i&&this.components===zO.slice(0,this.components.length)?s=e.format(c,o,t):s=e.format(`${c}.${this.components}`,this.getNodeType(e),t)}else s=r.build(e,t);return s}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class jO extends vn{static get type(){return"SetNode"}constructor(e,t,r){super(),this.sourceNode=e,this.components=t,this.targetNode=r}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:r,targetNode:i}=this,s=this.getNodeType(e),o=e.getComponentType(i.getNodeType(e)),a=e.getTypeFromLength(r.length,o),c=i.build(e,a),f=t.build(e,s),p=e.getTypeLength(s),g=[];for(let v=0;v<p;v++){const x=Ya[v];x===r[0]?(g.push(c),v+=r.length-1):g.push(f+"."+x)}return`${e.getType(s)}( ${g.join(", ")} )`}}class $O extends vn{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:r}=this,i=this.getNodeType(e),s=r.build(e),o=e.getVarFromNode(this),a=e.getPropertyName(o);e.addLineFlowCode(a+" = "+s,this);const c=e.getTypeLength(i),f=[];let p=0;for(let g=0;g<c;g++){const v=Ya[g];v===t[p]?(f.push("1.0 - "+(a+"."+v)),p++):f.push(a+"."+v)}return`${e.getType(i)}( ${f.join(", ")} )`}}class O1 extends Ie{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?Go(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=Go(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=CT(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?L1(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){De("Abstract function.")}}const lv=/float|u?int/;class Pi extends O1{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const r=this.getNodeType(e);return lv.test(r)&&lv.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),r,t)}}class HO extends Ie{static get type(){return"MemberNode"}constructor(e,t){super(),this.structNode=e,this.property=t,this.isMemberNode=!0}hasMember(e){return this.structNode.isMemberNode&&this.structNode.hasMember(e)===!1?!1:this.structNode.getMemberType(e,this.property)!=="void"}getNodeType(e){return this.hasMember(e)===!1?"float":this.structNode.getMemberType(e,this.property)}getMemberType(e,t){if(this.hasMember(e)===!1)return"float";const r=this.getNodeType(e);return e.getStructTypeNode(r).getMemberType(e,t)}generate(e){if(this.hasMember(e)===!1){De(`TSL: Member "${this.property}" does not exist in struct.`);const r=this.getNodeType(e);return e.generateConst(r)}return this.structNode.build(e)+"."+this.property}}let Yo=null;const ag=new Map;function de(n,e){if(ag.has(n)){De(`TSL: Redefinition of method chaining '${n}'.`);return}if(typeof e!="function")throw new Error(`THREE.TSL: Node element ${n} is not a function`);ag.set(n,e),n!=="assign"&&(Ie.prototype[n]=function(...t){return this.isStackNode?this.addToStack(e(...t)):e(this,...t)},Ie.prototype[n+"Assign"]=function(...t){return this.isStackNode?this.assign(t[0],e(...t)):this.assign(e(this,...t))})}const WO=n=>n.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),uv=n=>WO(n).split("").sort().join("");Ie.prototype.assign=function(...n){if(this.isStackNode!==!0)return Yo!==null?Yo.assign(this,...n):Be("TSL: No stack defined for assign operation. Make sure the assign is inside a Fn()."),this;{const e=ag.get("assign");return this.addToStack(e(...n))}};Ie.prototype.toVarIntent=function(){return this};Ie.prototype.get=function(n){return new HO(this,n)};const gA={};function kc(n,e,t){gA[n]=gA[e]=gA[t]={get(){this._cache=this._cache||{};let o=this._cache[n];return o===void 0&&(o=new BT(this,n),this._cache[n]=o),o},set(o){this[n].assign(Pe(o))}};const r=n.toUpperCase(),i=e.toUpperCase(),s=t.toUpperCase();Ie.prototype["set"+r]=Ie.prototype["set"+i]=Ie.prototype["set"+s]=function(o){const a=uv(n);return new jO(this,a,Pe(o))},Ie.prototype["flip"+r]=Ie.prototype["flip"+i]=Ie.prototype["flip"+s]=function(){const o=uv(n);return new $O(this,o)}}const rs=["x","y","z","w"],is=["r","g","b","a"],ss=["s","t","p","q"];for(let n=0;n<4;n++){let e=rs[n],t=is[n],r=ss[n];kc(e,t,r);for(let i=0;i<4;i++){e=rs[n]+rs[i],t=is[n]+is[i],r=ss[n]+ss[i],kc(e,t,r);for(let s=0;s<4;s++){e=rs[n]+rs[i]+rs[s],t=is[n]+is[i]+is[s],r=ss[n]+ss[i]+ss[s],kc(e,t,r);for(let o=0;o<4;o++)e=rs[n]+rs[i]+rs[s]+rs[o],t=is[n]+is[i]+is[s]+is[o],r=ss[n]+ss[i]+ss[s]+ss[o],kc(e,t,r)}}}for(let n=0;n<32;n++)gA[n]={get(){this._cache=this._cache||{};let e=this._cache[n];return e===void 0&&(e=new Ka(this,new Pi(n,"uint")),this._cache[n]=e),e},set(e){this[n].assign(Pe(e))}};Object.defineProperties(Ie.prototype,gA);const Av=new WeakMap,QO=function(n,e=null){const t=Go(n);return t==="node"?n:e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string"?Pe(lg(n,e)):t==="shader"?n.isFn?n:re(n):n},XO=function(n,e=null){for(const t in n)n[t]=Pe(n[t],e);return n},YO=function(n,e=null){const t=n.length;for(let r=0;r<t;r++)n[r]=Pe(n[r],e);return n},DT=function(n,e=null,t=null,r=null){function i(p){return r!==null?(p=Pe(Object.assign(p,r)),r.intent===!0&&(p=p.toVarIntent())):p=Pe(p),p}let s,o=e,a,c;function f(p){let g;return o?g=/[a-z]/i.test(o)?o+"()":o:g=n.type,a!==void 0&&p.length<a?(Be(`TSL: "${g}" parameter length is less than minimum required.`),p.concat(new Array(a-p.length).fill(0))):c!==void 0&&p.length>c?(Be(`TSL: "${g}" parameter length exceeds limit.`),p.slice(0,c)):p}return e===null?s=(...p)=>i(new n(...Va(f(p)))):t!==null?(t=Pe(t),s=(...p)=>i(new n(e,...Va(f(p)),t))):s=(...p)=>i(new n(e,...Va(f(p)))),s.setParameterLength=(...p)=>(p.length===1?a=c=p[0]:p.length===2&&([a,c]=p),s),s.setName=p=>(o=p,s),s},KO=function(n,...e){return new n(...Va(e))};class ZO extends Ie{constructor(e,t){super(),this.shaderNode=e,this.rawInputs=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getElementType(e){return this.getOutputNode(e).getElementType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,rawInputs:r}=this,i=e.getNodeProperties(t),s=e.getClosestSubBuild(t.subBuilds)||"",o=s||"default";if(i[o])return i[o];const a=e.subBuildFn,c=e.fnCall;e.subBuildFn=s,e.fnCall=this;let f=null;if(t.layout){let p=Av.get(e.constructor);p===void 0&&(p=new WeakMap,Av.set(e.constructor,p));let g=p.get(t);g===void 0&&(g=Pe(e.buildFunctionNode(t)),p.set(t,g)),e.addInclude(g);const v=r?JO(r):null;f=Pe(g.call(v))}else{const p=new Proxy(e,{get:(S,E,N)=>{let P;return Symbol.iterator===E?P=function*(){yield void 0}:P=Reflect.get(S,E,N),P}}),g=r?eF(r):null,v=Array.isArray(r)?r.length>0:r!==null,x=t.jsFunc,T=v||x.length>1?x(g,p):x(p);f=Pe(T)}return e.subBuildFn=a,e.fnCall=c,t.once&&(i[o]=f),f}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){const t=e.getNodeProperties(this),r=e.getSubBuildOutput(this);return t[r]=t[r]||this.setupOutput(e),t[r].subBuild=e.getClosestSubBuild(this),t[r]}build(e,t=null){let r=null;const i=e.getBuildStage(),s=e.getNodeProperties(this),o=e.getSubBuildOutput(this),a=this.getOutputNode(e),c=e.fnCall;if(e.fnCall=this,i==="setup"){const f=e.getSubBuildProperty("initialized",this);if(s[f]!==!0&&(s[f]=!0,s[o]=this.getOutputNode(e),s[o].build(e),this.shaderNode.subBuilds))for(const p of e.chaining){const g=e.getDataFromNode(p,"any");g.subBuilds=g.subBuilds||new Set;for(const v of this.shaderNode.subBuilds)g.subBuilds.add(v)}r=s[o]}else i==="analyze"?a.build(e,t):i==="generate"&&(r=a.build(e,t)||"");return e.fnCall=c,r}}function JO(n){let e;return gf(n),n[0]&&(n[0].isNode||Object.getPrototypeOf(n[0])!==Object.prototype)?e=[...n]:e=n[0],e}function eF(n){let e=0;return gf(n),new Proxy(n,{get:(t,r,i)=>{let s;if(r==="length")return s=n.length,s;if(Symbol.iterator===r)s=function*(){for(const o of n)yield Pe(o)};else{if(n.length>0)if(Object.getPrototypeOf(n[0])===Object.prototype){const o=n[0];o[r]===void 0?s=o[e++]:s=Reflect.get(o,r,i)}else n[0]instanceof Ie&&(n[r]===void 0?s=n[e++]:s=Reflect.get(n,r,i));else s=Reflect.get(t,r,i);s=Pe(s)}return s}})}class tF extends Ie{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}getLayout(){return this.layout}call(e=null){return new ZO(this,e)}setup(){return this.call()}}const nF=[!1,!0],rF=[0,1,2,3],iF=[-1,-2],LT=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],F1=new Map;for(const n of nF)F1.set(n,new Pi(n));const I1=new Map;for(const n of rF)I1.set(n,new Pi(n,"uint"));const k1=new Map([...I1].map(n=>new Pi(n.value,"int")));for(const n of iF)k1.set(n,new Pi(n,"int"));const pf=new Map([...k1].map(n=>new Pi(n.value)));for(const n of LT)pf.set(n,new Pi(n));for(const n of LT)pf.set(-n,new Pi(-n));const mf={bool:F1,uint:I1,ints:k1,float:pf},cv=new Map([...F1,...pf]),lg=(n,e)=>cv.has(n)?cv.get(n):n.isNode===!0?n:new Pi(n,e),qn=function(n,e=null){return(...t)=>{for(const i of t)if(i===void 0)return Be(`TSL: Invalid parameter for the type "${n}".`),new Pi(0,n);if((t.length===0||!["bool","float","int","uint"].includes(n)&&t.every(i=>{const s=typeof i;return s!=="object"&&s!=="function"}))&&(t=[L1(n,...t)]),t.length===1&&e!==null&&e.has(t[0]))return oA(e.get(t[0]));if(t.length===1){const i=lg(t[0],n);return i.nodeType===n?oA(i):oA(new PT(i,n))}const r=t.map(i=>lg(i));return oA(new VO(r,n))}},UA=n=>typeof n=="object"&&n!==null?n.value:n,OT=n=>n!=null?n.nodeType||n.convertTo||(typeof n=="string"?n:null):null;function ql(n,e){return new tF(n,e)}const Pe=(n,e=null)=>QO(n,e),oA=(n,e=null)=>Pe(n,e).toVarIntent(),gf=(n,e=null)=>new XO(n,e),Va=(n,e=null)=>new YO(n,e),tt=(n,e=null,t=null,r=null)=>new DT(n,e,t,r),Me=(n,...e)=>new KO(n,...e),Se=(n,e=null,t=null,r={})=>new DT(n,e,t,{...r,intent:!0});let sF=0;class oF extends Ie{constructor(e,t=null){super();let r=null;t!==null&&(typeof t=="object"?r=t.return:(typeof t=="string"?r=t:Be("TSL: Invalid layout type."),t=null)),this.shaderNode=new ql(e,r),t!==null&&this.setLayout(t),this.isFn=!0}setLayout(e){const t=this.shaderNode.nodeType;if(typeof e.inputs!="object"){const r={name:"fn"+sF++,type:t,inputs:[]};for(const i in e)i!=="return"&&r.inputs.push({name:i,type:e[i]});e=r}return this.shaderNode.setLayout(e),this}getNodeType(e){return this.shaderNode.getNodeType(e)||"float"}call(...e){const t=this.shaderNode.call(e);return this.shaderNode.nodeType==="void"&&t.toStack(),t.toVarIntent()}once(e=null){return this.shaderNode.once=!0,this.shaderNode.subBuilds=e,this}generate(e){const t=this.getNodeType(e);return Be('TSL: "Fn()" was declared but not invoked. Try calling it like "Fn()( ...params )".'),e.generateConst(t)}}function re(n,e=null){const t=new oF(n,e);return new Proxy(()=>{},{apply(r,i,s){return t.call(...s)},get(r,i,s){return Reflect.get(t,i,s)},set(r,i,s,o){return Reflect.set(t,i,s,o)}})}const qA=n=>{Yo=n},U1=()=>Yo,ze=(...n)=>Yo.If(...n),aF=(...n)=>Yo.Switch(...n);function yf(n){return Yo&&Yo.addToStack(n),n}de("toStack",yf);const FT=new qn("color"),z=new qn("float",mf.float),X=new qn("int",mf.ints),ye=new qn("uint",mf.uint),Ei=new qn("bool",mf.bool),we=new qn("vec2"),In=new qn("ivec2"),q1=new qn("uvec2"),IT=new qn("bvec2"),Z=new qn("vec3"),G1=new qn("ivec3"),Za=new qn("uvec3"),V1=new qn("bvec3"),je=new qn("vec4"),z1=new qn("ivec4"),j1=new qn("uvec4"),kT=new qn("bvec4"),_f=new qn("mat2"),ur=new qn("mat3"),Wo=new qn("mat4"),lF=(n="")=>new Pi(n,"string"),uF=n=>new Pi(n,"ArrayBuffer");de("toColor",FT);de("toFloat",z);de("toInt",X);de("toUint",ye);de("toBool",Ei);de("toVec2",we);de("toIVec2",In);de("toUVec2",q1);de("toBVec2",IT);de("toVec3",Z);de("toIVec3",G1);de("toUVec3",Za);de("toBVec3",V1);de("toVec4",je);de("toIVec4",z1);de("toUVec4",j1);de("toBVec4",kT);de("toMat2",_f);de("toMat3",ur);de("toMat4",Wo);const UT=tt(Ka).setParameterLength(2),qT=(n,e)=>Pe(new PT(Pe(n),e)),AF=(n,e)=>Pe(new BT(Pe(n),e));de("element",UT);de("convert",qT);const cF=n=>(De("TSL: append() has been renamed to Stack()."),yf(n));de("append",n=>(De("TSL: .append() has been renamed to .toStack()."),yf(n)));class Dt extends Ie{static get type(){return"PropertyNode"}constructor(e,t=null,r=!1){super(e),this.name=t,this.varying=r,this.isPropertyNode=!0,this.global=!0}customCacheKey(){return ec(this.type+":"+(this.name||"")+":"+(this.varying?"1":"0"))}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const Js=(n,e)=>new Dt(n,e),GA=(n,e)=>new Dt(n,e,!0),kt=Me(Dt,"vec4","DiffuseColor"),Ea=Me(Dt,"vec3","DiffuseContribution"),ug=Me(Dt,"vec3","EmissiveColor"),ps=Me(Dt,"float","Roughness"),Xs=Me(Dt,"float","Metalness"),Fh=Me(Dt,"float","Clearcoat"),VA=Me(Dt,"float","ClearcoatRoughness"),Zr=Me(Dt,"vec3","Sheen"),Fo=Me(Dt,"float","SheenRoughness"),vf=Me(Dt,"float","Iridescence"),Ih=Me(Dt,"float","IridescenceIOR"),kh=Me(Dt,"float","IridescenceThickness"),Uh=Me(Dt,"float","AlphaT"),Lo=Me(Dt,"float","Anisotropy"),yA=Me(Dt,"vec3","AnisotropyT"),za=Me(Dt,"vec3","AnisotropyB"),Ko=Me(Dt,"color","SpecularColor"),Fa=Me(Dt,"color","SpecularColorBlended"),$l=Me(Dt,"float","SpecularF90"),qh=Me(Dt,"float","Shininess"),Hl=Me(Dt,"vec4","Output"),O0=Me(Dt,"float","dashSize"),Ag=Me(Dt,"float","gapSize"),hF=Me(Dt,"float","pointWidth"),_A=Me(Dt,"float","IOR"),Gh=Me(Dt,"float","Transmission"),$1=Me(Dt,"float","Thickness"),H1=Me(Dt,"float","AttenuationDistance"),W1=Me(Dt,"color","AttenuationColor"),Q1=Me(Dt,"float","Dispersion");class GT extends Ie{static get type(){return"UniformGroupNode"}constructor(e,t=!1,r=1){super("string"),this.name=e,this.shared=t,this.order=r,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const VT=n=>new GT(n),bf=(n,e=0)=>new GT(n,!0,e),zT=bf("frame"),Ge=bf("render"),X1=VT("object");class tc extends O1{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=X1}setName(e){return this.name=e,this}label(e){return De('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){return e=e.bind(this),super.onUpdate(r=>{const i=e(r,this);i!==void 0&&(this.value=i)},t)}getInputType(e){let t=super.getInputType(e);return t==="bool"&&(t="uint"),t}generate(e,t){const r=this.getNodeType(e),i=this.getUniformHash(e);let s=e.getNodeFromHash(i);s===void 0&&(e.setHashNode(this,i),s=this);const o=s.getInputType(e),a=e.getUniformFromNode(s,o,e.shaderStage,this.name||e.context.nodeName),c=e.getPropertyName(a);e.context.nodeName!==void 0&&delete e.context.nodeName;let f=c;if(r==="bool"){const p=e.getDataFromNode(this);let g=p.propertyName;if(g===void 0){const v=e.getVarFromNode(this,null,"bool");g=e.getPropertyName(v),p.propertyName=g,f=e.format(c,o,r),e.addLineFlowCode(`${g} = ${f}`,this)}f=g}return e.format(f,r,t)}}const Ve=(n,e)=>{const t=OT(e||n);if(t===n&&(n=L1(t)),n&&n.isNode===!0){let r=n.value;n.traverse(i=>{i.isConstNode===!0&&(r=i.value)}),n=r}return new tc(n,t)};class hv extends vn{static get type(){return"ArrayNode"}constructor(e,t,r=null){super(e),this.count=t,this.values=r,this.isArrayNode=!0}getArrayCount(){return this.count}getNodeType(e){return this.nodeType===null?this.values[0].getNodeType(e):this.nodeType}getElementType(e){return this.getNodeType(e)}getMemberType(e,t){return this.nodeType===null?this.values[0].getMemberType(e,t):super.getMemberType(e,t)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const jT=(...n)=>{let e;if(n.length===1){const t=n[0];e=new hv(null,t.length,t)}else{const t=n[0],r=n[1];e=new hv(t,r)}return Pe(e)};de("toArray",(n,e)=>jT(Array(e).fill(n)));class fF extends vn{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const r=e.getTypeLength(t.node.getNodeType(e));return Ya.join("").slice(0,r)!==t.components}return!1}setup(e){const{targetNode:t,sourceNode:r}=this,i=t.getScope(),s=e.getDataFromNode(i);s.assign=!0;const o=e.getNodeProperties(this);o.sourceNode=r,o.targetNode=t.context({assign:!0})}generate(e,t){const{targetNode:r,sourceNode:i}=e.getNodeProperties(this),s=this.needsSplitAssign(e),o=r.build(e),a=r.getNodeType(e),c=i.build(e,a),f=i.getNodeType(e),p=e.getDataFromNode(this);let g;if(p.initialized===!0)t!=="void"&&(g=o);else if(s){const v=e.getVarFromNode(this,null,a),x=e.getPropertyName(v);e.addLineFlowCode(`${x} = ${c}`,this);const T=r.node,E=T.node.context({assign:!0}).build(e);for(let N=0;N<T.components.length;N++){const P=T.components[N];e.addLineFlowCode(`${E}.${P} = ${x}[ ${N} ]`,this)}t!=="void"&&(g=o)}else g=`${o} = ${c}`,(t==="void"||f==="void")&&(e.addLineFlowCode(g,this),t!=="void"&&(g=o));return p.initialized=!0,e.format(g,a,t)}}const $T=tt(fF).setParameterLength(2);de("assign",$T);class dF extends vn{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}getMemberType(e,t){return this.functionNode.getMemberType(e,t)}generate(e){const t=[],r=this.functionNode,i=r.getInputs(e),s=this.parameters,o=(c,f)=>{const p=f.type,g=p==="pointer";let v;return g?v="&"+c.build(e):v=c.build(e,p),v};if(Array.isArray(s)){if(s.length>i.length)Be("TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),s.length=i.length;else if(s.length<i.length)for(Be("TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");s.length<i.length;)s.push(z(0));for(let c=0;c<s.length;c++)t.push(o(s[c],i[c]))}else for(const c of i){const f=s[c.name];f!==void 0?t.push(o(f,c)):(Be(`TSL: Input '${c.name}' not found in 'Fn()'.`),t.push(o(z(0),c)))}return`${r.build(e,"property")}( ${t.join(", ")} )`}}const HT=(n,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?Va(e):gf(e[0]),new dF(Pe(n),e));de("call",HT);const pF={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class yn extends vn{static get type(){return"OperatorNode"}constructor(e,t,r,...i){if(super(),i.length>0){let s=new yn(e,t,r);for(let o=0;o<i.length-1;o++)s=new yn(e,s,i[o]);t=s,r=i[i.length-1]}this.op=e,this.aNode=t,this.bNode=r,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(pF[this.op],t)}getNodeType(e,t=null){const r=this.op,i=this.aNode,s=this.bNode,o=i.getNodeType(e),a=s?s.getNodeType(e):null;if(o==="void"||a==="void")return t||"void";if(r==="%")return o;if(r==="~"||r==="&"||r==="|"||r==="^"||r===">>"||r==="<<")return e.getIntegerType(o);if(r==="!"||r==="&&"||r==="||"||r==="^^")return"bool";if(r==="=="||r==="!="||r==="<"||r===">"||r==="<="||r===">="){const c=Math.max(e.getTypeLength(o),e.getTypeLength(a));return c>1?`bvec${c}`:"bool"}else{if(e.isMatrix(o)){if(a==="float")return o;if(e.isVector(a))return e.getVectorFromMatrix(o);if(e.isMatrix(a))return o}else if(e.isMatrix(a)){if(o==="float")return a;if(e.isVector(o))return e.getVectorFromMatrix(a)}return e.getTypeLength(a)>e.getTypeLength(o)?a:o}}generate(e,t){const r=this.op,{aNode:i,bNode:s}=this,o=this.getNodeType(e,t);let a=null,c=null;o!=="void"?(a=i.getNodeType(e),c=s?s.getNodeType(e):null,r==="<"||r===">"||r==="<="||r===">="||r==="=="||r==="!="?e.isVector(a)?c=a:e.isVector(c)?a=c:a!==c&&(a=c="float"):r===">>"||r==="<<"?(a=o,c=e.changeComponentType(c,"uint")):r==="%"?(a=o,c=e.isInteger(a)&&e.isInteger(c)?c:a):e.isMatrix(a)?c==="float"?c="float":e.isVector(c)?c=e.getVectorFromMatrix(a):e.isMatrix(c)||(a=c=o):e.isMatrix(c)?a==="float"?a="float":e.isVector(a)?a=e.getVectorFromMatrix(c):a=c=o:a=c=o):a=c=o;const f=i.build(e,a),p=s?s.build(e,c):null,g=e.getFunctionOperator(r);if(t!=="void"){const v=e.renderer.coordinateSystem===$0;if(r==="=="||r==="!="||r==="<"||r===">"||r==="<="||r===">=")return v?e.isVector(a)?e.format(`${this.getOperatorMethod(e,t)}( ${f}, ${p} )`,o,t):e.format(`( ${f} ${r} ${p} )`,o,t):e.format(`( ${f} ${r} ${p} )`,o,t);if(r==="%")return e.isInteger(c)?e.format(`( ${f} % ${p} )`,o,t):e.format(`${this.getOperatorMethod(e,o)}( ${f}, ${p} )`,o,t);if(r==="!"||r==="~")return e.format(`(${r}${f})`,a,t);if(g)return e.format(`${g}( ${f}, ${p} )`,o,t);if(e.isMatrix(a)&&c==="float")return e.format(`( ${p} ${r} ${f} )`,o,t);if(a==="float"&&e.isMatrix(c))return e.format(`${f} ${r} ${p}`,o,t);{let x=`( ${f} ${r} ${p} )`;return!v&&o==="bool"&&e.isVector(a)&&e.isVector(c)&&(x=`all${x}`),e.format(x,o,t)}}else if(a!=="void")return g?e.format(`${g}( ${f}, ${p} )`,o,t):e.isMatrix(a)&&c==="float"?e.format(`${p} ${r} ${f}`,o,t):e.format(`${f} ${r} ${p}`,o,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const Ln=Se(yn,"+").setParameterLength(2,1/0).setName("add"),St=Se(yn,"-").setParameterLength(2,1/0).setName("sub"),et=Se(yn,"*").setParameterLength(2,1/0).setName("mul"),ai=Se(yn,"/").setParameterLength(2,1/0).setName("div"),nc=Se(yn,"%").setParameterLength(2).setName("mod"),Y1=Se(yn,"==").setParameterLength(2).setName("equal"),WT=Se(yn,"!=").setParameterLength(2).setName("notEqual"),QT=Se(yn,"<").setParameterLength(2).setName("lessThan"),K1=Se(yn,">").setParameterLength(2).setName("greaterThan"),XT=Se(yn,"<=").setParameterLength(2).setName("lessThanEqual"),YT=Se(yn,">=").setParameterLength(2).setName("greaterThanEqual"),KT=Se(yn,"&&").setParameterLength(2,1/0).setName("and"),ZT=Se(yn,"||").setParameterLength(2,1/0).setName("or"),JT=Se(yn,"!").setParameterLength(1).setName("not"),e8=Se(yn,"^^").setParameterLength(2).setName("xor"),t8=Se(yn,"&").setParameterLength(2).setName("bitAnd"),n8=Se(yn,"~").setParameterLength(1).setName("bitNot"),r8=Se(yn,"|").setParameterLength(2).setName("bitOr"),i8=Se(yn,"^").setParameterLength(2).setName("bitXor"),s8=Se(yn,"<<").setParameterLength(2).setName("shiftLeft"),o8=Se(yn,">>").setParameterLength(2).setName("shiftRight"),a8=re(([n])=>(n.addAssign(1),n)),l8=re(([n])=>(n.subAssign(1),n)),u8=re(([n])=>{const e=X(n).toConst();return n.addAssign(1),e}),A8=re(([n])=>{const e=X(n).toConst();return n.subAssign(1),e});de("add",Ln);de("sub",St);de("mul",et);de("div",ai);de("mod",nc);de("equal",Y1);de("notEqual",WT);de("lessThan",QT);de("greaterThan",K1);de("lessThanEqual",XT);de("greaterThanEqual",YT);de("and",KT);de("or",ZT);de("not",JT);de("xor",e8);de("bitAnd",t8);de("bitNot",n8);de("bitOr",r8);de("bitXor",i8);de("shiftLeft",s8);de("shiftRight",o8);de("incrementBefore",a8);de("decrementBefore",l8);de("increment",u8);de("decrement",A8);const c8=(n,e)=>(De('TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),nc(X(n),X(e)));de("modInt",c8);class ue extends vn{static get type(){return"MathNode"}constructor(e,t,r=null,i=null){if(super(),(e===ue.MAX||e===ue.MIN)&&arguments.length>3){let s=new ue(e,t,r);for(let o=2;o<arguments.length-1;o++)s=new ue(e,s,arguments[o]);t=s,r=arguments[arguments.length-1],i=null}this.method=e,this.aNode=t,this.bNode=r,this.cNode=i,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),r=this.bNode?this.bNode.getNodeType(e):null,i=this.cNode?this.cNode.getNodeType(e):null,s=e.isMatrix(t)?0:e.getTypeLength(t),o=e.isMatrix(r)?0:e.getTypeLength(r),a=e.isMatrix(i)?0:e.getTypeLength(i);return s>o&&s>a?t:o>a?r:a>s?i:t}getNodeType(e){const t=this.method;return t===ue.LENGTH||t===ue.DISTANCE||t===ue.DOT?"float":t===ue.CROSS?"vec3":t===ue.ALL||t===ue.ANY?"bool":t===ue.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}setup(e){const{aNode:t,bNode:r,method:i}=this;let s=null;if(i===ue.ONE_MINUS)s=St(1,t);else if(i===ue.RECIPROCAL)s=ai(1,t);else if(i===ue.DIFFERENCE)s=en(St(t,r));else if(i===ue.TRANSFORM_DIRECTION){let o=t,a=r;e.isMatrix(o.getNodeType(e))?a=je(Z(a),0):o=je(Z(o),0);const c=et(o,a).xyz;s=Mr(c)}return s!==null?s:super.setup(e)}generate(e,t){if(e.getNodeProperties(this).outputNode)return super.generate(e,t);let i=this.method;const s=this.getNodeType(e),o=this.getInputType(e),a=this.aNode,c=this.bNode,f=this.cNode,p=e.renderer.coordinateSystem;if(i===ue.NEGATE)return e.format("( - "+a.build(e,o)+" )",s,t);{const g=[];return i===ue.CROSS?g.push(a.build(e,s),c.build(e,s)):p===$0&&i===ue.STEP?g.push(a.build(e,e.getTypeLength(a.getNodeType(e))===1?"float":o),c.build(e,o)):p===$0&&(i===ue.MIN||i===ue.MAX)?g.push(a.build(e,o),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":o)):i===ue.REFRACT?g.push(a.build(e,o),c.build(e,o),f.build(e,"float")):i===ue.MIX?g.push(a.build(e,o),c.build(e,o),f.build(e,e.getTypeLength(f.getNodeType(e))===1?"float":o)):(p===Qo&&i===ue.ATAN&&c!==null&&(i="atan2"),e.shaderStage!=="fragment"&&(i===ue.DFDX||i===ue.DFDY)&&(De(`TSL: '${i}' is not supported in the ${e.shaderStage} stage.`),i="/*"+i+"*/"),g.push(a.build(e,o)),c!==null&&g.push(c.build(e,o)),f!==null&&g.push(f.build(e,o))),e.format(`${e.getMethod(i,s)}( ${g.join(", ")} )`,s,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}ue.ALL="all";ue.ANY="any";ue.RADIANS="radians";ue.DEGREES="degrees";ue.EXP="exp";ue.EXP2="exp2";ue.LOG="log";ue.LOG2="log2";ue.SQRT="sqrt";ue.INVERSE_SQRT="inversesqrt";ue.FLOOR="floor";ue.CEIL="ceil";ue.NORMALIZE="normalize";ue.FRACT="fract";ue.SIN="sin";ue.COS="cos";ue.TAN="tan";ue.ASIN="asin";ue.ACOS="acos";ue.ATAN="atan";ue.ABS="abs";ue.SIGN="sign";ue.LENGTH="length";ue.NEGATE="negate";ue.ONE_MINUS="oneMinus";ue.DFDX="dFdx";ue.DFDY="dFdy";ue.ROUND="round";ue.RECIPROCAL="reciprocal";ue.TRUNC="trunc";ue.FWIDTH="fwidth";ue.TRANSPOSE="transpose";ue.DETERMINANT="determinant";ue.INVERSE="inverse";ue.EQUALS="equals";ue.MIN="min";ue.MAX="max";ue.STEP="step";ue.REFLECT="reflect";ue.DISTANCE="distance";ue.DIFFERENCE="difference";ue.DOT="dot";ue.CROSS="cross";ue.POW="pow";ue.TRANSFORM_DIRECTION="transformDirection";ue.MIX="mix";ue.CLAMP="clamp";ue.REFRACT="refract";ue.SMOOTHSTEP="smoothstep";ue.FACEFORWARD="faceforward";const Z1=z(1e-6),mF=z(1e6),Vh=z(Math.PI),gF=z(Math.PI*2),yF=z(Math.PI*2),_F=z(Math.PI*.5),h8=Se(ue,ue.ALL).setParameterLength(1),f8=Se(ue,ue.ANY).setParameterLength(1),d8=Se(ue,ue.RADIANS).setParameterLength(1),p8=Se(ue,ue.DEGREES).setParameterLength(1),J1=Se(ue,ue.EXP).setParameterLength(1),lu=Se(ue,ue.EXP2).setParameterLength(1),xf=Se(ue,ue.LOG).setParameterLength(1),xs=Se(ue,ue.LOG2).setParameterLength(1),gr=Se(ue,ue.SQRT).setParameterLength(1),e2=Se(ue,ue.INVERSE_SQRT).setParameterLength(1),Ts=Se(ue,ue.FLOOR).setParameterLength(1),Tf=Se(ue,ue.CEIL).setParameterLength(1),Mr=Se(ue,ue.NORMALIZE).setParameterLength(1),Yi=Se(ue,ue.FRACT).setParameterLength(1),Cr=Se(ue,ue.SIN).setParameterLength(1),Ui=Se(ue,ue.COS).setParameterLength(1),m8=Se(ue,ue.TAN).setParameterLength(1),g8=Se(ue,ue.ASIN).setParameterLength(1),t2=Se(ue,ue.ACOS).setParameterLength(1),wf=Se(ue,ue.ATAN).setParameterLength(1,2),en=Se(ue,ue.ABS).setParameterLength(1),n2=Se(ue,ue.SIGN).setParameterLength(1),ws=Se(ue,ue.LENGTH).setParameterLength(1),r2=Se(ue,ue.NEGATE).setParameterLength(1),y8=Se(ue,ue.ONE_MINUS).setParameterLength(1),i2=Se(ue,ue.DFDX).setParameterLength(1),s2=Se(ue,ue.DFDY).setParameterLength(1),_8=Se(ue,ue.ROUND).setParameterLength(1),v8=Se(ue,ue.RECIPROCAL).setParameterLength(1),o2=Se(ue,ue.TRUNC).setParameterLength(1),a2=Se(ue,ue.FWIDTH).setParameterLength(1),b8=Se(ue,ue.TRANSPOSE).setParameterLength(1),x8=Se(ue,ue.DETERMINANT).setParameterLength(1),T8=Se(ue,ue.INVERSE).setParameterLength(1),w8=(n,e)=>(De('TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),Y1(n,e)),zr=Se(ue,ue.MIN).setParameterLength(2,1/0),_n=Se(ue,ue.MAX).setParameterLength(2,1/0),Sf=Se(ue,ue.STEP).setParameterLength(2),S8=Se(ue,ue.REFLECT).setParameterLength(2),E8=Se(ue,ue.DISTANCE).setParameterLength(2),R8=Se(ue,ue.DIFFERENCE).setParameterLength(2),Ri=Se(ue,ue.DOT).setParameterLength(2),uo=Se(ue,ue.CROSS).setParameterLength(2),_i=Se(ue,ue.POW).setParameterLength(2),l2=n=>et(n,n),C8=n=>et(n,n,n),u2=n=>et(n,n,n,n),N8=Se(ue,ue.TRANSFORM_DIRECTION).setParameterLength(2),M8=n=>et(n2(n),_i(en(n),1/3)),A2=n=>Ri(n,n),Tt=Se(ue,ue.MIX).setParameterLength(3),Ki=(n,e=0,t=1)=>Pe(new ue(ue.CLAMP,Pe(n),Pe(e),Pe(t))),Ef=n=>Ki(n),c2=Se(ue,ue.REFRACT).setParameterLength(3),Zi=Se(ue,ue.SMOOTHSTEP).setParameterLength(3),h2=Se(ue,ue.FACEFORWARD).setParameterLength(3),P8=re(([n])=>{const r=43758.5453,i=Ri(n.xy,we(12.9898,78.233)),s=nc(i,Vh);return Yi(Cr(s).mul(r))}),B8=(n,e,t)=>Tt(e,t,n),D8=(n,e,t)=>Zi(e,t,n),L8=(n,e)=>Sf(e,n),O8=(n,e)=>(De('TSL: "atan2" is overloaded. Use "atan" instead.'),wf(n,e)),vF=h2,bF=e2;de("all",h8);de("any",f8);de("equals",w8);de("radians",d8);de("degrees",p8);de("exp",J1);de("exp2",lu);de("log",xf);de("log2",xs);de("sqrt",gr);de("inverseSqrt",e2);de("floor",Ts);de("ceil",Tf);de("normalize",Mr);de("fract",Yi);de("sin",Cr);de("cos",Ui);de("tan",m8);de("asin",g8);de("acos",t2);de("atan",wf);de("abs",en);de("sign",n2);de("length",ws);de("lengthSq",A2);de("negate",r2);de("oneMinus",y8);de("dFdx",i2);de("dFdy",s2);de("round",_8);de("reciprocal",v8);de("trunc",o2);de("fwidth",a2);de("atan2",O8);de("min",zr);de("max",_n);de("step",L8);de("reflect",S8);de("distance",E8);de("dot",Ri);de("cross",uo);de("pow",_i);de("pow2",l2);de("pow3",C8);de("pow4",u2);de("transformDirection",N8);de("mix",B8);de("clamp",Ki);de("refract",c2);de("smoothstep",D8);de("faceForward",h2);de("difference",R8);de("saturate",Ef);de("cbrt",M8);de("transpose",b8);de("determinant",x8);de("inverse",T8);de("rand",P8);class xF extends Ie{static get type(){return"ConditionalNode"}constructor(e,t,r=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=r}getNodeType(e){const{ifNode:t,elseNode:r}=e.getNodeProperties(this);if(t===void 0)return e.flowBuildStage(this,"setup"),this.getNodeType(e);const i=t.getNodeType(e);if(r!==null){const s=r.getNodeType(e);if(e.getTypeLength(s)>e.getTypeLength(i))return s}return i}setup(e){const t=this.condNode,r=this.ifNode.isolate(),i=this.elseNode?this.elseNode.isolate():null,s=e.context.nodeBlock;e.getDataFromNode(r).parentNodeBlock=s,i!==null&&(e.getDataFromNode(i).parentNodeBlock=s);const o=e.context.uniformFlow,a=e.getNodeProperties(this);a.condNode=t,a.ifNode=o?r:r.context({nodeBlock:r}),a.elseNode=i?o?i:i.context({nodeBlock:i}):null}generate(e,t){const r=this.getNodeType(e),i=e.getDataFromNode(this);if(i.nodeProperty!==void 0)return i.nodeProperty;const{condNode:s,ifNode:o,elseNode:a}=e.getNodeProperties(this),c=e.currentFunctionNode,f=t!=="void",p=f?Js(r).build(e):"";i.nodeProperty=p;const g=s.build(e,"bool");if(e.context.uniformFlow&&a!==null){const T=o.build(e,r),S=a.build(e,r),E=e.getTernary(g,T,S);return e.format(E,r,t)}e.addFlowCode(`
${e.tab}if ( ${g} ) {

`).addFlowTab();let x=o.build(e,r);if(x&&(f?x=p+" = "+x+";":(x="return "+x+";",c===null&&(De("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),x="// "+x))),e.removeFlowTab().addFlowCode(e.tab+"	"+x+`

`+e.tab+"}"),a!==null){e.addFlowCode(` else {

`).addFlowTab();let T=a.build(e,r);T&&(f?T=p+" = "+T+";":(T="return "+T+";",c===null&&(De("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),T="// "+T))),e.removeFlowTab().addFlowCode(e.tab+"	"+T+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(p,r,t)}}const lr=tt(xF).setParameterLength(2,3);de("select",lr);class F8 extends Ie{static get type(){return"ContextNode"}constructor(e=null,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}getFlowContextData(){const e=[];return this.traverse(t=>{t.isContextNode===!0&&e.push(t.value)}),Object.assign({},...e)}getMemberType(e,t){return this.node.getMemberType(e,t)}analyze(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}setup(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}generate(e,t){const r=e.addContext(this.value),i=this.node.build(e,t);return e.setContext(r),i}}const fo=(n=null,e={})=>{let t=n;return(t===null||t.isNode!==!0)&&(e=t||e,t=null),new F8(t,e)},I8=n=>fo(n,{uniformFlow:!0}),f2=(n,e)=>fo(n,{nodeName:e});function k8(n,e,t=null){return fo(t,{getShadow:({light:r,shadowColorNode:i})=>e===r?i.mul(n):i})}function U8(n,e=null){return fo(e,{getAO:(t,{material:r})=>r.transparent===!0?t:t!==null?t.mul(n):n})}function q8(n,e){return De('TSL: "label()" has been deprecated. Use "setName()" instead.'),f2(n,e)}de("context",fo);de("label",q8);de("uniformFlow",I8);de("setName",f2);de("builtinShadowContext",(n,e,t)=>k8(e,t,n));de("builtinAOContext",(n,e)=>U8(e,n));class F0 extends Ie{static get type(){return"VarNode"}constructor(e,t=null,r=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=r,this.parents=!0,this.intent=!1}setIntent(e){return this.intent=e,this}isIntent(e){return e.getDataFromNode(this).forceDeclaration===!0?!1:this.intent}getIntent(){return this.intent}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}getArrayCount(e){return this.node.getArrayCount(e)}isAssign(e){return e.getDataFromNode(this).assign}build(...e){const t=e[0];if(this._hasStack(t)===!1&&t.buildStage==="setup"&&(t.context.nodeLoop||t.context.nodeBlock)){let r=!1;if(this.node.isShaderCallNodeInternal&&this.node.shaderNode.getLayout()===null&&t.fnCall&&t.fnCall.shaderNode&&t.getDataFromNode(this.node.shaderNode).hasLoop){const o=t.getDataFromNode(this);o.forceDeclaration=!0,r=!0}const i=t.getBaseStack();r?i.addToStackBefore(this):i.addToStack(this)}return this.isIntent(t)&&this.isAssign(t)!==!0?this.node.build(...e):super.build(...e)}generate(e){const{node:t,name:r,readOnly:i}=this,{renderer:s}=e,o=s.backend.isWebGPUBackend===!0;let a=!1,c=!1;i&&(a=e.isDeterministic(t),c=o?i:a);const f=this.getNodeType(e);if(f=="void")return this.isIntent(e)!==!0&&Be('TSL: ".toVar()" can not be used with void type.'),t.build(e);const p=e.getVectorType(f),g=t.build(e,p),v=e.getVarFromNode(this,r,p,void 0,c),x=e.getPropertyName(v);let T=x;if(c)if(o)T=a?`const ${x}`:`let ${x}`;else{const S=t.getArrayCount(e);T=`const ${e.getVar(v.type,x,S)}`}return e.addLineFlowCode(`${T} = ${g}`,this),x}_hasStack(e){return e.getDataFromNode(this).stack!==void 0}}const d2=tt(F0),G8=(n,e=null)=>d2(n,e).toStack(),V8=(n,e=null)=>d2(n,e,!0).toStack(),z8=n=>d2(n).setIntent(!0).toStack();de("toVar",G8);de("toConst",V8);de("toVarIntent",z8);class TF extends Ie{static get type(){return"SubBuild"}constructor(e,t,r=null){super(r),this.node=e,this.name=t,this.isSubBuildNode=!0}getNodeType(e){if(this.nodeType!==null)return this.nodeType;e.addSubBuild(this.name);const t=this.node.getNodeType(e);return e.removeSubBuild(),t}build(e,...t){e.addSubBuild(this.name);const r=this.node.build(e,...t);return e.removeSubBuild(),r}}const Wl=(n,e,t=null)=>Pe(new TF(Pe(n),e,t));class wF extends Ie{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e,t=null){return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let r=t.varying;if(r===void 0){const i=this.name,s=this.getNodeType(e),o=this.interpolationType,a=this.interpolationSampling;t.varying=r=e.getVaryingFromNode(this,i,s,o,a),t.node=Wl(this.node,"VERTEX")}return r.needsInterpolation||(r.needsInterpolation=e.shaderStage==="fragment"),r}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(sA.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(sA.VERTEX,this.node)}generate(e){const t=e.getSubBuildProperty("property",e.currentStack),r=e.getNodeProperties(this),i=this.setupVarying(e);if(r[t]===void 0){const s=this.getNodeType(e),o=e.getPropertyName(i,sA.VERTEX);e.flowNodeFromShaderStage(sA.VERTEX,r.node,s,o),r[t]=o}return e.getPropertyName(i)}}const Fs=tt(wF).setParameterLength(1,2),j8=n=>Fs(n);de("toVarying",Fs);de("toVertexStage",j8);de("varying",(...n)=>(De("TSL: .varying() has been renamed to .toVarying()."),Fs(...n)));de("vertexStage",(...n)=>(De("TSL: .vertexStage() has been renamed to .toVertexStage()."),Fs(...n)));const $8=re(([n])=>{const e=n.mul(.9478672986).add(.0521327014).pow(2.4),t=n.mul(.0773993808),r=n.lessThanEqual(.04045);return Tt(e,t,r)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),H8=re(([n])=>{const e=n.pow(.41666).mul(1.055).sub(.055),t=n.mul(12.92),r=n.lessThanEqual(.0031308);return Tt(e,t,r)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),p2="WorkingColorSpace",SF="OutputColorSpace";class m2 extends vn{static get type(){return"ColorSpaceNode"}constructor(e,t,r){super("vec4"),this.colorNode=e,this.source=t,this.target=r}resolveColorSpace(e,t){return t===p2?Sn.workingColorSpace:t===SF?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,r=this.resolveColorSpace(e,this.source),i=this.resolveColorSpace(e,this.target);let s=t;return Sn.enabled===!1||r===i||!r||!i||(Sn.getTransfer(r)===ft&&(s=je($8(s.rgb),s.a)),Sn.getPrimaries(r)!==Sn.getPrimaries(i)&&(s=je(ur(Sn._getMatrix(new YA,r,i)).mul(s.rgb),s.a)),Sn.getTransfer(i)===ft&&(s=je(H8(s.rgb),s.a))),s}}const W8=(n,e)=>Pe(new m2(Pe(n),p2,e)),Rf=(n,e)=>Pe(new m2(Pe(n),e,p2)),EF=(n,e,t)=>Pe(new m2(Pe(n),e,t));de("workingToColorSpace",W8);de("colorSpaceToWorking",Rf);let RF=class extends Ka{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),r=this.referenceNode.getNodeType(),i=this.getNodeType();return e.format(t,r,i)}};class Q8 extends Ie{static get type(){return"ReferenceBaseNode"}constructor(e,t,r=null,i=null){super(),this.property=e,this.uniformType=t,this.object=r,this.count=i,this.properties=e.split("."),this.reference=r,this.node=null,this.group=null,this.updateType=ot.OBJECT}setGroup(e){return this.group=e,this}element(e){return new RF(this,Pe(e))}setNodeType(e){const t=Ve(null,e);this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let r=e[t[0]];for(let i=1;i<t.length;i++)r=r[t[i]];return r}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const CF=(n,e,t)=>new Q8(n,e,t);class NF extends Q8{static get type(){return"RendererReferenceNode"}constructor(e,t,r=null){super(e,t,r),this.renderer=r,this.setGroup(Ge)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const X8=(n,e,t=null)=>new NF(n,e,t);class MF extends vn{static get type(){return"ToneMappingNode"}constructor(e,t=K8,r=null){super("vec3"),this._toneMapping=e,this.exposureNode=t,this.colorNode=r}customCacheKey(){return mA(this._toneMapping)}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup(e){const t=this.colorNode||e.context.color,r=this._toneMapping;if(r===Ba)return t;let i=null;const s=e.renderer.library.getToneMappingFunction(r);return s!==null?i=je(s(t.rgb,this.exposureNode),t.a):(Be("ToneMappingNode: Unsupported Tone Mapping configuration.",r),i=t),i}}const Y8=(n,e,t)=>Pe(new MF(n,Pe(e),Pe(t))),K8=X8("toneMappingExposure","float");de("toneMapping",(n,e,t)=>Y8(e,t,n));const fv=new WeakMap;function dv(n,e){let t=fv.get(n);return t===void 0&&(t=new hx(n,e),fv.set(n,t)),t}class Eo extends O1{static get type(){return"BufferAttributeNode"}constructor(e,t=null,r=0,i=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=r,this.bufferOffset=i,this.usage=u1,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&e.itemSize<=4&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),r=e.getTypeLength(t),i=this.value,s=this.bufferStride||r,o=this.bufferOffset;let a;i.isInterleavedBuffer===!0?a=i:i.isBufferAttribute===!0?a=dv(i.array,s):a=dv(i,s);const c=new qo(a,r,o);a.setUsage(this.usage),this.attribute=c,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),r=e.getBufferAttributeFromNode(this,t),i=e.getPropertyName(r);let s=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=i,s=i):s=Fs(this).build(e,t),s}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}function Cf(n,e=null,t=0,r=0,i=u1,s=!1){return e==="mat3"||e===null&&n.itemSize===9?ur(new Eo(n,"vec3",9,0).setUsage(i).setInstanced(s),new Eo(n,"vec3",9,3).setUsage(i).setInstanced(s),new Eo(n,"vec3",9,6).setUsage(i).setInstanced(s)):e==="mat4"||e===null&&n.itemSize===16?Wo(new Eo(n,"vec4",16,0).setUsage(i).setInstanced(s),new Eo(n,"vec4",16,4).setUsage(i).setInstanced(s),new Eo(n,"vec4",16,8).setUsage(i).setInstanced(s),new Eo(n,"vec4",16,12).setUsage(i).setInstanced(s)):new Eo(n,e,t,r)}const g2=(n,e=null,t=0,r=0)=>Cf(n,e,t,r),PF=(n,e=null,t=0,r=0)=>Cf(n,e,t,r,Da),zh=(n,e=null,t=0,r=0)=>Cf(n,e,t,r,u1,!0),cg=(n,e=null,t=0,r=0)=>Cf(n,e,t,r,Da,!0);de("toAttribute",n=>g2(n.value));class BF extends Ie{static get type(){return"ComputeNode"}constructor(e,t){super("void"),this.isComputeNode=!0,this.computeNode=e,this.workgroupSize=t,this.count=null,this.version=1,this.name="",this.updateBeforeType=ot.OBJECT,this.onInitFunction=null}setCount(e){return this.count=e,this}getCount(){return this.count}dispose(){this.dispatchEvent({type:"dispose"})}setName(e){return this.name=e,this}label(e){return De('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.build(e);if(t){const r=e.getNodeProperties(this);r.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:r}=e;if(r==="compute"){const i=this.computeNode.build(e,"void");i!==""&&e.addLineFlowCode(i,this)}else{const s=e.getNodeProperties(this).outputComputeNode;if(s)return s.build(e,t)}}}const y2=(n,e=[64])=>{(e.length===0||e.length>3)&&Be("TSL: compute() workgroupSize must have 1, 2, or 3 elements");for(let t=0;t<e.length;t++){const r=e[t];(typeof r!="number"||r<=0||!Number.isInteger(r))&&Be(`TSL: compute() workgroupSize element at index [ ${t} ] must be a positive integer`)}for(;e.length<3;)e.push(1);return Pe(new BF(Pe(n),e))},Z8=(n,e,t)=>y2(n,t).setCount(e);de("compute",Z8);de("computeKernel",y2);class DF extends Ie{static get type(){return"IsolateNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isIsolateNode=!0}getNodeType(e){const t=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);const i=this.node.getNodeType(e);return e.setCache(t),i}build(e,...t){const r=e.getCache(),i=e.getCacheFromNode(this,this.parent);e.setCache(i);const s=this.node.build(e,...t);return e.setCache(r),s}setParent(e){return this.parent=e,this}getParent(){return this.parent}}const Ql=n=>new DF(Pe(n));function J8(n,e=!0){return De('TSL: "cache()" has been deprecated. Use "isolate()" instead.'),Ql(n).setParent(e)}de("cache",J8);de("isolate",Ql);class LF extends Ie{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const e6=tt(LF).setParameterLength(2);de("bypass",e6);class t6 extends Ie{static get type(){return"RemapNode"}constructor(e,t,r,i=z(0),s=z(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=r,this.outLowNode=i,this.outHighNode=s,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:r,outLowNode:i,outHighNode:s,doClamp:o}=this;let a=e.sub(t).div(r.sub(t));return o===!0&&(a=a.clamp()),a.mul(s.sub(i)).add(i)}}const n6=tt(t6,null,null,{doClamp:!1}).setParameterLength(3,5),r6=tt(t6).setParameterLength(3,5);de("remap",n6);de("remapClamp",r6);class I0 extends Ie{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const r=this.getNodeType(e),i=this.snippet;if(r==="void")e.addLineFlowCode(i,this);else return e.format(i,r,t)}}const Ao=tt(I0).setParameterLength(1,2),i6=n=>(n?lr(n,Ao("discard")):Ao("discard")).toStack(),OF=()=>Ao("return").toStack();de("discard",i6);class FF extends vn{static get type(){return"RenderOutputNode"}constructor(e,t,r){super("vec4"),this.colorNode=e,this._toneMapping=t,this.outputColorSpace=r,this.isRenderOutputNode=!0}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup({context:e}){let t=this.colorNode||e.color;const r=(this._toneMapping!==null?this._toneMapping:e.toneMapping)||Ba,i=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||Kl;return r!==Ba&&(t=t.toneMapping(r)),i!==Kl&&i!==Sn.workingColorSpace&&(t=t.workingToColorSpace(i)),t}}const s6=(n,e=null,t=null)=>Pe(new FF(Pe(n),e,t));de("renderOutput",s6);class IF extends vn{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,r=this.node.build(e),i="--- TSL debug - "+e.shaderStage+" shader ---",s="-".repeat(i.length);let o="";return o+="// #"+i+`#
`,o+=e.flow.code.replace(/^\t/mg,"")+`
`,o+="/* ... */ "+r+` /* ... */
`,o+="// #"+s+`#
`,t!==null?t(e,o):YC(o),r}}const o6=(n,e=null)=>Pe(new IF(Pe(n),e)).toStack();de("debug",o6);class a6{constructor(){this._renderer=null,this.currentFrame=null}get nodeFrame(){return this._renderer._nodes.nodeFrame}setRenderer(e){return this._renderer=e,this}getRenderer(){return this._renderer}init(){}begin(){}finish(){}inspect(){}computeAsync(){}beginCompute(){}finishCompute(){}beginRender(){}finishRender(){}copyTextureToTexture(){}copyFramebufferToTexture(){}}class kF extends Ie{static get type(){return"InspectorNode"}constructor(e,t="",r=null){super(),this.node=e,this.name=t,this.callback=r,this.updateType=ot.FRAME,this.isInspectorNode=!0}getName(){return this.name||this.node.name}update(e){e.renderer.inspector.inspect(this)}getNodeType(e){return this.node.getNodeType(e)}setup(e){let t=this.node;return e.context.inspector===!0&&this.callback!==null&&(t=this.callback(t)),e.renderer.backend.isWebGPUBackend!==!0&&e.renderer.inspector.constructor!==a6&&fn('TSL: ".toInspector()" is only available with WebGPU.'),t}}function l6(n,e="",t=null){return n=Pe(n),n.before(new kF(n,e,t))}de("toInspector",l6);function UF(n){De("TSL: AddNodeElement has been removed in favor of tree-shaking. Trying add",n)}class u6 extends Ie{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const r=this.getAttributeName(e);if(e.hasGeometryAttribute(r)){const i=e.geometry.getAttribute(r);t=e.getTypeFromAttribute(i)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),r=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const s=e.geometry.getAttribute(t),o=e.getTypeFromAttribute(s),a=e.getAttribute(t,o);return e.shaderStage==="vertex"?e.format(a.name,o,r):Fs(this).build(e,r)}else return De(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(r)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const co=(n,e=null)=>new u6(n,e),Ht=(n=0)=>co("uv"+(n>0?n:""),"vec2");class qF extends Ie{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const r=this.textureNode.build(e,"property"),i=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${r}, ${i} )`,this.getNodeType(e),t)}}const eo=tt(qF).setParameterLength(1,2);class GF extends tc{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=ot.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,r=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(r&&r.width!==void 0){const{width:i,height:s}=r;this.value=Math.log2(Math.max(i,s))}}}const _2=tt(GF).setParameterLength(1),v2=new e1;class Ms extends tc{static get type(){return"TextureNode"}constructor(e=v2,t=null,r=null,i=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=r,this.biasNode=i,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.offsetNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=ot.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this._flipYUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===Un?"uvec4":this.value.type===wr?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return Ht(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=Ve(this.value.matrix)),this._matrixUniform.mul(Z(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this}setupUV(e,t){return e.isFlipY()&&(this._flipYUniform===null&&(this._flipYUniform=Ve(!1)),t=t.toVar(),this.sampler?t=this._flipYUniform.select(t.flipY(),t):t=this._flipYUniform.select(t.setY(X(eo(this,this.levelNode).y).sub(t.y).sub(1)),t)),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const r=this.value;if(!r||r.isTexture!==!0)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");const i=re(()=>{let o=this.uvNode;return(o===null||e.context.forceUVContext===!0)&&e.context.getUV&&(o=e.context.getUV(this,e)),o||(o=this.getDefaultUV()),this.updateMatrix===!0&&(o=this.getTransformedUV(o)),o=this.setupUV(e,o),this.updateType=this._matrixUniform!==null||this._flipYUniform!==null?ot.OBJECT:ot.NONE,o})();let s=this.levelNode;s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),t.uvNode=i,t.levelNode=s,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode,t.offsetNode=this.offsetNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateOffset(e,t){return t.build(e,"ivec2")}generateSnippet(e,t,r,i,s,o,a,c,f){const p=this.value;let g;return s?g=e.generateTextureBias(p,t,r,s,o,f):c?g=e.generateTextureGrad(p,t,r,c,o,f):a?g=e.generateTextureCompare(p,t,r,a,o,f):this.sampler===!1?g=e.generateTextureLoad(p,t,r,i,o,f):i?g=e.generateTextureLevel(p,t,r,i,o,f):g=e.generateTexture(p,t,r,o,f),g}generate(e,t){const r=this.value,i=e.getNodeProperties(this),s=super.generate(e,"property");if(/^sampler/.test(t))return s+"_sampler";if(e.isReference(t))return s;{const o=e.getDataFromNode(this);let a=o.propertyName;if(a===void 0){const{uvNode:p,levelNode:g,biasNode:v,compareNode:x,depthNode:T,gradNode:S,offsetNode:E}=i,N=this.generateUV(e,p),P=g?g.build(e,"float"):null,B=v?v.build(e,"float"):null,L=T?T.build(e,"int"):null,k=x?x.build(e,"float"):null,q=S?[S[0].build(e,"vec2"),S[1].build(e,"vec2")]:null,I=E?this.generateOffset(e,E):null,U=e.getVarFromNode(this);a=e.getPropertyName(U);const j=this.generateSnippet(e,s,N,P,B,L,k,q,I);e.addLineFlowCode(`${a} = ${j}`,this),o.snippet=j,o.propertyName=a}let c=a;const f=this.getNodeType(e);return e.needsToWorkingColorSpace(r)&&(c=Rf(Ao(c,f),r.colorSpace).setup(e).build(e,f)),e.format(c,f,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return De("TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=Pe(e),t.referenceNode=this.getBase(),Pe(t)}load(e){return this.sample(e).setSampler(!1)}blur(e){const t=this.clone();t.biasNode=Pe(e).mul(_2(t)),t.referenceNode=this.getBase();const r=t.value;return t.generateMipmaps===!1&&(r&&r.generateMipmaps===!1||r.minFilter===qi||r.magFilter===qi)&&(De("TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),Pe(t)}level(e){const t=this.clone();return t.levelNode=Pe(e),t.referenceNode=this.getBase(),Pe(t)}size(e){return eo(this,e)}bias(e){const t=this.clone();return t.biasNode=Pe(e),t.referenceNode=this.getBase(),Pe(t)}getBase(){return this.referenceNode?this.referenceNode.getBase():this}compare(e){const t=this.clone();return t.compareNode=Pe(e),t.referenceNode=this.getBase(),Pe(t)}grad(e,t){const r=this.clone();return r.gradNode=[Pe(e),Pe(t)],r.referenceNode=this.getBase(),Pe(r)}depth(e){const t=this.clone();return t.depthNode=Pe(e),t.referenceNode=this.getBase(),Pe(t)}offset(e){const t=this.clone();return t.offsetNode=Pe(e),t.referenceNode=this.getBase(),Pe(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix();const r=this._flipYUniform;r!==null&&(r.value=e.image instanceof ImageBitmap&&e.flipY===!0||e.isRenderTargetTexture===!0||e.isFramebufferTexture===!0||e.isDepthTexture===!0)}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}const VF=tt(Ms).setParameterLength(1,4).setName("texture"),Nt=(n=v2,e=null,t=null,r=null)=>{let i;return n&&n.isTextureNode===!0?(i=Pe(n.clone()),i.referenceNode=n.getBase(),e!==null&&(i.uvNode=Pe(e)),t!==null&&(i.levelNode=Pe(t)),r!==null&&(i.biasNode=Pe(r))):i=VF(n,e,t,r),i},zF=(n=v2)=>Nt(n),wn=(...n)=>Nt(...n).setSampler(!1),jF=(n,e,t)=>Nt(n,e).level(t),$F=n=>(n.isNode===!0?n:Nt(n)).convert("sampler"),HF=n=>(n.isNode===!0?n:Nt(n)).convert("samplerComparison");class b2 extends tc{static get type(){return"BufferNode"}constructor(e,t,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=r,this.updateRanges=[]}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const rc=(n,e,t)=>new b2(n,e,t);class WF extends Ka{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),r=this.getNodeType(),i=this.node.getPaddedType();return e.format(t,i,r)}}class QF extends b2{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?Go(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=ot.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,r=this.elementType;if(r==="float"||r==="int"||r==="uint")for(let i=0;i<e.length;i++){const s=i*4;t[s]=e[i]}else if(r==="color")for(let i=0;i<e.length;i++){const s=i*4,o=e[i];t[s]=o.r,t[s+1]=o.g,t[s+2]=o.b||0}else if(r==="mat2")for(let i=0;i<e.length;i++){const s=i*4,o=e[i];t[s]=o.elements[0],t[s+1]=o.elements[1],t[s+2]=o.elements[2],t[s+3]=o.elements[3]}else if(r==="mat3")for(let i=0;i<e.length;i++){const s=i*16,o=e[i];t[s]=o.elements[0],t[s+1]=o.elements[1],t[s+2]=o.elements[2],t[s+4]=o.elements[3],t[s+5]=o.elements[4],t[s+6]=o.elements[5],t[s+8]=o.elements[6],t[s+9]=o.elements[7],t[s+10]=o.elements[8],t[s+15]=1}else if(r==="mat4")for(let i=0;i<e.length;i++){const s=i*16,o=e[i];for(let a=0;a<o.elements.length;a++)t[s+a]=o.elements[a]}else for(let i=0;i<e.length;i++){const s=i*4,o=e[i];t[s]=o.x,t[s+1]=o.y,t[s+2]=o.z||0,t[s+3]=o.w||0}}setup(e){const t=this.array.length,r=this.elementType;let i=Float32Array;const s=this.paddedType,o=e.getTypeLength(s);return r.charAt(0)==="i"&&(i=Int32Array),r.charAt(0)==="u"&&(i=Uint32Array),this.value=new i(t*o),this.bufferCount=t,this.bufferType=s,super.setup(e)}element(e){return new WF(this,Pe(e))}}const mr=(n,e)=>new QF(n,e);class XF extends Ie{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}const po=tt(XF).setParameterLength(1);let Lu,Ou;class rn extends Ie{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this._output=null,this.isViewportNode=!0}getNodeType(){return this.scope===rn.DPR?"float":this.scope===rn.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=ot.NONE;return(this.scope===rn.SIZE||this.scope===rn.VIEWPORT||this.scope===rn.DPR)&&(e=ot.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===rn.VIEWPORT?t!==null?Ou.copy(t.viewport):(e.getViewport(Ou),Ou.multiplyScalar(e.getPixelRatio())):this.scope===rn.DPR?this._output.value=e.getPixelRatio():t!==null?(Lu.width=t.width,Lu.height=t.height):e.getDrawingBufferSize(Lu)}setup(){const e=this.scope;let t=null;return e===rn.SIZE?t=Ve(Lu||(Lu=new _t)):e===rn.VIEWPORT?t=Ve(Ou||(Ou=new $t)):e===rn.DPR?t=Ve(1):t=we(Ja.div(Qa)),this._output=t,t}generate(e){if(this.scope===rn.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const r=e.getNodeProperties(Qa).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${r}.y - ${t}.y )`}return t}return super.generate(e)}}rn.COORDINATE="coordinate";rn.VIEWPORT="viewport";rn.SIZE="size";rn.UV="uv";rn.DPR="dpr";const A6=Me(rn,rn.DPR),to=Me(rn,rn.UV),Qa=Me(rn,rn.SIZE),Ja=Me(rn,rn.COORDINATE),x2=Me(rn,rn.VIEWPORT),T2=x2.zw,c6=Ja.sub(x2.xy),YF=c6.div(T2),KF=re(()=>(De('TSL: "viewportResolution" is deprecated. Use "screenSize" instead.'),Qa),"vec2").once()(),ta=Ve(0,"uint").setName("u_cameraIndex").setGroup(bf("cameraIndex")).toVarying("v_cameraIndex"),Io=Ve("float").setName("cameraNear").setGroup(Ge).onRenderUpdate(({camera:n})=>n.near),ko=Ve("float").setName("cameraFar").setGroup(Ge).onRenderUpdate(({camera:n})=>n.far),no=re(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const i of n.cameras)t.push(i.projectionMatrix);e=mr(t).setGroup(Ge).setName("cameraProjectionMatrices").element(n.isMultiViewCamera?po("gl_ViewID_OVR"):ta).toConst("cameraProjectionMatrix")}else e=Ve("mat4").setName("cameraProjectionMatrix").setGroup(Ge).onRenderUpdate(({camera:t})=>t.projectionMatrix);return e}).once()(),ZF=re(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const i of n.cameras)t.push(i.projectionMatrixInverse);e=mr(t).setGroup(Ge).setName("cameraProjectionMatricesInverse").element(n.isMultiViewCamera?po("gl_ViewID_OVR"):ta).toConst("cameraProjectionMatrixInverse")}else e=Ve("mat4").setName("cameraProjectionMatrixInverse").setGroup(Ge).onRenderUpdate(({camera:t})=>t.projectionMatrixInverse);return e}).once()(),Bi=re(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const i of n.cameras)t.push(i.matrixWorldInverse);e=mr(t).setGroup(Ge).setName("cameraViewMatrices").element(n.isMultiViewCamera?po("gl_ViewID_OVR"):ta).toConst("cameraViewMatrix")}else e=Ve("mat4").setName("cameraViewMatrix").setGroup(Ge).onRenderUpdate(({camera:t})=>t.matrixWorldInverse);return e}).once()(),JF=re(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const i of n.cameras)t.push(i.matrixWorld);e=mr(t).setGroup(Ge).setName("cameraWorldMatrices").element(n.isMultiViewCamera?po("gl_ViewID_OVR"):ta).toConst("cameraWorldMatrix")}else e=Ve("mat4").setName("cameraWorldMatrix").setGroup(Ge).onRenderUpdate(({camera:t})=>t.matrixWorld);return e}).once()(),eI=re(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const i of n.cameras)t.push(i.normalMatrix);e=mr(t).setGroup(Ge).setName("cameraNormalMatrices").element(n.isMultiViewCamera?po("gl_ViewID_OVR"):ta).toConst("cameraNormalMatrix")}else e=Ve("mat3").setName("cameraNormalMatrix").setGroup(Ge).onRenderUpdate(({camera:t})=>t.normalMatrix);return e}).once()(),h6=re(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(let i=0,s=n.cameras.length;i<s;i++)t.push(new ge);e=mr(t).setGroup(Ge).setName("cameraPositions").onRenderUpdate(({camera:i},s)=>{const o=i.cameras,a=s.array;for(let c=0,f=o.length;c<f;c++)a[c].setFromMatrixPosition(o[c].matrixWorld)}).element(n.isMultiViewCamera?po("gl_ViewID_OVR"):ta).toConst("cameraPosition")}else e=Ve(new ge).setName("cameraPosition").setGroup(Ge).onRenderUpdate(({camera:t},r)=>r.value.setFromMatrixPosition(t.matrixWorld));return e}).once()(),tI=re(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const i of n.cameras)t.push(i.viewport);e=mr(t,"vec4").setGroup(Ge).setName("cameraViewports").element(ta).toConst("cameraViewport")}else e=je(0,0,Qa.x,Qa.y).toConst("cameraViewport");return e}).once()(),pv=new l1;class xt extends Ie{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=ot.OBJECT,this.uniformNode=new tc(null)}getNodeType(){const e=this.scope;if(e===xt.WORLD_MATRIX)return"mat4";if(e===xt.POSITION||e===xt.VIEW_POSITION||e===xt.DIRECTION||e===xt.SCALE)return"vec3";if(e===xt.RADIUS)return"float"}update(e){const t=this.object3d,r=this.uniformNode,i=this.scope;if(i===xt.WORLD_MATRIX)r.value=t.matrixWorld;else if(i===xt.POSITION)r.value=r.value||new ge,r.value.setFromMatrixPosition(t.matrixWorld);else if(i===xt.SCALE)r.value=r.value||new ge,r.value.setFromMatrixScale(t.matrixWorld);else if(i===xt.DIRECTION)r.value=r.value||new ge,t.getWorldDirection(r.value);else if(i===xt.VIEW_POSITION){const s=e.camera;r.value=r.value||new ge,r.value.setFromMatrixPosition(t.matrixWorld),r.value.applyMatrix4(s.matrixWorldInverse)}else if(i===xt.RADIUS){const s=e.object.geometry;s.boundingSphere===null&&s.computeBoundingSphere(),pv.copy(s.boundingSphere).applyMatrix4(t.matrixWorld),r.value=pv.radius}}generate(e){const t=this.scope;return t===xt.WORLD_MATRIX?this.uniformNode.nodeType="mat4":t===xt.POSITION||t===xt.VIEW_POSITION||t===xt.DIRECTION||t===xt.SCALE?this.uniformNode.nodeType="vec3":t===xt.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}xt.WORLD_MATRIX="worldMatrix";xt.POSITION="position";xt.SCALE="scale";xt.VIEW_POSITION="viewPosition";xt.DIRECTION="direction";xt.RADIUS="radius";const nI=tt(xt,xt.DIRECTION).setParameterLength(1),rI=tt(xt,xt.WORLD_MATRIX).setParameterLength(1),f6=tt(xt,xt.POSITION).setParameterLength(1),iI=tt(xt,xt.SCALE).setParameterLength(1),sI=tt(xt,xt.VIEW_POSITION).setParameterLength(1),oI=tt(xt,xt.RADIUS).setParameterLength(1);class Ci extends xt{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}const aI=Me(Ci,Ci.DIRECTION),vi=Me(Ci,Ci.WORLD_MATRIX),lI=Me(Ci,Ci.POSITION),uI=Me(Ci,Ci.SCALE),AI=Me(Ci,Ci.VIEW_POSITION),cI=Me(Ci,Ci.RADIUS),d6=Ve(new YA).onObjectUpdate(({object:n},e)=>e.value.getNormalMatrix(n.matrixWorld)),hI=Ve(new dn).onObjectUpdate(({object:n},e)=>e.value.copy(n.matrixWorld).invert()),na=re(n=>n.context.modelViewMatrix||p6).once()().toVar("modelViewMatrix"),p6=Bi.mul(vi),hg=re(n=>(n.context.isHighPrecisionModelViewMatrix=!0,Ve("mat4").onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highpModelViewMatrix"),fg=re(n=>{const e=n.context.isHighPrecisionModelViewMatrix;return Ve("mat3").onObjectUpdate(({object:t,camera:r})=>(e!==!0&&t.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),ic=co("position","vec3"),pn=ic.toVarying("positionLocal"),jh=ic.toVarying("positionPrevious"),Ss=re(n=>vi.mul(pn).xyz.toVarying(n.getSubBuildProperty("v_positionWorld")),"vec3").once(["POSITION"])(),w2=re(()=>pn.transformDirection(vi).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),"vec3").once(["POSITION"])(),Mn=re(n=>n.context.setupPositionView().toVarying("v_positionView"),"vec3").once(["POSITION"])(),Yt=re(n=>{let e;return n.camera.isOrthographicCamera?e=Z(0,0,1):e=Mn.negate().toVarying("v_positionViewDirection").normalize(),e.toVar("positionViewDirection")},"vec3").once(["POSITION"])();class fI extends Ie{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){if(e.shaderStage!=="fragment")return"true";const{material:t}=e;return t.side===yr?"false":e.getFrontFacing()}}const m6=Me(fI),S2=z(m6).mul(2).sub(1),mu=re(([n],{material:e})=>{const t=e.side;return t===yr?n=n.mul(-1):t===xi&&(n=n.mul(S2)),n}),Nf=co("normal","vec3"),jr=re(n=>n.geometry.hasAttribute("normal")===!1?(De('TSL: Vertex attribute "normal" not found on geometry.'),Z(0,1,0)):Nf,"vec3").once()().toVar("normalLocal"),g6=Mn.dFdx().cross(Mn.dFdy()).normalize().toVar("normalFlat"),uu=re(n=>{let e;return n.material.flatShading===!0?e=g6:e=E2(jr).toVarying("v_normalViewGeometry").normalize(),e},"vec3").once()().toVar("normalViewGeometry"),y6=re(n=>{let e=uu.transformDirection(Bi);return n.material.flatShading!==!0&&(e=e.toVarying("v_normalWorldGeometry")),e.normalize().toVar("normalWorldGeometry")},"vec3").once()(),Rt=re(({subBuildFn:n,material:e,context:t})=>{let r;return n==="NORMAL"||n==="VERTEX"?(r=uu,e.flatShading!==!0&&(r=mu(r))):r=t.setupNormal().context({getUV:null}),r},"vec3").once(["NORMAL","VERTEX"])().toVar("normalView"),ra=Rt.transformDirection(Bi).toVar("normalWorld"),Ia=re(({subBuildFn:n,context:e})=>{let t;return n==="NORMAL"||n==="VERTEX"?t=Rt:t=e.setupClearcoatNormal().context({getUV:null}),t},"vec3").once(["NORMAL","VERTEX"])().toVar("clearcoatNormalView"),_6=re(([n,e=vi])=>{const t=ur(e),r=n.div(Z(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(r).xyz}),E2=re(([n],e)=>{const t=e.context.modelNormalViewMatrix;if(t)return t.transformDirection(n);const r=d6.mul(n);return Bi.transformDirection(r)}),dI=re(()=>(De('TSL: "transformedNormalView" is deprecated. Use "normalView" instead.'),Rt)).once(["NORMAL","VERTEX"])(),pI=re(()=>(De('TSL: "transformedNormalWorld" is deprecated. Use "normalWorld" instead.'),ra)).once(["NORMAL","VERTEX"])(),mI=re(()=>(De('TSL: "transformedClearcoatNormalView" is deprecated. Use "clearcoatNormalView" instead.'),Ia)).once(["NORMAL","VERTEX"])(),mv=new RA,Jd=new dn,v6=Ve(0).onReference(({material:n})=>n).onObjectUpdate(({material:n})=>n.refractionRatio),k0=Ve(1).onReference(({material:n})=>n).onObjectUpdate(function({material:n,scene:e}){return n.envMap?n.envMapIntensity:e.environmentIntensity}),R2=Ve(new dn).onReference(function(n){return n.material}).onObjectUpdate(function({material:n,scene:e}){const t=e.environment!==null&&n.envMap===null?e.environmentRotation:n.envMapRotation;return t?(mv.copy(t),Jd.makeRotationFromEuler(mv)):Jd.identity(),Jd}),b6=Yt.negate().reflect(Rt),x6=Yt.negate().refract(Rt,v6),T6=b6.transformDirection(Bi).toVar("reflectVector"),w6=x6.transformDirection(Bi).toVar("reflectVector"),S6=new Jg;class gI extends Ms{static get type(){return"CubeTextureNode"}constructor(e,t=null,r=null,i=null){super(e,t,r,i),this.isCubeTextureNode=!0}getInputType(){return this.value.isDepthTexture===!0?"cubeDepthTexture":"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===Z0?T6:e.mapping===J0?w6:(Be('CubeTextureNode: Mapping "%s" not supported.',e.mapping),Z(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const r=this.value;return r.isDepthTexture===!0?e.renderer.coordinateSystem===Qo?Z(t.x,t.y.negate(),t.z):t:((e.renderer.coordinateSystem===Qo||!r.isRenderTargetTexture)&&(t=Z(t.x.negate(),t.yz)),R2.mul(t))}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}}const C2=tt(gI).setParameterLength(1,4).setName("cubeTexture"),Nr=(n=S6,e=null,t=null,r=null)=>{let i;return n&&n.isCubeTextureNode===!0?(i=Pe(n.clone()),i.referenceNode=n,e!==null&&(i.uvNode=Pe(e)),t!==null&&(i.levelNode=Pe(t)),r!==null&&(i.biasNode=Pe(r))):i=C2(n,e,t,r),i},yI=(n=S6)=>C2(n);class _I extends Ka{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),r=this.referenceNode.getNodeType(),i=this.getNodeType();return e.format(t,r,i)}}class Mf extends Ie{static get type(){return"ReferenceNode"}constructor(e,t,r=null,i=null){super(),this.property=e,this.uniformType=t,this.object=r,this.count=i,this.properties=e.split("."),this.reference=r,this.node=null,this.group=null,this.name=null,this.updateType=ot.OBJECT}element(e){return new _I(this,Pe(e))}setGroup(e){return this.group=e,this}setName(e){return this.name=e,this}label(e){return De('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setNodeType(e){let t=null;this.count!==null?t=rc(null,e,this.count):Array.isArray(this.getValueFromReference())?t=mr(null,e):e==="texture"?t=Nt(null):e==="cubeTexture"?t=Nr(null):t=Ve(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.setName(this.name),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let r=e[t[0]];for(let i=1;i<t.length;i++)r=r[t[i]];return r}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const zt=(n,e,t)=>new Mf(n,e,t),dg=(n,e,t,r)=>new Mf(n,e,r,t);class vI extends Mf{static get type(){return"MaterialReferenceNode"}constructor(e,t,r=null){super(e,t,r),this.material=r,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const Hs=(n,e,t=null)=>new vI(n,e,t),E6=Ht(),bI=Mn.dFdx(),xI=Mn.dFdy(),R6=E6.dFdx(),C6=E6.dFdy(),N6=Rt,M6=xI.cross(N6),P6=N6.cross(bI),pg=M6.mul(R6.x).add(P6.mul(C6.x)),mg=M6.mul(R6.y).add(P6.mul(C6.y)),gv=pg.dot(pg).max(mg.dot(mg)),B6=gv.equal(0).select(0,gv.inverseSqrt()),TI=pg.mul(B6).toVar("tangentViewFrame"),wI=mg.mul(B6).toVar("bitangentViewFrame"),Pf=co("tangent","vec4"),sc=Pf.xyz.toVar("tangentLocal"),Bf=re(({subBuildFn:n,geometry:e,material:t})=>{let r;return n==="VERTEX"||e.hasAttribute("tangent")?r=na.mul(je(sc,0)).xyz.toVarying("v_tangentView").normalize():r=TI,t.flatShading!==!0&&(r=mu(r)),r},"vec3").once(["NORMAL","VERTEX"])().toVar("tangentView"),D6=Bf.transformDirection(Bi).toVarying("v_tangentWorld").normalize().toVar("tangentWorld"),Df=re(([n,e],{subBuildFn:t,material:r})=>{let i=n.mul(Pf.w).xyz;return t==="NORMAL"&&r.flatShading!==!0&&(i=i.toVarying(e)),i}).once(["NORMAL"]),SI=Df(Nf.cross(Pf),"v_bitangentGeometry").normalize().toVar("bitangentGeometry"),EI=Df(jr.cross(sc),"v_bitangentLocal").normalize().toVar("bitangentLocal"),L6=re(({subBuildFn:n,geometry:e,material:t})=>{let r;return n==="VERTEX"||e.hasAttribute("tangent")?r=Df(Rt.cross(Bf),"v_bitangentView").normalize():r=wI,t.flatShading!==!0&&(r=mu(r)),r},"vec3").once(["NORMAL","VERTEX"])().toVar("bitangentView"),RI=Df(ra.cross(D6),"v_bitangentWorld").normalize().toVar("bitangentWorld"),ka=ur(Bf,L6,Rt).toVar("TBNViewMatrix"),O6=Yt.mul(ka),CI=(n,e)=>n.sub(O6.mul(e)),F6=re(()=>{let n=za.cross(Yt);return n=n.cross(za).normalize(),n=Tt(n,Rt,Lo.mul(ps.oneMinus()).oneMinus().pow2().pow2()).normalize(),n}).once()(),I6=n=>Pe(n).mul(.5).add(.5),NI=n=>Pe(n).mul(2).sub(1),gg=n=>Z(n,gr(Ef(z(1).sub(Ri(n,n)))));class MI extends vn{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=Fd,this.unpackNormalMode=Id}setup({material:e}){const{normalMapType:t,scaleNode:r,unpackNormalMode:i}=this;let s=this.node.mul(2).sub(1);if(t===Fd?i===Zx?s=gg(s.xy):i===HC?s=gg(s.yw):i!==Id&&console.error(`THREE.NodeMaterial: Unexpected unpack normal mode: ${i}`):i!==Id&&console.error(`THREE.NodeMaterial: Normal map type '${t}' is not compatible with unpack normal mode '${i}'`),r!==null){let a=r;e.flatShading===!0&&(a=mu(a)),s=Z(s.xy.mul(a),s.z)}let o=null;return t===WC?o=E2(s):t===Fd?o=ka.mul(s).normalize():(Be(`NodeMaterial: Unsupported normal map type: ${t}`),o=Rt),o}}const yg=tt(MI).setParameterLength(1,2),PI=re(({textureNode:n,bumpScale:e})=>{const t=i=>n.isolate().context({getUV:s=>i(s.uvNode||Ht()),forceUVContext:!0}),r=z(t(i=>i));return we(z(t(i=>i.add(i.dFdx()))).sub(r),z(t(i=>i.add(i.dFdy()))).sub(r)).mul(e)}),BI=re(n=>{const{surf_pos:e,surf_norm:t,dHdxy:r}=n,i=e.dFdx().normalize(),s=e.dFdy().normalize(),o=t,a=s.cross(o),c=o.cross(i),f=i.dot(a).mul(S2),p=f.sign().mul(r.x.mul(a).add(r.y.mul(c)));return f.abs().mul(t).sub(p).normalize()});class DI extends vn{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=PI({textureNode:this.textureNode,bumpScale:e});return BI({surf_pos:Mn,surf_norm:Rt,dHdxy:t})}}const N2=tt(DI).setParameterLength(1,2),yv=new Map;class pe extends Ie{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let r=yv.get(e);return r===void 0&&(r=Hs(e,t),yv.set(e,r)),r}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,r=this.scope;let i=null;if(r===pe.COLOR){const s=t.color!==void 0?this.getColor(r):Z();t.map&&t.map.isTexture===!0?i=s.mul(this.getTexture("map")):i=s}else if(r===pe.OPACITY){const s=this.getFloat(r);t.alphaMap&&t.alphaMap.isTexture===!0?i=s.mul(this.getTexture("alpha")):i=s}else if(r===pe.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?i=this.getTexture("specular").r:i=z(1);else if(r===pe.SPECULAR_INTENSITY){const s=this.getFloat(r);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?i=s.mul(this.getTexture(r).a):i=s}else if(r===pe.SPECULAR_COLOR){const s=this.getColor(r);t.specularColorMap&&t.specularColorMap.isTexture===!0?i=s.mul(this.getTexture(r).rgb):i=s}else if(r===pe.ROUGHNESS){const s=this.getFloat(r);t.roughnessMap&&t.roughnessMap.isTexture===!0?i=s.mul(this.getTexture(r).g):i=s}else if(r===pe.METALNESS){const s=this.getFloat(r);t.metalnessMap&&t.metalnessMap.isTexture===!0?i=s.mul(this.getTexture(r).b):i=s}else if(r===pe.EMISSIVE){const s=this.getFloat("emissiveIntensity"),o=this.getColor(r).mul(s);t.emissiveMap&&t.emissiveMap.isTexture===!0?i=o.mul(this.getTexture(r)):i=o}else if(r===pe.NORMAL)t.normalMap?(i=yg(this.getTexture("normal"),this.getCache("normalScale","vec2")),i.normalMapType=t.normalMapType,(t.normalMap.format==Qs||t.normalMap.format==K0||t.normalMap.format==Y0)&&(i.unpackNormalMode=Zx)):t.bumpMap?i=N2(this.getTexture("bump").r,this.getFloat("bumpScale")):i=Rt;else if(r===pe.CLEARCOAT){const s=this.getFloat(r);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?i=s.mul(this.getTexture(r).r):i=s}else if(r===pe.CLEARCOAT_ROUGHNESS){const s=this.getFloat(r);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?i=s.mul(this.getTexture(r).r):i=s}else if(r===pe.CLEARCOAT_NORMAL)t.clearcoatNormalMap?i=yg(this.getTexture(r),this.getCache(r+"Scale","vec2")):i=Rt;else if(r===pe.SHEEN){const s=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?i=s.mul(this.getTexture("sheenColor").rgb):i=s}else if(r===pe.SHEEN_ROUGHNESS){const s=this.getFloat(r);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?i=s.mul(this.getTexture(r).a):i=s,i=i.clamp(1e-4,1)}else if(r===pe.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const s=this.getTexture(r);i=_f(Pl.x,Pl.y,Pl.y.negate(),Pl.x).mul(s.rg.mul(2).sub(we(1)).normalize().mul(s.b))}else i=Pl;else if(r===pe.IRIDESCENCE_THICKNESS){const s=zt("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const o=zt("0","float",t.iridescenceThicknessRange);i=s.sub(o).mul(this.getTexture(r).g).add(o)}else i=s}else if(r===pe.TRANSMISSION){const s=this.getFloat(r);t.transmissionMap?i=s.mul(this.getTexture(r).r):i=s}else if(r===pe.THICKNESS){const s=this.getFloat(r);t.thicknessMap?i=s.mul(this.getTexture(r).g):i=s}else if(r===pe.IOR)i=this.getFloat(r);else if(r===pe.LIGHT_MAP)i=this.getTexture(r).rgb.mul(this.getFloat("lightMapIntensity"));else if(r===pe.AO)i=this.getTexture(r).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(r===pe.LINE_DASH_OFFSET)i=t.dashOffset?this.getFloat(r):z(0);else{const s=this.getNodeType(e);i=this.getCache(r,s)}return i}}pe.ALPHA_TEST="alphaTest";pe.COLOR="color";pe.OPACITY="opacity";pe.SHININESS="shininess";pe.SPECULAR="specular";pe.SPECULAR_STRENGTH="specularStrength";pe.SPECULAR_INTENSITY="specularIntensity";pe.SPECULAR_COLOR="specularColor";pe.REFLECTIVITY="reflectivity";pe.ROUGHNESS="roughness";pe.METALNESS="metalness";pe.NORMAL="normal";pe.CLEARCOAT="clearcoat";pe.CLEARCOAT_ROUGHNESS="clearcoatRoughness";pe.CLEARCOAT_NORMAL="clearcoatNormal";pe.EMISSIVE="emissive";pe.ROTATION="rotation";pe.SHEEN="sheen";pe.SHEEN_ROUGHNESS="sheenRoughness";pe.ANISOTROPY="anisotropy";pe.IRIDESCENCE="iridescence";pe.IRIDESCENCE_IOR="iridescenceIOR";pe.IRIDESCENCE_THICKNESS="iridescenceThickness";pe.IOR="ior";pe.TRANSMISSION="transmission";pe.THICKNESS="thickness";pe.ATTENUATION_DISTANCE="attenuationDistance";pe.ATTENUATION_COLOR="attenuationColor";pe.LINE_SCALE="scale";pe.LINE_DASH_SIZE="dashSize";pe.LINE_GAP_SIZE="gapSize";pe.LINE_WIDTH="linewidth";pe.LINE_DASH_OFFSET="dashOffset";pe.POINT_SIZE="size";pe.DISPERSION="dispersion";pe.LIGHT_MAP="light";pe.AO="ao";const k6=Me(pe,pe.ALPHA_TEST),U6=Me(pe,pe.COLOR),q6=Me(pe,pe.SHININESS),G6=Me(pe,pe.EMISSIVE),M2=Me(pe,pe.OPACITY),V6=Me(pe,pe.SPECULAR),_g=Me(pe,pe.SPECULAR_INTENSITY),z6=Me(pe,pe.SPECULAR_COLOR),vA=Me(pe,pe.SPECULAR_STRENGTH),U0=Me(pe,pe.REFLECTIVITY),j6=Me(pe,pe.ROUGHNESS),$6=Me(pe,pe.METALNESS),H6=Me(pe,pe.NORMAL),W6=Me(pe,pe.CLEARCOAT),Q6=Me(pe,pe.CLEARCOAT_ROUGHNESS),X6=Me(pe,pe.CLEARCOAT_NORMAL),Y6=Me(pe,pe.ROTATION),K6=Me(pe,pe.SHEEN),Z6=Me(pe,pe.SHEEN_ROUGHNESS),J6=Me(pe,pe.ANISOTROPY),ew=Me(pe,pe.IRIDESCENCE),tw=Me(pe,pe.IRIDESCENCE_IOR),nw=Me(pe,pe.IRIDESCENCE_THICKNESS),rw=Me(pe,pe.TRANSMISSION),iw=Me(pe,pe.THICKNESS),sw=Me(pe,pe.IOR),ow=Me(pe,pe.ATTENUATION_DISTANCE),aw=Me(pe,pe.ATTENUATION_COLOR),lw=Me(pe,pe.LINE_SCALE),uw=Me(pe,pe.LINE_DASH_SIZE),Aw=Me(pe,pe.LINE_GAP_SIZE),LI=Me(pe,pe.LINE_WIDTH),cw=Me(pe,pe.LINE_DASH_OFFSET),hw=Me(pe,pe.POINT_SIZE),fw=Me(pe,pe.DISPERSION),P2=Me(pe,pe.LIGHT_MAP),dw=Me(pe,pe.AO),Pl=Ve(new _t).onReference(function(n){return n.material}).onRenderUpdate(function({material:n}){this.value.set(n.anisotropy*Math.cos(n.anisotropyRotation),n.anisotropy*Math.sin(n.anisotropyRotation))}),pw=re(n=>n.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class OI extends Ka{static get type(){return"StorageArrayElementNode"}constructor(e,t){super(e,t),this.isStorageArrayElementNode=!0}set storageBufferNode(e){this.node=e}get storageBufferNode(){return this.node}getMemberType(e,t){const r=this.storageBufferNode.structTypeNode;return r?r.getMemberType(e,t):"void"}setup(e){return e.isAvailable("storageBuffer")===!1&&this.node.isPBO===!0&&e.setupPBO(this.node),super.setup(e)}generate(e,t){let r;const i=e.context.assign;if(e.isAvailable("storageBuffer")===!1?this.node.isPBO===!0&&i!==!0&&(this.node.value.isInstancedBufferAttribute||e.shaderStage!=="compute")?r=e.generatePBO(this):r=this.node.build(e):r=super.generate(e),i!==!0){const s=this.getNodeType(e);r=e.format(r,s,t)}return r}}const FI=tt(OI).setParameterLength(2);class II extends b2{static get type(){return"StorageBufferNode"}constructor(e,t=null,r=0){let i,s=null;t&&t.isStruct?(i="struct",s=t.layout,(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(r=e.count)):t===null&&(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)?(i=ST(e.itemSize),r=e.count):i=t,super(e,i,r),this.isStorageBufferNode=!0,this.structTypeNode=s,this.access=ar.READ_WRITE,this.isAtomic=!1,this.isPBO=!1,this._attribute=null,this._varying=null,this.global=!0,e.isStorageBufferAttribute!==!0&&e.isStorageInstancedBufferAttribute!==!0&&(e.isInstancedBufferAttribute?e.isStorageInstancedBufferAttribute=!0:e.isStorageBufferAttribute=!0)}getHash(e){if(this.bufferCount===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getInputType(){return this.value.isIndirectStorageBufferAttribute?"indirectStorageBuffer":"storageBuffer"}element(e){return FI(this,e)}setPBO(e){return this.isPBO=e,this}getPBO(){return this.isPBO}setAccess(e){return this.access=e,this}toReadOnly(){return this.setAccess(ar.READ_ONLY)}setAtomic(e){return this.isAtomic=e,this}toAtomic(){return this.setAtomic(!0)}getAttributeData(){return this._attribute===null&&(this._attribute=g2(this.value),this._varying=Fs(this._attribute)),{attribute:this._attribute,varying:this._varying}}getNodeType(e){if(this.structTypeNode!==null)return this.structTypeNode.getNodeType(e);if(e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.getNodeType(e);const{attribute:t}=this.getAttributeData();return t.getNodeType(e)}getMemberType(e,t){return this.structTypeNode!==null?this.structTypeNode.getMemberType(e,t):"void"}generate(e){if(this.structTypeNode!==null&&this.structTypeNode.build(e),e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.generate(e);const{attribute:t,varying:r}=this.getAttributeData(),i=r.build(e);return e.registerTransform(i,t),i}}const ro=(n,e=null,t=0)=>new II(n,e,t),kI=(n,e,t)=>(De('TSL: "storageObject()" is deprecated. Use "storage().setPBO( true )" instead.'),ro(n,e,t).setPBO(!0));class ln extends Ie{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),r=this.scope;let i;if(r===ln.VERTEX)i=e.getVertexIndex();else if(r===ln.INSTANCE)i=e.getInstanceIndex();else if(r===ln.DRAW)i=e.getDrawIndex();else if(r===ln.INVOCATION_LOCAL)i=e.getInvocationLocalIndex();else if(r===ln.INVOCATION_SUBGROUP)i=e.getInvocationSubgroupIndex();else if(r===ln.SUBGROUP)i=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+r);let s;return e.shaderStage==="vertex"||e.shaderStage==="compute"?s=i:s=Fs(this).build(e,t),s}}ln.VERTEX="vertex";ln.INSTANCE="instance";ln.SUBGROUP="subgroup";ln.INVOCATION_LOCAL="invocationLocal";ln.INVOCATION_SUBGROUP="invocationSubgroup";ln.DRAW="draw";const mw=Me(ln,ln.VERTEX),Es=Me(ln,ln.INSTANCE),UI=Me(ln,ln.SUBGROUP),qI=Me(ln,ln.INVOCATION_SUBGROUP),GI=Me(ln,ln.INVOCATION_LOCAL),gw=Me(ln,ln.DRAW);class yw extends Ie{static get type(){return"InstanceNode"}constructor(e,t,r=null){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=r,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=ot.FRAME,this.buffer=null,this.bufferColor=null}get isStorageMatrix(){const{instanceMatrix:e}=this;return e&&e.isStorageInstancedBufferAttribute===!0}get isStorageColor(){const{instanceColor:e}=this;return e&&e.isStorageInstancedBufferAttribute===!0}setup(e){const{instanceMatrix:t,instanceColor:r,isStorageMatrix:i,isStorageColor:s}=this,{count:o}=t;let{instanceMatrixNode:a,instanceColorNode:c}=this;if(a===null){if(i)a=ro(t,"mat4",Math.max(o,1)).element(Es);else if(o<=1e3)a=rc(t.array,"mat4",Math.max(o,1)).element(Es);else{const p=new eh(t.array,16,1);this.buffer=p;const g=t.usage===Da?cg:zh,v=[g(p,"vec4",16,0),g(p,"vec4",16,4),g(p,"vec4",16,8),g(p,"vec4",16,12)];a=Wo(...v)}this.instanceMatrixNode=a}if(r&&c===null){if(s)c=ro(r,"vec3",Math.max(r.count,1)).element(Es);else{const p=new zo(r.array,3),g=r.usage===Da?cg:zh;this.bufferColor=p,c=Z(g(p,"vec3",3,0))}this.instanceColorNode=c}const f=a.mul(pn).xyz;if(pn.assign(f),e.hasGeometryAttribute("normal")){const p=_6(jr,a);jr.assign(p)}this.instanceColorNode!==null&&GA("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.buffer!==null&&this.isStorageMatrix!==!0&&(this.buffer.clearUpdateRanges(),this.buffer.updateRanges.push(...this.instanceMatrix.updateRanges),this.instanceMatrix.usage!==Da&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version)),this.instanceColor&&this.bufferColor!==null&&this.isStorageColor!==!0&&(this.bufferColor.clearUpdateRanges(),this.bufferColor.updateRanges.push(...this.instanceColor.updateRanges),this.instanceColor.usage!==Da&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version))}}const VI=tt(yw).setParameterLength(2,3);class zI extends yw{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:r,instanceColor:i}=e;super(t,r,i),this.instancedMesh=e}}const _w=tt(zI).setParameterLength(1);class jI extends Ie{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=Es:this.batchingIdNode=gw);const r=re(([T])=>{const S=X(eo(wn(this.batchMesh._indirectTexture),0).x).toConst(),E=X(T).mod(S).toConst(),N=X(T).div(S).toConst();return wn(this.batchMesh._indirectTexture,In(E,N)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(X(this.batchingIdNode)),i=this.batchMesh._matricesTexture,s=X(eo(wn(i),0).x).toConst(),o=z(r).mul(4).toInt().toConst(),a=o.mod(s).toConst(),c=o.div(s).toConst(),f=Wo(wn(i,In(a,c)),wn(i,In(a.add(1),c)),wn(i,In(a.add(2),c)),wn(i,In(a.add(3),c))),p=this.batchMesh._colorsTexture;if(p!==null){const S=re(([E])=>{const N=X(eo(wn(p),0).x).toConst(),P=E,B=P.mod(N).toConst(),L=P.div(N).toConst();return wn(p,In(B,L)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(r);GA("vec3","vBatchColor").assign(S)}const g=ur(f);pn.assign(f.mul(pn));const v=jr.div(Z(g[0].dot(g[0]),g[1].dot(g[1]),g[2].dot(g[2]))),x=g.mul(v).xyz;jr.assign(x),e.hasGeometryAttribute("tangent")&&sc.mulAssign(g)}}const vw=tt(jI).setParameterLength(1),_v=new WeakMap;class bw extends Ie{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=ot.OBJECT,this.skinIndexNode=co("skinIndex","uvec4"),this.skinWeightNode=co("skinWeight","vec4"),this.bindMatrixNode=zt("bindMatrix","mat4"),this.bindMatrixInverseNode=zt("bindMatrixInverse","mat4"),this.boneMatricesNode=dg("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=pn,this.toPositionNode=pn,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){const{skinIndexNode:r,skinWeightNode:i,bindMatrixNode:s,bindMatrixInverseNode:o}=this,a=e.element(r.x),c=e.element(r.y),f=e.element(r.z),p=e.element(r.w),g=s.mul(t),v=Ln(a.mul(i.x).mul(g),c.mul(i.y).mul(g),f.mul(i.z).mul(g),p.mul(i.w).mul(g));return o.mul(v).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=jr){const{skinIndexNode:r,skinWeightNode:i,bindMatrixNode:s,bindMatrixInverseNode:o}=this,a=e.element(r.x),c=e.element(r.y),f=e.element(r.z),p=e.element(r.w);let g=Ln(i.x.mul(a),i.y.mul(c),i.z.mul(f),i.w.mul(p));return g=o.mul(g).mul(s),g.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=dg("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,jh)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||RT(e.object).useVelocity===!0}setup(e){this.needsPreviousBoneMatrices(e)&&jh.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const r=this.getSkinnedNormal();jr.assign(r),e.hasGeometryAttribute("tangent")&&sc.assign(r)}return t}generate(e,t){if(t!=="void")return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;_v.get(t)!==e.frameId&&(_v.set(t,e.frameId),this.previousBoneMatricesNode!==null&&(t.previousBoneMatrices===null&&(t.previousBoneMatrices=new Float32Array(t.boneMatrices)),t.previousBoneMatrices.set(t.boneMatrices)),t.update())}}const xw=n=>new bw(n),$I=(n,e=null)=>{const t=new bw(n);return t.positionNode=ro(new zo(n.geometry.getAttribute("position").array,3),"vec3").setPBO(!0).toReadOnly().element(Es).toVar(),t.skinIndexNode=ro(new zo(new Uint32Array(n.geometry.getAttribute("skinIndex").array),4),"uvec4").setPBO(!0).toReadOnly().element(Es).toVar(),t.skinWeightNode=ro(new zo(n.geometry.getAttribute("skinWeight").array,4),"vec4").setPBO(!0).toReadOnly().element(Es).toVar(),t.bindMatrixNode=Ve(n.bindMatrix,"mat4"),t.bindMatrixInverseNode=Ve(n.bindMatrixInverse,"mat4"),t.boneMatricesNode=rc(n.skeleton.boneMatrices,"mat4",n.skeleton.bones.length),t.toPositionNode=e,Pe(t)};class HI extends Ie{static get type(){return"LoopNode"}constructor(e=[]){super("void"),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const r={};for(let a=0,c=this.params.length-1;a<c;a++){const f=this.params[a],p=f.isNode!==!0&&f.name||this.getVarName(a),g=f.isNode!==!0&&f.type||"int";r[p]=Ao(p,g)}const i=e.addStack(),s=this.params[this.params.length-1](r);t.returnsNode=s.context({nodeLoop:s}),t.stackNode=i;const o=this.params[0];if(o.isNode!==!0&&typeof o.update=="function"){const a=re(this.params[0].update)(r);t.updateNode=a.context({nodeLoop:a})}return e.removeStack(),t}setup(e){if(this.getProperties(e),e.fnCall){const t=e.getDataFromNode(e.fnCall.shaderNode);t.hasLoop=!0}}generate(e){const t=this.getProperties(e),r=this.params,i=t.stackNode;for(let o=0,a=r.length-1;o<a;o++){const c=r[o];let f=!1,p=null,g=null,v=null,x=null,T=null,S=null;c.isNode?c.getNodeType(e)==="bool"?(f=!0,x="bool",g=c.build(e,x)):(x="int",v=this.getVarName(o),p="0",g=c.build(e,x),T="<"):(x=c.type||"int",v=c.name||this.getVarName(o),p=c.start,g=c.end,T=c.condition,S=c.update,typeof p=="number"?p=e.generateConst(x,p):p&&p.isNode&&(p=p.build(e,x)),typeof g=="number"?g=e.generateConst(x,g):g&&g.isNode&&(g=g.build(e,x)),p!==void 0&&g===void 0?(p=p+" - 1",g="0",T=">="):g!==void 0&&p===void 0&&(p="0",T="<"),T===void 0&&(Number(p)>Number(g)?T=">=":T="<"));let E;if(f)E=`while ( ${g} )`;else{const N={start:p,end:g},P=N.start,B=N.end;let L;const k=()=>T.includes("<")?"+=":"-=";if(S!=null)switch(typeof S){case"function":L=e.flowStagesNode(t.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":L=v+" "+k()+" "+e.generateConst(x,S);break;case"string":L=v+" "+S;break;default:S.isNode?L=v+" "+k()+" "+S.build(e):(Be("TSL: 'Loop( { update: ... } )' is not a function, string or number."),L="break /* invalid update */")}else x==="int"||x==="uint"?S=T.includes("<")?"++":"--":S=k()+" 1.",L=v+" "+S;const q=e.getVar(x,v)+" = "+P,I=v+" "+T+" "+B;E=`for ( ${q}; ${I}; ${L} )`}e.addFlowCode((o===0?`
`:"")+e.tab+E+` {

`).addFlowTab()}const s=i.build(e,"void");t.returnsNode.build(e,"void"),e.removeFlowTab().addFlowCode(`
`+e.tab+s);for(let o=0,a=this.params.length-1;o<a;o++)e.addFlowCode((o===0?"":e.tab)+`}

`).removeFlowTab();e.addFlowTab()}}const qt=(...n)=>new HI(Va(n,"int")).toStack(),WI=()=>Ao("continue").toStack(),Tw=()=>Ao("break").toStack(),ep=new WeakMap,Yr=new $t,vv=re(({bufferMap:n,influence:e,stride:t,width:r,depth:i,offset:s})=>{const o=X(mw).mul(t).add(s),a=o.div(r),c=o.sub(a.mul(r));return wn(n,In(c,a)).depth(i).xyz.mul(e)});function QI(n){const e=n.morphAttributes.position!==void 0,t=n.morphAttributes.normal!==void 0,r=n.morphAttributes.color!==void 0,i=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,s=i!==void 0?i.length:0;let o=ep.get(n);if(o===void 0||o.count!==s){let N=function(){S.dispose(),ep.delete(n),n.removeEventListener("dispose",N)};o!==void 0&&o.texture.dispose();const a=n.morphAttributes.position||[],c=n.morphAttributes.normal||[],f=n.morphAttributes.color||[];let p=0;e===!0&&(p=1),t===!0&&(p=2),r===!0&&(p=3);let g=n.attributes.position.count*p,v=1;const x=4096;g>x&&(v=Math.ceil(g/x),g=x);const T=new Float32Array(g*v*4*s),S=new QC(T,g,v,s);S.type=yi,S.needsUpdate=!0;const E=p*4;for(let P=0;P<s;P++){const B=a[P],L=c[P],k=f[P],q=g*v*4*P;for(let I=0;I<B.count;I++){const U=I*E;e===!0&&(Yr.fromBufferAttribute(B,I),T[q+U+0]=Yr.x,T[q+U+1]=Yr.y,T[q+U+2]=Yr.z,T[q+U+3]=0),t===!0&&(Yr.fromBufferAttribute(L,I),T[q+U+4]=Yr.x,T[q+U+5]=Yr.y,T[q+U+6]=Yr.z,T[q+U+7]=0),r===!0&&(Yr.fromBufferAttribute(k,I),T[q+U+8]=Yr.x,T[q+U+9]=Yr.y,T[q+U+10]=Yr.z,T[q+U+11]=k.itemSize===4?Yr.w:1)}}o={count:s,texture:S,stride:p,size:new _t(g,v)},ep.set(n,o),n.addEventListener("dispose",N)}return o}class XI extends Ie{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=Ve(1),this.updateType=ot.OBJECT}setup(e){const{geometry:t}=e,r=t.morphAttributes.position!==void 0,i=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,s=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,o=s!==void 0?s.length:0,{texture:a,stride:c,size:f}=QI(t);r===!0&&pn.mulAssign(this.morphBaseInfluence),i===!0&&jr.mulAssign(this.morphBaseInfluence);const p=X(f.width);qt(o,({i:g})=>{const v=z(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?v.assign(wn(this.mesh.morphTexture,In(X(g).add(1),X(Es))).r):v.assign(zt("morphTargetInfluences","float").element(g).toVar()),ze(v.notEqual(0),()=>{r===!0&&pn.addAssign(vv({bufferMap:a,influence:v,stride:c,width:p,depth:g,offset:X(0)})),i===!0&&jr.addAssign(vv({bufferMap:a,influence:v,stride:c,width:p,depth:g,offset:X(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,r)=>t+r,0)}}const ww=tt(XI).setParameterLength(1);class gu extends Ie{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class YI extends gu{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class KI extends F8{static get type(){return"LightingContextNode"}constructor(e,t=null,r=null,i=null){super(e),this.lightingModel=t,this.backdropNode=r,this.backdropAlphaNode=i,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,r=Z().toVar("directDiffuse"),i=Z().toVar("directSpecular"),s=Z().toVar("indirectDiffuse"),o=Z().toVar("indirectSpecular"),a={directDiffuse:r,directSpecular:i,indirectDiffuse:s,indirectSpecular:o};return{radiance:Z().toVar("radiance"),irradiance:Z().toVar("irradiance"),iblIrradiance:Z().toVar("iblIrradiance"),ambientOcclusion:z(1).toVar("ambientOcclusion"),reflectedLight:a,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const Sw=tt(KI);class ZI extends gu{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}const _l=new _t;class Lf extends Ms{static get type(){return"ViewportTextureNode"}constructor(e=to,t=null,r=null){let i=null;r===null?(i=new Xg,i.minFilter=qa,r=i):i=r,super(r,e,t),this.generateMipmaps=!1,this.defaultFramebuffer=i,this.isOutputTextureNode=!0,this.updateBeforeType=ot.FRAME,this._cacheTextures=new WeakMap}getTextureForReference(e=null){let t,r;if(this.referenceNode?(t=this.referenceNode.defaultFramebuffer,r=this.referenceNode._cacheTextures):(t=this.defaultFramebuffer,r=this._cacheTextures),e===null)return t;if(r.has(e)===!1){const i=t.clone();r.set(e,i)}return r.get(e)}updateReference(e){const t=e.renderer.getRenderTarget();return this.value=this.getTextureForReference(t),this.value}updateBefore(e){const t=e.renderer,r=t.getRenderTarget();r===null?t.getDrawingBufferSize(_l):_l.set(r.width,r.height);const i=this.getTextureForReference(r);(i.image.width!==_l.width||i.image.height!==_l.height)&&(i.image.width=_l.width,i.image.height=_l.height,i.needsUpdate=!0);const s=i.generateMipmaps;i.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(i),i.generateMipmaps=s}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const JI=tt(Lf).setParameterLength(0,3),B2=tt(Lf,null,null,{generateMipmaps:!0}).setParameterLength(0,3);let Uc=null;class ek extends Lf{static get type(){return"ViewportDepthTextureNode"}constructor(e=to,t=null){Uc===null&&(Uc=new Wi),super(e,t,Uc)}getTextureForReference(){return Uc}}const D2=tt(ek).setParameterLength(0,2);class kr extends Ie{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===kr.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,r=this.valueNode;let i=null;if(t===kr.DEPTH_BASE)r!==null&&(i=Rw().assign(r));else if(t===kr.DEPTH)e.isPerspectiveCamera?i=Ew(Mn.z,Io,ko):i=Xl(Mn.z,Io,ko);else if(t===kr.LINEAR_DEPTH)if(r!==null)if(e.isPerspectiveCamera){const s=L2(r,Io,ko);i=Xl(s,Io,ko)}else i=r;else i=Xl(Mn.z,Io,ko);return i}}kr.DEPTH_BASE="depthBase";kr.DEPTH="depth";kr.LINEAR_DEPTH="linearDepth";const Xl=(n,e,t)=>n.add(e).div(e.sub(t)),tk=(n,e,t)=>e.sub(t).mul(n).sub(e),Ew=(n,e,t)=>e.add(n).mul(t).div(t.sub(e).mul(n)),L2=(n,e,t)=>e.mul(t).div(t.sub(e).mul(n).sub(t)),O2=(n,e,t)=>{e=e.max(1e-6).toVar();const r=xs(n.negate().div(e)),i=xs(t.div(e));return r.div(i)},nk=(n,e,t)=>{const r=n.mul(xf(t.div(e)));return z(Math.E).pow(r).mul(e).negate()},Rw=tt(kr,kr.DEPTH_BASE),F2=Me(kr,kr.DEPTH),$h=tt(kr,kr.LINEAR_DEPTH).setParameterLength(0,1),rk=$h(D2());F2.assign=n=>Rw(n);class wi extends Ie{static get type(){return"ClippingNode"}constructor(e=wi.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:r,unionPlanes:i}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===wi.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(r,i):this.scope===wi.HARDWARE?this.setupHardwareClipping(i,e):this.setupDefault(r,i)}setupAlphaToCoverage(e,t){return re(()=>{const r=z().toVar("distanceToPlane"),i=z().toVar("distanceToGradient"),s=z(1).toVar("clipOpacity"),o=t.length;if(this.hardwareClipping===!1&&o>0){const c=mr(t).setGroup(Ge);qt(o,({i:f})=>{const p=c.element(f);r.assign(Mn.dot(p.xyz).negate().add(p.w)),i.assign(r.fwidth().div(2)),s.mulAssign(Zi(i.negate(),i,r))})}const a=e.length;if(a>0){const c=mr(e).setGroup(Ge),f=z(1).toVar("intersectionClipOpacity");qt(a,({i:p})=>{const g=c.element(p);r.assign(Mn.dot(g.xyz).negate().add(g.w)),i.assign(r.fwidth().div(2)),f.mulAssign(Zi(i.negate(),i,r).oneMinus())}),s.mulAssign(f.oneMinus())}kt.a.mulAssign(s),kt.a.equal(0).discard()})()}setupDefault(e,t){return re(()=>{const r=t.length;if(this.hardwareClipping===!1&&r>0){const s=mr(t).setGroup(Ge);qt(r,({i:o})=>{const a=s.element(o);Mn.dot(a.xyz).greaterThan(a.w).discard()})}const i=e.length;if(i>0){const s=mr(e).setGroup(Ge),o=Ei(!0).toVar("clipped");qt(i,({i:a})=>{const c=s.element(a);o.assign(Mn.dot(c.xyz).greaterThan(c.w).and(o))}),o.discard()}})()}setupHardwareClipping(e,t){const r=e.length;return t.enableHardwareClipping(r),re(()=>{const i=mr(e).setGroup(Ge),s=po(t.getClipDistance());qt(r,({i:o})=>{const a=i.element(o),c=Mn.dot(a.xyz).sub(a.w).negate();s.element(o).assign(c)})})()}}wi.ALPHA_TO_COVERAGE="alphaToCoverage";wi.DEFAULT="default";wi.HARDWARE="hardware";const ik=()=>new wi,sk=()=>new wi(wi.ALPHA_TO_COVERAGE),ok=()=>new wi(wi.HARDWARE),ak=.05,bv=re(([n])=>Yi(et(1e4,Cr(et(17,n.x).add(et(.1,n.y)))).mul(Ln(.1,en(Cr(et(13,n.y).add(n.x))))))),xv=re(([n])=>bv(we(bv(n.xy),n.z))),lk=re(([n])=>{const e=_n(ws(i2(n.xyz)),ws(s2(n.xyz))),t=z(1).div(z(ak).mul(e)).toVar("pixScale"),r=we(lu(Ts(xs(t))),lu(Tf(xs(t)))),i=we(xv(Ts(r.x.mul(n.xyz))),xv(Ts(r.y.mul(n.xyz)))),s=Yi(xs(t)),o=Ln(et(s.oneMinus(),i.x),et(s,i.y)),a=zr(s,s.oneMinus()),c=Z(o.mul(o).div(et(2,a).mul(St(1,a))),o.sub(et(.5,a)).div(St(1,a)),St(1,St(1,o).mul(St(1,o)).div(et(2,a).mul(St(1,a))))),f=o.lessThan(a.oneMinus()).select(o.lessThan(a).select(c.x,c.y),c.z);return Ki(f,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class uk extends u6{static get type(){return"VertexColorNode"}constructor(e){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e),r=e.hasGeometryAttribute(t);let i;return r===!0?i=super.generate(e):i=e.generateConst(this.nodeType,new $t(1,1,1,1)),i}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const Cw=(n=0)=>new uk(n),Nw=re(([n,e])=>zr(1,n.oneMinus().div(e)).oneMinus()).setLayout({name:"blendBurn",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Mw=re(([n,e])=>zr(n.div(e.oneMinus()),1)).setLayout({name:"blendDodge",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Pw=re(([n,e])=>n.oneMinus().mul(e.oneMinus()).oneMinus()).setLayout({name:"blendScreen",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Bw=re(([n,e])=>Tt(n.mul(2).mul(e),n.oneMinus().mul(2).mul(e.oneMinus()).oneMinus(),Sf(.5,n))).setLayout({name:"blendOverlay",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Ak=re(([n,e])=>{const t=e.a.add(n.a.mul(e.a.oneMinus()));return je(e.rgb.mul(e.a).add(n.rgb.mul(n.a).mul(e.a.oneMinus())).div(t),t)}).setLayout({name:"blendColor",type:"vec4",inputs:[{name:"base",type:"vec4"},{name:"blend",type:"vec4"}]}),Dw=re(([n])=>je(n.rgb.mul(n.a),n.a),{color:"vec4",return:"vec4"}),ck=re(([n])=>(ze(n.a.equal(0),()=>je(0)),je(n.rgb.div(n.a),n.a)),{color:"vec4",return:"vec4"}),hk=(...n)=>(De('TSL: "burn" has been renamed. Use "blendBurn" instead.'),Nw(n)),fk=(...n)=>(De('TSL: "dodge" has been renamed. Use "blendDodge" instead.'),Mw(n)),dk=(...n)=>(De('TSL: "screen" has been renamed. Use "blendScreen" instead.'),Pw(n)),pk=(...n)=>(De('TSL: "overlay" has been renamed. Use "blendOverlay" instead.'),Bw(n));class Rn extends T_{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,this.contextNode=null,Object.defineProperty(this,"shadowPositionNode",{get:()=>this.receivedShadowPositionNode,set:e=>{De('NodeMaterial: ".shadowPositionNode" was renamed to ".receivedShadowPositionNode".'),this.receivedShadowPositionNode=e}})}_getNodeChildren(){const e=[];for(const t of Object.getOwnPropertyNames(this)){if(t.startsWith("_")===!0)continue;const r=this[t];r&&r.isNode===!0&&e.push({property:t,childNode:r})}return e}customProgramCacheKey(){const e=[];for(const{property:t,childNode:r}of this._getNodeChildren())e.push(ec(t.slice(0,-4)),r.getCacheKey());return this.type+pu(e)}build(e){this.setup(e)}setupObserver(e){return new OO(e)}setup(e){e.context.setupNormal=()=>Wl(this.setupNormal(e),"NORMAL","vec3"),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,r=t.getRenderTarget();t.contextNode.isContextNode===!0?e.context={...e.context,...t.contextNode.getFlowContextData()}:Be('NodeMaterial: "renderer.contextNode" must be an instance of `context()`.'),this.contextNode!==null&&(this.contextNode.isContextNode===!0?e.context={...e.context,...this.contextNode.getFlowContextData()}:Be('NodeMaterial: "material.contextNode" must be an instance of `context()`.')),e.addStack();const i=Wl(this.setupVertex(e),"VERTEX"),s=this.vertexNode||i;e.stack.outputNode=s,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let o;const a=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(r!==null?r.depthBuffer===!0&&this.setupDepth(e):t.depth===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const c=this.setupLighting(e);a!==null&&e.stack.addToStack(a);const f=je(c,kt.a).max(0);o=this.setupOutput(e,f),Hl.assign(o);const p=this.outputNode!==null;if(p&&(o=this.outputNode),e.context.getOutput&&(o=e.context.getOutput(o,e)),r!==null){const g=t.getMRT(),v=this.mrtNode;g!==null?(p&&Hl.assign(o),o=g,v!==null&&(o=g.merge(v))):v!==null&&(o=v)}}else{let c=this.fragmentNode;c.isOutputStructNode!==!0&&(c=je(c)),o=this.setupOutput(e,c)}e.stack.outputNode=o,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{unionPlanes:t,intersectionPlanes:r}=e.clippingContext;let i=null;if(t.length>0||r.length>0){const s=e.renderer.currentSamples;this.alphaToCoverage&&s>1?i=sk():e.stack.addToStack(ik())}return i}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.addToStack(ok()),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:r}=e;let i=this.depthNode;if(i===null){const s=t.getMRT();s&&s.has("depth")?i=s.get("depth"):t.logarithmicDepthBuffer===!0&&(r.isPerspectiveCamera?i=O2(Mn.z,Io,ko):i=Xl(Mn.z,Io,ko))}i!==null&&F2.assign(i).toStack()}setupPositionView(){return na.mul(pn).xyz}setupModelViewProjection(){return no.mul(Mn)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),pw}setupPosition(e){const{object:t,geometry:r}=e;if((r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color)&&ww(t).toStack(),t.isSkinnedMesh===!0&&xw(t).toStack(),this.displacementMap){const i=Hs("displacementMap","texture"),s=Hs("displacementScale","float"),o=Hs("displacementBias","float");pn.addAssign(jr.normalize().mul(i.x.mul(s).add(o)))}return t.isBatchedMesh&&vw(t).toStack(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&_w(t).toStack(),this.positionNode!==null&&pn.assign(Wl(this.positionNode,"POSITION","vec3")),pn}setupDiffuseColor(e){const{object:t,geometry:r}=e;this.maskNode!==null&&Ei(this.maskNode).not().discard();let i=this.colorNode?je(this.colorNode):U6;this.vertexColors===!0&&r.hasAttribute("color")&&(i=i.mul(Cw())),t.instanceColor&&(i=GA("vec3","vInstanceColor").mul(i)),t.isBatchedMesh&&t._colorsTexture&&(i=GA("vec3","vBatchColor").mul(i)),kt.assign(i);const s=this.opacityNode?z(this.opacityNode):M2;kt.a.assign(kt.a.mul(s));let o=null;(this.alphaTestNode!==null||this.alphaTest>0)&&(o=this.alphaTestNode!==null?z(this.alphaTestNode):k6,this.alphaToCoverage===!0?(kt.a=Zi(o,o.add(a2(kt.a)),kt.a),kt.a.lessThanEqual(0).discard()):kt.a.lessThanEqual(o).discard()),this.alphaHash===!0&&kt.a.lessThan(lk(pn)).discard(),e.isOpaque()&&kt.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?Z(0):kt.rgb}setupNormal(){return this.normalNode?Z(this.normalNode):H6}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?Hs("envMap","cubeTexture"):Hs("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new ZI(P2)),t}setupLights(e){const t=[],r=this.setupEnvironment(e);r&&r.isLightingNode&&t.push(r);const i=this.setupLightMap(e);i&&i.isLightingNode&&t.push(i);let s=this.aoNode;s===null&&e.material.aoMap&&(s=dw),e.context.getAO&&(s=e.context.getAO(s,e)),s&&t.push(new YI(s));let o=this.lightsNode||e.lightsNode;return t.length>0&&(o=e.renderer.lighting.createNode([...o.getLights(),...t])),o}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:r,backdropAlphaNode:i,emissiveNode:s}=this,a=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let c=this.setupOutgoingLight(e);if(a&&a.getScope().hasLights){const f=this.setupLightingModel(e)||null;c=Sw(a,f,r,i)}else r!==null&&(c=Z(i!==null?Tt(c,r,i):r));return(s&&s.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(ug.assign(Z(s||G6)),c=c.add(ug)),c}setupFog(e,t){const r=e.fogNode;return r&&(Hl.assign(t),t=je(r.toVar())),t}setupPremultipliedAlpha(e,t){return Dw(t)}setupOutput(e,t){return this.fog===!0&&(t=this.setupFog(e,t)),this.premultipliedAlpha===!0&&(t=this.setupPremultipliedAlpha(e,t)),t}setDefaultValues(e){for(const r in e){const i=e[r];this[r]===void 0&&(this[r]=i,i&&i.clone&&(this[r]=i.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const r in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,r)===void 0&&t[r].get!==void 0&&Object.defineProperty(this.constructor.prototype,r,t[r])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const r=T_.prototype.toJSON.call(this,e);r.inputNodes={};for(const{property:s,childNode:o}of this._getNodeChildren())r.inputNodes[s]=o.toJSON(e).uuid;function i(s){const o=[];for(const a in s){const c=s[a];delete c.metadata,o.push(c)}return o}if(t){const s=i(e.textures),o=i(e.images),a=i(e.nodes);s.length>0&&(r.textures=s),o.length>0&&(r.images=o),a.length>0&&(r.nodes=a)}return r}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.aoNode=e.aoNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.maskNode=e.maskNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.receivedShadowPositionNode=e.receivedShadowPositionNode,this.castShadowPositionNode=e.castShadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,this.contextNode=e.contextNode,super.copy(e)}}const mk=new Af;class gk extends Rn{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(mk),this.setValues(e)}}const yk=new hC;class _k extends Rn{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(yk),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?z(this.offsetNode):cw,t=this.dashScaleNode?z(this.dashScaleNode):lw,r=this.dashSizeNode?z(this.dashSizeNode):uw,i=this.gapSizeNode?z(this.gapSizeNode):Aw;O0.assign(r),Ag.assign(i);const s=Fs(co("lineDistance").mul(t));(e?s.add(e):s).mod(O0.add(Ag)).greaterThan(O0).discard()}}let qc=null;class vk extends Lf{static get type(){return"ViewportSharedTextureNode"}constructor(e=to,t=null){qc===null&&(qc=new Xg),super(e,t,qc)}getTextureForReference(){return qc}updateReference(){return this}}const bk=tt(vk).setParameterLength(0,2),xk=new AC;class Tk extends Rn{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(xk),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?z(this.opacityNode):M2;kt.assign(Rf(je(I6(Rt),e),XA))}}const I2=re(([n=w2])=>{const e=n.z.atan(n.x).mul(1/(Math.PI*2)).add(.5),t=n.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return we(e,t)});class Lw extends jC{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const r=t.minFilter,i=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const s=new a1(5,5,5),o=I2(w2),a=new Rn;a.colorNode=Nt(t,o,0),a.side=yr,a.blending=Zl;const c=new gn(s,a),f=new rf;f.add(c),t.minFilter===qa&&(t.minFilter=Xi);const p=new $C(1,10,this),g=e.getMRT();return e.setMRT(null),p.update(e,f),e.setMRT(g),t.minFilter=r,t.currentGenerateMipmaps=i,c.geometry.dispose(),c.material.dispose(),this}}const bA=new WeakMap;class wk extends vn{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=Nr(null);const t=new Jg;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=ot.RENDER}updateBefore(e){const{renderer:t,material:r}=e,i=this.envNode;if(i.isTextureNode||i.isMaterialReferenceNode){const s=i.isTextureNode?i.value:r[i.property];if(s&&s.isTexture){const o=s.mapping;if(o===Kg||o===Zg){if(bA.has(s)){const a=bA.get(s);Tv(a,s.mapping),this._cubeTexture=a}else{const a=s.image;if(Sk(a)){const c=new Lw(a.height);c.fromEquirectangularTexture(t,s),Tv(c.texture,s.mapping),this._cubeTexture=c.texture,bA.set(s,c.texture),s.addEventListener("dispose",Ow)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function Sk(n){return n==null?!1:n.height>0}function Ow(n){const e=n.target;e.removeEventListener("dispose",Ow);const t=bA.get(e);t!==void 0&&(bA.delete(e),t.dispose())}function Tv(n,e){e===Kg?n.mapping=Z0:e===Zg&&(n.mapping=J0)}const Fw=tt(wk).setParameterLength(1);class k2 extends gu{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=Fw(this.envNode)}}class Ek extends gu{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=z(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class Of{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class Iw extends Of{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,r=e.reflectedLight,i=e.irradianceLightMap;r.indirectDiffuse.assign(je(0)),i?r.indirectDiffuse.addAssign(i):r.indirectDiffuse.addAssign(je(1,1,1,0)),r.indirectDiffuse.mulAssign(t),r.indirectDiffuse.mulAssign(kt.rgb)}finish(e){const{material:t,context:r}=e,i=r.outgoingLight,s=e.context.environment;if(s)switch(t.combine){case qC:i.rgb.assign(Tt(i.rgb,i.rgb.mul(s.rgb),vA.mul(U0)));break;case UC:i.rgb.assign(Tt(i.rgb,s.rgb,vA.mul(U0)));break;case kC:i.rgb.addAssign(s.rgb.mul(vA.mul(U0)));break;default:De("BasicLightingModel: Unsupported .combine value:",t.combine);break}}}const Rk=new ds;class Ck extends Rn{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Rk),this.setValues(e)}setupNormal(){return mu(uu)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new k2(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new Ek(P2)),t}setupOutgoingLight(){return kt.rgb}setupLightingModel(){return new Iw}}const Au=re(({f0:n,f90:e,dotVH:t})=>{const r=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return n.mul(r.oneMinus()).add(e.mul(r))}),Xa=re(n=>n.diffuseColor.mul(1/Math.PI)),Nk=()=>z(.25),Mk=re(({dotNH:n})=>qh.mul(z(.5)).add(1).mul(z(1/Math.PI)).mul(n.pow(qh))),Pk=re(({lightDirection:n})=>{const e=n.add(Yt).normalize(),t=Rt.dot(e).clamp(),r=Yt.dot(e).clamp(),i=Au({f0:Ko,f90:1,dotVH:r}),s=Nk(),o=Mk({dotNH:t});return i.mul(s).mul(o)});class kw extends Iw{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:r}){const s=Rt.dot(e).clamp().mul(t);r.directDiffuse.addAssign(s.mul(Xa({diffuseColor:kt.rgb}))),this.specular===!0&&r.directSpecular.addAssign(s.mul(Pk({lightDirection:e})).mul(vA))}indirect(e){const{ambientOcclusion:t,irradiance:r,reflectedLight:i}=e.context;i.indirectDiffuse.addAssign(r.mul(Xa({diffuseColor:kt}))),i.indirectDiffuse.mulAssign(t)}}const Bk=new ho;class Dk extends Rn{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Bk),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new k2(t):null}setupLightingModel(){return new kw(!1)}}const Lk=new Qx;class Ok extends Rn{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(Lk),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new k2(t):null}setupLightingModel(){return new kw}setupVariants(){const e=(this.shininessNode?z(this.shininessNode):q6).max(1e-4);qh.assign(e);const t=this.specularNode||V6;Ko.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const Uw=re(n=>{if(n.geometry.hasAttribute("normal")===!1)return z(0);const e=uu.dFdx().abs().max(uu.dFdy().abs());return e.x.max(e.y).max(e.z)}),U2=re(n=>{const{roughness:e}=n,t=Uw();let r=e.max(.0525);return r=r.add(t),r=r.min(1),r}),qw=re(({alpha:n,dotNL:e,dotNV:t})=>{const r=n.pow2(),i=e.mul(r.add(r.oneMinus().mul(t.pow2())).sqrt()),s=t.mul(r.add(r.oneMinus().mul(e.pow2())).sqrt());return ai(.5,i.add(s).max(Z1))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),Fk=re(({alphaT:n,alphaB:e,dotTV:t,dotBV:r,dotTL:i,dotBL:s,dotNV:o,dotNL:a})=>{const c=a.mul(Z(n.mul(t),e.mul(r),o).length()),f=o.mul(Z(n.mul(i),e.mul(s),a).length());return ai(.5,c.add(f))}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),Gw=re(({alpha:n,dotNH:e})=>{const t=n.pow2(),r=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(r.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),Ik=z(1/Math.PI),kk=re(({alphaT:n,alphaB:e,dotNH:t,dotTH:r,dotBH:i})=>{const s=n.mul(e),o=Z(e.mul(r),n.mul(i),s.mul(t)),a=o.dot(o),c=s.div(a);return Ik.mul(s.mul(c.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),q2=re(({lightDirection:n,f0:e,f90:t,roughness:r,f:i,normalView:s=Rt,USE_IRIDESCENCE:o,USE_ANISOTROPY:a})=>{const c=r.pow2(),f=n.add(Yt).normalize(),p=s.dot(n).clamp(),g=s.dot(Yt).clamp(),v=s.dot(f).clamp(),x=Yt.dot(f).clamp();let T=Au({f0:e,f90:t,dotVH:x}),S,E;if(UA(o)&&(T=vf.mix(T,i)),UA(a)){const N=yA.dot(n),P=yA.dot(Yt),B=yA.dot(f),L=za.dot(n),k=za.dot(Yt),q=za.dot(f);S=Fk({alphaT:Uh,alphaB:c,dotTV:P,dotBV:k,dotTL:N,dotBL:L,dotNV:g,dotNL:p}),E=kk({alphaT:Uh,alphaB:c,dotNH:v,dotTH:B,dotBH:q})}else S=qw({alpha:c,dotNL:p,dotNV:g}),E=Gw({alpha:c,dotNH:v});return T.mul(S).mul(E)}),Uk=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let os=null;const zA=re(({roughness:n,dotNV:e})=>{os===null&&(os=new Wx(Uk,16,16,Qs,or),os.name="DFG_LUT",os.minFilter=Xi,os.magFilter=Xi,os.wrapS=SA,os.wrapT=SA,os.generateMipmaps=!1,os.needsUpdate=!0);const t=we(n,e);return Nt(os,t).rg}),qk=re(({lightDirection:n,f0:e,f90:t,roughness:r,f:i,USE_IRIDESCENCE:s,USE_ANISOTROPY:o})=>{const a=q2({lightDirection:n,f0:e,f90:t,roughness:r,f:i,USE_IRIDESCENCE:s,USE_ANISOTROPY:o}),c=Rt.dot(n).clamp(),f=Rt.dot(Yt).clamp(),p=zA({roughness:r,dotNV:f}),g=zA({roughness:r,dotNV:c}),v=e.mul(p.x).add(t.mul(p.y)),x=e.mul(g.x).add(t.mul(g.y)),T=p.x.add(p.y),S=g.x.add(g.y),E=z(1).sub(T),N=z(1).sub(S),P=e.add(e.oneMinus().mul(.047619)),B=v.mul(x).mul(P).div(z(1).sub(E.mul(N).mul(P).mul(P)).add(Z1)),L=E.mul(N),k=B.mul(L);return a.add(k)}),Vw=re(n=>{const{dotNV:e,specularColor:t,specularF90:r,roughness:i}=n,s=zA({dotNV:e,roughness:i});return t.mul(s.x).add(r.mul(s.y))}),vg=re(({f:n,f90:e,dotVH:t})=>{const r=t.oneMinus().saturate(),i=r.mul(r),s=r.mul(i,i).clamp(0,.9999);return n.sub(Z(e).mul(s)).div(s.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),Gk=re(({roughness:n,dotNH:e})=>{const t=n.pow2(),r=z(1).div(t),s=e.pow2().oneMinus().max(.0078125);return z(2).add(r).mul(s.pow(r.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),Vk=re(({dotNV:n,dotNL:e})=>z(1).div(z(4).mul(e.add(n).sub(e.mul(n))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),zk=re(({lightDirection:n})=>{const e=n.add(Yt).normalize(),t=Rt.dot(n).clamp(),r=Rt.dot(Yt).clamp(),i=Rt.dot(e).clamp(),s=Gk({roughness:Fo,dotNH:i}),o=Vk({dotNV:r,dotNL:t});return Zr.mul(s).mul(o)}),jk=re(({N:n,V:e,roughness:t})=>{const s=.0078125,o=n.dot(e).saturate(),a=we(t,o.oneMinus().sqrt());return a.assign(a.mul(.984375).add(s)),a}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),$k=re(({f:n})=>{const e=n.length();return _n(e.mul(e).add(n.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),Gc=re(({v1:n,v2:e})=>{const t=n.dot(e),r=t.abs().toVar(),i=r.mul(.0145206).add(.4965155).mul(r).add(.8543985).toVar(),s=r.add(4.1616724).mul(r).add(3.417594).toVar(),o=i.div(s),a=t.greaterThan(0).select(o,_n(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(o));return n.cross(e).mul(a)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),wv=re(({N:n,V:e,P:t,mInv:r,p0:i,p1:s,p2:o,p3:a})=>{const c=s.sub(i).toVar(),f=a.sub(i).toVar(),p=c.cross(f),g=Z().toVar();return ze(p.dot(t.sub(i)).greaterThanEqual(0),()=>{const v=e.sub(n.mul(e.dot(n))).normalize(),x=n.cross(v).negate(),T=r.mul(ur(v,x,n).transpose()).toVar(),S=T.mul(i.sub(t)).normalize().toVar(),E=T.mul(s.sub(t)).normalize().toVar(),N=T.mul(o.sub(t)).normalize().toVar(),P=T.mul(a.sub(t)).normalize().toVar(),B=Z(0).toVar();B.addAssign(Gc({v1:S,v2:E})),B.addAssign(Gc({v1:E,v2:N})),B.addAssign(Gc({v1:N,v2:P})),B.addAssign(Gc({v1:P,v2:S})),g.assign(Z($k({f:B})))}),g}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),Ff=1/6,zw=n=>et(Ff,et(n,et(n,n.negate().add(3)).sub(3)).add(1)),bg=n=>et(Ff,et(n,et(n,et(3,n).sub(6))).add(4)),jw=n=>et(Ff,et(n,et(n,et(-3,n).add(3)).add(3)).add(1)),xg=n=>et(Ff,_i(n,3)),Sv=n=>zw(n).add(bg(n)),Ev=n=>jw(n).add(xg(n)),Rv=n=>Ln(-1,bg(n).div(zw(n).add(bg(n)))),Cv=n=>Ln(1,xg(n).div(jw(n).add(xg(n)))),Nv=(n,e,t)=>{const r=n.uvNode,i=et(r,e.zw).add(.5),s=Ts(i),o=Yi(i),a=Sv(o.x),c=Ev(o.x),f=Rv(o.x),p=Cv(o.x),g=Rv(o.y),v=Cv(o.y),x=we(s.x.add(f),s.y.add(g)).sub(.5).mul(e.xy),T=we(s.x.add(p),s.y.add(g)).sub(.5).mul(e.xy),S=we(s.x.add(f),s.y.add(v)).sub(.5).mul(e.xy),E=we(s.x.add(p),s.y.add(v)).sub(.5).mul(e.xy),N=Sv(o.y).mul(Ln(a.mul(n.sample(x).level(t)),c.mul(n.sample(T).level(t)))),P=Ev(o.y).mul(Ln(a.mul(n.sample(S).level(t)),c.mul(n.sample(E).level(t))));return N.add(P)},G2=re(([n,e])=>{const t=we(n.size(X(e))),r=we(n.size(X(e.add(1)))),i=ai(1,t),s=ai(1,r),o=Nv(n,je(i,t),Ts(e)),a=Nv(n,je(s,r),Tf(e));return Yi(e).mix(o,a)}),Hk=re(([n,e])=>{const t=e.mul(_2(n));return G2(n,t)}),Mv=re(([n,e,t,r,i])=>{const s=Z(c2(e.negate(),Mr(n),ai(1,r))),o=Z(ws(i[0].xyz),ws(i[1].xyz),ws(i[2].xyz));return Mr(s).mul(t.mul(o))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),Wk=re(([n,e])=>n.mul(Ki(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),Qk=B2(),Xk=B2(),Pv=re(([n,e,t],{material:r})=>{const s=(r.side===yr?Qk:Xk).sample(n),o=xs(Qa.x).mul(Wk(e,t));return G2(s,o)}),Bv=re(([n,e,t])=>(ze(t.notEqual(0),()=>{const r=xf(e).negate().div(t);return J1(r.negate().mul(n))}),Z(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),Yk=re(([n,e,t,r,i,s,o,a,c,f,p,g,v,x,T])=>{let S,E;if(T){S=je().toVar(),E=Z().toVar();const k=p.sub(1).mul(T.mul(.025)),q=Z(p.sub(k),p,p.add(k));qt({start:0,end:3},({i:I})=>{const U=q.element(I),j=Mv(n,e,g,U,a),J=o.add(j),Q=f.mul(c.mul(je(J,1))),K=we(Q.xy.div(Q.w)).toVar();K.addAssign(1),K.divAssign(2),K.assign(we(K.x,K.y.oneMinus()));const te=Pv(K,t,U);S.element(I).assign(te.element(I)),S.a.addAssign(te.a),E.element(I).assign(r.element(I).mul(Bv(ws(j),v,x).element(I)))}),S.a.divAssign(3)}else{const k=Mv(n,e,g,p,a),q=o.add(k),I=f.mul(c.mul(je(q,1))),U=we(I.xy.div(I.w)).toVar();U.addAssign(1),U.divAssign(2),U.assign(we(U.x,U.y.oneMinus())),S=Pv(U,t,p),E=r.mul(Bv(ws(k),v,x))}const N=E.rgb.mul(S.rgb),P=n.dot(e).clamp(),B=Z(Vw({dotNV:P,specularColor:i,specularF90:s,roughness:t})),L=E.r.add(E.g,E.b).div(3);return je(B.oneMinus().mul(N),S.a.oneMinus().mul(L).oneMinus())}),Kk=ur(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),Zk=n=>{const e=n.sqrt();return Z(1).add(e).div(Z(1).sub(e))},Dv=(n,e)=>n.sub(e).div(n.add(e)).pow2(),Jk=(n,e)=>{const t=n.mul(2*Math.PI*1e-9),r=Z(54856e-17,44201e-17,52481e-17),i=Z(1681e3,1795300,2208400),s=Z(43278e5,93046e5,66121e5),o=z(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let a=r.mul(s.mul(2*Math.PI).sqrt()).mul(i.mul(t).add(e).cos()).mul(t.pow2().negate().mul(s).exp());return a=Z(a.x.add(o),a.y,a.z).div(10685e-11),Kk.mul(a)},Lv=re(({outsideIOR:n,eta2:e,cosTheta1:t,thinFilmThickness:r,baseF0:i})=>{const s=Tt(n,e,Zi(0,.03,r)),a=n.div(s).pow2().mul(t.pow2().oneMinus()).oneMinus();ze(a.lessThan(0),()=>Z(1));const c=a.sqrt(),f=Dv(s,n),p=Au({f0:f,f90:1,dotVH:t}),g=p.oneMinus(),v=s.lessThan(n).select(Math.PI,0),x=z(Math.PI).sub(v),T=Zk(i.clamp(0,.9999)),S=Dv(T,s.toVec3()),E=Au({f0:S,f90:1,dotVH:c}),N=Z(T.x.lessThan(s).select(Math.PI,0),T.y.lessThan(s).select(Math.PI,0),T.z.lessThan(s).select(Math.PI,0)),P=s.mul(r,c,2),B=Z(x).add(N),L=p.mul(E).clamp(1e-5,.9999),k=L.sqrt(),q=g.pow2().mul(E).div(Z(1).sub(L)),U=p.add(q).toVar(),j=q.sub(g).toVar();return qt({start:1,end:2,condition:"<=",name:"m"},({m:J})=>{j.mulAssign(k);const Q=Jk(z(J).mul(P),z(J).mul(B)).mul(2);U.addAssign(j.mul(Q))}),U.max(Z(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),Fu=re(({normal:n,viewDir:e,roughness:t})=>{const r=n.dot(e).saturate(),i=t.mul(t),s=t.add(.1).reciprocal(),o=z(-1.9362).add(t.mul(1.0678)).add(i.mul(.4573)).sub(s.mul(.8469)),a=z(-.6014).add(t.mul(.5538)).sub(i.mul(.467)).sub(s.mul(.1255));return o.mul(r).add(a).exp().saturate()}),tp=Z(.04),np=z(1);class $w extends Of{constructor(e=!1,t=!1,r=!1,i=!1,s=!1,o=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=r,this.anisotropy=i,this.transmission=s,this.dispersion=o,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null,this.iridescenceF0Dielectric=null,this.iridescenceF0Metallic=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=Z().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=Z().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=Z().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=Z().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=Z().toVar("sheenSpecularIndirect")),this.iridescence===!0){const t=Rt.dot(Yt).clamp(),r=Lv({outsideIOR:z(1),eta2:Ih,cosTheta1:t,thinFilmThickness:kh,baseF0:Ko}),i=Lv({outsideIOR:z(1),eta2:Ih,cosTheta1:t,thinFilmThickness:kh,baseF0:kt.rgb});this.iridescenceFresnel=Tt(r,i,Xs),this.iridescenceF0Dielectric=vg({f:r,f90:1,dotVH:t}),this.iridescenceF0Metallic=vg({f:i,f90:1,dotVH:t}),this.iridescenceF0=Tt(this.iridescenceF0Dielectric,this.iridescenceF0Metallic,Xs)}if(this.transmission===!0){const t=Ss,r=h6.sub(Ss).normalize(),i=ra,s=e.context;s.backdrop=Yk(i,r,ps,Ea,Fa,$l,t,vi,Bi,no,_A,$1,W1,H1,this.dispersion?Q1:null),s.backdropAlpha=Gh,kt.a.mulAssign(Tt(1,s.backdrop.a,Gh))}super.start(e)}computeMultiscattering(e,t,r,i,s=null){const o=Rt.dot(Yt).clamp(),a=zA({roughness:ps,dotNV:o}),c=s?vf.mix(i,s):i,f=c.mul(a.x).add(r.mul(a.y)),g=a.x.add(a.y).oneMinus(),v=c.add(c.oneMinus().mul(.047619)),x=f.mul(v).div(g.mul(v).oneMinus());e.addAssign(f),t.addAssign(x.mul(g))}direct({lightDirection:e,lightColor:t,reflectedLight:r}){const s=Rt.dot(e).clamp().mul(t).toVar();if(this.sheen===!0){this.sheenSpecularDirect.addAssign(s.mul(zk({lightDirection:e})));const o=Fu({normal:Rt,viewDir:Yt,roughness:Fo}),a=Fu({normal:Rt,viewDir:e,roughness:Fo}),c=Zr.r.max(Zr.g).max(Zr.b).mul(o.max(a)).oneMinus();s.mulAssign(c)}if(this.clearcoat===!0){const a=Ia.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(a.mul(q2({lightDirection:e,f0:tp,f90:np,roughness:VA,normalView:Ia})))}r.directDiffuse.addAssign(s.mul(Xa({diffuseColor:Ea}))),r.directSpecular.addAssign(s.mul(qk({lightDirection:e,f0:Fa,f90:1,roughness:ps,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:r,halfHeight:i,reflectedLight:s,ltc_1:o,ltc_2:a}){const c=t.add(r).sub(i),f=t.sub(r).sub(i),p=t.sub(r).add(i),g=t.add(r).add(i),v=Rt,x=Yt,T=Mn.toVar(),S=jk({N:v,V:x,roughness:ps}),E=o.sample(S).toVar(),N=a.sample(S).toVar(),P=ur(Z(E.x,0,E.y),Z(0,1,0),Z(E.z,0,E.w)).toVar(),B=Fa.mul(N.x).add(Fa.oneMinus().mul(N.y)).toVar();s.directSpecular.addAssign(e.mul(B).mul(wv({N:v,V:x,P:T,mInv:P,p0:c,p1:f,p2:p,p3:g}))),s.directDiffuse.addAssign(e.mul(Ea).mul(wv({N:v,V:x,P:T,mInv:ur(1,0,0,0,1,0,0,0,1),p0:c,p1:f,p2:p,p3:g})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:r}=e.context,i=t.mul(Xa({diffuseColor:Ea})).toVar();if(this.sheen===!0){const s=Fu({normal:Rt,viewDir:Yt,roughness:Fo}),o=Zr.r.max(Zr.g).max(Zr.b).mul(s).oneMinus();i.mulAssign(o)}r.indirectDiffuse.addAssign(i)}indirectSpecular(e){const{radiance:t,iblIrradiance:r,reflectedLight:i}=e.context;if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(r.mul(Zr,Fu({normal:Rt,viewDir:Yt,roughness:Fo}))),this.clearcoat===!0){const E=Ia.dot(Yt).clamp(),N=Vw({dotNV:E,specularColor:tp,specularF90:np,roughness:VA});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(N))}const s=Z().toVar("singleScatteringDielectric"),o=Z().toVar("multiScatteringDielectric"),a=Z().toVar("singleScatteringMetallic"),c=Z().toVar("multiScatteringMetallic");this.computeMultiscattering(s,o,$l,Ko,this.iridescenceF0Dielectric),this.computeMultiscattering(a,c,$l,kt.rgb,this.iridescenceF0Metallic);const f=Tt(s,a,Xs),p=Tt(o,c,Xs),g=s.add(o),v=Ea.mul(g.oneMinus()),x=r.mul(1/Math.PI),T=t.mul(f).add(p.mul(x)).toVar(),S=v.mul(x).toVar();if(this.sheen===!0){const E=Fu({normal:Rt,viewDir:Yt,roughness:Fo}),N=Zr.r.max(Zr.g).max(Zr.b).mul(E).oneMinus();T.mulAssign(N),S.mulAssign(N)}i.indirectSpecular.addAssign(T),i.indirectDiffuse.addAssign(S)}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:r}=e.context,s=Rt.dot(Yt).clamp().add(t),o=ps.mul(-16).oneMinus().negate().exp2(),a=t.sub(s.pow(o).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),r.indirectDiffuse.mulAssign(t),r.indirectSpecular.mulAssign(a)}finish({context:e}){const{outgoingLight:t}=e;if(this.clearcoat===!0){const r=Ia.dot(Yt).clamp(),i=Au({dotVH:r,f0:tp,f90:np}),s=t.mul(Fh.mul(i).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(Fh));t.assign(s)}if(this.sheen===!0){const r=t.add(this.sheenSpecularDirect,this.sheenSpecularIndirect.mul(1/Math.PI));t.assign(r)}}}const Ov=z(1),Tg=z(-2),Vc=z(.8),rp=z(-1),zc=z(.4),ip=z(2),jc=z(.305),sp=z(3),Fv=z(.21),eU=z(4),Iv=z(4),tU=z(16),nU=re(([n])=>{const e=Z(en(n)).toVar(),t=z(-1).toVar();return ze(e.x.greaterThan(e.z),()=>{ze(e.x.greaterThan(e.y),()=>{t.assign(lr(n.x.greaterThan(0),0,3))}).Else(()=>{t.assign(lr(n.y.greaterThan(0),1,4))})}).Else(()=>{ze(e.z.greaterThan(e.y),()=>{t.assign(lr(n.z.greaterThan(0),2,5))}).Else(()=>{t.assign(lr(n.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),rU=re(([n,e])=>{const t=we().toVar();return ze(e.equal(0),()=>{t.assign(we(n.z,n.y).div(en(n.x)))}).ElseIf(e.equal(1),()=>{t.assign(we(n.x.negate(),n.z.negate()).div(en(n.y)))}).ElseIf(e.equal(2),()=>{t.assign(we(n.x.negate(),n.y).div(en(n.z)))}).ElseIf(e.equal(3),()=>{t.assign(we(n.z.negate(),n.y).div(en(n.x)))}).ElseIf(e.equal(4),()=>{t.assign(we(n.x.negate(),n.z).div(en(n.y)))}).Else(()=>{t.assign(we(n.x,n.y).div(en(n.z)))}),et(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),iU=re(([n])=>{const e=z(0).toVar();return ze(n.greaterThanEqual(Vc),()=>{e.assign(Ov.sub(n).mul(rp.sub(Tg)).div(Ov.sub(Vc)).add(Tg))}).ElseIf(n.greaterThanEqual(zc),()=>{e.assign(Vc.sub(n).mul(ip.sub(rp)).div(Vc.sub(zc)).add(rp))}).ElseIf(n.greaterThanEqual(jc),()=>{e.assign(zc.sub(n).mul(sp.sub(ip)).div(zc.sub(jc)).add(ip))}).ElseIf(n.greaterThanEqual(Fv),()=>{e.assign(jc.sub(n).mul(eU.sub(sp)).div(jc.sub(Fv)).add(sp))}).Else(()=>{e.assign(z(-2).mul(xs(et(1.16,n))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),Hw=re(([n,e])=>{const t=n.toVar();t.assign(et(2,t).sub(1));const r=Z(t,1).toVar();return ze(e.equal(0),()=>{r.assign(r.zyx)}).ElseIf(e.equal(1),()=>{r.assign(r.xzy),r.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{r.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{r.assign(r.zyx),r.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{r.assign(r.xzy),r.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{r.z.mulAssign(-1)}),r}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),Ww=re(([n,e,t,r,i,s])=>{const o=z(t),a=Z(e),c=Ki(iU(o),Tg,s),f=Yi(c),p=Ts(c),g=Z(jA(n,a,p,r,i,s)).toVar();return ze(f.notEqual(0),()=>{const v=Z(jA(n,a,p.add(1),r,i,s)).toVar();g.assign(Tt(g,v,f))}),g}),jA=re(([n,e,t,r,i,s])=>{const o=z(t).toVar(),a=Z(e),c=z(nU(a)).toVar(),f=z(_n(Iv.sub(o),0)).toVar();o.assign(_n(o,Iv));const p=z(lu(o)).toVar(),g=we(rU(a,c).mul(p.sub(2)).add(1)).toVar();return ze(c.greaterThan(2),()=>{g.y.addAssign(p),c.subAssign(3)}),g.x.addAssign(c.mul(p)),g.x.addAssign(f.mul(et(3,tU))),g.y.addAssign(et(4,lu(s).sub(p))),g.x.mulAssign(r),g.y.mulAssign(i),n.sample(g).grad(we(),we())}),op=re(({envMap:n,mipInt:e,outputDirection:t,theta:r,axis:i,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:a})=>{const c=Ui(r),f=t.mul(c).add(i.cross(t).mul(Cr(r))).add(i.mul(i.dot(t).mul(c.oneMinus())));return jA(n,f,e,s,o,a)}),Qw=re(({n,latitudinal:e,poleAxis:t,outputDirection:r,weights:i,samples:s,dTheta:o,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:f,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:g})=>{const v=Z(lr(e,t,uo(t,r))).toVar();ze(v.equal(Z(0)),()=>{v.assign(Z(r.z,0,r.x.negate()))}),v.assign(Mr(v));const x=Z().toVar();return x.addAssign(i.element(0).mul(op({theta:0,axis:v,outputDirection:r,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:f,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:g}))),qt({start:X(1),end:n},({i:T})=>{ze(T.greaterThanEqual(s),()=>{Tw()});const S=z(o.mul(z(T))).toVar();x.addAssign(i.element(T).mul(op({theta:S.mul(-1),axis:v,outputDirection:r,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:f,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:g}))),x.addAssign(i.element(T).mul(op({theta:S,axis:v,outputDirection:r,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:f,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:g})))}),je(x,1)}),sU=re(([n])=>{const e=ye(n).toVar();return e.assign(e.shiftLeft(ye(16)).bitOr(e.shiftRight(ye(16)))),e.assign(e.bitAnd(ye(1431655765)).shiftLeft(ye(1)).bitOr(e.bitAnd(ye(2863311530)).shiftRight(ye(1)))),e.assign(e.bitAnd(ye(858993459)).shiftLeft(ye(2)).bitOr(e.bitAnd(ye(3435973836)).shiftRight(ye(2)))),e.assign(e.bitAnd(ye(252645135)).shiftLeft(ye(4)).bitOr(e.bitAnd(ye(4042322160)).shiftRight(ye(4)))),e.assign(e.bitAnd(ye(16711935)).shiftLeft(ye(8)).bitOr(e.bitAnd(ye(4278255360)).shiftRight(ye(8)))),z(e).mul(23283064365386963e-26)}),oU=re(([n,e])=>we(z(n).div(z(e)),sU(n))),aU=re(([n,e,t])=>{const r=Z(e).toVar(),i=z(t),s=i.mul(i).toVar(),o=Mr(Z(s.mul(r.x),s.mul(r.y),r.z)).toVar(),a=o.x.mul(o.x).add(o.y.mul(o.y)),c=lr(a.greaterThan(0),Z(o.y.negate(),o.x,0).div(gr(a)),Z(1,0,0)).toVar(),f=uo(o,c).toVar(),p=gr(n.x),g=et(2,3.14159265359).mul(n.y),v=p.mul(Ui(g)).toVar(),x=p.mul(Cr(g)).toVar(),T=et(.5,o.z.add(1));x.assign(T.oneMinus().mul(gr(v.mul(v).oneMinus())).add(T.mul(x)));const S=c.mul(v).add(f.mul(x)).add(o.mul(gr(_n(0,v.mul(v).add(x.mul(x)).oneMinus()))));return Mr(Z(s.mul(S.x),s.mul(S.y),_n(0,S.z)))}),Xw=re(({roughness:n,mipInt:e,envMap:t,N_immutable:r,GGX_SAMPLES:i,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:a})=>{const c=Z(r).toVar(),f=Z(0).toVar(),p=z(0).toVar();return ze(n.lessThan(.001),()=>{f.assign(jA(t,c,e,s,o,a))}).Else(()=>{const g=lr(en(c.z).lessThan(.999),Z(0,0,1),Z(1,0,0)),v=Mr(uo(g,c)).toVar(),x=uo(c,v).toVar();qt({start:ye(0),end:i},({i:T})=>{const S=oU(T,i),E=aU(S,Z(0,0,1),n),N=Mr(v.mul(E.x).add(x.mul(E.y)).add(c.mul(E.z))),P=Mr(N.mul(Ri(c,N).mul(2)).sub(c)),B=_n(Ri(c,P),0);ze(B.greaterThan(0),()=>{const L=jA(t,P,e,s,o,a);f.addAssign(L.mul(B)),p.addAssign(B)})}),ze(p.greaterThan(0),()=>{f.assign(f.div(p))})}),je(f,1)}),Vo=4,kv=[.125,.215,.35,.446,.526,.582],Ra=20,lU=512,Iu=new Yg(-1,1,1,-1,0,1),uU=new wA(90,1),Uv=new jn;let ap=null,lp=0,up=0;const AU=new ge,Hh=new WeakMap,cU=[3,1,5,0,4,2],Ap=Hw(Ht(),co("faceIndex")).normalize(),If=Z(Ap.x,Ap.y,Ap.z);class hU{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._ggxMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,r=.1,i=100,s={}){const{size:o=256,position:a=AU,renderTarget:c=null}=s;if(this._setSize(o),this._hasInitialized===!1){De('PMREMGenerator: ".fromScene()" called before the backend is initialized. Try using "await renderer.init()" instead.');const p=c||this._allocateTarget();return s.renderTarget=p,this.fromSceneAsync(e,t,r,i,s),p}ap=this._renderer.getRenderTarget(),lp=this._renderer.getActiveCubeFace(),up=this._renderer.getActiveMipmapLevel();const f=c||this._allocateTarget();return f.depthBuffer=!0,this._init(f),this._sceneToCubeUV(e,r,i,f,a),t>0&&this._blur(f,0,0,t),this._applyPMREM(f),this._cleanup(f),f}async fromSceneAsync(e,t=0,r=.1,i=100,s={}){return fn('PMREMGenerator: ".fromSceneAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this.fromScene(e,t,r,i,s)}fromEquirectangular(e,t=null){if(this._hasInitialized===!1){De('PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using "await renderer.init()" instead.'),this._setSizeFromTexture(e);const r=t||this._allocateTarget();return this.fromEquirectangularAsync(e,r),r}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return fn('PMREMGenerator: ".fromEquirectangularAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(this._hasInitialized===!1){De("PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const r=t||this._allocateTarget();return this.fromCubemapAsync(e,t),r}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return fn('PMREMGenerator: ".fromCubemapAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Gv(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Vv(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===Z0||e.mapping===J0?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(ap,lp,up),e.scissorTest=!1,vl(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),ap=this._renderer.getRenderTarget(),lp=this._renderer.getActiveCubeFace(),up=this._renderer.getActiveMipmapLevel();const r=t||this._allocateTarget();return this._init(r),this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTarget(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize;return qv(e,t)}_init(e){if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e.width||this._pingPongRenderTarget.height!==e.height){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=qv(e.width,e.height);const{_lodMax:t}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=fU(t)),this._blurMaterial=dU(t,e.width,e.height),this._ggxMaterial=pU(t,e.width,e.height)}}async _compileMaterial(e){const t=new gn(new Hr,e);await this._renderer.compile(t,Iu)}_sceneToCubeUV(e,t,r,i,s){const o=uU;o.near=t,o.far=r;const a=[1,1,1,1,-1,1],c=[1,-1,1,-1,1,-1],f=this._renderer,p=f.autoClear;f.getClearColor(Uv),f.autoClear=!1,this._backgroundBox===null&&(this._backgroundBox=new gn(new a1,new ds({name:"PMREM.Background",side:yr,depthWrite:!1,depthTest:!1})));const g=this._backgroundBox,v=g.material;let x=!1;const T=e.background;T?T.isColor&&(v.color.copy(T),e.background=null,x=!0):(v.color.copy(Uv),x=!0),f.setRenderTarget(i),f.clear(),x&&f.render(g,o);for(let S=0;S<6;S++){const E=S%3;E===0?(o.up.set(0,a[S],0),o.position.set(s.x,s.y,s.z),o.lookAt(s.x+c[S],s.y,s.z)):E===1?(o.up.set(0,0,a[S]),o.position.set(s.x,s.y,s.z),o.lookAt(s.x,s.y+c[S],s.z)):(o.up.set(0,a[S],0),o.position.set(s.x,s.y,s.z),o.lookAt(s.x,s.y,s.z+c[S]));const N=this._cubeSize;vl(i,E*N,S>2?N:0,N,N),f.render(e,o)}f.autoClear=p,e.background=T}_textureToCubeUV(e,t){const r=this._renderer,i=e.mapping===Z0||e.mapping===J0;i?this._cubemapMaterial===null&&(this._cubemapMaterial=Gv(e)):this._equirectMaterial===null&&(this._equirectMaterial=Vv(e));const s=i?this._cubemapMaterial:this._equirectMaterial;s.fragmentNode.value=e;const o=this._lodMeshes[0];o.material=s;const a=this._cubeSize;vl(t,0,0,3*a,2*a),r.setRenderTarget(t),r.render(o,Iu)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;const i=this._lodMeshes.length;for(let s=1;s<i;s++)this._applyGGXFilter(e,s-1,s);t.autoClear=r}_applyGGXFilter(e,t,r){const i=this._renderer,s=this._pingPongRenderTarget,o=this._ggxMaterial,a=this._lodMeshes[r];a.material=o;const c=Hh.get(o),f=r/(this._lodMeshes.length-1),p=t/(this._lodMeshes.length-1),g=Math.sqrt(f*f-p*p),v=0+f*1.25,x=g*v,{_lodMax:T}=this,S=this._sizeLods[r],E=3*S*(r>T-Vo?r-T+Vo:0),N=4*(this._cubeSize-S);e.texture.frame=(e.texture.frame||0)+1,c.envMap.value=e.texture,c.roughness.value=x,c.mipInt.value=T-t,vl(s,E,N,3*S,2*S),i.setRenderTarget(s),i.render(a,Iu),s.texture.frame=(s.texture.frame||0)+1,c.envMap.value=s.texture,c.roughness.value=0,c.mipInt.value=T-r,vl(e,E,N,3*S,2*S),i.setRenderTarget(e),i.render(a,Iu)}_blur(e,t,r,i,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,r,i,"latitudinal",s),this._halfBlur(o,e,r,r,i,"longitudinal",s)}_halfBlur(e,t,r,i,s,o,a){const c=this._renderer,f=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&Be("blur direction must be either latitudinal or longitudinal!");const p=3,g=this._lodMeshes[i];g.material=f;const v=Hh.get(f),x=this._sizeLods[r]-1,T=isFinite(s)?Math.PI/(2*x):2*Math.PI/(2*Ra-1),S=s/T,E=isFinite(s)?1+Math.floor(p*S):Ra;E>Ra&&De(`sigmaRadians, ${s}, is too large and will clip, as it requested ${E} samples when the maximum is set to ${Ra}`);const N=[];let P=0;for(let I=0;I<Ra;++I){const U=I/S,j=Math.exp(-U*U/2);N.push(j),I===0?P+=j:I<E&&(P+=2*j)}for(let I=0;I<N.length;I++)N[I]=N[I]/P;e.texture.frame=(e.texture.frame||0)+1,v.envMap.value=e.texture,v.samples.value=E,v.weights.array=N,v.latitudinal.value=o==="latitudinal"?1:0,a&&(v.poleAxis.value=a);const{_lodMax:B}=this;v.dTheta.value=T,v.mipInt.value=B-r;const L=this._sizeLods[i],k=3*L*(i>B-Vo?i-B+Vo:0),q=4*(this._cubeSize-L);vl(t,k,q,3*L,2*L),c.setRenderTarget(t),c.render(g,Iu)}}function fU(n){const e=[],t=[],r=[];let i=n;const s=n-Vo+1+kv.length;for(let o=0;o<s;o++){const a=Math.pow(2,i);e.push(a);let c=1/a;o>n-Vo?c=kv[o-n+Vo-1]:o===0&&(c=0),t.push(c);const f=1/(a-2),p=-f,g=1+f,v=[p,p,g,p,g,g,p,p,g,g,p,g],x=6,T=6,S=3,E=2,N=1,P=new Float32Array(S*T*x),B=new Float32Array(E*T*x),L=new Float32Array(N*T*x);for(let q=0;q<x;q++){const I=q%3*2/3-1,U=q>2?0:-1,j=[I,U,0,I+2/3,U,0,I+2/3,U+1,0,I,U,0,I+2/3,U+1,0,I,U+1,0],J=cU[q];P.set(j,S*T*J),B.set(v,E*T*J);const Q=[J,J,J,J,J,J];L.set(Q,N*T*J)}const k=new Hr;k.setAttribute("position",new Hi(P,S)),k.setAttribute("uv",new Hi(B,E)),k.setAttribute("faceIndex",new Hi(L,N)),r.push(new gn(k,null)),i>Vo&&i--}return{lodMeshes:r,sizeLods:e,sigmas:t}}function qv(n,e){const t={magFilter:Xi,minFilter:Xi,generateMipmaps:!1,type:or,format:zi,colorSpace:Jx},r=new ea(n,e,t);return r.texture.mapping=Wp,r.texture.name="PMREM.cubeUv",r.texture.isPMREMTexture=!0,r.scissorTest=!0,r}function vl(n,e,t,r,i){n.viewport.set(e,t,r,i),n.scissor.set(e,t,r,i)}function kf(n){const e=new Rn;return e.depthTest=!1,e.depthWrite=!1,e.blending=Zl,e.name=`PMREM_${n}`,e}function dU(n,e,t){const r=mr(new Array(Ra).fill(0)),i=Ve(new ge(0,1,0)),s=Ve(0),o=z(Ra),a=Ve(0),c=Ve(1),f=Nt(),p=Ve(0),g=z(1/e),v=z(1/t),x=z(n),T={n:o,latitudinal:a,weights:r,poleAxis:i,outputDirection:If,dTheta:s,samples:c,envMap:f,mipInt:p,CUBEUV_TEXEL_WIDTH:g,CUBEUV_TEXEL_HEIGHT:v,CUBEUV_MAX_MIP:x},S=kf("blur");return S.fragmentNode=Qw({...T,latitudinal:a.equal(1)}),Hh.set(S,T),S}function pU(n,e,t){const r=Nt(),i=Ve(0),s=Ve(0),o=z(1/e),a=z(1/t),c=z(n),f={envMap:r,roughness:i,mipInt:s,CUBEUV_TEXEL_WIDTH:o,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:c},p=kf("ggx");return p.fragmentNode=Xw({...f,N_immutable:If,GGX_SAMPLES:ye(lU)}),Hh.set(p,f),p}function Gv(n){const e=kf("cubemap");return e.fragmentNode=Nr(n,If),e}function Vv(n){const e=kf("equirect");return e.fragmentNode=Nt(n,I2(If),0),e}const zv=new WeakMap;function mU(n){const e=Math.log2(n)-2,t=1/n;return{texelWidth:1/(3*Math.max(Math.pow(2,e),112)),texelHeight:t,maxMip:e}}function gU(n,e,t){const r=yU(e);let i=r.get(n);if((i!==void 0?i.pmremVersion:-1)!==n.pmremVersion){const o=n.image;if(n.isCubeTexture)if(vU(o))i=t.fromCubemap(n,i);else return null;else if(bU(o))i=t.fromEquirectangular(n,i);else return null;i.pmremVersion=n.pmremVersion,r.set(n,i)}return i.texture}function yU(n){let e=zv.get(n);return e===void 0&&(e=new WeakMap,zv.set(n,e)),e}class _U extends vn{static get type(){return"PMREMNode"}constructor(e,t=null,r=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=r,this._generator=null;const i=new e1;i.isRenderTargetTexture=!0,this._texture=Nt(i),this._width=Ve(0),this._height=Ve(0),this._maxMip=Ve(0),this.updateBeforeType=ot.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=mU(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const r=t?t.pmremVersion:-1,i=this._value;r!==i.pmremVersion&&(i.isPMREMTexture===!0?t=i:t=gU(i,e.renderer,this._generator),t!==null&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){this._generator===null&&(this._generator=new hU(e.renderer)),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this,e)),t=R2.mul(Z(t.x,t.y.negate(),t.z));let r=this.levelNode;return r===null&&e.context.getTextureLevel&&(r=e.context.getTextureLevel(this)),Ww(this._texture,t,r,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}}function vU(n){if(n==null)return!1;let e=0;const t=6;for(let r=0;r<t;r++)n[r]!==void 0&&e++;return e===t}function bU(n){return n==null?!1:n.height>0}const V2=tt(_U).setParameterLength(1,3),jv=new WeakMap;class xU extends gu{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const g=r.isTextureNode?r.value:t[r.property];let v=jv.get(g);v===void 0&&(v=V2(g),jv.set(g,v)),r=v}const s=t.useAnisotropy===!0||t.anisotropy>0?F6:Rt,o=r.context($v(ps,s)).mul(k0),a=r.context(TU(ra)).mul(Math.PI).mul(k0),c=Ql(o),f=Ql(a);e.context.radiance.addAssign(c),e.context.iblIrradiance.addAssign(f);const p=e.context.lightingModel.clearcoatRadiance;if(p){const g=r.context($v(VA,Ia)).mul(k0),v=Ql(g);p.addAssign(v)}}}const $v=(n,e)=>{let t=null;return{getUV:()=>(t===null&&(t=Yt.negate().reflect(e),t=u2(n).mix(t,e).normalize(),t=t.transformDirection(Bi)),t),getTextureLevel:()=>n}},TU=n=>({getUV:()=>n,getTextureLevel:()=>z(1)}),wU=new aC;class Yw extends Rn{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(wU),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new xU(t):null}setupLightingModel(){return new $w}setupSpecular(){const e=Tt(Z(.04),kt.rgb,Xs);Ko.assign(Z(.04)),Fa.assign(e),$l.assign(1)}setupVariants(){const e=this.metalnessNode?z(this.metalnessNode):$6;Xs.assign(e);let t=this.roughnessNode?z(this.roughnessNode):j6;t=U2({roughness:t}),ps.assign(t),this.setupSpecular(),Ea.assign(kt.rgb.mul(e.oneMinus()))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const SU=new lC;class EU extends Yw{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(SU),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?z(this.iorNode):sw;_A.assign(e),Ko.assign(zr(l2(_A.sub(1).div(_A.add(1))).mul(z6),Z(1)).mul(_g)),Fa.assign(Tt(Ko,kt.rgb,Xs)),$l.assign(Tt(_g,1,Xs))}setupLightingModel(){return new $w(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?z(this.clearcoatNode):W6,r=this.clearcoatRoughnessNode?z(this.clearcoatRoughnessNode):Q6;Fh.assign(t),VA.assign(U2({roughness:r}))}if(this.useSheen){const t=this.sheenNode?Z(this.sheenNode):K6,r=this.sheenRoughnessNode?z(this.sheenRoughnessNode):Z6;Zr.assign(t),Fo.assign(r)}if(this.useIridescence){const t=this.iridescenceNode?z(this.iridescenceNode):ew,r=this.iridescenceIORNode?z(this.iridescenceIORNode):tw,i=this.iridescenceThicknessNode?z(this.iridescenceThicknessNode):nw;vf.assign(t),Ih.assign(r),kh.assign(i)}if(this.useAnisotropy){const t=(this.anisotropyNode?we(this.anisotropyNode):J6).toVar();Lo.assign(t.length()),ze(Lo.equal(0),()=>{t.assign(we(1,0))}).Else(()=>{t.divAssign(we(Lo)),Lo.assign(Lo.saturate())}),Uh.assign(Lo.pow2().mix(ps.pow2(),1)),yA.assign(ka[0].mul(t.x).add(ka[1].mul(t.y))),za.assign(ka[1].mul(t.x).sub(ka[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?z(this.transmissionNode):rw,r=this.thicknessNode?z(this.thicknessNode):iw,i=this.attenuationDistanceNode?z(this.attenuationDistanceNode):ow,s=this.attenuationColorNode?Z(this.attenuationColorNode):aw;if(Gh.assign(t),$1.assign(r),H1.assign(i),W1.assign(s),this.useDispersion){const o=this.dispersionNode?z(this.dispersionNode):fw;Q1.assign(o)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?Z(this.clearcoatNormalNode):X6}setup(e){e.context.setupClearcoatNormal=()=>Wl(this.setupClearcoatNormal(e),"NORMAL","vec3"),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const RU=re(({normal:n,lightDirection:e,builder:t})=>{const r=n.dot(e),i=we(r.mul(.5).add(.5),0);if(t.material.gradientMap){const s=Hs("gradientMap","texture").context({getUV:()=>i});return Z(s.r)}else{const s=i.fwidth().mul(.5);return Tt(Z(.7),Z(1),Zi(z(.7).sub(s.x),z(.7).add(s.x),i.x))}});class CU extends Of{direct({lightDirection:e,lightColor:t,reflectedLight:r},i){const s=RU({normal:Nf,lightDirection:e,builder:i}).mul(t);r.directDiffuse.addAssign(s.mul(Xa({diffuseColor:kt.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:r,reflectedLight:i}=e.context;i.indirectDiffuse.addAssign(r.mul(Xa({diffuseColor:kt}))),i.indirectDiffuse.mulAssign(t)}}const NU=new uC;class MU extends Rn{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(NU),this.setValues(e)}setupLightingModel(){return new CU}}const Kw=re(()=>{const n=Z(Yt.z,0,Yt.x.negate()).normalize(),e=Yt.cross(n);return we(n.dot(Rt),e.dot(Rt)).mul(.495).add(.5)}).once(["NORMAL","VERTEX"])().toVar("matcapUV"),PU=new cC;class BU extends Rn{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(PU),this.setValues(e)}setupVariants(e){const t=Kw;let r;e.material.matcap?r=Hs("matcap","texture").context({getUV:()=>t}):r=Z(Tt(.2,.8,t.y)),kt.rgb.mulAssign(r.rgb)}}class DU extends vn{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:r}=this;if(this.getNodeType(e)==="vec2"){const s=t.cos(),o=t.sin();return _f(s,o,o.negate(),s).mul(r)}else{const s=t,o=Wo(je(1,0,0,0),je(0,Ui(s.x),Cr(s.x).negate(),0),je(0,Cr(s.x),Ui(s.x),0),je(0,0,0,1)),a=Wo(je(Ui(s.y),0,Cr(s.y),0),je(0,1,0,0),je(Cr(s.y).negate(),0,Ui(s.y),0),je(0,0,0,1)),c=Wo(je(Ui(s.z),Cr(s.z).negate(),0,0),je(Cr(s.z),Ui(s.z),0,0),je(0,0,1,0),je(0,0,0,1));return o.mul(a).mul(c).mul(je(r,1)).xyz}}}const oc=tt(DU).setParameterLength(2),LU=new fC;class Zw extends Rn{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(LU),this.setValues(e)}setupPositionView(e){const{object:t,camera:r}=e,{positionNode:i,rotationNode:s,scaleNode:o,sizeAttenuation:a}=this,c=na.mul(Z(i||0));let f=we(vi[0].xyz.length(),vi[1].xyz.length());o!==null&&(f=f.mul(we(o))),r.isPerspectiveCamera&&a===!1&&(f=f.mul(c.z.negate()));let p=ic.xy;if(t.center&&t.center.isVector2===!0){const x=CF("center","vec2",t);p=p.sub(x.sub(.5))}p=p.mul(f);const g=z(s||Y6),v=oc(p,g);return je(c.xy.add(v),c.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const OU=new Xx,FU=new _t;class IU extends Zw{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(OU),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return na.mul(Z(e||pn)).xyz}setupVertexSprite(e){const{material:t,camera:r}=e,{rotationNode:i,scaleNode:s,sizeNode:o,sizeAttenuation:a}=this;let c=super.setupVertex(e);if(t.isNodeMaterial!==!0)return c;let f=o!==null?we(o):hw;f=f.mul(A6),r.isPerspectiveCamera&&a===!0&&(f=f.mul(kU.div(Mn.z.negate()))),s&&s.isNode&&(f=f.mul(we(s)));let p=ic.xy;if(i&&i.isNode){const g=z(i);p=oc(p,g)}return p=p.mul(f),p=p.div(T2.div(2)),p=p.mul(c.w),c=c.add(je(p,0,0)),c}setupVertex(e){return e.object.isPoints?super.setupVertex(e):this.setupVertexSprite(e)}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}const kU=Ve(1).onFrameUpdate(function({renderer:n}){const e=n.getSize(FU);this.value=.5*e.y});class UU extends Of{constructor(){super(),this.shadowNode=z(1).toVar("shadowMask")}direct({lightNode:e}){e.shadowNode!==null&&this.shadowNode.mulAssign(e.shadowNode)}finish({context:e}){kt.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(kt.rgb)}}const qU=new dC;class GU extends Rn{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(qU),this.setValues(e)}setupLightingModel(){return new UU}}Js("vec3");Js("vec3");Js("vec3");class VU{constructor(e,t,r){this.renderer=e,this.nodes=t,this.info=r,this._context=typeof self<"u"?self:null,this._animationLoop=null,this._requestId=null}start(){const e=(t,r)=>{this._requestId=this._context.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this.renderer._inspector.begin(),this._animationLoop!==null&&this._animationLoop(t,r),this.renderer._inspector.finish()};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}}class Ji{constructor(){this.weakMaps={}}_getWeakMap(e){const t=e.length;let r=this.weakMaps[t];return r===void 0&&(r=new WeakMap,this.weakMaps[t]=r),r}get(e){let t=this._getWeakMap(e);for(let r=0;r<e.length-1;r++)if(t=t.get(e[r]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let r=this._getWeakMap(e);for(let i=0;i<e.length-1;i++){const s=e[i];r.has(s)===!1&&r.set(s,new WeakMap),r=r.get(s)}return r.set(e[e.length-1],t),this}delete(e){let t=this._getWeakMap(e);for(let r=0;r<e.length-1;r++)if(t=t.get(e[r]),t===void 0)return!1;return t.delete(e[e.length-1])}}let zU=0;function jU(n){const e=Object.keys(n);let t=Object.getPrototypeOf(n);for(;t;){const r=Object.getOwnPropertyDescriptors(t);for(const i in r)if(r[i]!==void 0){const s=r[i];s&&typeof s.get=="function"&&e.push(i)}t=Object.getPrototypeOf(t)}return e}class $U{constructor(e,t,r,i,s,o,a,c,f,p){this.id=zU++,this._nodes=e,this._geometries=t,this.renderer=r,this.object=i,this.material=s,this.scene=o,this.camera=a,this.lightsNode=c,this.context=f,this.geometry=i.geometry,this.version=s.version,this.drawRange=null,this.attributes=null,this.attributesId=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=p,this.clippingContextCacheKey=p!==null?p.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.onGeometryDispose=()=>{this.attributes=null,this.attributesId=null},this.material.addEventListener("dispose",this.onMaterialDispose),this.geometry.addEventListener("dispose",this.onGeometryDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getIndirectOffset(){return this._geometries.getIndirectOffset(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null,this.attributesId=null}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,r=[],i=new Set,s={};for(const o of e){let a;if(o.node&&o.node.attribute?a=o.node.attribute:(a=t.getAttribute(o.name),s[o.name]=a.version),a===void 0)continue;r.push(a);const c=a.isInterleavedBufferAttribute?a.data:a;i.add(c)}return this.attributes=r,this.attributesId=s,this.vertexBuffers=Array.from(i.values()),r}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:r,group:i,drawRange:s}=this,o=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),a=this.getIndex(),c=a!==null;let f=1;if(r.isInstancedBufferGeometry===!0?f=r.instanceCount:e.count!==void 0&&(f=Math.max(0,e.count)),f===0)return null;if(o.instanceCount=f,e.isBatchedMesh===!0)return o;let p=1;t.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(p=2);let g=s.start*p,v=(s.start+s.count)*p;i!==null&&(g=Math.max(g,i.start*p),v=Math.min(v,(i.start+i.count)*p));const x=r.attributes.position;let T=1/0;c?T=a.count:x!=null&&(T=x.count),g=Math.max(g,0),v=Math.min(v,T);const S=v-g;return S<0||S===1/0?null:(o.vertexCount=S,o.firstVertex=g,o)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const r of Object.keys(e.attributes).sort()){const i=e.attributes[r];t+=r+",",i.data&&(t+=i.data.stride+","),i.offset&&(t+=i.offset+","),i.itemSize&&(t+=i.itemSize+","),i.normalized&&(t+="n,")}for(const r of Object.keys(e.morphAttributes).sort()){const i=e.morphAttributes[r];t+="morph-"+r+",";for(let s=0,o=i.length;s<o;s++){const a=i[s];t+=a.id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t,renderer:r}=this;let i=t.customProgramCacheKey();for(const s of jU(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(s))continue;const o=t[s];let a;if(o!==null){const c=typeof o;c==="number"?a=o!==0?"1":"0":c==="object"?(a="{",o.isTexture&&(a+=o.mapping,r.backend.isWebGPUBackend===!0&&(a+=o.magFilter,a+=o.minFilter,a+=o.wrapS,a+=o.wrapT,a+=o.wrapR)),a+="}"):a=String(o)}else a=String(o);i+=a+","}return i+=this.clippingContextCacheKey+",",e.geometry&&(i+=this.getGeometryCacheKey()),e.skeleton&&(i+=e.skeleton.bones.length+","),e.isBatchedMesh&&(i+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(i+=e._colorsTexture.uuid+",")),(e.isInstancedMesh||e.count>1||Array.isArray(e.morphTargetInfluences))&&(i+=e.uuid+","),i+=this.context.id+",",i+=e.receiveShadow+",",ec(i)}get needsGeometryUpdate(){if(this.geometry.id!==this.object.geometry.id)return!0;if(this.attributes!==null){const e=this.attributesId;for(const t in e){const r=this.geometry.getAttribute(t);if(r===void 0||e[t]!==r.id)return!0}}return!1}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return this.material.isShadowPassMaterial!==!0&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=mA(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=mA(e,1)),e=mA(e,this.camera.id,this.renderer.contextNode.id,this.renderer.contextNode.version),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.geometry.removeEventListener("dispose",this.onGeometryDispose),this.onDispose()}}const ma=[];class HU{constructor(e,t,r,i,s,o){this.renderer=e,this.nodes=t,this.geometries=r,this.pipelines=i,this.bindings=s,this.info=o,this.chainMaps={}}get(e,t,r,i,s,o,a,c){const f=this.getChainMap(c);ma[0]=e,ma[1]=t,ma[2]=o,ma[3]=s;let p=f.get(ma);return p===void 0?(p=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,r,i,s,o,a,c),f.set(ma,p)):(p.updateClipping(a),p.needsGeometryUpdate&&p.setGeometry(e.geometry),(p.version!==t.version||p.needsUpdate)&&(p.initialCacheKey!==p.getCacheKey()?(p.dispose(),p=this.get(e,t,r,i,s,o,a,c)):p.version=t.version)),ma.length=0,p}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new Ji)}dispose(){this.chainMaps={}}createRenderObject(e,t,r,i,s,o,a,c,f,p,g){const v=this.getChainMap(g),x=new $U(e,t,r,i,s,o,a,c,f,p);return x.onDispose=()=>{this.pipelines.delete(x),this.bindings.deleteForRender(x),this.nodes.delete(x),v.delete(x.getChainArray())},x}}class ia{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const bi={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},Uo=16,WU=211,QU=212;class XU extends ia{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return t!==null&&this.backend.destroyAttribute(e),t}update(e,t){const r=this.get(e);if(r.version===void 0)t===bi.VERTEX?this.backend.createAttribute(e):t===bi.INDEX?this.backend.createIndexAttribute(e):t===bi.STORAGE?this.backend.createStorageAttribute(e):t===bi.INDIRECT&&this.backend.createIndirectStorageAttribute(e),r.version=this._getBufferAttribute(e).version;else{const i=this._getBufferAttribute(e);(r.version<i.version||i.usage===Da)&&(this.backend.updateAttribute(e),r.version=i.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function Jw(n){return n.index!==null?n.index.version:n.attributes.position.version}function Hv(n){const e=[],t=n.index,r=n.attributes.position;if(t!==null){const s=t.array;for(let o=0,a=s.length;o<a;o+=3){const c=s[o+0],f=s[o+1],p=s[o+2];e.push(c,f,f,p,p,c)}}else{const s=r.array;for(let o=0,a=s.length/3-1;o<a;o+=3){const c=o+0,f=o+1,p=o+2;e.push(c,f,f,p,p,c)}}const i=new(yC(e)?mC:gC)(e,1);return i.version=Jw(n),i}class YU extends ia{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap,this._geometryDisposeListeners=new Map}has(e){const t=e.geometry;return super.has(t)&&this.get(t).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry,r=this.get(t);r.initialized=!0,this.info.memory.geometries++;const i=()=>{this.info.memory.geometries--;const s=t.index,o=e.getAttributes();s!==null&&this.attributes.delete(s);for(const c of o)this.attributes.delete(c);const a=this.wireframes.get(t);a!==void 0&&this.attributes.delete(a),t.removeEventListener("dispose",i),this._geometryDisposeListeners.delete(t)};t.addEventListener("dispose",i),this._geometryDisposeListeners.set(t,i)}updateAttributes(e){const t=e.getAttributes();for(const s of t)s.isStorageBufferAttribute||s.isStorageInstancedBufferAttribute?this.updateAttribute(s,bi.STORAGE):this.updateAttribute(s,bi.VERTEX);const r=this.getIndex(e);r!==null&&this.updateAttribute(r,bi.INDEX);const i=e.geometry.indirect;i!==null&&this.updateAttribute(i,bi.INDIRECT)}updateAttribute(e,t){const r=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,t),this.attributeCall.set(e,r)):this.attributeCall.get(e.data)!==r&&(this.attributes.update(e,t),this.attributeCall.set(e.data,r),this.attributeCall.set(e,r)):this.attributeCall.get(e)!==r&&(this.attributes.update(e,t),this.attributeCall.set(e,r))}getIndirect(e){return e.geometry.indirect}getIndirectOffset(e){return e.geometry.indirectOffset}getIndex(e){const{geometry:t,material:r}=e;let i=t.index;if(r.wireframe===!0){const s=this.wireframes;let o=s.get(t);o===void 0?(o=Hv(t),s.set(t,o)):o.version!==Jw(t)&&(this.attributes.delete(o),o=Hv(t),s.set(t,o)),i=o}return i}dispose(){for(const[e,t]of this._geometryDisposeListeners.entries())e.removeEventListener("dispose",t);this._geometryDisposeListeners.clear()}}class KU{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,r){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=r*(t/3):e.isPoints?this.render.points+=r*t:e.isLineSegments?this.render.lines+=r*(t/2):e.isLine?this.render.lines+=r*(t-1):Be("WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class e5{constructor(e){this.cacheKey=e,this.usedTimes=0}}class ZU extends e5{constructor(e,t,r){super(e),this.vertexProgram=t,this.fragmentProgram=r}}class JU extends e5{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let eq=0;class cp{constructor(e,t,r,i=null,s=null){this.id=eq++,this.code=e,this.stage=t,this.name=r,this.transforms=i,this.attributes=s,this.usedTimes=0}}class tq extends ia{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:r}=this,i=this.get(e);if(this._needsComputeUpdate(e)){const s=i.pipeline;s&&(s.usedTimes--,s.computeProgram.usedTimes--);const o=this.nodes.getForCompute(e);let a=this.programs.compute.get(o.computeShader);a===void 0&&(s&&s.computeProgram.usedTimes===0&&this._releaseProgram(s.computeProgram),a=new cp(o.computeShader,"compute",e.name,o.transforms,o.nodeAttributes),this.programs.compute.set(o.computeShader,a),r.createProgram(a));const c=this._getComputeCacheKey(e,a);let f=this.caches.get(c);f===void 0&&(s&&s.usedTimes===0&&this._releasePipeline(s),f=this._getComputePipeline(e,a,c,t)),f.usedTimes++,a.usedTimes++,i.version=e.version,i.pipeline=f}return i.pipeline}getForRender(e,t=null){const{backend:r}=this,i=this.get(e);if(this._needsRenderUpdate(e)){const s=i.pipeline;s&&(s.usedTimes--,s.vertexProgram.usedTimes--,s.fragmentProgram.usedTimes--);const o=e.getNodeBuilderState(),a=e.material?e.material.name:"";let c=this.programs.vertex.get(o.vertexShader);c===void 0&&(s&&s.vertexProgram.usedTimes===0&&this._releaseProgram(s.vertexProgram),c=new cp(o.vertexShader,"vertex",a),this.programs.vertex.set(o.vertexShader,c),r.createProgram(c));let f=this.programs.fragment.get(o.fragmentShader);f===void 0&&(s&&s.fragmentProgram.usedTimes===0&&this._releaseProgram(s.fragmentProgram),f=new cp(o.fragmentShader,"fragment",a),this.programs.fragment.set(o.fragmentShader,f),r.createProgram(f));const p=this._getRenderCacheKey(e,c,f);let g=this.caches.get(p);g===void 0?(s&&s.usedTimes===0&&this._releasePipeline(s),g=this._getRenderPipeline(e,c,f,p,t)):e.pipeline=g,g.usedTimes++,c.usedTimes++,f.usedTimes++,i.pipeline=g}return i.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,t.usedTimes===0&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,t.computeProgram.usedTimes===0&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,t.vertexProgram.usedTimes===0&&this._releaseProgram(t.vertexProgram),t.fragmentProgram.usedTimes===0&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,r,i){r=r||this._getComputeCacheKey(e,t);let s=this.caches.get(r);return s===void 0&&(s=new JU(r,t),this.caches.set(r,s),this.backend.createComputePipeline(s,i)),s}_getRenderPipeline(e,t,r,i,s){i=i||this._getRenderCacheKey(e,t,r);let o=this.caches.get(i);return o===void 0&&(o=new ZU(i,t,r),this.caches.set(i,o),e.pipeline=o,this.backend.createRenderPipeline(e,s)),o}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,r){return t.id+","+r.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,r=e.stage;this.programs[r].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return t.pipeline===void 0||t.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class nq extends ia{constructor(e,t,r,i,s,o){super(),this.backend=e,this.textures=r,this.pipelines=s,this.attributes=i,this.nodes=t,this.info=o,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const r of t){const i=this.get(r);i.bindGroup===void 0&&(this._init(r),this.backend.createBindings(r,t,0),i.bindGroup=r)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const r of t){const i=this.get(r);i.bindGroup===void 0&&(this._init(r),this.backend.createBindings(r,t,0),i.bindGroup=r)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}deleteForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const r of t)this.backend.deleteBindGroupData(r),this.delete(r)}deleteForRender(e){const t=e.getBindings();for(const r of t)this.backend.deleteBindGroupData(r),this.delete(r)}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isSampler)this.textures.updateSampler(t.texture);else if(t.isStorageBuffer){const r=t.attribute,i=r.isIndirectStorageBufferAttribute?bi.INDIRECT:bi.STORAGE;this.attributes.update(r,i)}}_update(e,t){const{backend:r}=this;let i=!1,s=!0,o=0,a=0;for(const c of e.bindings)if(this.nodes.updateGroup(c)!==!1){if(c.isStorageBuffer){const p=c.attribute,g=p.isIndirectStorageBufferAttribute?bi.INDIRECT:bi.STORAGE;this.attributes.update(p,g)}if(c.isUniformBuffer)c.update()&&r.updateBinding(c);else if(c.isSampledTexture){const p=c.update(),g=c.texture,v=this.textures.get(g);if(p&&(this.textures.updateTexture(g),c.generation!==v.generation&&(c.generation=v.generation,i=!0,s=!1)),r.get(g).externalTexture!==void 0||v.isDefaultTexture?s=!1:(o=o*10+g.id,a+=g.version),g.isStorageTexture===!0&&g.mipmapsAutoUpdate===!0){const T=this.get(g);c.store===!0?T.needsMipmap=!0:this.textures.needsMipmaps(g)&&T.needsMipmap===!0&&(this.backend.generateMipmaps(g),T.needsMipmap=!1)}}else if(c.isSampler&&c.update()){const g=this.textures.updateSampler(c.texture);c.samplerKey!==g&&(c.samplerKey=g,i=!0,s=!1)}}i===!0&&this.backend.updateBindings(e,t,s?o:0,a)}}function rq(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?n.z-e.z:n.id-e.id}function Wv(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function Qv(n){return(n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode)&&n.side===xi&&n.forceSinglePass===!1}class iq{constructor(e,t,r){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,r),this.lightsArray=[],this.scene=t,this.camera=r,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,r,i,s,o,a){let c=this.renderItems[this.renderItemsIndex];return c===void 0?(c={id:e.id,object:e,geometry:t,material:r,groupOrder:i,renderOrder:e.renderOrder,z:s,group:o,clippingContext:a},this.renderItems[this.renderItemsIndex]=c):(c.id=e.id,c.object=e,c.geometry=t,c.material=r,c.groupOrder=i,c.renderOrder=e.renderOrder,c.z=s,c.group=o,c.clippingContext=a),this.renderItemsIndex++,c}push(e,t,r,i,s,o,a){const c=this.getNextRenderItem(e,t,r,i,s,o,a);e.occlusionTest===!0&&this.occlusionQueryCount++,r.transparent===!0||r.transmission>0||r.transmissionNode&&r.transmissionNode.isNode||r.backdropNode&&r.backdropNode.isNode?(Qv(r)&&this.transparentDoublePass.push(c),this.transparent.push(c)):this.opaque.push(c)}unshift(e,t,r,i,s,o,a){const c=this.getNextRenderItem(e,t,r,i,s,o,a);r.transparent===!0||r.transmission>0||r.transmissionNode&&r.transmissionNode.isNode||r.backdropNode&&r.backdropNode.isNode?(Qv(r)&&this.transparentDoublePass.unshift(c),this.transparent.unshift(c)):this.opaque.unshift(c)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||rq),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||Wv),this.transparent.length>1&&this.transparent.sort(t||Wv)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const r=this.renderItems[e];if(r.id===null)break;r.id=null,r.object=null,r.geometry=null,r.material=null,r.groupOrder=null,r.renderOrder=null,r.z=null,r.group=null,r.clippingContext=null}}}const ku=[];class sq{constructor(e){this.lighting=e,this.lists=new Ji}get(e,t){const r=this.lists;ku[0]=e,ku[1]=t;let i=r.get(ku);return i===void 0&&(i=new iq(this.lighting,e,t),r.set(ku,i)),ku.length=0,i}dispose(){this.lists=new Ji}}let oq=0;class aq{constructor(){this.id=oq++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new $t,this.scissor=!1,this.scissorValue=new $t,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return t5(this)}}function t5(n){const{textures:e,activeCubeFace:t,activeMipmapLevel:r}=n,i=[t,r];for(const s of e)i.push(s.id);return pu(i)}const bl=[],lq=new rf,uq=new Hg;class Aq{constructor(){this.chainMaps={}}get(e,t,r=null,i=null){bl[0]=e,bl[1]=t,i!==null&&(bl[2]=i);let s;if(r===null)s="default";else{const c=r.texture.format;s=`${r.textures.length}:${c}:${r.samples}:${r.depthBuffer}:${r.stencilBuffer}`}const o=this._getChainMap(s);let a=o.get(bl);return a===void 0&&(a=new aq,o.set(bl,a)),bl.length=0,r!==null&&(a.sampleCount=r.samples===0?1:r.samples),a}getForClear(e=null){return this.get(lq,uq,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new Ji)}dispose(){this.chainMaps={}}}const cq=new ge;class hq extends ia{constructor(e,t,r){super(),this.renderer=e,this.backend=t,this.info=r}updateRenderTarget(e,t=0){const r=this.get(e),i=e.samples===0?1:e.samples,s=r.depthTextureMips||(r.depthTextureMips={}),o=e.textures,a=this.getSize(o[0]),c=a.width>>t,f=a.height>>t;let p=e.depthTexture||s[t];const g=e.depthBuffer===!0||e.stencilBuffer===!0;let v=!1;p===void 0&&g&&(p=new Wi,p.format=e.stencilBuffer?$o:Ho,p.type=e.stencilBuffer?jo:Un,p.image.width=c,p.image.height=f,p.image.depth=a.depth,p.renderTarget=e,p.isArrayTexture=e.multiview===!0&&a.depth>1,s[t]=p),(r.width!==a.width||a.height!==r.height)&&(v=!0,p&&(p.needsUpdate=!0,p.image.width=c,p.image.height=f,p.image.depth=p.isArrayTexture?p.image.depth:1)),r.width=a.width,r.height=a.height,r.textures=o,r.depthTexture=p||null,r.depth=e.depthBuffer,r.stencil=e.stencilBuffer,r.renderTarget=e,r.sampleCount!==i&&(v=!0,p&&(p.needsUpdate=!0),r.sampleCount=i);const x={sampleCount:i};if(e.isXRRenderTarget!==!0){for(let T=0;T<o.length;T++){const S=o[T];v&&(S.needsUpdate=!0),this.updateTexture(S,x)}p&&this.updateTexture(p,x)}r.initialized!==!0&&(r.initialized=!0,r.onDispose=()=>{this._destroyRenderTarget(e)},e.addEventListener("dispose",r.onDispose))}updateTexture(e,t={}){const r=this.get(e);if(r.initialized===!0&&r.version===e.version)return;const i=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,s=this.backend;if(i&&r.initialized===!0&&s.destroyTexture(e),e.isFramebufferTexture){const f=this.renderer.getRenderTarget();f?e.type=f.texture.type:e.type=ii}const{width:o,height:a,depth:c}=this.getSize(e);if(t.width=o,t.height=a,t.depth=c,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,o,a):1,e.isCubeTexture&&e.mipmaps.length>0&&t.levels++,i||e.isStorageTexture===!0||e.isExternalTexture===!0)s.createTexture(e,t),r.generation=e.version;else if(e.version>0){const f=e.image;if(f===void 0)De("Renderer: Texture marked for update but image is undefined.");else if(f.complete===!1)De("Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const g=[];for(const v of e.images)g.push(v);t.images=g}else t.image=f;(r.isDefaultTexture===void 0||r.isDefaultTexture===!0)&&(s.createTexture(e,t),r.isDefaultTexture=!1,r.generation=e.version),e.source.dataReady===!0&&s.updateTexture(e,t);const p=e.isStorageTexture===!0&&e.mipmapsAutoUpdate===!1;t.needsMipmaps&&e.mipmaps.length===0&&!p&&s.generateMipmaps(e),e.onUpdate&&e.onUpdate(e)}}else s.createDefaultTexture(e),r.isDefaultTexture=!0,r.generation=e.version;r.initialized!==!0&&(r.initialized=!0,r.generation=e.version,this.info.memory.textures++,e.isVideoTexture&&Sn.enabled===!0&&Sn.getTransfer(e.colorSpace)!==ft&&De("WebGPURenderer: Video textures must use a color space with a sRGB transfer function, e.g. SRGBColorSpace."),r.onDispose=()=>{this._destroyTexture(e)},e.addEventListener("dispose",r.onDispose)),r.version=e.version}updateSampler(e){return this.backend.updateSampler(e)}getSize(e,t=cq){let r=e.images?e.images[0]:e.image;return r?(r.image!==void 0&&(r=r.image),typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement?(t.width=r.videoWidth||1,t.height=r.videoHeight||1,t.depth=1):typeof VideoFrame<"u"&&r instanceof VideoFrame?(t.width=r.displayWidth||1,t.height=r.displayHeight||1,t.depth=1):(t.width=r.width||1,t.height=r.height||1,t.depth=e.isCubeTexture?6:r.depth||1)):t.width=t.height=t.depth=1,t}getMipLevels(e,t,r){let i;return e.mipmaps.length>0?i=e.mipmaps.length:e.isCompressedTexture===!0?i=1:i=Math.floor(Math.log2(Math.max(t,r)))+1,i}needsMipmaps(e){return e.generateMipmaps===!0||e.mipmaps.length>0}_destroyRenderTarget(e){if(this.has(e)===!0){const t=this.get(e),r=t.textures,i=t.depthTexture;e.removeEventListener("dispose",t.onDispose);for(let s=0;s<r.length;s++)this._destroyTexture(r[s]);i&&this._destroyTexture(i),this.delete(e),this.backend.delete(e)}}_destroyTexture(e){if(this.has(e)===!0){const t=this.get(e);e.removeEventListener("dispose",t.onDispose);const r=t.isDefaultTexture;this.backend.destroyTexture(e,r),this.delete(e),this.info.memory.textures--}}}class z2 extends jn{constructor(e,t,r,i=1){super(e,t,r),this.a=i}set(e,t,r,i=1){return this.a=i,super.set(e,t,r)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class n5 extends Dt{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getMemberType(e,t){const r=this.getNodeType(e),i=e.getStructTypeNode(r);let s;return i!==null?s=i.getMemberType(e,t):(Be(`TSL: Member "${t}" not found in struct "${r}".`),s="float"),s}getHash(){return this.uuid}generate(){return this.name}}const fq=(n,e)=>new n5(n,e);class dq extends Ie{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this._expressionNode=null,this._currentNode=null,this.isStackNode=!0}getElementType(e){return this.hasOutput?this.outputNode.getElementType(e):"void"}getNodeType(e){return this.hasOutput?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.hasOutput?this.outputNode.getMemberType(e,t):"void"}addToStack(e,t=this.nodes.length){return e.isNode!==!0?(Be("TSL: Invalid node added to stack."),this):(this.nodes.splice(t,0,e),this)}addToStackBefore(e){const t=this._currentNode?this.nodes.indexOf(this._currentNode):0;return this.addToStack(e,t)}If(e,t){const r=new ql(t);return this._currentCond=lr(e,r),this.addToStack(this._currentCond)}ElseIf(e,t){const r=new ql(t),i=lr(e,r);return this._currentCond.elseNode=i,this._currentCond=i,this}Else(e){return this._currentCond.elseNode=new ql(e),this}Switch(e){return this._expressionNode=Pe(e),this}Case(...e){const t=[];if(e.length>=2)for(let a=0;a<e.length-1;a++)t.push(this._expressionNode.equal(Pe(e[a])));else Be("TSL: Invalid parameter length. Case() requires at least two parameters.");const r=e[e.length-1],i=new ql(r);let s=t[0];for(let a=1;a<t.length;a++)s=s.or(t[a]);const o=lr(s,i);return this._currentCond===null?(this._currentCond=o,this.addToStack(this._currentCond)):(this._currentCond.elseNode=o,this._currentCond=o,this)}Default(e){return this.Else(e),this}setup(e){const t=e.getNodeProperties(this);let r=0;for(const i of this.getChildren())i.isVarNode&&i.isIntent(e)&&i.isAssign(e)!==!0||(t["node"+r++]=i);return t.outputNode||null}get hasOutput(){return this.outputNode&&this.outputNode.isNode}build(e,...t){const r=U1(),i=e.buildStage;qA(this),e.setActiveStack(this);const s=f=>{if(this._currentNode=f,!(f.isVarNode&&f.isIntent(e)&&f.isAssign(e)!==!0)){if(i==="setup")f.build(e);else if(i==="analyze")f.build(e,this);else if(i==="generate"){const p=e.getDataFromNode(f,"any").stages,g=p&&p[e.shaderStage];if(f.isVarNode&&g&&g.length===1&&g[0]&&g[0].isStackNode)return;f.build(e,"void")}}},o=[...this.nodes];for(const f of o)s(f);this._currentNode=null;const a=this.nodes.filter(f=>o.indexOf(f)===-1);for(const f of a)s(f);let c;return this.hasOutput?c=this.outputNode.build(e,...t):c=super.build(e,...t),qA(r),e.removeActiveStack(this),c}}const q0=tt(dq).setParameterLength(0,1);function pq(n){return Object.entries(n).map(([e,t])=>typeof t=="string"?{name:e,type:t,atomic:!1}:{name:e,type:t.type,atomic:t.atomic||!1})}class mq extends Ie{static get type(){return"StructTypeNode"}constructor(e,t=null){super("struct"),this.membersLayout=pq(e),this.name=t,this.isStructLayoutNode=!0}getLength(){const e=Float32Array.BYTES_PER_ELEMENT;let t=1,r=0;for(const i of this.membersLayout){const s=i.type,o=IO(s),a=kO(s)/e;t=Math.max(t,a);const f=r%t%a;f!==0&&(r+=a-f),r+=o}return Math.ceil(r/t)*t}getMemberType(e,t){const r=this.membersLayout.find(i=>i.name===t);return r?r.type:"void"}getNodeType(e){return e.getStructTypeFromNode(this,this.membersLayout,this.name).name}setup(e){e.getStructTypeFromNode(this,this.membersLayout,this.name),e.addInclude(this)}generate(e){return this.getNodeType(e)}}class gq extends Ie{static get type(){return"StructNode"}constructor(e,t){super("vec3"),this.structTypeNode=e,this.values=t,this.isStructNode=!0}getNodeType(e){return this.structTypeNode.getNodeType(e)}getMemberType(e,t){return this.structTypeNode.getMemberType(e,t)}generate(e){const t=e.getVarFromNode(this),r=t.type,i=e.getPropertyName(t);return e.addLineFlowCode(`${i} = ${e.generateStruct(r,this.structTypeNode.membersLayout,this.values)}`,this),t.name}}const yq=(n,e=null)=>{const t=new mq(n,e),r=(...i)=>{let s=null;if(i.length>0)if(i[0].isNode){s={};const o=Object.keys(n);for(let a=0;a<i.length;a++)s[o[a]]=i[a]}else s=i[0];return new gq(t,s)};return r.layout=t,r.isStruct=!0,r};class r5 extends Ie{static get type(){return"OutputStructNode"}constructor(...e){super(),this.members=e,this.isOutputStructNode=!0}getNodeType(e){const t=e.getNodeProperties(this);if(t.membersLayout===void 0){const r=this.members,i=[];for(let s=0;s<r.length;s++){const o="m"+s,a=r[s].getNodeType(e);i.push({name:o,type:a,index:s})}t.membersLayout=i,t.structType=e.getOutputStructTypeFromNode(this,t.membersLayout)}return t.structType.name}generate(e){const t=e.getOutputStructName(),r=this.members,i=t!==""?t+".":"";for(let s=0;s<r.length;s++){const o=r[s].build(e);e.addLineFlowCode(`${i}m${s} = ${o}`,this)}return t}}const _q=tt(r5);function i5(n,e){for(let t=0;t<n.length;t++)if(n[t].name===e)return t;return-1}class vq extends r5{static get type(){return"MRTNode"}constructor(e){super(),this.outputNodes=e,this.isMRTNode=!0}has(e){return this.outputNodes[e]!==void 0}get(e){return this.outputNodes[e]}merge(e){const t={...this.outputNodes,...e.outputNodes};return s5(t)}setup(e){const t=this.outputNodes,r=e.renderer.getRenderTarget(),i=[],s=r.textures;for(const o in t){const a=i5(s,o);i[a]=je(t[o])}return this.members=i,super.setup(e)}}const s5=tt(vq);class ac extends vn{static get type(){return"BitcastNode"}constructor(e,t,r=null){super(),this.valueNode=e,this.conversionType=t,this.inputType=r,this.isBitcastNode=!0}getNodeType(e){if(this.inputType!==null){const t=this.valueNode.getNodeType(e),r=e.getTypeLength(t);return e.getTypeFromLength(r,this.conversionType)}return this.conversionType}generate(e){const t=this.getNodeType(e);let r="";if(this.inputType!==null){const i=this.valueNode.getNodeType(e);r=e.getTypeLength(i)===1?this.inputType:e.changeComponentType(i,this.inputType)}else r=this.valueNode.getNodeType(e);return`${e.getBitcastMethod(t,r)}( ${this.valueNode.build(e,r)} )`}}const o5=Se(ac).setParameterLength(2),bq=n=>new ac(n,"int","float"),a5=n=>new ac(n,"uint","float"),xq=n=>new ac(n,"float","int"),Tq=n=>new ac(n,"float","uint"),$c={};class si extends ue{static get type(){return"BitcountNode"}constructor(e,t){super(e,t),this.isBitcountNode=!0}_resolveElementType(e,t,r){r==="int"?t.assign(o5(e,"uint")):t.assign(e)}_returnDataNode(e){switch(e){case"uint":return ye;case"int":return X;case"uvec2":return q1;case"uvec3":return Za;case"uvec4":return j1;case"ivec2":return In;case"ivec3":return G1;case"ivec4":return z1}}_createTrailingZerosBaseLayout(e,t){const r=this._returnDataNode(t);return re(([s])=>{const o=ye(0);this._resolveElementType(s,o,t);const a=z(o.bitAnd(r2(o))),f=a5(a).shiftRight(23).sub(127);return r(f)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createLeadingZerosBaseLayout(e,t){const r=this._returnDataNode(t);return re(([s])=>{ze(s.equal(ye(0)),()=>ye(32));const o=ye(0),a=ye(0);return this._resolveElementType(s,o,t),ze(o.shiftRight(16).equal(0),()=>{a.addAssign(16),o.shiftLeftAssign(16)}),ze(o.shiftRight(24).equal(0),()=>{a.addAssign(8),o.shiftLeftAssign(8)}),ze(o.shiftRight(28).equal(0),()=>{a.addAssign(4),o.shiftLeftAssign(4)}),ze(o.shiftRight(30).equal(0),()=>{a.addAssign(2),o.shiftLeftAssign(2)}),ze(o.shiftRight(31).equal(0),()=>{a.addAssign(1)}),r(a)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createOneBitsBaseLayout(e,t){const r=this._returnDataNode(t);return re(([s])=>{const o=ye(0);this._resolveElementType(s,o,t),o.assign(o.sub(o.shiftRight(ye(1)).bitAnd(ye(1431655765)))),o.assign(o.bitAnd(ye(858993459)).add(o.shiftRight(ye(2)).bitAnd(ye(858993459))));const a=o.add(o.shiftRight(ye(4))).bitAnd(ye(252645135)).mul(ye(16843009)).shiftRight(ye(24));return r(a)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createMainLayout(e,t,r,i){const s=this._returnDataNode(t);return re(([a])=>{if(r===1)return s(i(a));{const c=s(0),f=["x","y","z","w"];for(let p=0;p<r;p++){const g=f[p];c[g].assign(i(a[g]))}return c}}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}setup(e){const{method:t,aNode:r}=this,{renderer:i}=e;if(i.backend.isWebGPUBackend)return super.setup(e);const s=this.getInputType(e),o=e.getElementType(s),a=e.getTypeLength(s),c=`${t}_base_${o}`,f=`${t}_${s}`;let p=$c[c];if(p===void 0){switch(t){case si.COUNT_LEADING_ZEROS:{p=this._createLeadingZerosBaseLayout(c,o);break}case si.COUNT_TRAILING_ZEROS:{p=this._createTrailingZerosBaseLayout(c,o);break}case si.COUNT_ONE_BITS:{p=this._createOneBitsBaseLayout(c,o);break}}$c[c]=p}let g=$c[f];return g===void 0&&(g=this._createMainLayout(f,s,a,p),$c[f]=g),re(()=>g(r))()}}si.COUNT_TRAILING_ZEROS="countTrailingZeros";si.COUNT_LEADING_ZEROS="countLeadingZeros";si.COUNT_ONE_BITS="countOneBits";const wq=Se(si,si.COUNT_TRAILING_ZEROS).setParameterLength(1),Sq=Se(si,si.COUNT_LEADING_ZEROS).setParameterLength(1),Eq=Se(si,si.COUNT_ONE_BITS).setParameterLength(1),Rq=re(([n])=>{const e=n.toUint().mul(747796405).add(2891336453),t=e.shiftRight(e.shiftRight(28).add(4)).bitXor(e).mul(277803737);return t.shiftRight(22).bitXor(t).toFloat().mul(1/2**32)}),wg=(n,e)=>_i(et(4,n.mul(St(1,n))),e),Cq=(n,e)=>n.lessThan(.5)?wg(n.mul(2),e).div(2):St(1,wg(et(St(1,n),2),e).div(2)),Nq=(n,e,t)=>_i(ai(_i(n,e),Ln(_i(n,e),_i(St(1,n),t))),1/e),Mq=(n,e)=>Cr(Vh.mul(e.mul(n).sub(1))).div(Vh.mul(e.mul(n).sub(1)));class j2 extends vn{static get type(){return"PackFloatNode"}constructor(e,t){super(),this.vectorNode=t,this.encoding=e,this.isPackFloatNode=!0}getNodeType(){return"uint"}generate(e){const t=this.vectorNode.getNodeType(e);return`${e.getFloatPackingMethod(this.encoding)}(${this.vectorNode.build(e,t)})`}}const Pq=Se(j2,"snorm").setParameterLength(1),Bq=Se(j2,"unorm").setParameterLength(1),Dq=Se(j2,"float16").setParameterLength(1);class $2 extends vn{static get type(){return"UnpackFloatNode"}constructor(e,t){super(),this.uintNode=t,this.encoding=e,this.isUnpackFloatNode=!0}getNodeType(){return"vec2"}generate(e){const t=this.uintNode.getNodeType(e);return`${e.getFloatUnpackingMethod(this.encoding)}(${this.uintNode.build(e,t)})`}}const Lq=Se($2,"snorm").setParameterLength(1),Oq=Se($2,"unorm").setParameterLength(1),Fq=Se($2,"float16").setParameterLength(1),js=re(([n])=>n.fract().sub(.5).abs()).setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),Iq=re(([n])=>Z(js(n.z.add(js(n.y.mul(1)))),js(n.z.add(js(n.x.mul(1)))),js(n.y.add(js(n.x.mul(1)))))).setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),kq=re(([n,e,t])=>{const r=Z(n).toVar(),i=z(1.4).toVar(),s=z(0).toVar(),o=Z(r).toVar();return qt({start:z(0),end:z(3),type:"float",condition:"<="},()=>{const a=Z(Iq(o.mul(2))).toVar();r.addAssign(a.add(t.mul(z(.1).mul(e)))),o.mulAssign(1.8),i.mulAssign(1.5),r.mulAssign(1.2);const c=z(js(r.z.add(js(r.x.add(js(r.y)))))).toVar();s.addAssign(c.div(i)),o.addAssign(.14)}),s}).setLayout({name:"triNoise3D",type:"float",inputs:[{name:"position",type:"vec3"},{name:"speed",type:"float"},{name:"time",type:"float"}]});class Uq extends Ie{static get type(){return"FunctionOverloadingNode"}constructor(e=[],...t){super(),this.functionNodes=e,this.parametersNodes=t,this._candidateFn=null,this.global=!0}getNodeType(e){return this.getCandidateFn(e).shaderNode.layout.type}getCandidateFn(e){const t=this.parametersNodes;let r=this._candidateFn;if(r===null){let i=null,s=-1;for(const o of this.functionNodes){const c=o.shaderNode.layout;if(c===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const f=c.inputs;if(t.length===f.length){let p=0;for(let g=0;g<t.length;g++){const v=t[g],x=f[g];v.getNodeType(e)===x.type&&p++}p>s&&(i=o,s=p)}}this._candidateFn=r=i}return r}setup(e){return this.getCandidateFn(e)(...this.parametersNodes)}}const qq=tt(Uq),cr=n=>(...e)=>qq(n,...e),yu=Ve(0).setGroup(Ge).onRenderUpdate(n=>n.time),Gq=Ve(0).setGroup(Ge).onRenderUpdate(n=>n.deltaTime),l5=Ve(0,"uint").setGroup(Ge).onRenderUpdate(n=>n.frameId),Vq=(n=yu)=>n.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5),zq=(n=yu)=>n.fract().round(),jq=(n=yu)=>n.add(.5).fract().mul(2).sub(1).abs(),$q=(n=yu)=>n.fract();function Hq(n,e=null){return fo(e,{getUV:n})}const Wq=re(([n,e,t=we(.5)])=>oc(n.sub(t),e).add(t)),Qq=re(([n,e,t=we(.5)])=>{const r=n.sub(t),i=r.dot(r),o=i.mul(i).mul(e);return n.add(r.mul(o))}),Xq=re(({position:n=null,horizontal:e=!0,vertical:t=!1})=>{let r;n!==null?(r=vi.toVar(),r[3][0]=n.x,r[3][1]=n.y,r[3][2]=n.z):r=vi;const i=Bi.mul(r);return UA(e)&&(i[0][0]=vi[0].length(),i[0][1]=0,i[0][2]=0),UA(t)&&(i[1][0]=0,i[1][1]=vi[1].length(),i[1][2]=0),i[2][0]=0,i[2][1]=0,i[2][2]=1,no.mul(i).mul(pn)}),Yq=re(([n=null])=>{const e=$h();return $h(D2(n)).sub(e).lessThan(0).select(to,n)});class Kq extends Ie{static get type(){return"SpriteSheetUVNode"}constructor(e,t=Ht(),r=z(0)){super("vec2"),this.countNode=e,this.uvNode=t,this.frameNode=r}setup(){const{frameNode:e,uvNode:t,countNode:r}=this,{width:i,height:s}=r,o=e.mod(i.mul(s)).floor(),a=o.mod(i),c=s.sub(o.add(1).div(i).ceil()),f=r.reciprocal(),p=we(a,c);return t.add(p).mul(f)}}const Zq=tt(Kq).setParameterLength(3),u5=re(([n,e=null,t=null,r=z(1),i=pn,s=jr])=>{let o=s.abs().normalize();o=o.div(o.dot(Z(1)));const a=i.yz.mul(r),c=i.zx.mul(r),f=i.xy.mul(r),p=n.value,g=e!==null?e.value:p,v=t!==null?t.value:p,x=Nt(p,a).mul(o.x),T=Nt(g,c).mul(o.y),S=Nt(v,f).mul(o.z);return Ln(x,T,S)}),Jq=(...n)=>u5(...n),xl=new t1,ga=new ge,Tl=new ge,hp=new ge,Uu=new dn,Hc=new ge(0,0,-1),as=new $t,qu=new ge,Wc=new ge,Gu=new $t,Qc=new _t,Wh=new ea,eG=to.flipX();Wh.depthTexture=new Wi(1,1);let Xc=!1;class H2 extends Ms{static get type(){return"ReflectorNode"}constructor(e={}){super(e.defaultTexture||Wh.texture,eG),this._reflectorBaseNode=e.reflector||new tG(this,e),this._depthNode=null,this.setUpdateMatrix(!1)}get reflector(){return this._reflectorBaseNode}get target(){return this._reflectorBaseNode.target}getDepthNode(){if(this._depthNode===null){if(this._reflectorBaseNode.depth!==!0)throw new Error("THREE.ReflectorNode: Depth node can only be requested when the reflector is created with { depth: true }. ");this._depthNode=Pe(new H2({defaultTexture:Wh.depthTexture,reflector:this._reflectorBaseNode}))}return this._depthNode}setup(e){return e.object.isQuadMesh||this._reflectorBaseNode.build(e),super.setup(e)}clone(){const e=new this.constructor(this.reflectorNode);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e._reflectorBaseNode=this._reflectorBaseNode,e}dispose(){super.dispose(),this._reflectorBaseNode.dispose()}}class tG extends Ie{static get type(){return"ReflectorBaseNode"}constructor(e,t={}){super();const{target:r=new nf,resolutionScale:i=1,generateMipmaps:s=!1,bounces:o=!0,depth:a=!1,samples:c=0}=t;this.textureNode=e,this.target=r,this.resolutionScale=i,t.resolution!==void 0&&(fn('ReflectorNode: The "resolution" parameter has been renamed to "resolutionScale".'),this.resolutionScale=t.resolution),this.generateMipmaps=s,this.bounces=o,this.depth=a,this.samples=c,this.updateBeforeType=o?ot.RENDER:ot.FRAME,this.virtualCameras=new WeakMap,this.renderTargets=new Map,this.forceUpdate=!1,this.hasOutput=!1}_updateResolution(e,t){const r=this.resolutionScale;t.getDrawingBufferSize(Qc),e.setSize(Math.round(Qc.width*r),Math.round(Qc.height*r))}setup(e){return this._updateResolution(Wh,e.renderer),super.setup(e)}dispose(){super.dispose();for(const e of this.renderTargets.values())e.dispose()}getVirtualCamera(e){let t=this.virtualCameras.get(e);return t===void 0&&(t=e.clone(),this.virtualCameras.set(e,t)),t}getRenderTarget(e){let t=this.renderTargets.get(e);return t===void 0&&(t=new ea(0,0,{type:or,samples:this.samples}),this.generateMipmaps===!0&&(t.texture.minFilter=XC,t.texture.generateMipmaps=!0),this.depth===!0&&(t.depthTexture=new Wi),this.renderTargets.set(e,t)),t}updateBefore(e){if(this.bounces===!1&&Xc)return!1;Xc=!0;const{scene:t,camera:r,renderer:i,material:s}=e,{target:o}=this,a=this.getVirtualCamera(r),c=this.getRenderTarget(a);i.getDrawingBufferSize(Qc),this._updateResolution(c,i),Tl.setFromMatrixPosition(o.matrixWorld),hp.setFromMatrixPosition(r.matrixWorld),Uu.extractRotation(o.matrixWorld),ga.set(0,0,1),ga.applyMatrix4(Uu),qu.subVectors(Tl,hp);const f=qu.dot(ga)>0;let p=!1;if(f===!0&&this.forceUpdate===!1){if(this.hasOutput===!1){Xc=!1;return}p=!0}qu.reflect(ga).negate(),qu.add(Tl),Uu.extractRotation(r.matrixWorld),Hc.set(0,0,-1),Hc.applyMatrix4(Uu),Hc.add(hp),Wc.subVectors(Tl,Hc),Wc.reflect(ga).negate(),Wc.add(Tl),a.coordinateSystem=r.coordinateSystem,a.position.copy(qu),a.up.set(0,1,0),a.up.applyMatrix4(Uu),a.up.reflect(ga),a.lookAt(Wc),a.near=r.near,a.far=r.far,a.updateMatrixWorld(),a.projectionMatrix.copy(r.projectionMatrix),xl.setFromNormalAndCoplanarPoint(ga,Tl),xl.applyMatrix4(a.matrixWorldInverse),as.set(xl.normal.x,xl.normal.y,xl.normal.z,xl.constant);const g=a.projectionMatrix;Gu.x=(Math.sign(as.x)+g.elements[8])/g.elements[0],Gu.y=(Math.sign(as.y)+g.elements[9])/g.elements[5],Gu.z=-1,Gu.w=(1+g.elements[10])/g.elements[14],as.multiplyScalar(1/as.dot(Gu));const v=0;g.elements[2]=as.x,g.elements[6]=as.y,g.elements[10]=i.coordinateSystem===Qo?as.z-v:as.z+1-v,g.elements[14]=as.w,this.textureNode.value=c.texture,this.depth===!0&&(this.textureNode.getDepthNode().value=c.depthTexture),s.visible=!1;const x=i.getRenderTarget(),T=i.getMRT(),S=i.autoClear;i.setMRT(null),i.setRenderTarget(c),i.autoClear=!0;const E=t.name;t.name=(t.name||"Scene")+" [ Reflector ]",p?(i.clear(),this.hasOutput=!1):(i.render(t,a),this.hasOutput=!0),t.name=E,i.setMRT(T),i.setRenderTarget(x),i.autoClear=S,s.visible=!0,Xc=!1,this.forceUpdate=!1}get resolution(){return fn('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale}set resolution(e){fn('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale=e}}const nG=n=>new H2(n),fp=new Yg(-1,1,1,-1,0,1);class rG extends Hr{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new Cs([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Cs(t,2))}}const iG=new rG;class Uf extends gn{constructor(e=null){super(iG,e),this.camera=fp,this.isQuadMesh=!0}async renderAsync(e){fn('QuadMesh: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await e.init(),e.render(this,fp)}render(e){e.render(this,fp)}}const sG=new _t;class oG extends Ms{static get type(){return"RTTNode"}constructor(e,t=null,r=null,i={type:or}){const s=new ea(t,r,i);super(s.texture,Ht()),this.isRTTNode=!0,this.node=e,this.width=t,this.height=r,this.pixelRatio=1,this.renderTarget=s,this.textureNeedsUpdate=!0,this.autoUpdate=!0,this._rttNode=null,this._quadMesh=new Uf(new Rn),this.updateBeforeType=ot.RENDER}get autoResize(){return this.width===null}setup(e){return this._rttNode=this.node.context(e.getSharedContext()),this._quadMesh.material.name="RTT",this._quadMesh.material.needsUpdate=!0,super.setup(e)}setSize(e,t){this.width=e,this.height=t;const r=e*this.pixelRatio,i=t*this.pixelRatio;this.renderTarget.setSize(r,i),this.textureNeedsUpdate=!0}setPixelRatio(e){this.pixelRatio=e,this.setSize(this.width,this.height)}updateBefore({renderer:e}){if(this.textureNeedsUpdate===!1&&this.autoUpdate===!1)return;if(this.textureNeedsUpdate=!1,this.autoResize===!0){const i=e.getPixelRatio(),s=e.getSize(sG),o=Math.floor(s.width*i),a=Math.floor(s.height*i);(o!==this.renderTarget.width||a!==this.renderTarget.height)&&(this.renderTarget.setSize(o,a),this.textureNeedsUpdate=!0)}let t="RTT";this.node.name&&(t=this.node.name+" [ "+t+" ]"),this._quadMesh.material.fragmentNode=this._rttNode,this._quadMesh.name=t;const r=e.getRenderTarget();e.setRenderTarget(this.renderTarget),this._quadMesh.render(e),e.setRenderTarget(r)}clone(){const e=new Ms(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e.referenceNode=this,e}}const A5=(n,...e)=>Pe(new oG(Pe(n),...e)),aG=(n,...e)=>n.isSampleNode||n.isTextureNode?n:n.isPassNode?n.getTextureNode():A5(n,...e),Bl=re(([n,e,t],r)=>{let i;r.renderer.coordinateSystem===Qo?(n=we(n.x,n.y.oneMinus()).mul(2).sub(1),i=je(Z(n,e),1)):i=je(Z(n.x,n.y.oneMinus(),e).mul(2).sub(1),1);const s=je(t.mul(i));return s.xyz.div(s.w)}),lG=re(([n,e])=>{const t=e.mul(je(n,1)),r=t.xy.div(t.w).mul(.5).add(.5).toVar();return we(r.x,r.y.oneMinus())}),uG=re(([n,e,t])=>{const r=eo(wn(e)),i=In(n.mul(r)).toVar(),s=wn(e,i).toVar(),o=wn(e,i.sub(In(2,0))).toVar(),a=wn(e,i.sub(In(1,0))).toVar(),c=wn(e,i.add(In(1,0))).toVar(),f=wn(e,i.add(In(2,0))).toVar(),p=wn(e,i.add(In(0,2))).toVar(),g=wn(e,i.add(In(0,1))).toVar(),v=wn(e,i.sub(In(0,1))).toVar(),x=wn(e,i.sub(In(0,2))).toVar(),T=en(St(z(2).mul(a).sub(o),s)).toVar(),S=en(St(z(2).mul(c).sub(f),s)).toVar(),E=en(St(z(2).mul(g).sub(p),s)).toVar(),N=en(St(z(2).mul(v).sub(x),s)).toVar(),P=Bl(n,s,t).toVar(),B=T.lessThan(S).select(P.sub(Bl(n.sub(we(z(1).div(r.x),0)),a,t)),P.negate().add(Bl(n.add(we(z(1).div(r.x),0)),c,t))),L=E.lessThan(N).select(P.sub(Bl(n.add(we(0,z(1).div(r.y))),g,t)),P.negate().add(Bl(n.sub(we(0,z(1).div(r.y))),v,t)));return Mr(uo(B,L))}),W2=re(([n])=>Yi(z(52.9829189).mul(Yi(Ri(n,we(.06711056,.00583715)))))).setLayout({name:"interleavedGradientNoise",type:"float",inputs:[{name:"position",type:"vec2"}]}),Vi=re(([n,e,t])=>{const r=z(2.399963229728653),i=gr(z(n).add(.5).div(z(e))),s=z(n).mul(r).add(t);return we(Ui(s),Cr(s)).mul(i)}).setLayout({name:"vogelDiskSample",type:"vec2",inputs:[{name:"sampleIndex",type:"int"},{name:"samplesCount",type:"int"},{name:"phi",type:"float"}]});class AG extends Ie{static get type(){return"SampleNode"}constructor(e,t=null){super(),this.callback=e,this.uvNode=t,this.isSampleNode=!0}setup(){return this.sample(Ht())}sample(e){return this.callback(e)}}const cG=(n,e=null)=>new AG(n,Pe(e));class Ur extends Ie{static get type(){return"EventNode"}constructor(e,t){super("void"),this.eventType=e,this.callback=t,e===Ur.OBJECT?this.updateType=ot.OBJECT:e===Ur.MATERIAL?this.updateType=ot.RENDER:e===Ur.BEFORE_OBJECT?this.updateBeforeType=ot.OBJECT:e===Ur.BEFORE_MATERIAL&&(this.updateBeforeType=ot.RENDER)}update(e){this.callback(e)}updateBefore(e){this.callback(e)}}Ur.OBJECT="object";Ur.MATERIAL="material";Ur.BEFORE_OBJECT="beforeObject";Ur.BEFORE_MATERIAL="beforeMaterial";const qf=(n,e)=>new Ur(n,e).toStack(),hG=n=>qf(Ur.OBJECT,n),fG=n=>qf(Ur.MATERIAL,n),dG=n=>qf(Ur.BEFORE_OBJECT,n),pG=n=>qf(Ur.BEFORE_MATERIAL,n);class G0 extends zo{constructor(e,t,r=Float32Array){const i=ArrayBuffer.isView(e)?e:new r(e*t);super(i,t),this.isStorageInstancedBufferAttribute=!0}}class mG extends Hi{constructor(e,t,r=Float32Array){const i=ArrayBuffer.isView(e)?e:new r(e*t);super(i,t),this.isStorageBufferAttribute=!0}}const gG=(n,e="float")=>{let t,r;e.isStruct===!0?(t=e.layout.getLength(),r=Oh("float")):(t=ET(e),r=Oh(e));const i=new mG(n,t,r);return ro(i,e,n)},yG=(n,e="float")=>{let t,r;e.isStruct===!0?(t=e.layout.getLength(),r=Oh("float")):(t=ET(e),r=Oh(e));const i=new G0(n,t,r);return ro(i,e,n)};class _G extends Ie{static get type(){return"PointUVNode"}constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}const vG=Me(_G),Vu=new RA,dp=new dn;class qr extends Ie{static get type(){return"SceneNode"}constructor(e=qr.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,r=this.scene!==null?this.scene:e.scene;let i;return t===qr.BACKGROUND_BLURRINESS?i=zt("backgroundBlurriness","float",r):t===qr.BACKGROUND_INTENSITY?i=zt("backgroundIntensity","float",r):t===qr.BACKGROUND_ROTATION?i=Ve("mat4").setName("backgroundRotation").setGroup(Ge).onRenderUpdate(()=>{const s=r.background;return s!==null&&s.isTexture&&s.mapping!==zC?(Vu.copy(r.backgroundRotation),Vu.x*=-1,Vu.y*=-1,Vu.z*=-1,dp.makeRotationFromEuler(Vu)):dp.identity(),dp}):Be("SceneNode: Unknown scope:",t),i}}qr.BACKGROUND_BLURRINESS="backgroundBlurriness";qr.BACKGROUND_INTENSITY="backgroundIntensity";qr.BACKGROUND_ROTATION="backgroundRotation";const c5=Me(qr,qr.BACKGROUND_BLURRINESS),Sg=Me(qr,qr.BACKGROUND_INTENSITY),h5=Me(qr,qr.BACKGROUND_ROTATION);class bG extends Ms{static get type(){return"StorageTextureNode"}constructor(e,t,r=null){super(e,t),this.storeNode=r,this.mipLevel=0,this.isStorageTextureNode=!0,this.access=ar.WRITE_ONLY}getInputType(){return"storageTexture"}setup(e){super.setup(e);const t=e.getNodeProperties(this);return t.storeNode=this.storeNode,t}setAccess(e){return this.access=e,this}setMipLevel(e){return this.mipLevel=e,this}generate(e,t){let r;return this.storeNode!==null?r=this.generateStore(e):r=super.generate(e,t),r}toReadWrite(){return this.setAccess(ar.READ_WRITE)}toReadOnly(){return this.setAccess(ar.READ_ONLY)}toWriteOnly(){return this.setAccess(ar.WRITE_ONLY)}generateStore(e){const t=e.getNodeProperties(this),{uvNode:r,storeNode:i,depthNode:s}=t,o=super.generate(e,"property"),a=r.build(e,this.value.is3DTexture===!0?"uvec3":"uvec2"),c=i.build(e,"vec4"),f=s?s.build(e,"int"):null,p=e.generateTextureStore(e,o,a,f,c);e.addLineFlowCode(p,this)}clone(){const e=super.clone();return e.storeNode=this.storeNode,e.mipLevel=this.mipLevel,e}}const f5=tt(bG).setParameterLength(1,3),xG=(n,e,t)=>{const r=f5(n,e,t);return t!==null&&r.toStack(),r},TG=re(({texture:n,uv:e})=>{const r=Z().toVar();return ze(e.x.lessThan(1e-4),()=>{r.assign(Z(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{r.assign(Z(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{r.assign(Z(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{r.assign(Z(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{r.assign(Z(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{r.assign(Z(0,0,-1))}).Else(()=>{const s=n.sample(e.add(Z(-.01,0,0))).r.sub(n.sample(e.add(Z(.01,0,0))).r),o=n.sample(e.add(Z(0,-.01,0))).r.sub(n.sample(e.add(Z(0,.01,0))).r),a=n.sample(e.add(Z(0,0,-.01))).r.sub(n.sample(e.add(Z(0,0,.01))).r);r.assign(Z(s,o,a))}),r.normalize()});class wG extends Ms{static get type(){return"Texture3DNode"}constructor(e,t=null,r=null){super(e,t,r),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return Z(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){const r=this.value;return e.isFlipY()&&(r.isRenderTargetTexture===!0||r.isFramebufferTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(X(eo(this,this.levelNode).y).sub(t.y).sub(1))),t}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}generateOffset(e,t){return t.build(e,"ivec3")}normal(e){return TG({texture:this,uv:e})}}const Gf=tt(wG).setParameterLength(1,3),SG=(...n)=>Gf(...n).setSampler(!1),EG=(n,e,t)=>Gf(n,e).level(t);class RG extends Mf{static get type(){return"UserDataNode"}constructor(e,t,r=null){super(e,t,r),this.userData=r}updateReference(e){return this.reference=this.userData!==null?this.userData:e.object.userData,this.reference}}const CG=(n,e,t)=>new RG(n,e,t),Xv=new WeakMap;class NG extends vn{static get type(){return"VelocityNode"}constructor(){super("vec2"),this.projectionMatrix=null,this.updateType=ot.OBJECT,this.updateAfterType=ot.OBJECT,this.previousModelWorldMatrix=Ve(new dn),this.previousProjectionMatrix=Ve(new dn).setGroup(Ge),this.previousCameraViewMatrix=Ve(new dn)}setProjectionMatrix(e){this.projectionMatrix=e}update({frameId:e,camera:t,object:r}){const i=Yv(r);this.previousModelWorldMatrix.value.copy(i);const s=d5(t);s.frameId!==e&&(s.frameId=e,s.previousProjectionMatrix===void 0?(s.previousProjectionMatrix=new dn,s.previousCameraViewMatrix=new dn,s.currentProjectionMatrix=new dn,s.currentCameraViewMatrix=new dn,s.previousProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),s.previousCameraViewMatrix.copy(t.matrixWorldInverse)):(s.previousProjectionMatrix.copy(s.currentProjectionMatrix),s.previousCameraViewMatrix.copy(s.currentCameraViewMatrix)),s.currentProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),s.currentCameraViewMatrix.copy(t.matrixWorldInverse),this.previousProjectionMatrix.value.copy(s.previousProjectionMatrix),this.previousCameraViewMatrix.value.copy(s.previousCameraViewMatrix))}updateAfter({object:e}){Yv(e).copy(e.matrixWorld)}setup(){const e=this.projectionMatrix===null?no:Ve(this.projectionMatrix),t=this.previousCameraViewMatrix.mul(this.previousModelWorldMatrix),r=e.mul(na).mul(pn),i=this.previousProjectionMatrix.mul(t).mul(jh),s=r.xy.div(r.w),o=i.xy.div(i.w);return St(s,o)}}function d5(n){let e=Xv.get(n);return e===void 0&&(e={},Xv.set(n,e)),e}function Yv(n,e=0){const t=d5(n);let r=t[e];return r===void 0&&(t[e]=r=new dn,t[e].copy(n.matrixWorld)),r}const MG=Me(NG),PG=re(([n])=>Q2(n.rgb)),BG=re(([n,e=z(1)])=>e.mix(Q2(n.rgb),n.rgb)),DG=re(([n,e=z(1)])=>{const t=Ln(n.r,n.g,n.b).div(3),r=n.r.max(n.g.max(n.b)),i=r.sub(t).mul(e).mul(-3);return Tt(n.rgb,r,i)}),LG=re(([n,e=z(1)])=>{const t=Z(.57735,.57735,.57735),r=e.cos();return Z(n.rgb.mul(r).add(t.cross(n.rgb).mul(e.sin()).add(t.mul(Ri(t,n.rgb).mul(r.oneMinus())))))}),Q2=(n,e=Z(Sn.getLuminanceCoefficients(new ge)))=>Ri(n,e),OG=re(([n,e=Z(1),t=Z(0),r=Z(1),i=z(1),s=Z(Sn.getLuminanceCoefficients(new ge,Jx))])=>{const o=n.rgb.dot(Z(s)),a=_n(n.rgb.mul(e).add(t),0).toVar(),c=a.pow(r).toVar();return ze(a.r.greaterThan(0),()=>{a.r.assign(c.r)}),ze(a.g.greaterThan(0),()=>{a.g.assign(c.g)}),ze(a.b.greaterThan(0),()=>{a.b.assign(c.b)}),a.assign(o.add(a.sub(o).mul(i))),je(a.rgb,n.a)});class FG extends vn{static get type(){return"PosterizeNode"}constructor(e,t){super(),this.sourceNode=e,this.stepsNode=t}setup(){const{sourceNode:e,stepsNode:t}=this;return e.mul(t).floor().div(t)}}const IG=tt(FG).setParameterLength(2),Yc=new _t;class p5 extends Ms{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class Kv extends p5{static get type(){return"PassMultipleTextureNode"}constructor(e,t,r=!1){super(e,null),this.textureName=t,this.previousTexture=r}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){const e=new this.constructor(this.passNode,this.textureName,this.previousTexture);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}class Ps extends vn{static get type(){return"PassNode"}constructor(e,t,r,i={}){super("vec4"),this.scope=e,this.scene=t,this.camera=r,this.options=i,this._pixelRatio=1,this._width=1,this._height=1;const s=new Wi;s.isRenderTargetTexture=!0,s.name="depth";const o=new ea(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:or,...i});o.texture.name="output",o.depthTexture=s,this.renderTarget=o,this.overrideMaterial=null,this.transparent=!0,this.opaque=!0,this.contextNode=null,this._contextNodeCache=null,this._textures={output:o.texture,depth:s},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=Ve(0),this._cameraFar=Ve(0),this._mrt=null,this._layers=null,this._resolutionScale=1,this._viewport=null,this._scissor=null,this.isPassNode=!0,this.updateBeforeType=ot.FRAME,this.global=!0}setResolutionScale(e){return this._resolutionScale=e,this}getResolutionScale(){return this._resolutionScale}setResolution(e){return De("PassNode: .setResolution() is deprecated. Use .setResolutionScale() instead."),this.setResolutionScale(e)}getResolution(){return De("PassNode: .getResolution() is deprecated. Use .getResolutionScale() instead."),this.getResolutionScale()}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const r=this._textures[e],i=this.renderTarget.textures.indexOf(r);this.renderTarget.textures[i]=t,this._textures[e]=t,this._previousTextures[e]=r,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=new Kv(this,e),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=new Kv(this,e,!0),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const r=this._cameraNear,i=this._cameraFar;this._viewZNodes[e]=t=L2(this.getTextureNode(e),r,i)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const r=this._cameraNear,i=this._cameraFar,s=this.getViewZNode(e);this._linearDepthNodes[e]=t=Xl(s,r,i)}return t}async compileAsync(e){const t=e.getRenderTarget(),r=e.getMRT();e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),await e.compileAsync(this.scene,this.camera),e.setRenderTarget(t),e.setMRT(r)}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,this.renderTarget.texture.type=e.getOutputBufferType(),this.scope===Ps.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:r}=this;let i,s;const o=t.getOutputRenderTarget();o&&o.isXRRenderTarget===!0?(s=1,i=t.xr.getCamera(),t.xr.updateCamera(i),Yc.set(o.width,o.height)):(i=this.camera,s=t.getPixelRatio(),t.getSize(Yc)),this._pixelRatio=s,this.setSize(Yc.width,Yc.height);const a=t.getRenderTarget(),c=t.getMRT(),f=t.autoClear,p=t.transparent,g=t.opaque,v=i.layers.mask,x=t.contextNode,T=r.overrideMaterial;this._cameraNear.value=i.near,this._cameraFar.value=i.far,this._layers!==null&&(i.layers.mask=this._layers.mask);for(const E in this._previousTextures)this.toggleTexture(E);this.overrideMaterial!==null&&(r.overrideMaterial=this.overrideMaterial),t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.autoClear=!0,t.transparent=this.transparent,t.opaque=this.opaque,this.contextNode!==null&&((this._contextNodeCache===null||this._contextNodeCache.version!==this.version)&&(this._contextNodeCache={version:this.version,context:fo({...t.contextNode.getFlowContextData(),...this.contextNode.getFlowContextData()})}),t.contextNode=this._contextNodeCache.context);const S=r.name;r.name=this.name?this.name:r.name,t.render(r,i),r.name=S,r.overrideMaterial=T,t.setRenderTarget(a),t.setMRT(c),t.autoClear=f,t.transparent=p,t.opaque=g,t.contextNode=x,i.layers.mask=v}setSize(e,t){this._width=e,this._height=t;const r=Math.floor(this._width*this._pixelRatio*this._resolutionScale),i=Math.floor(this._height*this._pixelRatio*this._resolutionScale);this.renderTarget.setSize(r,i),this._scissor!==null&&this.renderTarget.scissor.copy(this._scissor),this._viewport!==null&&this.renderTarget.viewport.copy(this._viewport)}setScissor(e,t,r,i){e===null?this._scissor=null:(this._scissor===null&&(this._scissor=new $t),e.isVector4?this._scissor.copy(e):this._scissor.set(e,t,r,i),this._scissor.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setViewport(e,t,r,i){e===null?this._viewport=null:(this._viewport===null&&(this._viewport=new $t),e.isVector4?this._viewport.copy(e):this._viewport.set(e,t,r,i),this._viewport.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}Ps.COLOR="color";Ps.DEPTH="depth";const kG=(n,e,t)=>new Ps(Ps.COLOR,n,e,t),UG=(n,e)=>new p5(n,e),qG=(n,e,t)=>new Ps(Ps.DEPTH,n,e,t);class GG extends Ps{static get type(){return"ToonOutlinePassNode"}constructor(e,t,r,i,s){super(Ps.COLOR,e,t),this.colorNode=r,this.thicknessNode=i,this.alphaNode=s,this._materialCache=new WeakMap,this.name="Outline Pass"}updateBefore(e){const{renderer:t}=e,r=t.getRenderObjectFunction();t.setRenderObjectFunction((i,s,o,a,c,f,p,g)=>{if((c.isMeshToonMaterial||c.isMeshToonNodeMaterial)&&c.wireframe===!1){const v=this._getOutlineMaterial(c);t.renderObject(i,s,o,a,v,f,p,g)}t.renderObject(i,s,o,a,c,f,p,g)}),super.updateBefore(e),t.setRenderObjectFunction(r)}_createMaterial(){const e=new Rn;e.isMeshToonOutlineMaterial=!0,e.name="Toon_Outline",e.side=yr;const t=jr.negate(),r=no.mul(na),i=z(1),s=r.mul(je(pn,1)),o=r.mul(je(pn.add(t),1)),a=Mr(s.sub(o));return e.vertexNode=s.add(a.mul(this.thicknessNode).mul(s.w).mul(i)),e.colorNode=je(this.colorNode,this.alphaNode),e}_getOutlineMaterial(e){let t=this._materialCache.get(e);return t===void 0&&(t=this._createMaterial(),this._materialCache.set(e,t)),t}}const VG=(n,e,t=new jn(0,0,0),r=.003,i=1)=>Pe(new GG(n,e,Pe(t),Pe(r),Pe(i))),m5=re(([n,e])=>n.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),g5=re(([n,e])=>(n=n.mul(e),n.div(n.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),y5=re(([n,e])=>{n=n.mul(e),n=n.sub(.004).max(0);const t=n.mul(n.mul(6.2).add(.5)),r=n.mul(n.mul(6.2).add(1.7)).add(.06);return t.div(r).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),zG=re(([n])=>{const e=n.mul(n.add(.0245786)).sub(90537e-9),t=n.mul(n.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),_5=re(([n,e])=>{const t=ur(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),r=ur(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return n=n.mul(e).div(.6),n=t.mul(n),n=zG(n),n=r.mul(n),n.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),jG=ur(Z(1.6605,-.1246,-.0182),Z(-.5876,1.1329,-.1006),Z(-.0728,-.0083,1.1187)),$G=ur(Z(.6274,.0691,.0164),Z(.3293,.9195,.088),Z(.0433,.0113,.8956)),HG=re(([n])=>{const e=Z(n).toVar(),t=Z(e.mul(e)).toVar(),r=Z(t.mul(t)).toVar();return z(15.5).mul(r.mul(t)).sub(et(40.14,r.mul(e))).add(et(31.96,r).sub(et(6.868,t.mul(e))).add(et(.4298,t).add(et(.1191,e).sub(.00232))))}),v5=re(([n,e])=>{const t=Z(n).toVar(),r=ur(Z(.856627153315983,.137318972929847,.11189821299995),Z(.0951212405381588,.761241990602591,.0767994186031903),Z(.0482516061458583,.101439036467562,.811302368396859)),i=ur(Z(1.1271005818144368,-.1413297634984383,-.14132976349843826),Z(-.11060664309660323,1.157823702216272,-.11060664309660294),Z(-.016493938717834573,-.016493938717834257,1.2519364065950405)),s=z(-12.47393),o=z(4.026069);return t.mulAssign(e),t.assign($G.mul(t)),t.assign(r.mul(t)),t.assign(_n(t,1e-10)),t.assign(xs(t)),t.assign(t.sub(s).div(o.sub(s))),t.assign(Ki(t,0,1)),t.assign(HG(t)),t.assign(i.mul(t)),t.assign(_i(_n(Z(0),t),Z(2.2))),t.assign(jG.mul(t)),t.assign(Ki(t,0,1)),t}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),b5=re(([n,e])=>{const t=z(.76),r=z(.15);n=n.mul(e);const i=zr(n.r,zr(n.g,n.b)),s=lr(i.lessThan(.08),i.sub(et(6.25,i.mul(i))),.04);n.subAssign(s);const o=_n(n.r,_n(n.g,n.b));ze(o.lessThan(t),()=>n);const a=St(1,t),c=St(1,a.mul(a).div(o.add(a.sub(t))));n.mulAssign(c.div(o));const f=St(1,ai(1,r.mul(o.sub(c)).add(1)));return Tt(n,Z(c),f)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class Zn extends Ie{static get type(){return"CodeNode"}constructor(e="",t=[],r=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=e,this.includes=t,this.language=r}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const i of t)i.build(e);const r=e.getCodeFromNode(this,this.getNodeType(e));return r.code=this.code,r.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}const Vf=tt(Zn).setParameterLength(1,3),WG=(n,e)=>Vf(n,e,"js"),QG=(n,e)=>Vf(n,e,"wgsl"),XG=(n,e)=>Vf(n,e,"glsl");class x5 extends Zn{static get type(){return"FunctionNode"}constructor(e="",t=[],r=""){super(e,t,r)}getNodeType(e){return this.getNodeFunction(e).type}getMemberType(e,t){const r=this.getNodeType(e);return e.getStructTypeNode(r).getMemberType(e,t)}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let r=t.nodeFunction;return r===void 0&&(r=e.parser.parseFunction(this.code),t.nodeFunction=r),r}generate(e,t){super.generate(e);const r=this.getNodeFunction(e),i=r.name,s=r.type,o=e.getCodeFromNode(this,s);i!==""&&(o.name=i);const a=e.getPropertyName(o),c=this.getNodeFunction(e).getCode(a);return o.code=c+`
`,t==="property"?a:e.format(`${a}()`,s,t)}}const T5=(n,e=[],t="")=>{for(let s=0;s<e.length;s++){const o=e[s];typeof o=="function"&&(e[s]=o.functionNode)}const r=new x5(n,e,t),i=(...s)=>r.call(...s);return i.functionNode=r,i},YG=(n,e)=>T5(n,e,"glsl"),KG=(n,e)=>T5(n,e,"wgsl");class ZG extends Ie{static get type(){return"ScriptableValueNode"}constructor(e=null){super(),this._value=e,this._cache=null,this.inputType=null,this.outputType=null,this.events=new sf,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return this.outputType!==null}set value(e){this._value!==e&&(this._cache&&this.inputType==="URL"&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=e,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const e=this.value;if(e&&this._cache===null&&this.inputType==="URL"&&e.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([e.value]));else if(e&&e.value!==null&&e.value!==void 0&&((this.inputType==="URL"||this.inputType==="String")&&typeof e.value=="string"||this.inputType==="Number"&&typeof e.value=="number"||this.inputType==="Vector2"&&e.value.isVector2||this.inputType==="Vector3"&&e.value.isVector3||this.inputType==="Vector4"&&e.value.isVector4||this.inputType==="Color"&&e.value.isColor||this.inputType==="Matrix3"&&e.value.isMatrix3||this.inputType==="Matrix4"&&e.value.isMatrix4))return e.value;return this._cache||e}getNodeType(e){return this.value&&this.value.isNode?this.value.getNodeType(e):"float"}setup(){return this.value&&this.value.isNode?this.value:z()}serialize(e){super.serialize(e),this.value!==null?this.inputType==="ArrayBuffer"?e.value=CT(this.value):e.value=this.value?this.value.toJSON(e.meta).uuid:null:e.value=null,e.inputType=this.inputType,e.outputType=this.outputType}deserialize(e){super.deserialize(e);let t=null;e.value!==null&&(e.inputType==="ArrayBuffer"?t=NT(e.value):e.inputType==="Texture"?t=e.meta.textures[e.value]:t=e.meta.nodes[e.value]||null),this.value=t,this.inputType=e.inputType,this.outputType=e.outputType}}const V0=tt(ZG).setParameterLength(1);class w5 extends Map{get(e,t=null,...r){if(this.has(e))return super.get(e);if(t!==null){const i=t(...r);return this.set(e,i),i}}}class JG{constructor(e){this.scriptableNode=e}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(e){return this.scriptableNode.getInputLayout(e)}get(e){const t=this.parameters[e];return t?t.getValue():null}}const z0=new w5;class eV extends Ie{static get type(){return"ScriptableNode"}constructor(e=null,t={}){super(),this.codeNode=e,this.parameters=t,this._local=new w5,this._output=V0(null),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(e,t){return this._local.set(e,t)}getLocal(e){return this._local.get(e)}onRefresh(){this._refresh()}getInputLayout(e){for(const t of this.getLayout())if(t.inputType&&(t.id===e||t.name===e))return t}getOutputLayout(e){for(const t of this.getLayout())if(t.outputType&&(t.id===e||t.name===e))return t}setOutput(e,t){const r=this._outputs;return r[e]===void 0?r[e]=V0(t):r[e].value=t,this}getOutput(e){return this._outputs[e]}getParameter(e){return this.parameters[e]}setParameter(e,t){const r=this.parameters;return t&&t.isScriptableNode?(this.deleteParameter(e),r[e]=t,r[e].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):t&&t.isScriptableValueNode?(this.deleteParameter(e),r[e]=t,r[e].events.addEventListener("refresh",this.onRefresh)):r[e]===void 0?(r[e]=V0(t),r[e].events.addEventListener("refresh",this.onRefresh)):r[e].value=t,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(e){let t=this.parameters[e];return t&&(t.isScriptableNode&&(t=t.getDefaultOutput()),t.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const e of Object.keys(this.parameters))this.deleteParameter(e);return this.needsUpdate=!0,this}call(e,...t){const i=this.getObject()[e];if(typeof i=="function")return i(...t)}async callAsync(e,...t){const i=this.getObject()[e];if(typeof i=="function")return i.constructor.name==="AsyncFunction"?await i(...t):i(...t)}getNodeType(e){return this.getDefaultOutputNode().getNodeType(e)}refresh(e=null){e!==null?this.getOutput(e).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),this._object!==null)return this._object;const e=()=>this.refresh(),t=(f,p)=>this.setOutput(f,p),r=new JG(this),i=z0.get("THREE"),s=z0.get("TSL"),o=this.getMethod(),a=[r,this._local,z0,e,t,i,s];this._object=o(...a);const c=this._object.layout;if(c&&(c.cache===!1&&this._local.clear(),this._output.outputType=c.outputType||null,Array.isArray(c.elements)))for(const f of c.elements){const p=f.id||f.name;f.inputType&&(this.getParameter(p)===void 0&&this.setParameter(p,null),this.getParameter(p).inputType=f.inputType),f.outputType&&(this.getOutput(p)===void 0&&this.setOutput(p,null),this.getOutput(p).outputType=f.outputType)}return this._object}deserialize(e){super.deserialize(e);for(const t in this.parameters){let r=this.parameters[t];r.isScriptableNode&&(r=r.getDefaultOutput()),r.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const e=this.getDefaultOutput().value;return e&&e.isNode?e:z()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),this._method!==null)return this._method;const e=["parameters","local","global","refresh","setOutput","THREE","TSL"],r=["layout","init","main","dispose"].join(", "),i="var "+r+`; var output = {};
`,s=`
return { ...output, `+r+" };",o=i+this.codeNode.code+s;return this._method=new Function(...e,o),this._method}dispose(){this._method!==null&&(this._object&&typeof this._object.dispose=="function"&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}getCacheKey(e){const t=[ec(this.source),this.getDefaultOutputNode().getCacheKey(e)];for(const r in this.parameters)t.push(this.parameters[r].getCacheKey(e));return pu(t)}set needsUpdate(e){e===!0&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return this.codeNode===null?this:(this._needsOutputUpdate===!0&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value,this)}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const tV=tt(eV).setParameterLength(1,2);function S5(n){let e;const t=n.context.getViewZ;return t!==void 0&&(e=t(this)),(e||Mn.z).negate()}const X2=re(([n,e],t)=>{const r=S5(t);return Zi(n,e,r)}),Y2=re(([n],e)=>{const t=S5(e);return n.mul(n,t,t).negate().exp().oneMinus()}),$A=re(([n,e])=>je(e.toFloat().mix(Hl.rgb,n.toVec3()),Hl.a));function nV(n,e,t){return De('TSL: "rangeFog( color, near, far )" is deprecated. Use "fog( color, rangeFogFactor( near, far ) )" instead.'),$A(n,X2(e,t))}function rV(n,e){return De('TSL: "densityFog( color, density )" is deprecated. Use "fog( color, densityFogFactor( density ) )" instead.'),$A(n,Y2(e))}let ya=null,_a=null;class iV extends Ie{static get type(){return"RangeNode"}constructor(e=z(),t=z()){super(),this.minNode=e,this.maxNode=t}getVectorLength(e){const t=this.getConstNode(this.minNode),r=this.getConstNode(this.maxNode),i=e.getTypeLength(Go(t.value)),s=e.getTypeLength(Go(r.value));return i>s?i:s}getNodeType(e){return e.object.count>1?e.getTypeFromLength(this.getVectorLength(e)):"float"}getConstNode(e){let t=null;if(e.traverse(r=>{r.isConstNode===!0&&(t=r)}),t===null)throw new Error('THREE.TSL: No "ConstNode" found in node graph.');return t}setup(e){const t=e.object;let r=null;if(t.count>1){const i=this.getConstNode(this.minNode),s=this.getConstNode(this.maxNode),o=i.value,a=s.value,c=e.getTypeLength(Go(o)),f=e.getTypeLength(Go(a));ya=ya||new $t,_a=_a||new $t,ya.setScalar(0),_a.setScalar(0),c===1?ya.setScalar(o):o.isColor?ya.set(o.r,o.g,o.b,1):ya.set(o.x,o.y,o.z||0,o.w||0),f===1?_a.setScalar(a):a.isColor?_a.set(a.r,a.g,a.b,1):_a.set(a.x,a.y,a.z||0,a.w||0);const p=4,g=p*t.count,v=new Float32Array(g);for(let T=0;T<g;T++){const S=T%p,E=ya.getComponent(S),N=_a.getComponent(S);v[T]=Jl.lerp(E,N,Math.random())}const x=this.getNodeType(e);if(t.count<=4096)r=rc(v,"vec4",t.count).element(Es).convert(x);else{const T=new zo(v,4);e.geometry.setAttribute("__range"+this.id,T),r=zh(T).convert(x)}}else r=z(0);return r}}const sV=tt(iV).setParameterLength(2);class oV extends Ie{static get type(){return"ComputeBuiltinNode"}constructor(e,t){super(t),this._builtinName=e}getHash(e){return this.getBuiltinName(e)}getNodeType(){return this.nodeType}setBuiltinName(e){return this._builtinName=e,this}getBuiltinName(){return this._builtinName}hasBuiltin(e){return e.hasBuiltin(this._builtinName)}generate(e,t){const r=this.getBuiltinName(e),i=this.getNodeType(e);return e.shaderStage==="compute"?e.format(r,i,t):(De(`ComputeBuiltinNode: Compute built-in value ${r} can not be accessed in the ${e.shaderStage} stage`),e.generateConst(i))}serialize(e){super.serialize(e),e.global=this.global,e._builtinName=this._builtinName}deserialize(e){super.deserialize(e),this.global=e.global,this._builtinName=e._builtinName}}const lc=(n,e)=>new oV(n,e),aV=lc("numWorkgroups","uvec3"),lV=lc("workgroupId","uvec3"),uV=lc("globalId","uvec3"),AV=lc("localId","uvec3"),cV=lc("subgroupSize","uint");class hV extends Ie{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:r}=e;r.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}const K2=tt(hV),fV=()=>K2("workgroup").toStack(),dV=()=>K2("storage").toStack(),pV=()=>K2("texture").toStack();class mV extends Ka{constructor(e,t){super(e,t),this.isWorkgroupInfoElementNode=!0}generate(e,t){let r;const i=e.context.assign;if(r=super.generate(e),i!==!0){const s=this.getNodeType(e);r=e.format(r,s,t)}return r}}class gV extends Ie{constructor(e,t,r=0){super(t),this.bufferType=t,this.bufferCount=r,this.isWorkgroupInfoNode=!0,this.elementType=t,this.scope=e,this.name=""}setName(e){return this.name=e,this}label(e){return De('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setScope(e){return this.scope=e,this}getElementType(){return this.elementType}getInputType(){return`${this.scope}Array`}element(e){return new mV(this,e)}generate(e){const t=this.name!==""?this.name:`${this.scope}Array_${this.id}`;return e.getScopedArray(t,this.scope.toLowerCase(),this.bufferType,this.bufferCount)}}const yV=(n,e)=>new gV("Workgroup",n,e);class Hn extends Ie{static get type(){return"AtomicFunctionNode"}constructor(e,t,r){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=r,this.parents=!0}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=e.getNodeProperties(this),r=t.parents,i=this.method,s=this.getNodeType(e),o=this.getInputType(e),a=this.pointerNode,c=this.valueNode,f=[];f.push(`&${a.build(e,o)}`),c!==null&&f.push(c.build(e,o));const p=`${e.getMethod(i,s)}( ${f.join(", ")} )`;if(r?r.length===1&&r[0].isStackNode===!0:!1)e.addLineFlowCode(p,this);else return t.constNode===void 0&&(t.constNode=Ao(p,s).toConst()),t.constNode.build(e)}}Hn.ATOMIC_LOAD="atomicLoad";Hn.ATOMIC_STORE="atomicStore";Hn.ATOMIC_ADD="atomicAdd";Hn.ATOMIC_SUB="atomicSub";Hn.ATOMIC_MAX="atomicMax";Hn.ATOMIC_MIN="atomicMin";Hn.ATOMIC_AND="atomicAnd";Hn.ATOMIC_OR="atomicOr";Hn.ATOMIC_XOR="atomicXor";const _V=tt(Hn),Is=(n,e,t)=>_V(n,e,t).toStack(),vV=n=>Is(Hn.ATOMIC_LOAD,n,null),bV=(n,e)=>Is(Hn.ATOMIC_STORE,n,e),xV=(n,e)=>Is(Hn.ATOMIC_ADD,n,e),TV=(n,e)=>Is(Hn.ATOMIC_SUB,n,e),wV=(n,e)=>Is(Hn.ATOMIC_MAX,n,e),SV=(n,e)=>Is(Hn.ATOMIC_MIN,n,e),EV=(n,e)=>Is(Hn.ATOMIC_AND,n,e),RV=(n,e)=>Is(Hn.ATOMIC_OR,n,e),CV=(n,e)=>Is(Hn.ATOMIC_XOR,n,e);class Le extends vn{static get type(){return"SubgroupFunctionNode"}constructor(e,t=null,r=null){super(),this.method=e,this.aNode=t,this.bNode=r}getInputType(e){const t=this.aNode?this.aNode.getNodeType(e):null,r=this.bNode?this.bNode.getNodeType(e):null,i=e.isMatrix(t)?0:e.getTypeLength(t),s=e.isMatrix(r)?0:e.getTypeLength(r);return i>s?t:r}getNodeType(e){const t=this.method;return t===Le.SUBGROUP_ELECT?"bool":t===Le.SUBGROUP_BALLOT?"uvec4":this.getInputType(e)}generate(e,t){const r=this.method,i=this.getNodeType(e),s=this.getInputType(e),o=this.aNode,a=this.bNode,c=[];if(r===Le.SUBGROUP_BROADCAST||r===Le.SUBGROUP_SHUFFLE||r===Le.QUAD_BROADCAST){const p=a.getNodeType(e);c.push(o.build(e,i),a.build(e,p==="float"?"int":i))}else r===Le.SUBGROUP_SHUFFLE_XOR||r===Le.SUBGROUP_SHUFFLE_DOWN||r===Le.SUBGROUP_SHUFFLE_UP?c.push(o.build(e,i),a.build(e,"uint")):(o!==null&&c.push(o.build(e,s)),a!==null&&c.push(a.build(e,s)));const f=c.length===0?"()":`( ${c.join(", ")} )`;return e.format(`${e.getMethod(r,i)}${f}`,i,t)}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}Le.SUBGROUP_ELECT="subgroupElect";Le.SUBGROUP_BALLOT="subgroupBallot";Le.SUBGROUP_ADD="subgroupAdd";Le.SUBGROUP_INCLUSIVE_ADD="subgroupInclusiveAdd";Le.SUBGROUP_EXCLUSIVE_AND="subgroupExclusiveAdd";Le.SUBGROUP_MUL="subgroupMul";Le.SUBGROUP_INCLUSIVE_MUL="subgroupInclusiveMul";Le.SUBGROUP_EXCLUSIVE_MUL="subgroupExclusiveMul";Le.SUBGROUP_AND="subgroupAnd";Le.SUBGROUP_OR="subgroupOr";Le.SUBGROUP_XOR="subgroupXor";Le.SUBGROUP_MIN="subgroupMin";Le.SUBGROUP_MAX="subgroupMax";Le.SUBGROUP_ALL="subgroupAll";Le.SUBGROUP_ANY="subgroupAny";Le.SUBGROUP_BROADCAST_FIRST="subgroupBroadcastFirst";Le.QUAD_SWAP_X="quadSwapX";Le.QUAD_SWAP_Y="quadSwapY";Le.QUAD_SWAP_DIAGONAL="quadSwapDiagonal";Le.SUBGROUP_BROADCAST="subgroupBroadcast";Le.SUBGROUP_SHUFFLE="subgroupShuffle";Le.SUBGROUP_SHUFFLE_XOR="subgroupShuffleXor";Le.SUBGROUP_SHUFFLE_UP="subgroupShuffleUp";Le.SUBGROUP_SHUFFLE_DOWN="subgroupShuffleDown";Le.QUAD_BROADCAST="quadBroadcast";const NV=Se(Le,Le.SUBGROUP_ELECT).setParameterLength(0),MV=Se(Le,Le.SUBGROUP_BALLOT).setParameterLength(1),PV=Se(Le,Le.SUBGROUP_ADD).setParameterLength(1),BV=Se(Le,Le.SUBGROUP_INCLUSIVE_ADD).setParameterLength(1),DV=Se(Le,Le.SUBGROUP_EXCLUSIVE_AND).setParameterLength(1),LV=Se(Le,Le.SUBGROUP_MUL).setParameterLength(1),OV=Se(Le,Le.SUBGROUP_INCLUSIVE_MUL).setParameterLength(1),FV=Se(Le,Le.SUBGROUP_EXCLUSIVE_MUL).setParameterLength(1),IV=Se(Le,Le.SUBGROUP_AND).setParameterLength(1),kV=Se(Le,Le.SUBGROUP_OR).setParameterLength(1),UV=Se(Le,Le.SUBGROUP_XOR).setParameterLength(1),qV=Se(Le,Le.SUBGROUP_MIN).setParameterLength(1),GV=Se(Le,Le.SUBGROUP_MAX).setParameterLength(1),VV=Se(Le,Le.SUBGROUP_ALL).setParameterLength(0),zV=Se(Le,Le.SUBGROUP_ANY).setParameterLength(0),jV=Se(Le,Le.SUBGROUP_BROADCAST_FIRST).setParameterLength(2),$V=Se(Le,Le.QUAD_SWAP_X).setParameterLength(1),HV=Se(Le,Le.QUAD_SWAP_Y).setParameterLength(1),WV=Se(Le,Le.QUAD_SWAP_DIAGONAL).setParameterLength(1),QV=Se(Le,Le.SUBGROUP_BROADCAST).setParameterLength(2),XV=Se(Le,Le.SUBGROUP_SHUFFLE).setParameterLength(2),YV=Se(Le,Le.SUBGROUP_SHUFFLE_XOR).setParameterLength(2),KV=Se(Le,Le.SUBGROUP_SHUFFLE_UP).setParameterLength(2),ZV=Se(Le,Le.SUBGROUP_SHUFFLE_DOWN).setParameterLength(2),JV=Se(Le,Le.QUAD_BROADCAST).setParameterLength(1);let Kc;function zf(n){Kc=Kc||new WeakMap;let e=Kc.get(n);return e===void 0&&Kc.set(n,e={}),e}function jf(n){const e=zf(n);return e.shadowMatrix||(e.shadowMatrix=Ve("mat4").setGroup(Ge).onRenderUpdate(t=>((n.castShadow!==!0||t.renderer.shadowMap.enabled===!1)&&(n.shadow.camera.coordinateSystem!==t.camera.coordinateSystem&&(n.shadow.camera.coordinateSystem=t.camera.coordinateSystem,n.shadow.camera.updateProjectionMatrix()),n.shadow.updateMatrices(n)),n.shadow.matrix)))}function E5(n,e=Ss){const t=jf(n).mul(e);return t.xyz.div(t.w)}function Z2(n){const e=zf(n);return e.position||(e.position=Ve(new ge).setGroup(Ge).onRenderUpdate((t,r)=>r.value.setFromMatrixPosition(n.matrixWorld)))}function R5(n){const e=zf(n);return e.targetPosition||(e.targetPosition=Ve(new ge).setGroup(Ge).onRenderUpdate((t,r)=>r.value.setFromMatrixPosition(n.target.matrixWorld)))}function J2(n){const e=zf(n);return e.viewPosition||(e.viewPosition=Ve(new ge).setGroup(Ge).onRenderUpdate(({camera:t},r)=>{r.value=r.value||new ge,r.value.setFromMatrixPosition(n.matrixWorld),r.value.applyMatrix4(t.matrixWorldInverse)}))}const ey=n=>Bi.transformDirection(Z2(n).sub(R5(n))),ez=n=>n.sort((e,t)=>e.id-t.id),tz=(n,e)=>{for(const t of e)if(t.isAnalyticLightNode&&t.light.id===n)return t;return null},pp=new WeakMap,zu=[];class ty extends Ie{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=Js("vec3","totalDiffuse"),this.totalSpecularNode=Js("vec3","totalSpecular"),this.outgoingLightNode=Js("vec3","outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=this._lights;for(let r=0;r<e.length;r++){const i=e[r];if(zu.push(i.id),zu.push(i.castShadow?1:0),i.isSpotLight===!0){const s=i.map!==null?i.map.id:-1,o=i.colorNode?i.colorNode.getCacheKey():-1;zu.push(s,o)}}const t=pu(zu);return zu.length=0,t}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const t=[];for(const r of this._lightNodes)t.push(r.getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getNodeProperties(this);for(const r of t.nodes)r.build(e);t.outputNode.build(e)}setupLightsNode(e){const t=[],r=this._lightNodes,i=ez(this._lights),s=e.renderer.library;for(const o of i)if(o.isNode)t.push(Pe(o));else{let a=null;if(r!==null&&(a=tz(o.id,r)),a===null){const c=s.getLightNodeClass(o.constructor);if(c===null){De(`LightsNode.setupNodeLights: Light node not found for ${o.constructor.name}`);continue}let f=null;pp.has(o)?f=pp.get(o):(f=new c(o),pp.set(o,f)),t.push(f)}}this._lightNodes=t}setupDirectLight(e,t,r){const{lightingModel:i,reflectedLight:s}=e.context;i.direct({...r,lightNode:t,reflectedLight:s},e)}setupDirectRectAreaLight(e,t,r){const{lightingModel:i,reflectedLight:s}=e.context;i.directRectArea({...r,lightNode:t,reflectedLight:s},e)}setupLights(e,t){for(const r of t)r.build(e)}getLightNodes(e){return this._lightNodes===null&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let r=this.outgoingLightNode;const i=e.context,s=i.lightingModel,o=e.getNodeProperties(this);if(s){const{totalDiffuseNode:a,totalSpecularNode:c}=this;i.outgoingLight=r;const f=e.addStack();o.nodes=f.nodes,s.start(e);const{backdrop:p,backdropAlpha:g}=i,{directDiffuse:v,directSpecular:x,indirectDiffuse:T,indirectSpecular:S}=i.reflectedLight;let E=v.add(T);p!==null&&(g!==null?E=Z(g.mix(E,p)):E=Z(p)),a.assign(E),c.assign(x.add(S)),r.assign(a.add(c)),s.finish(e),r=r.bypass(e.removeStack())}else o.nodes=[];return e.lightsNode=t,r}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}const nz=(n=[])=>new ty().setLights(n);class rz extends Ie{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=ot.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){ny.assign(t.receivedShadowPositionNode||e.shadowPositionWorld||Ss)}}const ny=Js("vec3","shadowPositionWorld");function iz(n,e={}){return e.toneMapping=n.toneMapping,e.toneMappingExposure=n.toneMappingExposure,e.outputColorSpace=n.outputColorSpace,e.renderTarget=n.getRenderTarget(),e.activeCubeFace=n.getActiveCubeFace(),e.activeMipmapLevel=n.getActiveMipmapLevel(),e.renderObjectFunction=n.getRenderObjectFunction(),e.pixelRatio=n.getPixelRatio(),e.mrt=n.getMRT(),e.clearColor=n.getClearColor(e.clearColor||new jn),e.clearAlpha=n.getClearAlpha(),e.autoClear=n.autoClear,e.scissorTest=n.getScissorTest(),e}function sz(n,e){return e=iz(n,e),n.setMRT(null),n.setRenderObjectFunction(null),n.setClearColor(0,1),n.autoClear=!0,e}function oz(n,e){n.toneMapping=e.toneMapping,n.toneMappingExposure=e.toneMappingExposure,n.outputColorSpace=e.outputColorSpace,n.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),n.setRenderObjectFunction(e.renderObjectFunction),n.setPixelRatio(e.pixelRatio),n.setMRT(e.mrt),n.setClearColor(e.clearColor,e.clearAlpha),n.autoClear=e.autoClear,n.setScissorTest(e.scissorTest)}function az(n,e={}){return e.background=n.background,e.backgroundNode=n.backgroundNode,e.overrideMaterial=n.overrideMaterial,e}function lz(n,e){return e=az(n,e),n.background=null,n.backgroundNode=null,n.overrideMaterial=null,e}function uz(n,e){n.background=e.background,n.backgroundNode=e.backgroundNode,n.overrideMaterial=e.overrideMaterial}function Az(n,e,t){return t=sz(n,t),t=lz(e,t),t}function cz(n,e,t){oz(n,t),uz(e,t)}const Qh=new WeakMap,C5=re(({depthTexture:n,shadowCoord:e,depthLayer:t})=>{let r=Nt(n,e.xy).setName("t_basic");return n.isArrayTexture&&(r=r.depth(t)),r.compare(e.z)}),N5=re(({depthTexture:n,shadowCoord:e,shadow:t,depthLayer:r})=>{const i=(p,g)=>{let v=Nt(n,p);return n.isArrayTexture&&(v=v.depth(r)),v.compare(g)},s=zt("mapSize","vec2",t).setGroup(Ge),o=zt("radius","float",t).setGroup(Ge),a=we(1).div(s),c=o.mul(a.x),f=W2(Ja.xy).mul(6.28318530718);return Ln(i(e.xy.add(Vi(0,5,f).mul(c)),e.z),i(e.xy.add(Vi(1,5,f).mul(c)),e.z),i(e.xy.add(Vi(2,5,f).mul(c)),e.z),i(e.xy.add(Vi(3,5,f).mul(c)),e.z),i(e.xy.add(Vi(4,5,f).mul(c)),e.z)).mul(1/5)}),M5=re(({depthTexture:n,shadowCoord:e,shadow:t,depthLayer:r})=>{const i=(g,v)=>{let x=Nt(n,g);return n.isArrayTexture&&(x=x.depth(r)),x.compare(v)},s=zt("mapSize","vec2",t).setGroup(Ge),o=we(1).div(s),a=o.x,c=o.y,f=e.xy,p=Yi(f.mul(s).add(.5));return f.subAssign(p.mul(o)),Ln(i(f,e.z),i(f.add(we(a,0)),e.z),i(f.add(we(0,c)),e.z),i(f.add(o),e.z),Tt(i(f.add(we(a.negate(),0)),e.z),i(f.add(we(a.mul(2),0)),e.z),p.x),Tt(i(f.add(we(a.negate(),c)),e.z),i(f.add(we(a.mul(2),c)),e.z),p.x),Tt(i(f.add(we(0,c.negate())),e.z),i(f.add(we(0,c.mul(2))),e.z),p.y),Tt(i(f.add(we(a,c.negate())),e.z),i(f.add(we(a,c.mul(2))),e.z),p.y),Tt(Tt(i(f.add(we(a.negate(),c.negate())),e.z),i(f.add(we(a.mul(2),c.negate())),e.z),p.x),Tt(i(f.add(we(a.negate(),c.mul(2))),e.z),i(f.add(we(a.mul(2),c.mul(2))),e.z),p.x),p.y)).mul(1/9)}),P5=re(({depthTexture:n,shadowCoord:e,depthLayer:t})=>{let r=Nt(n).sample(e.xy);n.isArrayTexture&&(r=r.depth(t)),r=r.rg;const i=r.x,s=_n(1e-7,r.y.mul(r.y)),o=Sf(e.z,i);ze(o.equal(1),()=>z(1));const a=e.z.sub(i);let c=s.div(s.add(a.mul(a)));return c=Ki(St(c,.3).div(.65)),_n(o,c)}),hz=re(([n,e,t])=>{let r=Ss.sub(n).length();return r=r.sub(e).div(t.sub(e)),r=r.saturate(),r}),fz=n=>{const e=n.shadow.camera,t=zt("near","float",e).setGroup(Ge),r=zt("far","float",e).setGroup(Ge),i=f6(n);return hz(i,t,r)},B5=n=>{let e=Qh.get(n);if(e===void 0){const t=n.isPointLight?fz(n):null;e=new Rn,e.colorNode=je(0,0,0,1),e.depthNode=t,e.isShadowPassMaterial=!0,e.name="ShadowMaterial",e.fog=!1,Qh.set(n,e)}return e},D5=n=>{const e=Qh.get(n);e!==void 0&&(e.dispose(),Qh.delete(n))},Zv=new Ji,wl=[],L5=(n,e,t,r)=>{wl[0]=n,wl[1]=e;let i=Zv.get(wl);return(i===void 0||i.shadowType!==t||i.useVelocity!==r)&&(i=(s,o,a,c,f,p,...g)=>{(s.castShadow===!0||s.receiveShadow&&t===S0)&&(r&&(RT(s).useVelocity=!0),s.onBeforeShadow(n,s,a,e.camera,c,o.overrideMaterial,p),n.renderObject(s,o,a,c,f,p,...g),s.onAfterShadow(n,s,a,e.camera,c,o.overrideMaterial,p))},i.shadowType=t,i.useVelocity=r,Zv.set(wl,i)),wl[0]=null,wl[1]=null,i},dz=re(({samples:n,radius:e,size:t,shadowPass:r,depthLayer:i})=>{const s=z(0).toVar("meanVertical"),o=z(0).toVar("squareMeanVertical"),a=n.lessThanEqual(z(1)).select(z(0),z(2).div(n.sub(1))),c=n.lessThanEqual(z(1)).select(z(0),z(-1));qt({start:X(0),end:X(n),type:"int",condition:"<"},({i:p})=>{const g=c.add(z(p).mul(a));let v=r.sample(Ln(Ja.xy,we(0,g).mul(e)).div(t));r.value.isArrayTexture&&(v=v.depth(i)),v=v.x,s.addAssign(v),o.addAssign(v.mul(v))}),s.divAssign(n),o.divAssign(n);const f=gr(o.sub(s.mul(s)).max(0));return we(s,f)}),pz=re(({samples:n,radius:e,size:t,shadowPass:r,depthLayer:i})=>{const s=z(0).toVar("meanHorizontal"),o=z(0).toVar("squareMeanHorizontal"),a=n.lessThanEqual(z(1)).select(z(0),z(2).div(n.sub(1))),c=n.lessThanEqual(z(1)).select(z(0),z(-1));qt({start:X(0),end:X(n),type:"int",condition:"<"},({i:p})=>{const g=c.add(z(p).mul(a));let v=r.sample(Ln(Ja.xy,we(g,0).mul(e)).div(t));r.value.isArrayTexture&&(v=v.depth(i)),s.addAssign(v.x),o.addAssign(Ln(v.y.mul(v.y),v.x.mul(v.x)))}),s.divAssign(n),o.divAssign(n);const f=gr(o.sub(s.mul(s)).max(0));return we(s,f)}),mz=[C5,N5,M5,P5];let mp;const Zc=new Uf;class O5 extends rz{static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._currentShadowType=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(e,{filterFn:t,depthTexture:r,shadowCoord:i,shadow:s,depthLayer:o}){const a=i.x.greaterThanEqual(0).and(i.x.lessThanEqual(1)).and(i.y.greaterThanEqual(0)).and(i.y.lessThanEqual(1)).and(i.z.lessThanEqual(1)),c=t({depthTexture:r,shadowCoord:i,shadow:s,depthLayer:o});return a.select(c,z(1))}setupShadowCoord(e,t){const{shadow:r}=this,{renderer:i}=e,s=zt("bias","float",r).setGroup(Ge);let o=t,a;if(r.camera.isOrthographicCamera||i.logarithmicDepthBuffer!==!0)o=o.xyz.div(o.w),a=o.z,i.coordinateSystem===Qo&&(a=a.mul(2).sub(1));else{const c=o.w;o=o.xy.div(c);const f=zt("near","float",r.camera).setGroup(Ge),p=zt("far","float",r.camera).setGroup(Ge);a=O2(c.negate(),f,p)}return o=Z(o.x,o.y.oneMinus(),a.add(s)),o}getShadowFilterFn(e){return mz[e]}setupRenderTarget(e,t){const r=new Wi(e.mapSize.width,e.mapSize.height);r.name="ShadowDepthTexture",r.compareFunction=uf;const i=t.createRenderTarget(e.mapSize.width,e.mapSize.height);return i.texture.name="ShadowMap",i.texture.type=e.mapType,i.depthTexture=r,{shadowMap:i,depthTexture:r}}setupShadow(e){const{renderer:t,camera:r}=e,{light:i,shadow:s}=this,o=t.shadowMap.type,{depthTexture:a,shadowMap:c}=this.setupRenderTarget(s,e);if(s.camera.coordinateSystem=r.coordinateSystem,s.camera.updateProjectionMatrix(),o===S0&&s.isPointLightShadow!==!0){a.compareFunction=null,c.depth>1?(c._vsmShadowMapVertical||(c._vsmShadowMapVertical=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:Qs,type:or,depth:c.depth,depthBuffer:!1}),c._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=c._vsmShadowMapVertical,c._vsmShadowMapHorizontal||(c._vsmShadowMapHorizontal=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:Qs,type:or,depth:c.depth,depthBuffer:!1}),c._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=c._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:Qs,type:or,depthBuffer:!1}),this.vsmShadowMapHorizontal=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:Qs,type:or,depthBuffer:!1}));let B=Nt(a);a.isArrayTexture&&(B=B.depth(this.depthLayer));let L=Nt(this.vsmShadowMapVertical.texture);a.isArrayTexture&&(L=L.depth(this.depthLayer));const k=zt("blurSamples","float",s).setGroup(Ge),q=zt("radius","float",s).setGroup(Ge),I=zt("mapSize","vec2",s).setGroup(Ge);let U=this.vsmMaterialVertical||(this.vsmMaterialVertical=new Rn);U.fragmentNode=dz({samples:k,radius:q,size:I,shadowPass:B,depthLayer:this.depthLayer}).context(e.getSharedContext()),U.name="VSMVertical",U=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new Rn),U.fragmentNode=pz({samples:k,radius:q,size:I,shadowPass:L,depthLayer:this.depthLayer}).context(e.getSharedContext()),U.name="VSMHorizontal"}const f=zt("intensity","float",s).setGroup(Ge),p=zt("normalBias","float",s).setGroup(Ge),g=jf(i).mul(ny.add(ra.mul(p))),v=this.setupShadowCoord(e,g),x=s.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(x===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const T=o===S0&&s.isPointLightShadow!==!0?this.vsmShadowMapHorizontal.texture:a,S=this.setupShadowFilter(e,{filterFn:x,shadowTexture:c.texture,depthTexture:T,shadowCoord:v,shadow:s,depthLayer:this.depthLayer});let E;c.texture.isCubeTexture?E=Nr(c.texture,v.xyz):(E=Nt(c.texture,v),a.isArrayTexture&&(E=E.depth(this.depthLayer)));const N=Tt(1,S.rgb.mix(E,1),f.mul(E.a)).toVar();this.shadowMap=c,this.shadow.map=c;const P=`${this.light.type} Shadow [ ${this.light.name||"ID: "+this.light.id} ]`;return N.toInspector(`${P} / Color`,()=>this.shadowMap.texture.isCubeTexture?Nr(this.shadowMap.texture):Nt(this.shadowMap.texture)).toInspector(`${P} / Depth`,()=>this.shadowMap.texture.isCubeTexture?Nr(this.shadowMap.texture).r.oneMinus():wn(this.shadowMap.depthTexture,Ht().mul(eo(Nt(this.shadowMap.depthTexture)))).r.oneMinus())}setup(e){if(e.renderer.shadowMap.enabled!==!1)return re(()=>{const t=e.renderer.shadowMap.type;this._currentShadowType!==t&&(this._reset(),this._node=null);let r=this._node;return this.setupShadowPosition(e),r===null&&(this._node=r=this.setupShadow(e),this._currentShadowType=t),e.material.shadowNode&&De('NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(r=e.material.receivedShadowNode(r)),r})()}renderShadow(e){const{shadow:t,shadowMap:r,light:i}=this,{renderer:s,scene:o}=e;t.updateMatrices(i),r.setSize(t.mapSize.width,t.mapSize.height,r.depth);const a=o.name;o.name=`Shadow Map [ ${i.name||"ID: "+i.id} ]`,s.render(o,t.camera),o.name=a}updateShadow(e){const{shadowMap:t,light:r,shadow:i}=this,{renderer:s,scene:o,camera:a}=e,c=s.shadowMap.type,f=t.depthTexture.version;this._depthVersionCached=f;const p=i.camera.layers.mask;(i.camera.layers.mask&4294967294)===0&&(i.camera.layers.mask=a.layers.mask);const g=s.getRenderObjectFunction(),v=s.getMRT(),x=v?v.has("velocity"):!1;mp=Az(s,o,mp),o.overrideMaterial=B5(r),s.setRenderObjectFunction(L5(s,i,c,x)),s.setClearColor(0,0),s.setRenderTarget(t),this.renderShadow(e),s.setRenderObjectFunction(g),c===S0&&i.isPointLightShadow!==!0&&this.vsmPass(s),i.camera.layers.mask=p,cz(s,o,mp)}vsmPass(e){const{shadow:t}=this,r=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height,r),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height,r),e.setRenderTarget(this.vsmShadowMapVertical),Zc.material=this.vsmMaterialVertical,Zc.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),Zc.material=this.vsmMaterialHorizontal,Zc.render(e)}dispose(){this._reset(),super.dispose()}_reset(){this._currentShadowType=null,D5(this.light),this.shadowMap&&(this.shadowMap.dispose(),this.shadowMap=null),this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null)}updateBefore(e){const{shadow:t}=this;let r=t.needsUpdate||t.autoUpdate;r&&(this._cameraFrameId[e.camera]===e.frameId&&(r=!1),this._cameraFrameId[e.camera]=e.frameId),r&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const F5=(n,e)=>new O5(n,e),gz=new jn,Jv=new dn,ju=new ge,gp=new ge,yz=[new ge(1,0,0),new ge(-1,0,0),new ge(0,-1,0),new ge(0,1,0),new ge(0,0,1),new ge(0,0,-1)],_z=[new ge(0,-1,0),new ge(0,-1,0),new ge(0,0,-1),new ge(0,0,1),new ge(0,-1,0),new ge(0,-1,0)],vz=[new ge(1,0,0),new ge(-1,0,0),new ge(0,1,0),new ge(0,-1,0),new ge(0,0,1),new ge(0,0,-1)],bz=[new ge(0,-1,0),new ge(0,-1,0),new ge(0,0,1),new ge(0,0,-1),new ge(0,-1,0),new ge(0,-1,0)],I5=re(({depthTexture:n,bd3D:e,dp:t})=>Nr(n,e).compare(t)),k5=re(({depthTexture:n,bd3D:e,dp:t,shadow:r})=>{const i=zt("radius","float",r).setGroup(Ge),s=zt("mapSize","vec2",r).setGroup(Ge),o=i.div(s.x),a=en(e),c=Mr(uo(e,a.x.greaterThan(a.z).select(Z(0,1,0),Z(1,0,0)))),f=uo(e,c),p=W2(Ja.xy).mul(6.28318530718),g=Vi(0,5,p),v=Vi(1,5,p),x=Vi(2,5,p),T=Vi(3,5,p),S=Vi(4,5,p);return Nr(n,e.add(c.mul(g.x).add(f.mul(g.y)).mul(o))).compare(t).add(Nr(n,e.add(c.mul(v.x).add(f.mul(v.y)).mul(o))).compare(t)).add(Nr(n,e.add(c.mul(x.x).add(f.mul(x.y)).mul(o))).compare(t)).add(Nr(n,e.add(c.mul(T.x).add(f.mul(T.y)).mul(o))).compare(t)).add(Nr(n,e.add(c.mul(S.x).add(f.mul(S.y)).mul(o))).compare(t)).mul(1/5)}),xz=re(({filterFn:n,depthTexture:e,shadowCoord:t,shadow:r})=>{const i=t.xyz.toVar(),s=i.length(),o=Ve("float").setGroup(Ge).onRenderUpdate(()=>r.camera.near),a=Ve("float").setGroup(Ge).onRenderUpdate(()=>r.camera.far),c=zt("bias","float",r).setGroup(Ge),f=z(1).toVar();return ze(s.sub(a).lessThanEqual(0).and(s.sub(o).greaterThanEqual(0)),()=>{const p=s.sub(o).div(a.sub(o)).toVar();p.addAssign(c);const g=i.normalize();f.assign(n({depthTexture:e,bd3D:g,dp:p,shadow:r}))}),f});class Tz extends O5{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===GC?I5:k5}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,depthTexture:r,shadowCoord:i,shadow:s}){return xz({filterFn:t,depthTexture:r,shadowCoord:i,shadow:s})}setupRenderTarget(e,t){const r=new VC(e.mapSize.width);r.name="PointShadowDepthTexture",r.compareFunction=uf;const i=t.createCubeRenderTarget(e.mapSize.width);return i.texture.name="PointShadowMap",i.depthTexture=r,{shadowMap:i,depthTexture:r}}renderShadow(e){const{shadow:t,shadowMap:r,light:i}=this,{renderer:s,scene:o}=e,a=t.camera,c=t.matrix,f=s.coordinateSystem===Qo,p=f?yz:vz,g=f?_z:bz;r.setSize(t.mapSize.width,t.mapSize.width);const v=s.autoClear,x=s.getClearColor(gz),T=s.getClearAlpha();s.autoClear=!1,s.setClearColor(t.clearColor,t.clearAlpha);for(let S=0;S<6;S++){s.setRenderTarget(r,S),s.clear();const E=i.distance||a.far;E!==a.far&&(a.far=E,a.updateProjectionMatrix()),ju.setFromMatrixPosition(i.matrixWorld),a.position.copy(ju),gp.copy(a.position),gp.add(p[S]),a.up.copy(g[S]),a.lookAt(gp),a.updateMatrixWorld(),c.makeTranslation(-ju.x,-ju.y,-ju.z),Jv.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse),t._frustum.setFromProjectionMatrix(Jv,a.coordinateSystem,a.reversedDepth);const N=o.name;o.name=`Point Light Shadow [ ${i.name||"ID: "+i.id} ] - Face ${S+1}`,s.render(o,a),o.name=N}s.autoClear=v,s.setClearColor(x,T)}}const U5=(n,e)=>new Tz(n,e);class el extends gu{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new jn,this.colorNode=e&&e.colorNode||Ve(this.color).setGroup(Ge),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=ot.FRAME,e&&e.shadow&&(this._shadowDisposeListener=()=>{this.disposeShadow()},e.addEventListener("dispose",this._shadowDisposeListener))}dispose(){this._shadowDisposeListener&&this.light.removeEventListener("dispose",this._shadowDisposeListener),super.dispose()}disposeShadow(){this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null),this.shadowColorNode=null,this.baseColorNode!==null&&(this.colorNode=this.baseColorNode,this.baseColorNode=null)}getHash(){return this.light.uuid}getLightVector(e){return J2(this.light).sub(e.context.positionView||Mn)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return F5(this.light)}setupShadow(e){const{renderer:t}=e;if(t.shadowMap.enabled===!1)return;let r=this.shadowColorNode;if(r===null){const i=this.light.shadow.shadowNode;let s;i!==void 0?s=Pe(i):s=this.setupShadowNode(),this.shadowNode=s,this.shadowColorNode=r=this.colorNode.mul(s),this.baseColorNode=this.colorNode}e.context.getShadow&&(r=e.context.getShadow(this,e)),this.colorNode=r}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),r=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),r&&e.lightsNode.setupDirectRectAreaLight(e,this,r)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const ry=re(({lightDistance:n,cutoffDistance:e,decayExponent:t})=>{const r=n.pow(t).max(.01).reciprocal();return e.greaterThan(0).select(r.mul(n.div(e).pow4().oneMinus().clamp().pow2()),r)}),q5=({color:n,lightVector:e,cutoffDistance:t,decayExponent:r})=>{const i=e.normalize(),s=e.length(),o=ry({lightDistance:s,cutoffDistance:t,decayExponent:r}),a=n.mul(o);return{lightDirection:i,lightColor:a}};class wz extends el{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=Ve(0).setGroup(Ge),this.decayExponentNode=Ve(2).setGroup(Ge)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return U5(this.light)}setupDirect(e){return q5({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}const Sz=re(([n=Ht()])=>{const e=n.mul(2),t=e.x.floor(),r=e.y.floor();return t.add(r).mod(2).sign()}),Ez=re(([n=Ht()],{renderer:e,material:t})=>{const r=A2(n.mul(2).sub(1));let i;if(t.alphaToCoverage&&e.currentSamples>0){const s=z(r.fwidth()).toVar();i=Zi(s.oneMinus(),s.add(1),r).oneMinus()}else i=lr(r.greaterThan(1),0,1);return i}),xA=re(([n,e,t])=>{const r=z(t).toVar(),i=z(e).toVar(),s=Ei(n).toVar();return lr(s,i,r)}).setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),Xh=re(([n,e])=>{const t=Ei(e).toVar(),r=z(n).toVar();return lr(t,r.negate(),r)}).setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),Dn=re(([n])=>{const e=z(n).toVar();return X(Ts(e))}).setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),An=re(([n,e])=>{const t=z(n).toVar();return e.assign(Dn(t)),t.sub(z(e))}),Rz=re(([n,e,t,r,i,s])=>{const o=z(s).toVar(),a=z(i).toVar(),c=z(r).toVar(),f=z(t).toVar(),p=z(e).toVar(),g=z(n).toVar(),v=z(St(1,a)).toVar();return St(1,o).mul(g.mul(v).add(p.mul(a))).add(o.mul(f.mul(v).add(c.mul(a))))}).setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),Cz=re(([n,e,t,r,i,s])=>{const o=z(s).toVar(),a=z(i).toVar(),c=Z(r).toVar(),f=Z(t).toVar(),p=Z(e).toVar(),g=Z(n).toVar(),v=z(St(1,a)).toVar();return St(1,o).mul(g.mul(v).add(p.mul(a))).add(o.mul(f.mul(v).add(c.mul(a))))}).setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]}),G5=cr([Rz,Cz]),Nz=re(([n,e,t,r,i,s,o,a,c,f,p])=>{const g=z(p).toVar(),v=z(f).toVar(),x=z(c).toVar(),T=z(a).toVar(),S=z(o).toVar(),E=z(s).toVar(),N=z(i).toVar(),P=z(r).toVar(),B=z(t).toVar(),L=z(e).toVar(),k=z(n).toVar(),q=z(St(1,x)).toVar(),I=z(St(1,v)).toVar();return z(St(1,g)).toVar().mul(I.mul(k.mul(q).add(L.mul(x))).add(v.mul(B.mul(q).add(P.mul(x))))).add(g.mul(I.mul(N.mul(q).add(E.mul(x))).add(v.mul(S.mul(q).add(T.mul(x))))))}).setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),Mz=re(([n,e,t,r,i,s,o,a,c,f,p])=>{const g=z(p).toVar(),v=z(f).toVar(),x=z(c).toVar(),T=Z(a).toVar(),S=Z(o).toVar(),E=Z(s).toVar(),N=Z(i).toVar(),P=Z(r).toVar(),B=Z(t).toVar(),L=Z(e).toVar(),k=Z(n).toVar(),q=z(St(1,x)).toVar(),I=z(St(1,v)).toVar();return z(St(1,g)).toVar().mul(I.mul(k.mul(q).add(L.mul(x))).add(v.mul(B.mul(q).add(P.mul(x))))).add(g.mul(I.mul(N.mul(q).add(E.mul(x))).add(v.mul(S.mul(q).add(T.mul(x))))))}).setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),V5=cr([Nz,Mz]),Pz=re(([n,e,t])=>{const r=z(t).toVar(),i=z(e).toVar(),s=ye(n).toVar(),o=ye(s.bitAnd(ye(7))).toVar(),a=z(xA(o.lessThan(ye(4)),i,r)).toVar(),c=z(et(2,xA(o.lessThan(ye(4)),r,i))).toVar();return Xh(a,Ei(o.bitAnd(ye(1)))).add(Xh(c,Ei(o.bitAnd(ye(2)))))}).setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),Bz=re(([n,e,t,r])=>{const i=z(r).toVar(),s=z(t).toVar(),o=z(e).toVar(),a=ye(n).toVar(),c=ye(a.bitAnd(ye(15))).toVar(),f=z(xA(c.lessThan(ye(8)),o,s)).toVar(),p=z(xA(c.lessThan(ye(4)),s,xA(c.equal(ye(12)).or(c.equal(ye(14))),o,i))).toVar();return Xh(f,Ei(c.bitAnd(ye(1)))).add(Xh(p,Ei(c.bitAnd(ye(2)))))}).setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),Jn=cr([Pz,Bz]),Dz=re(([n,e,t])=>{const r=z(t).toVar(),i=z(e).toVar(),s=Za(n).toVar();return Z(Jn(s.x,i,r),Jn(s.y,i,r),Jn(s.z,i,r))}).setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),Lz=re(([n,e,t,r])=>{const i=z(r).toVar(),s=z(t).toVar(),o=z(e).toVar(),a=Za(n).toVar();return Z(Jn(a.x,o,s,i),Jn(a.y,o,s,i),Jn(a.z,o,s,i))}).setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),pi=cr([Dz,Lz]),Oz=re(([n])=>{const e=z(n).toVar();return et(.6616,e)}).setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),Fz=re(([n])=>{const e=z(n).toVar();return et(.982,e)}).setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),Iz=re(([n])=>{const e=Z(n).toVar();return et(.6616,e)}).setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),z5=cr([Oz,Iz]),kz=re(([n])=>{const e=Z(n).toVar();return et(.982,e)}).setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),j5=cr([Fz,kz]),ni=re(([n,e])=>{const t=X(e).toVar(),r=ye(n).toVar();return r.shiftLeft(t).bitOr(r.shiftRight(X(32).sub(t)))}).setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),$5=re(([n,e,t])=>{n.subAssign(t),n.bitXorAssign(ni(t,X(4))),t.addAssign(e),e.subAssign(n),e.bitXorAssign(ni(n,X(6))),n.addAssign(t),t.subAssign(e),t.bitXorAssign(ni(e,X(8))),e.addAssign(n),n.subAssign(t),n.bitXorAssign(ni(t,X(16))),t.addAssign(e),e.subAssign(n),e.bitXorAssign(ni(n,X(19))),n.addAssign(t),t.subAssign(e),t.bitXorAssign(ni(e,X(4))),e.addAssign(n)}),uc=re(([n,e,t])=>{const r=ye(t).toVar(),i=ye(e).toVar(),s=ye(n).toVar();return r.bitXorAssign(i),r.subAssign(ni(i,X(14))),s.bitXorAssign(r),s.subAssign(ni(r,X(11))),i.bitXorAssign(s),i.subAssign(ni(s,X(25))),r.bitXorAssign(i),r.subAssign(ni(i,X(16))),s.bitXorAssign(r),s.subAssign(ni(r,X(4))),i.bitXorAssign(s),i.subAssign(ni(s,X(14))),r.bitXorAssign(i),r.subAssign(ni(i,X(24))),r}).setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),_r=re(([n])=>{const e=ye(n).toVar();return z(e).div(z(ye(X(4294967295))))}).setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),Rs=re(([n])=>{const e=z(n).toVar();return e.mul(e).mul(e).mul(e.mul(e.mul(6).sub(15)).add(10))}).setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),Uz=re(([n])=>{const e=X(n).toVar(),t=ye(ye(1)).toVar(),r=ye(ye(X(3735928559)).add(t.shiftLeft(ye(2))).add(ye(13))).toVar();return uc(r.add(ye(e)),r,r)}).setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),qz=re(([n,e])=>{const t=X(e).toVar(),r=X(n).toVar(),i=ye(ye(2)).toVar(),s=ye().toVar(),o=ye().toVar(),a=ye().toVar();return s.assign(o.assign(a.assign(ye(X(3735928559)).add(i.shiftLeft(ye(2))).add(ye(13))))),s.addAssign(ye(r)),o.addAssign(ye(t)),uc(s,o,a)}).setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),Gz=re(([n,e,t])=>{const r=X(t).toVar(),i=X(e).toVar(),s=X(n).toVar(),o=ye(ye(3)).toVar(),a=ye().toVar(),c=ye().toVar(),f=ye().toVar();return a.assign(c.assign(f.assign(ye(X(3735928559)).add(o.shiftLeft(ye(2))).add(ye(13))))),a.addAssign(ye(s)),c.addAssign(ye(i)),f.addAssign(ye(r)),uc(a,c,f)}).setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),Vz=re(([n,e,t,r])=>{const i=X(r).toVar(),s=X(t).toVar(),o=X(e).toVar(),a=X(n).toVar(),c=ye(ye(4)).toVar(),f=ye().toVar(),p=ye().toVar(),g=ye().toVar();return f.assign(p.assign(g.assign(ye(X(3735928559)).add(c.shiftLeft(ye(2))).add(ye(13))))),f.addAssign(ye(a)),p.addAssign(ye(o)),g.addAssign(ye(s)),$5(f,p,g),f.addAssign(ye(i)),uc(f,p,g)}).setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),zz=re(([n,e,t,r,i])=>{const s=X(i).toVar(),o=X(r).toVar(),a=X(t).toVar(),c=X(e).toVar(),f=X(n).toVar(),p=ye(ye(5)).toVar(),g=ye().toVar(),v=ye().toVar(),x=ye().toVar();return g.assign(v.assign(x.assign(ye(X(3735928559)).add(p.shiftLeft(ye(2))).add(ye(13))))),g.addAssign(ye(f)),v.addAssign(ye(c)),x.addAssign(ye(a)),$5(g,v,x),g.addAssign(ye(o)),v.addAssign(ye(s)),uc(g,v,x)}).setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]}),jt=cr([Uz,qz,Gz,Vz,zz]),jz=re(([n,e])=>{const t=X(e).toVar(),r=X(n).toVar(),i=ye(jt(r,t)).toVar(),s=Za().toVar();return s.x.assign(i.bitAnd(X(255))),s.y.assign(i.shiftRight(X(8)).bitAnd(X(255))),s.z.assign(i.shiftRight(X(16)).bitAnd(X(255))),s}).setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),$z=re(([n,e,t])=>{const r=X(t).toVar(),i=X(e).toVar(),s=X(n).toVar(),o=ye(jt(s,i,r)).toVar(),a=Za().toVar();return a.x.assign(o.bitAnd(X(255))),a.y.assign(o.shiftRight(X(8)).bitAnd(X(255))),a.z.assign(o.shiftRight(X(16)).bitAnd(X(255))),a}).setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),mi=cr([jz,$z]),Hz=re(([n])=>{const e=we(n).toVar(),t=X().toVar(),r=X().toVar(),i=z(An(e.x,t)).toVar(),s=z(An(e.y,r)).toVar(),o=z(Rs(i)).toVar(),a=z(Rs(s)).toVar(),c=z(G5(Jn(jt(t,r),i,s),Jn(jt(t.add(X(1)),r),i.sub(1),s),Jn(jt(t,r.add(X(1))),i,s.sub(1)),Jn(jt(t.add(X(1)),r.add(X(1))),i.sub(1),s.sub(1)),o,a)).toVar();return z5(c)}).setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),Wz=re(([n])=>{const e=Z(n).toVar(),t=X().toVar(),r=X().toVar(),i=X().toVar(),s=z(An(e.x,t)).toVar(),o=z(An(e.y,r)).toVar(),a=z(An(e.z,i)).toVar(),c=z(Rs(s)).toVar(),f=z(Rs(o)).toVar(),p=z(Rs(a)).toVar(),g=z(V5(Jn(jt(t,r,i),s,o,a),Jn(jt(t.add(X(1)),r,i),s.sub(1),o,a),Jn(jt(t,r.add(X(1)),i),s,o.sub(1),a),Jn(jt(t.add(X(1)),r.add(X(1)),i),s.sub(1),o.sub(1),a),Jn(jt(t,r,i.add(X(1))),s,o,a.sub(1)),Jn(jt(t.add(X(1)),r,i.add(X(1))),s.sub(1),o,a.sub(1)),Jn(jt(t,r.add(X(1)),i.add(X(1))),s,o.sub(1),a.sub(1)),Jn(jt(t.add(X(1)),r.add(X(1)),i.add(X(1))),s.sub(1),o.sub(1),a.sub(1)),c,f,p)).toVar();return j5(g)}).setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]}),iy=cr([Hz,Wz]),Qz=re(([n])=>{const e=we(n).toVar(),t=X().toVar(),r=X().toVar(),i=z(An(e.x,t)).toVar(),s=z(An(e.y,r)).toVar(),o=z(Rs(i)).toVar(),a=z(Rs(s)).toVar(),c=Z(G5(pi(mi(t,r),i,s),pi(mi(t.add(X(1)),r),i.sub(1),s),pi(mi(t,r.add(X(1))),i,s.sub(1)),pi(mi(t.add(X(1)),r.add(X(1))),i.sub(1),s.sub(1)),o,a)).toVar();return z5(c)}).setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),Xz=re(([n])=>{const e=Z(n).toVar(),t=X().toVar(),r=X().toVar(),i=X().toVar(),s=z(An(e.x,t)).toVar(),o=z(An(e.y,r)).toVar(),a=z(An(e.z,i)).toVar(),c=z(Rs(s)).toVar(),f=z(Rs(o)).toVar(),p=z(Rs(a)).toVar(),g=Z(V5(pi(mi(t,r,i),s,o,a),pi(mi(t.add(X(1)),r,i),s.sub(1),o,a),pi(mi(t,r.add(X(1)),i),s,o.sub(1),a),pi(mi(t.add(X(1)),r.add(X(1)),i),s.sub(1),o.sub(1),a),pi(mi(t,r,i.add(X(1))),s,o,a.sub(1)),pi(mi(t.add(X(1)),r,i.add(X(1))),s.sub(1),o,a.sub(1)),pi(mi(t,r.add(X(1)),i.add(X(1))),s,o.sub(1),a.sub(1)),pi(mi(t.add(X(1)),r.add(X(1)),i.add(X(1))),s.sub(1),o.sub(1),a.sub(1)),c,f,p)).toVar();return j5(g)}).setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),Ac=cr([Qz,Xz]),Yz=re(([n])=>{const e=z(n).toVar(),t=X(Dn(e)).toVar();return _r(jt(t))}).setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),Kz=re(([n])=>{const e=we(n).toVar(),t=X(Dn(e.x)).toVar(),r=X(Dn(e.y)).toVar();return _r(jt(t,r))}).setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),Zz=re(([n])=>{const e=Z(n).toVar(),t=X(Dn(e.x)).toVar(),r=X(Dn(e.y)).toVar(),i=X(Dn(e.z)).toVar();return _r(jt(t,r,i))}).setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),Jz=re(([n])=>{const e=je(n).toVar(),t=X(Dn(e.x)).toVar(),r=X(Dn(e.y)).toVar(),i=X(Dn(e.z)).toVar(),s=X(Dn(e.w)).toVar();return _r(jt(t,r,i,s))}).setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]}),ej=cr([Yz,Kz,Zz,Jz]),tj=re(([n])=>{const e=z(n).toVar(),t=X(Dn(e)).toVar();return Z(_r(jt(t,X(0))),_r(jt(t,X(1))),_r(jt(t,X(2))))}).setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),nj=re(([n])=>{const e=we(n).toVar(),t=X(Dn(e.x)).toVar(),r=X(Dn(e.y)).toVar();return Z(_r(jt(t,r,X(0))),_r(jt(t,r,X(1))),_r(jt(t,r,X(2))))}).setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),rj=re(([n])=>{const e=Z(n).toVar(),t=X(Dn(e.x)).toVar(),r=X(Dn(e.y)).toVar(),i=X(Dn(e.z)).toVar();return Z(_r(jt(t,r,i,X(0))),_r(jt(t,r,i,X(1))),_r(jt(t,r,i,X(2))))}).setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),ij=re(([n])=>{const e=je(n).toVar(),t=X(Dn(e.x)).toVar(),r=X(Dn(e.y)).toVar(),i=X(Dn(e.z)).toVar(),s=X(Dn(e.w)).toVar();return Z(_r(jt(t,r,i,s,X(0))),_r(jt(t,r,i,s,X(1))),_r(jt(t,r,i,s,X(2))))}).setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]}),$f=cr([tj,nj,rj,ij]),Yh=re(([n,e,t,r])=>{const i=z(r).toVar(),s=z(t).toVar(),o=X(e).toVar(),a=Z(n).toVar(),c=z(0).toVar(),f=z(1).toVar();return qt(o,()=>{c.addAssign(f.mul(iy(a))),f.mulAssign(i),a.mulAssign(s)}),c}).setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),Hf=re(([n,e,t,r])=>{const i=z(r).toVar(),s=z(t).toVar(),o=X(e).toVar(),a=Z(n).toVar(),c=Z(0).toVar(),f=z(1).toVar();return qt(o,()=>{c.addAssign(f.mul(Ac(a))),f.mulAssign(i),a.mulAssign(s)}),c}).setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),sj=re(([n,e,t,r])=>{const i=z(r).toVar(),s=z(t).toVar(),o=X(e).toVar(),a=Z(n).toVar();return we(Yh(a,o,s,i),Yh(a.add(Z(X(19),X(193),X(17))),o,s,i))}).setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),oj=re(([n,e,t,r])=>{const i=z(r).toVar(),s=z(t).toVar(),o=X(e).toVar(),a=Z(n).toVar(),c=Z(Hf(a,o,s,i)).toVar(),f=z(Yh(a.add(Z(X(19),X(193),X(17))),o,s,i)).toVar();return je(c,f)}).setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),aj=re(([n,e,t,r,i,s,o])=>{const a=X(o).toVar(),c=z(s).toVar(),f=X(i).toVar(),p=X(r).toVar(),g=X(t).toVar(),v=X(e).toVar(),x=we(n).toVar(),T=Z($f(we(v.add(p),g.add(f)))).toVar(),S=we(T.x,T.y).toVar();S.subAssign(.5),S.mulAssign(c),S.addAssign(.5);const E=we(we(z(v),z(g)).add(S)).toVar(),N=we(E.sub(x)).toVar();return ze(a.equal(X(2)),()=>en(N.x).add(en(N.y))),ze(a.equal(X(3)),()=>_n(en(N.x),en(N.y))),Ri(N,N)}).setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),lj=re(([n,e,t,r,i,s,o,a,c])=>{const f=X(c).toVar(),p=z(a).toVar(),g=X(o).toVar(),v=X(s).toVar(),x=X(i).toVar(),T=X(r).toVar(),S=X(t).toVar(),E=X(e).toVar(),N=Z(n).toVar(),P=Z($f(Z(E.add(x),S.add(v),T.add(g)))).toVar();P.subAssign(.5),P.mulAssign(p),P.addAssign(.5);const B=Z(Z(z(E),z(S),z(T)).add(P)).toVar(),L=Z(B.sub(N)).toVar();return ze(f.equal(X(2)),()=>en(L.x).add(en(L.y)).add(en(L.z))),ze(f.equal(X(3)),()=>_n(en(L.x),en(L.y),en(L.z))),Ri(L,L)}).setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),_u=cr([aj,lj]),uj=re(([n,e,t])=>{const r=X(t).toVar(),i=z(e).toVar(),s=we(n).toVar(),o=X().toVar(),a=X().toVar(),c=we(An(s.x,o),An(s.y,a)).toVar(),f=z(1e6).toVar();return qt({start:-1,end:X(1),name:"x",condition:"<="},({x:p})=>{qt({start:-1,end:X(1),name:"y",condition:"<="},({y:g})=>{const v=z(_u(c,p,g,o,a,i,r)).toVar();f.assign(zr(f,v))})}),ze(r.equal(X(0)),()=>{f.assign(gr(f))}),f}).setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Aj=re(([n,e,t])=>{const r=X(t).toVar(),i=z(e).toVar(),s=we(n).toVar(),o=X().toVar(),a=X().toVar(),c=we(An(s.x,o),An(s.y,a)).toVar(),f=we(1e6,1e6).toVar();return qt({start:-1,end:X(1),name:"x",condition:"<="},({x:p})=>{qt({start:-1,end:X(1),name:"y",condition:"<="},({y:g})=>{const v=z(_u(c,p,g,o,a,i,r)).toVar();ze(v.lessThan(f.x),()=>{f.y.assign(f.x),f.x.assign(v)}).ElseIf(v.lessThan(f.y),()=>{f.y.assign(v)})})}),ze(r.equal(X(0)),()=>{f.assign(gr(f))}),f}).setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),cj=re(([n,e,t])=>{const r=X(t).toVar(),i=z(e).toVar(),s=we(n).toVar(),o=X().toVar(),a=X().toVar(),c=we(An(s.x,o),An(s.y,a)).toVar(),f=Z(1e6,1e6,1e6).toVar();return qt({start:-1,end:X(1),name:"x",condition:"<="},({x:p})=>{qt({start:-1,end:X(1),name:"y",condition:"<="},({y:g})=>{const v=z(_u(c,p,g,o,a,i,r)).toVar();ze(v.lessThan(f.x),()=>{f.z.assign(f.y),f.y.assign(f.x),f.x.assign(v)}).ElseIf(v.lessThan(f.y),()=>{f.z.assign(f.y),f.y.assign(v)}).ElseIf(v.lessThan(f.z),()=>{f.z.assign(v)})})}),ze(r.equal(X(0)),()=>{f.assign(gr(f))}),f}).setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),hj=re(([n,e,t])=>{const r=X(t).toVar(),i=z(e).toVar(),s=Z(n).toVar(),o=X().toVar(),a=X().toVar(),c=X().toVar(),f=Z(An(s.x,o),An(s.y,a),An(s.z,c)).toVar(),p=z(1e6).toVar();return qt({start:-1,end:X(1),name:"x",condition:"<="},({x:g})=>{qt({start:-1,end:X(1),name:"y",condition:"<="},({y:v})=>{qt({start:-1,end:X(1),name:"z",condition:"<="},({z:x})=>{const T=z(_u(f,g,v,x,o,a,c,i,r)).toVar();p.assign(zr(p,T))})})}),ze(r.equal(X(0)),()=>{p.assign(gr(p))}),p}).setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),fj=cr([uj,hj]),dj=re(([n,e,t])=>{const r=X(t).toVar(),i=z(e).toVar(),s=Z(n).toVar(),o=X().toVar(),a=X().toVar(),c=X().toVar(),f=Z(An(s.x,o),An(s.y,a),An(s.z,c)).toVar(),p=we(1e6,1e6).toVar();return qt({start:-1,end:X(1),name:"x",condition:"<="},({x:g})=>{qt({start:-1,end:X(1),name:"y",condition:"<="},({y:v})=>{qt({start:-1,end:X(1),name:"z",condition:"<="},({z:x})=>{const T=z(_u(f,g,v,x,o,a,c,i,r)).toVar();ze(T.lessThan(p.x),()=>{p.y.assign(p.x),p.x.assign(T)}).ElseIf(T.lessThan(p.y),()=>{p.y.assign(T)})})})}),ze(r.equal(X(0)),()=>{p.assign(gr(p))}),p}).setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),pj=cr([Aj,dj]),mj=re(([n,e,t])=>{const r=X(t).toVar(),i=z(e).toVar(),s=Z(n).toVar(),o=X().toVar(),a=X().toVar(),c=X().toVar(),f=Z(An(s.x,o),An(s.y,a),An(s.z,c)).toVar(),p=Z(1e6,1e6,1e6).toVar();return qt({start:-1,end:X(1),name:"x",condition:"<="},({x:g})=>{qt({start:-1,end:X(1),name:"y",condition:"<="},({y:v})=>{qt({start:-1,end:X(1),name:"z",condition:"<="},({z:x})=>{const T=z(_u(f,g,v,x,o,a,c,i,r)).toVar();ze(T.lessThan(p.x),()=>{p.z.assign(p.y),p.y.assign(p.x),p.x.assign(T)}).ElseIf(T.lessThan(p.y),()=>{p.z.assign(p.y),p.y.assign(T)}).ElseIf(T.lessThan(p.z),()=>{p.z.assign(T)})})})}),ze(r.equal(X(0)),()=>{p.assign(gr(p))}),p}).setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),sy=cr([cj,mj]),gj=re(([n,e,t,r,i,s,o,a,c,f,p])=>{const g=X(n).toVar(),v=we(e).toVar(),x=we(t).toVar(),T=we(r).toVar(),S=z(i).toVar(),E=z(s).toVar(),N=z(o).toVar(),P=Ei(a).toVar(),B=X(c).toVar(),L=z(f).toVar(),k=z(p).toVar(),q=v.mul(x).add(T),I=z(0).toVar();return ze(g.equal(X(0)),()=>{I.assign(Ac(q))}),ze(g.equal(X(1)),()=>{I.assign($f(q))}),ze(g.equal(X(2)),()=>{I.assign(sy(q,S,X(0)))}),ze(g.equal(X(3)),()=>{I.assign(Hf(Z(q,0),B,L,k))}),I.assign(I.mul(N.sub(E)).add(E)),ze(P,()=>{I.assign(Ki(I,E,N))}),I}).setLayout({name:"mx_unifiednoise2d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"texcoord",type:"vec2"},{name:"freq",type:"vec2"},{name:"offset",type:"vec2"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),yj=re(([n,e,t,r,i,s,o,a,c,f,p])=>{const g=X(n).toVar(),v=Z(e).toVar(),x=Z(t).toVar(),T=Z(r).toVar(),S=z(i).toVar(),E=z(s).toVar(),N=z(o).toVar(),P=Ei(a).toVar(),B=X(c).toVar(),L=z(f).toVar(),k=z(p).toVar(),q=v.mul(x).add(T),I=z(0).toVar();return ze(g.equal(X(0)),()=>{I.assign(Ac(q))}),ze(g.equal(X(1)),()=>{I.assign($f(q))}),ze(g.equal(X(2)),()=>{I.assign(sy(q,S,X(0)))}),ze(g.equal(X(3)),()=>{I.assign(Hf(q,B,L,k))}),I.assign(I.mul(N.sub(E)).add(E)),ze(P,()=>{I.assign(Ki(I,E,N))}),I}).setLayout({name:"mx_unifiednoise3d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"position",type:"vec3"},{name:"freq",type:"vec3"},{name:"offset",type:"vec3"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),_j=re(([n])=>{const e=n.y,t=n.z,r=Z().toVar();return ze(e.lessThan(1e-4),()=>{r.assign(Z(t,t,t))}).Else(()=>{let i=n.x;i=i.sub(Ts(i)).mul(6).toVar();const s=X(o2(i)),o=i.sub(z(s)),a=t.mul(e.oneMinus()),c=t.mul(e.mul(o).oneMinus()),f=t.mul(e.mul(o.oneMinus()).oneMinus());ze(s.equal(X(0)),()=>{r.assign(Z(t,f,a))}).ElseIf(s.equal(X(1)),()=>{r.assign(Z(c,t,a))}).ElseIf(s.equal(X(2)),()=>{r.assign(Z(a,t,f))}).ElseIf(s.equal(X(3)),()=>{r.assign(Z(a,c,t))}).ElseIf(s.equal(X(4)),()=>{r.assign(Z(f,a,t))}).Else(()=>{r.assign(Z(t,a,c))})}),r}).setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),vj=re(([n])=>{const e=Z(n).toVar(),t=z(e.x).toVar(),r=z(e.y).toVar(),i=z(e.z).toVar(),s=z(zr(t,zr(r,i))).toVar(),o=z(_n(t,_n(r,i))).toVar(),a=z(o.sub(s)).toVar(),c=z().toVar(),f=z().toVar(),p=z().toVar();return p.assign(o),ze(o.greaterThan(0),()=>{f.assign(a.div(o))}).Else(()=>{f.assign(0)}),ze(f.lessThanEqual(0),()=>{c.assign(0)}).Else(()=>{ze(t.greaterThanEqual(o),()=>{c.assign(r.sub(i).div(a))}).ElseIf(r.greaterThanEqual(o),()=>{c.assign(Ln(2,i.sub(t).div(a)))}).Else(()=>{c.assign(Ln(4,t.sub(r).div(a)))}),c.mulAssign(1/6),ze(c.lessThan(0),()=>{c.addAssign(1)})}),Z(c,f,p)}).setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),bj=re(([n])=>{const e=Z(n).toVar(),t=V1(K1(e,Z(.04045))).toVar(),r=Z(e.div(12.92)).toVar(),i=Z(_i(_n(e.add(Z(.055)),Z(0)).div(1.055),Z(2.4))).toVar();return Tt(r,i,t)}).setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),H5=(n,e)=>{n=z(n),e=z(e);const t=we(e.dFdx(),e.dFdy()).length().mul(.7071067811865476);return Zi(n.sub(t),n.add(t),e)},W5=(n,e,t,r)=>Tt(n,e,t[r].clamp()),xj=(n,e,t=Ht())=>W5(n,e,t,"x"),Tj=(n,e,t=Ht())=>W5(n,e,t,"y"),wj=(n,e,t,r,i=Ht())=>{const s=i.x.clamp(),o=i.y.clamp(),a=Tt(n,e,s),c=Tt(t,r,s);return Tt(a,c,o)},Q5=(n,e,t,r,i)=>Tt(n,e,H5(t,r[i])),Sj=(n,e,t,r=Ht())=>Q5(n,e,t,r,"x"),Ej=(n,e,t,r=Ht())=>Q5(n,e,t,r,"y"),Rj=(n=1,e=0,t=Ht())=>t.mul(n).add(e),Cj=(n,e=1)=>(n=z(n),n.abs().pow(e).mul(n.sign())),Nj=(n,e=1,t=.5)=>z(n).sub(t).mul(e).add(t),Mj=(n=Ht(),e=1,t=0)=>iy(n.convert("vec2|vec3")).mul(e).add(t),Pj=(n=Ht(),e=1,t=0)=>Ac(n.convert("vec2|vec3")).mul(e).add(t),Bj=(n=Ht(),e=1,t=0)=>(n=n.convert("vec2|vec3"),je(Ac(n),iy(n.add(we(19,73)))).mul(e).add(t)),Dj=(n,e=Ht(),t=we(1,1),r=we(0,0),i=1,s=0,o=1,a=!1,c=1,f=2,p=.5)=>gj(n,e.convert("vec2|vec3"),t,r,i,s,o,a,c,f,p),Lj=(n,e=Ht(),t=we(1,1),r=we(0,0),i=1,s=0,o=1,a=!1,c=1,f=2,p=.5)=>yj(n,e.convert("vec2|vec3"),t,r,i,s,o,a,c,f,p),Oj=(n=Ht(),e=1)=>fj(n.convert("vec2|vec3"),e,X(1)),Fj=(n=Ht(),e=1)=>pj(n.convert("vec2|vec3"),e,X(1)),Ij=(n=Ht(),e=1)=>sy(n.convert("vec2|vec3"),e,X(1)),kj=(n=Ht())=>ej(n.convert("vec2|vec3")),Uj=(n=Ht(),e=3,t=2,r=.5,i=1)=>Yh(n,X(e),t,r).mul(i),qj=(n=Ht(),e=3,t=2,r=.5,i=1)=>sj(n,X(e),t,r).mul(i),Gj=(n=Ht(),e=3,t=2,r=.5,i=1)=>Hf(n,X(e),t,r).mul(i),Vj=(n=Ht(),e=3,t=2,r=.5,i=1)=>oj(n,X(e),t,r).mul(i),zj=(n,e=z(0))=>Ln(n,e),jj=(n,e=z(0))=>St(n,e),$j=(n,e=z(1))=>et(n,e),Hj=(n,e=z(1))=>ai(n,e),Wj=(n,e=z(1))=>nc(n,e),Qj=(n,e=z(1))=>_i(n,e),Xj=(n=z(0),e=z(1))=>wf(n,e),Yj=()=>yu,Kj=()=>l5,Zj=(n,e=z(1))=>St(e,n),Jj=(n,e,t,r)=>n.greaterThan(e).mix(t,r),e$=(n,e,t,r)=>n.greaterThanEqual(e).mix(t,r),t$=(n,e,t,r)=>n.equal(e).mix(t,r),n$=(n,e=null)=>{if(typeof e=="string"){const t={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3},r=e.replace(/^out/,"").toLowerCase();if(t[r]!==void 0)return n.element(t[r])}if(typeof e=="number")return n.element(e);if(typeof e=="string"&&e.length===1){const t={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3};if(t[e]!==void 0)return n.element(t[e])}return n},r$=(n,e=we(.5,.5),t=we(1,1),r=z(0),i=we(0,0))=>{let s=n;if(e&&(s=s.sub(e)),t&&(s=s.mul(t)),r){const o=r.mul(Math.PI/180),a=o.cos(),c=o.sin();s=we(s.x.mul(a).sub(s.y.mul(c)),s.x.mul(c).add(s.y.mul(a)))}return e&&(s=s.add(e)),i&&(s=s.add(i)),s},i$=(n,e)=>{n=we(n),e=z(e);const t=e.mul(Math.PI/180);return oc(n,t)},s$=(n,e,t)=>{n=Z(n),e=z(e),t=Z(t);const r=e.mul(Math.PI/180),i=t.normalize(),s=r.cos(),o=r.sin(),a=z(1).sub(s);return n.mul(s).add(i.cross(n).mul(o)).add(i.mul(i.dot(n)).mul(a))},o$=(n,e)=>(n=Z(n),e=z(e),N2(n,e)),a$=re(([n,e,t])=>{const r=Mr(n).toVar(),i=St(z(.5).mul(e.sub(t)),Ss).div(r).toVar(),s=St(z(-.5).mul(e.sub(t)),Ss).div(r).toVar(),o=Z().toVar();o.x=r.x.greaterThan(z(0)).select(i.x,s.x),o.y=r.y.greaterThan(z(0)).select(i.y,s.y),o.z=r.z.greaterThan(z(0)).select(i.z,s.z);const a=zr(o.x,o.y,o.z).toVar();return Ss.add(r.mul(a)).toVar().sub(t)}),X5=re(([n,e])=>{const t=n.x,r=n.y,i=n.z;let s=e.element(0).mul(.886227);return s=s.add(e.element(1).mul(2*.511664).mul(r)),s=s.add(e.element(2).mul(2*.511664).mul(i)),s=s.add(e.element(3).mul(2*.511664).mul(t)),s=s.add(e.element(4).mul(2*.429043).mul(t).mul(r)),s=s.add(e.element(5).mul(2*.429043).mul(r).mul(i)),s=s.add(e.element(6).mul(i.mul(i).mul(.743125).sub(.247708))),s=s.add(e.element(7).mul(2*.429043).mul(t).mul(i)),s=s.add(e.element(8).mul(.429043).mul(et(t,t).sub(et(r,r)))),s});var C=Object.freeze({__proto__:null,BRDF_GGX:q2,BRDF_Lambert:Xa,BasicPointShadowFilter:I5,BasicShadowFilter:C5,Break:Tw,Const:V8,Continue:WI,DFGLUT:zA,D_GGX:Gw,Discard:i6,EPSILON:Z1,F_Schlick:Au,Fn:re,HALF_PI:_F,INFINITY:mF,If:ze,Loop:qt,NodeAccess:ar,NodeShaderStage:sA,NodeType:UO,NodeUpdateType:ot,OnBeforeMaterialUpdate:pG,OnBeforeObjectUpdate:dG,OnMaterialUpdate:fG,OnObjectUpdate:hG,PCFShadowFilter:N5,PCFSoftShadowFilter:M5,PI:Vh,PI2:gF,PointShadowFilter:k5,Return:OF,Schlick_to_F0:vg,ScriptableNodeResources:z0,ShaderNode:ql,Stack:yf,Switch:aF,TBNViewMatrix:ka,TWO_PI:yF,VSMShadowFilter:P5,V_GGX_SmithCorrelated:qw,Var:G8,VarIntent:z8,abs:en,acesFilmicToneMapping:_5,acos:t2,add:Ln,addMethodChaining:de,addNodeElement:UF,agxToneMapping:v5,all:h8,alphaT:Uh,and:KT,anisotropy:Lo,anisotropyB:za,anisotropyT:yA,any:f8,append:cF,array:jT,arrayBuffer:uF,asin:g8,assign:$T,atan:wf,atan2:O8,atomicAdd:xV,atomicAnd:EV,atomicFunc:Is,atomicLoad:vV,atomicMax:wV,atomicMin:SV,atomicOr:RV,atomicStore:bV,atomicSub:TV,atomicXor:CV,attenuationColor:W1,attenuationDistance:H1,attribute:co,attributeArray:gG,backgroundBlurriness:c5,backgroundIntensity:Sg,backgroundRotation:h5,batch:vw,bentNormalView:F6,billboarding:Xq,bitAnd:t8,bitNot:n8,bitOr:r8,bitXor:i8,bitangentGeometry:SI,bitangentLocal:EI,bitangentView:L6,bitangentWorld:RI,bitcast:o5,blendBurn:Nw,blendColor:Ak,blendDodge:Mw,blendOverlay:Bw,blendScreen:Pw,blur:Qw,bool:Ei,buffer:rc,bufferAttribute:g2,builtin:po,builtinAOContext:U8,builtinShadowContext:k8,bumpMap:N2,burn:hk,bvec2:IT,bvec3:V1,bvec4:kT,bypass:e6,cache:J8,call:HT,cameraFar:ko,cameraIndex:ta,cameraNear:Io,cameraNormalMatrix:eI,cameraPosition:h6,cameraProjectionMatrix:no,cameraProjectionMatrixInverse:ZF,cameraViewMatrix:Bi,cameraViewport:tI,cameraWorldMatrix:JF,cbrt:M8,cdl:OG,ceil:Tf,checker:Sz,cineonToneMapping:y5,clamp:Ki,clearcoat:Fh,clearcoatNormalView:Ia,clearcoatRoughness:VA,code:Vf,color:FT,colorSpaceToWorking:Rf,colorToDirection:NI,compute:Z8,computeKernel:y2,computeSkinning:$I,context:fo,convert:qT,convertColorSpace:EF,convertToTexture:aG,cos:Ui,countLeadingZeros:Sq,countOneBits:Eq,countTrailingZeros:wq,cross:uo,cubeTexture:Nr,cubeTextureBase:C2,dFdx:i2,dFdy:s2,dashSize:O0,debug:o6,decrement:A8,decrementBefore:l8,defaultBuildStages:sg,defaultShaderStages:MT,defined:UA,degrees:p8,deltaTime:Gq,densityFog:rV,densityFogFactor:Y2,depth:F2,depthPass:qG,determinant:x8,difference:R8,diffuseColor:kt,diffuseContribution:Ea,directPointLight:q5,directionToColor:I6,directionToFaceDirection:mu,dispersion:Q1,disposeShadowMaterial:D5,distance:E8,div:ai,dodge:fk,dot:Ri,drawIndex:gw,dynamicBufferAttribute:PF,element:UT,emissive:ug,equal:Y1,equals:w8,equirectUV:I2,exp:J1,exp2:lu,expression:Ao,faceDirection:S2,faceForward:h2,faceforward:vF,float:z,floatBitsToInt:bq,floatBitsToUint:a5,floor:Ts,fog:$A,fract:Yi,frameGroup:zT,frameId:l5,frontFacing:m6,fwidth:a2,gain:Cq,gapSize:Ag,getConstNodeType:OT,getCurrentStack:U1,getDirection:Hw,getDistanceAttenuation:ry,getGeometryRoughness:Uw,getNormalFromDepth:uG,getParallaxCorrectNormal:a$,getRoughness:U2,getScreenPosition:lG,getShIrradianceAt:X5,getShadowMaterial:B5,getShadowRenderObjectFunction:L5,getTextureIndex:i5,getViewPosition:Bl,ggxConvolution:Xw,globalId:uV,glsl:XG,glslFn:YG,grayscale:PG,greaterThan:K1,greaterThanEqual:YT,hash:Rq,highpModelNormalViewMatrix:fg,highpModelViewMatrix:hg,hue:LG,increment:u8,incrementBefore:a8,inspector:l6,instance:VI,instanceIndex:Es,instancedArray:yG,instancedBufferAttribute:zh,instancedDynamicBufferAttribute:cg,instancedMesh:_w,int:X,intBitsToFloat:xq,interleavedGradientNoise:W2,inverse:T8,inverseSqrt:e2,inversesqrt:bF,invocationLocalIndex:GI,invocationSubgroupIndex:qI,ior:_A,iridescence:vf,iridescenceIOR:Ih,iridescenceThickness:kh,isolate:Ql,ivec2:In,ivec3:G1,ivec4:z1,js:WG,label:q8,length:ws,lengthSq:A2,lessThan:QT,lessThanEqual:XT,lightPosition:Z2,lightProjectionUV:E5,lightShadowMatrix:jf,lightTargetDirection:ey,lightTargetPosition:R5,lightViewPosition:J2,lightingContext:Sw,lights:nz,linearDepth:$h,linearToneMapping:m5,localId:AV,log:xf,log2:xs,logarithmicDepthToViewZ:nk,luminance:Q2,mat2:_f,mat3:ur,mat4:Wo,matcapUV:Kw,materialAO:dw,materialAlphaTest:k6,materialAnisotropy:J6,materialAnisotropyVector:Pl,materialAttenuationColor:aw,materialAttenuationDistance:ow,materialClearcoat:W6,materialClearcoatNormal:X6,materialClearcoatRoughness:Q6,materialColor:U6,materialDispersion:fw,materialEmissive:G6,materialEnvIntensity:k0,materialEnvRotation:R2,materialIOR:sw,materialIridescence:ew,materialIridescenceIOR:tw,materialIridescenceThickness:nw,materialLightMap:P2,materialLineDashOffset:cw,materialLineDashSize:uw,materialLineGapSize:Aw,materialLineScale:lw,materialLineWidth:LI,materialMetalness:$6,materialNormal:H6,materialOpacity:M2,materialPointSize:hw,materialReference:Hs,materialReflectivity:U0,materialRefractionRatio:v6,materialRotation:Y6,materialRoughness:j6,materialSheen:K6,materialSheenRoughness:Z6,materialShininess:q6,materialSpecular:V6,materialSpecularColor:z6,materialSpecularIntensity:_g,materialSpecularStrength:vA,materialThickness:iw,materialTransmission:rw,max:_n,maxMipLevel:_2,mediumpModelViewMatrix:p6,metalness:Xs,min:zr,mix:Tt,mixElement:B8,mod:nc,modInt:c8,modelDirection:aI,modelNormalMatrix:d6,modelPosition:lI,modelRadius:cI,modelScale:uI,modelViewMatrix:na,modelViewPosition:AI,modelViewProjection:pw,modelWorldMatrix:vi,modelWorldMatrixInverse:hI,morphReference:ww,mrt:s5,mul:et,mx_aastep:H5,mx_add:zj,mx_atan2:Xj,mx_cell_noise_float:kj,mx_contrast:Nj,mx_divide:Hj,mx_fractal_noise_float:Uj,mx_fractal_noise_vec2:qj,mx_fractal_noise_vec3:Gj,mx_fractal_noise_vec4:Vj,mx_frame:Kj,mx_heighttonormal:o$,mx_hsvtorgb:_j,mx_ifequal:t$,mx_ifgreater:Jj,mx_ifgreatereq:e$,mx_invert:Zj,mx_modulo:Wj,mx_multiply:$j,mx_noise_float:Mj,mx_noise_vec3:Pj,mx_noise_vec4:Bj,mx_place2d:r$,mx_power:Qj,mx_ramp4:wj,mx_ramplr:xj,mx_ramptb:Tj,mx_rgbtohsv:vj,mx_rotate2d:i$,mx_rotate3d:s$,mx_safepower:Cj,mx_separate:n$,mx_splitlr:Sj,mx_splittb:Ej,mx_srgb_texture_to_lin_rec709:bj,mx_subtract:jj,mx_timer:Yj,mx_transform_uv:Rj,mx_unifiednoise2d:Dj,mx_unifiednoise3d:Lj,mx_worley_noise_float:Oj,mx_worley_noise_vec2:Fj,mx_worley_noise_vec3:Ij,negate:r2,neutralToneMapping:b5,nodeArray:Va,nodeImmutable:Me,nodeObject:Pe,nodeObjectIntent:oA,nodeObjects:gf,nodeProxy:tt,nodeProxyIntent:Se,normalFlat:g6,normalGeometry:Nf,normalLocal:jr,normalMap:yg,normalView:Rt,normalViewGeometry:uu,normalWorld:ra,normalWorldGeometry:y6,normalize:Mr,not:JT,notEqual:WT,numWorkgroups:aV,objectDirection:nI,objectGroup:X1,objectPosition:f6,objectRadius:oI,objectScale:iI,objectViewPosition:sI,objectWorldMatrix:rI,oneMinus:y8,or:ZT,orthographicDepthToViewZ:tk,oscSawtooth:$q,oscSine:Vq,oscSquare:zq,oscTriangle:jq,output:Hl,outputStruct:_q,overlay:pk,overloadingFn:cr,packHalf2x16:Dq,packSnorm2x16:Pq,packUnorm2x16:Bq,parabola:wg,parallaxDirection:O6,parallaxUV:CI,parameter:fq,pass:kG,passTexture:UG,pcurve:Nq,perspectiveDepthToViewZ:L2,pmremTexture:V2,pointShadow:U5,pointUV:vG,pointWidth:hF,positionGeometry:ic,positionLocal:pn,positionPrevious:jh,positionView:Mn,positionViewDirection:Yt,positionWorld:Ss,positionWorldDirection:w2,posterize:IG,pow:_i,pow2:l2,pow3:C8,pow4:u2,premultiplyAlpha:Dw,property:Js,quadBroadcast:JV,quadSwapDiagonal:WV,quadSwapX:$V,quadSwapY:HV,radians:d8,rand:P8,range:sV,rangeFog:nV,rangeFogFactor:X2,reciprocal:v8,reference:zt,referenceBuffer:dg,reflect:S8,reflectVector:T6,reflectView:b6,reflector:nG,refract:c2,refractVector:w6,refractView:x6,reinhardToneMapping:g5,remap:n6,remapClamp:r6,renderGroup:Ge,renderOutput:s6,rendererReference:X8,replaceDefaultUV:Hq,rotate:oc,rotateUV:Wq,roughness:ps,round:_8,rtt:A5,sRGBTransferEOTF:$8,sRGBTransferOETF:H8,sample:cG,sampler:$F,samplerComparison:HF,saturate:Ef,saturation:BG,screen:dk,screenCoordinate:Ja,screenDPR:A6,screenSize:Qa,screenUV:to,scriptable:tV,scriptableValue:V0,select:lr,setCurrentStack:qA,setName:f2,shaderStages:og,shadow:F5,shadowPositionWorld:ny,shapeCircle:Ez,sharedUniformGroup:bf,sheen:Zr,sheenRoughness:Fo,shiftLeft:s8,shiftRight:o8,shininess:qh,sign:n2,sin:Cr,sinc:Mq,skinning:xw,smoothstep:Zi,smoothstepElement:D8,specularColor:Ko,specularColorBlended:Fa,specularF90:$l,spherizeUV:Qq,split:AF,spritesheetUV:Zq,sqrt:gr,stack:q0,step:Sf,stepElement:L8,storage:ro,storageBarrier:dV,storageObject:kI,storageTexture:f5,string:lF,struct:yq,sub:St,subBuild:Wl,subgroupAdd:PV,subgroupAll:VV,subgroupAnd:IV,subgroupAny:zV,subgroupBallot:MV,subgroupBroadcast:QV,subgroupBroadcastFirst:jV,subgroupElect:NV,subgroupExclusiveAdd:DV,subgroupExclusiveMul:FV,subgroupInclusiveAdd:BV,subgroupInclusiveMul:OV,subgroupIndex:UI,subgroupMax:GV,subgroupMin:qV,subgroupMul:LV,subgroupOr:kV,subgroupShuffle:XV,subgroupShuffleDown:ZV,subgroupShuffleUp:KV,subgroupShuffleXor:YV,subgroupSize:cV,subgroupXor:UV,tan:m8,tangentGeometry:Pf,tangentLocal:sc,tangentView:Bf,tangentWorld:D6,texture:Nt,texture3D:Gf,texture3DLevel:EG,texture3DLoad:SG,textureBarrier:pV,textureBicubic:Hk,textureBicubicLevel:G2,textureCubeUV:Ww,textureLevel:jF,textureLoad:wn,textureSize:eo,textureStore:xG,thickness:$1,time:yu,toneMapping:Y8,toneMappingExposure:K8,toonOutlinePass:VG,transformDirection:N8,transformNormal:_6,transformNormalToView:E2,transformedClearcoatNormalView:mI,transformedNormalView:dI,transformedNormalWorld:pI,transmission:Gh,transpose:b8,triNoise3D:kq,triplanarTexture:Jq,triplanarTextures:u5,trunc:o2,uint:ye,uintBitsToFloat:Tq,uniform:Ve,uniformArray:mr,uniformCubeTexture:yI,uniformFlow:I8,uniformGroup:VT,uniformTexture:zF,unpackHalf2x16:Fq,unpackNormal:gg,unpackSnorm2x16:Lq,unpackUnorm2x16:Oq,unpremultiplyAlpha:ck,userData:CG,uv:Ht,uvec2:q1,uvec3:Za,uvec4:j1,varying:Fs,varyingProperty:GA,vec2:we,vec3:Z,vec4:je,vectorComponents:Ya,velocity:MG,vertexColor:Cw,vertexIndex:mw,vertexStage:j8,vibrance:DG,viewZToLogarithmicDepth:O2,viewZToOrthographicDepth:Xl,viewZToPerspectiveDepth:Ew,viewport:x2,viewportCoordinate:c6,viewportDepthTexture:D2,viewportLinearDepth:rk,viewportMipTexture:B2,viewportResolution:KF,viewportSafeUV:Yq,viewportSharedTexture:bk,viewportSize:T2,viewportTexture:JI,viewportUV:YF,vogelDiskSample:Vi,wgsl:QG,wgslFn:KG,workgroupArray:yV,workgroupBarrier:fV,workgroupId:lV,workingToColorSpace:W8,xor:e8});const Li=new z2;class l$ extends ia{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,r){const i=this.renderer,s=this.nodes.getBackgroundNode(e)||e.background;let o=!1;if(s===null)i._clearColor.getRGB(Li),Li.a=i._clearColor.a;else if(s.isColor===!0)s.getRGB(Li),Li.a=1,o=!0;else if(s.isNode===!0){const c=this.get(e),f=s;Li.copy(i._clearColor);let p=c.backgroundMesh;if(p===void 0){let P=function(){s.removeEventListener("dispose",P),p.material.dispose(),p.geometry.dispose()};const v=je(f).mul(Sg).context({getUV:()=>h5.mul(y6),getTextureLevel:()=>c5}),x=no.element(3).element(3).equal(1),T=ai(1,no.element(1).element(1)).mul(3),S=x.select(pn.mul(T),pn);let E=no.mul(na.mul(je(S,0)));E=E.setZ(E.w);const N=new Rn;N.name="Background.material",N.side=yr,N.depthTest=!1,N.depthWrite=!1,N.allowOverride=!1,N.fog=!1,N.lights=!1,N.vertexNode=E,N.colorNode=v,c.backgroundMeshNode=v,c.backgroundMesh=p=new gn(new Jo(1,32,32),N),p.frustumCulled=!1,p.name="Background.mesh",s.addEventListener("dispose",P)}const g=f.getCacheKey();c.backgroundCacheKey!==g&&(c.backgroundMeshNode.node=je(f).mul(Sg),c.backgroundMeshNode.needsUpdate=!0,p.material.needsUpdate=!0,c.backgroundCacheKey=g),t.unshift(p,p.geometry,p.material,0,0,null,null)}else Be("Renderer: Unsupported background configuration.",s);const a=i.xr.getEnvironmentBlendMode();if(a==="additive"?Li.set(0,0,0,1):a==="alpha-blend"&&Li.set(0,0,0,0),i.autoClear===!0||o===!0){const c=r.clearColorValue;c.r=Li.r,c.g=Li.g,c.b=Li.b,c.a=Li.a,(i.backend.isWebGLBackend===!0||i.alpha===!0)&&(c.r*=c.a,c.g*=c.a,c.b*=c.a),r.depthClearValue=i._clearDepth,r.stencilClearValue=i._clearStencil,r.clearColor=i.autoClearColor===!0,r.clearDepth=i.autoClearDepth===!0,r.clearStencil=i.autoClearStencil===!0}else r.clearColor=!1,r.clearDepth=!1,r.clearStencil=!1}}let u$=0;class Eg{constructor(e="",t=[],r=0,i=[]){this.name=e,this.bindings=t,this.index=r,this.bindingsReference=i,this.id=u$++}}class A${constructor(e,t,r,i,s,o,a,c,f,p=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=r,this.transforms=p,this.nodeAttributes=i,this.bindings=s,this.updateNodes=o,this.updateBeforeNodes=a,this.updateAfterNodes=c,this.observer=f,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings)if(t.bindings[0].groupNode.shared!==!0){const i=new Eg(t.name,[],t.index,t.bindingsReference);e.push(i);for(const s of t.bindings)i.bindings.push(s.clone())}else e.push(t);return e}}class eb{constructor(e,t,r=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=r}}class c${constructor(e,t,r){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=r}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class Y5{constructor(e,t,r=!1,i=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=r,this.count=i}}class h$ extends Y5{constructor(e,t,r=null,i=null){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=r,this.interpolationSampling=i}}class f${constructor(e,t,r=""){this.name=e,this.type=t,this.code=r,Object.defineProperty(this,"isNodeCode",{value:!0})}}let d$=0;class yp{constructor(e=null){this.id=d$++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class p${constructor(e,t){this.name=e,this.members=t,this.output=!1}}class sa{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class m$ extends sa{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class g$ extends sa{constructor(e,t=new _t){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class y$ extends sa{constructor(e,t=new ge){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class _$ extends sa{constructor(e,t=new $t){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class v$ extends sa{constructor(e,t=new jn){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class b$ extends sa{constructor(e,t=new Yx){super(e,t),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}}class x$ extends sa{constructor(e,t=new YA){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class T$ extends sa{constructor(e,t=new dn){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class w$ extends m${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class S$ extends g${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class E$ extends y${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class R$ extends _${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class C$ extends v${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class N$ extends b${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class M$ extends x${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class P$ extends T${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}let B$=0;const D$=new WeakMap,tb=new WeakMap,L$=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),Jc=n=>/e/g.test(n)?String(n).replace(/\+/g,""):(n=Number(n),n+(n%1?"":".0"));class K5{constructor(e,t,r){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=r,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.types={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=q0(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new yp,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.subBuildLayers=[],this.activeStacks=[],this.subBuildFn=null,this.fnCall=null,Object.defineProperty(this,"id",{value:B$++})}isOpaque(){const e=this.material;return e.transparent===!1&&e.blending===Ys&&e.alphaToCoverage===!1}getBindGroupsCache(){let e=tb.get(this.renderer);return e===void 0&&(e=new Ji,tb.set(this.renderer,e)),e}createRenderTarget(e,t,r){return new ea(e,t,r)}createCubeRenderTarget(e,t){return new Lw(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const r=this.getBindGroupsCache(),i=[];let s=!0;for(const a of t)i.push(a),s=s&&a.groupNode.shared!==!0;let o;return s?(o=r.get(i),o===void 0&&(o=new Eg(e,i,this.bindingsIndexes[e].group,i),r.set(i,o))):o=new Eg(e,i,this.bindingsIndexes[e].group,i),o}getBindGroupArray(e,t){const r=this.bindings[t];let i=r[e];return i===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),r[e]=i=[]),i}getBindings(){let e=this.bindGroups;if(e===null){const t={},r=this.bindings;for(const i of og)for(const s in r[i]){const o=r[i][s];(t[s]||(t[s]=[])).push(...o)}e=[];for(const i in t){const s=t[i],o=this._getBindGroup(i,s);e.push(o)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((t,r)=>t.bindings[0].groupNode.order-r.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const r=e[t];this.bindingsIndexes[r.name].group=t,r.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==ot.NONE&&this.updateNodes.push(e);for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),r=e.getUpdateAfterType();t!==ot.NONE&&this.updateBeforeNodes.push(e),r!==ot.NONE&&this.updateAfterNodes.push(e)}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===Xi||e.magFilter===Qp||e.magFilter===EA||e.magFilter===qa||e.minFilter===Xi||e.minFilter===Qp||e.minFilter===EA||e.minFilter===qa}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getTernary(){return null}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}addContext(e){const t=this.getContext();return this.setContext({...this.context,...e}),t}getSharedContext(){const e={...this.context};return delete e.material,delete e.getUV,delete e.getOutput,delete e.getTextureLevel,delete e.getAO,delete e.getShadow,e}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const r=this.getDataFromNode(e);return r.cache===void 0&&(r.cache=new yp(t?this.getCache():null)),r.cache}isAvailable(){return!1}getVertexIndex(){De("Abstract function.")}getInstanceIndex(){De("Abstract function.")}getDrawIndex(){De("Abstract function.")}getFrontFacing(){De("Abstract function.")}getFragCoord(){De("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){De("Abstract function.")}generateTextureLod(){De("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t,r=null){let i=this.generateArrayDeclaration(e,t)+"( ";for(let s=0;s<t;s++){const o=r?r[s]:null;o!==null?i+=o.build(this,e):i+=this.generateConst(e),s<t-1&&(i+=", ")}return i+=" )",i}generateStruct(e,t,r=null){const i=[];for(const s of t){const{name:o,type:a}=s;r&&r[o]&&r[o].isNode?i.push(r[o].build(this,a)):i.push(this.generateConst(a))}return e+"( "+i.join(", ")+" )"}generateConst(e,t=null){if(t===null&&(e==="float"||e==="int"||e==="uint"?t=0:e==="bool"?t=!1:e==="color"?t=new jn:e==="vec2"||e==="uvec2"||e==="ivec2"?t=new _t:e==="vec3"||e==="uvec3"||e==="ivec3"?t=new ge:(e==="vec4"||e==="uvec4"||e==="ivec4")&&(t=new $t)),e==="float")return Jc(t);if(e==="int")return`${Math.round(t)}`;if(e==="uint")return t>=0?`${Math.round(t)}u`:"0u";if(e==="bool")return t?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${Jc(t.r)}, ${Jc(t.g)}, ${Jc(t.b)} )`;const r=this.getTypeLength(e),i=this.getComponentType(e),s=o=>this.generateConst(i,o);if(r===2)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)} )`;if(r===3)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)} )`;if(r===4&&e!=="mat2")return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)}, ${s(t.w)} )`;if(r>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(s).join(", ")} )`;if(r>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){const r=this.attributes;for(const s of r)if(s.name===e)return s;const i=new eb(e,t);return this.registerDeclaration(i),r.push(i),i}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="samplerComparison"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===wr)return"int";if(t===Un)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]==="b"?"bool":t[1]==="i"?"int":t[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,t="float"){if(e===1)return t;let r=ST(e);const i=t==="float"?"":t[0];return/mat2/.test(t)===!0&&(r=r.replace("vec","mat")),i+r}getTypeFromArray(e){return L$.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const r=t.array,i=e.itemSize,s=e.normalized;let o;return!(e instanceof Kx)&&s!==!0&&(o=this.getTypeFromArray(r)),this.getTypeFromLength(i,o)}getTypeLength(e){const t=this.getVectorType(e),r=/vec([2-4])/.exec(t);return r!==null?Number(r[1]):t==="float"||t==="bool"||t==="int"||t==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return t==="int"||t==="uint"?e:this.changeComponentType(e,"int")}setActiveStack(e){this.activeStacks.push(e)}removeActiveStack(e){if(this.activeStacks[this.activeStacks.length-1]===e)this.activeStacks.pop();else throw new Error("NodeBuilder: Invalid active stack removal.")}getActiveStack(){return this.activeStacks[this.activeStacks.length-1]}getBaseStack(){return this.activeStacks[0]}addStack(){this.stack=q0(this.stack);const e=U1();return this.stacks.push(e),qA(this.stack),this.stack}removeStack(){const e=this.stack;for(const t of e.nodes){const r=this.getDataFromNode(t);r.stack=e}return this.stack=e.parent,qA(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,r=null){r=r===null?e.isGlobal(this)?this.globalCache:this.cache:r;let i=r.getData(e);i===void 0&&(i={},r.setData(e,i)),i[t]===void 0&&(i[t]={});let s=i[t];const o=i.any?i.any.subBuilds:null,a=this.getClosestSubBuild(o);return a&&(s.subBuildsCache===void 0&&(s.subBuildsCache={}),s=s.subBuildsCache[a]||(s.subBuildsCache[a]={}),s.subBuilds=o),s}getNodeProperties(e,t="any"){const r=this.getDataFromNode(e,t);return r.properties||(r.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const r=this.getDataFromNode(e,"vertex");let i=r.bufferAttribute;if(i===void 0){const s=this.uniforms.index++;i=new eb("nodeAttribute"+s,t,e),this.bufferAttributes.push(i),r.bufferAttribute=i}return i}getStructTypeNode(e,t=this.shaderStage){return this.types[t][e]||null}getStructTypeFromNode(e,t,r=null,i=this.shaderStage){const s=this.getDataFromNode(e,i,this.globalCache);let o=s.structType;if(o===void 0){const a=this.structs.index++;r===null&&(r="StructType"+a),o=new p$(r,t),this.structs[i].push(o),this.types[i][r]=e,s.structType=o}return o}getOutputStructTypeFromNode(e,t){const r=this.getStructTypeFromNode(e,t,"OutputType","fragment");return r.output=!0,r}getUniformFromNode(e,t,r=this.shaderStage,i=null){const s=this.getDataFromNode(e,r,this.globalCache);let o=s.uniform;if(o===void 0){const a=this.uniforms.index++;o=new c$(i||"nodeUniform"+a,t,e),this.uniforms[r].push(o),this.registerDeclaration(o),s.uniform=o}return o}getVarFromNode(e,t=null,r=e.getNodeType(this),i=this.shaderStage,s=!1){const o=this.getDataFromNode(e,i),a=this.getSubBuildProperty("variable",o.subBuilds);let c=o[a];if(c===void 0){const f=s?"_const":"_var",p=this.vars[i]||(this.vars[i]=[]),g=this.vars[f]||(this.vars[f]=0);t===null&&(t=(s?"nodeConst":"nodeVar")+g,this.vars[f]++),a!=="variable"&&(t=this.getSubBuildProperty(t,o.subBuilds));const v=e.getArrayCount(this);c=new Y5(t,r,s,v),s||p.push(c),this.registerDeclaration(c),o[a]=c}return c}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0)&&(e.cNode?this.isDeterministic(e.cNode):!0);if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0);if(e.isArrayNode){if(e.values!==null){for(const t of e.values)if(!this.isDeterministic(t))return!1}return!0}else if(e.isConstNode)return!0;return!1}getVaryingFromNode(e,t=null,r=e.getNodeType(this),i=null,s=null){const o=this.getDataFromNode(e,"any"),a=this.getSubBuildProperty("varying",o.subBuilds);let c=o[a];if(c===void 0){const f=this.varyings,p=f.length;t===null&&(t="nodeVarying"+p),a!=="varying"&&(t=this.getSubBuildProperty(t,o.subBuilds)),c=new h$(t,r,i,s),f.push(c),this.registerDeclaration(c),o[a]=c}return c}registerDeclaration(e){const t=this.shaderStage,r=this.declarations[t]||(this.declarations[t]={}),i=this.getPropertyName(e);let s=1,o=i;for(;r[o]!==void 0;)o=i+"_"+s++;s>1&&(e.name=o,De(`TSL: Declaration name '${i}' of '${e.type}' already in use. Renamed to '${o}'.`)),r[o]=e}getCodeFromNode(e,t,r=this.shaderStage){const i=this.getDataFromNode(e);let s=i.code;if(s===void 0){const o=this.codes[r]||(this.codes[r]=[]),a=o.length;s=new f$("nodeCode"+a,t),o.push(s),i.code=s}return s}addFlowCodeHierarchy(e,t){const{flowCodes:r,flowCodeBlock:i}=this.getDataFromNode(e);let s=!0,o=t;for(;o;){if(i.get(o)===!0){s=!1;break}o=this.getDataFromNode(o).parentNodeBlock}if(s)for(const a of r)this.addLineFlowCode(a)}addLineFlowCodeBlock(e,t,r){const i=this.getDataFromNode(e),s=i.flowCodes||(i.flowCodes=[]),o=i.flowCodeBlock||(i.flowCodeBlock=new WeakMap);s.push(t),o.set(r,!0)}addLineFlowCode(e,t=null){return e===""?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),r=this.flowChildNode(e,t);return this.flowsData.set(e,r),r}addInclude(e){this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new x5,r=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=r,t}flowShaderNode(e){const t=e.layout,r={[Symbol.iterator](){let o=0;const a=Object.values(this);return{next:()=>({value:a[o],done:o++>=a.length})}}};for(const o of t.inputs)r[o.name]=new n5(o.type,o.name);e.layout=null;const i=e.call(r),s=this.flowStagesNode(i,t.type);return e.layout=t,s}flowBuildStage(e,t,r=null){const i=this.getBuildStage();this.setBuildStage(t);const s=e.build(this,r);return this.setBuildStage(i),s}flowStagesNode(e,t=null){const r=this.flow,i=this.vars,s=this.declarations,o=this.cache,a=this.buildStage,c=this.stack,f={code:""};this.flow=f,this.vars={},this.declarations={},this.cache=new yp,this.stack=q0();for(const p of sg)this.setBuildStage(p),f.result=e.build(this,t);return f.vars=this.getVars(this.shaderStage),this.flow=r,this.vars=i,this.declarations=s,this.cache=o,this.stack=c,this.setBuildStage(a),f}getFunctionOperator(){return null}buildFunctionCode(){De("Abstract function.")}flowChildNode(e,t=null){const r=this.flow,i={code:""};return this.flow=i,i.result=e.build(this,t),this.flow=r,i}flowNodeFromShaderStage(e,t,r=null,i=null){const s=this.tab,o=this.cache,a=this.shaderStage,c=this.context;this.setShaderStage(e);const f={...this.context};delete f.nodeBlock,this.cache=this.globalCache,this.tab="	",this.context=f;let p=null;if(this.buildStage==="generate"){const g=this.flowChildNode(t,r);i!==null&&(g.code+=`${this.tab+i} = ${g.result};
`),this.flowCode[e]=this.flowCode[e]+g.code,p=g}else p=t.build(this);return this.setShaderStage(a),this.cache=o,this.tab=s,this.context=c,p}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){De("Abstract function.")}getVaryings(){De("Abstract function.")}getVar(e,t,r=null){return`${r!==null?this.generateArrayDeclaration(e,r):this.getType(e)} ${t}`}getVars(e){let t="";const r=this.vars[e];if(r!==void 0)for(const i of r)t+=`${this.getVar(i.type,i.name)}; `;return t}getUniforms(){De("Abstract function.")}getCodes(e){const t=this.codes[e];let r="";if(t!==void 0)for(const i of t)r+=i.code+`
`;return r}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){De("Abstract function.")}get subBuild(){return this.subBuildLayers[this.subBuildLayers.length-1]||null}addSubBuild(e){this.subBuildLayers.push(e)}removeSubBuild(){return this.subBuildLayers.pop()}getClosestSubBuild(e){let t;if(e&&e.isNode?e.isShaderCallNodeInternal?t=e.shaderNode.subBuilds:e.isStackNode?t=[e.subBuild]:t=this.getDataFromNode(e,"any").subBuilds:e instanceof Set?t=[...e]:t=e,!t)return null;const r=this.subBuildLayers;for(let i=t.length-1;i>=0;i--){const s=t[i];if(r.includes(s))return s}return null}getSubBuildOutput(e){return this.getSubBuildProperty("outputNode",e)}getSubBuildProperty(e="",t=null){let r;t!==null?r=this.getClosestSubBuild(t):r=this.subBuildFn;let i;return r?i=e?r+"_"+e:r:i=e,i}build(){const{object:e,material:t,renderer:r}=this;if(t!==null){let i=r.library.fromMaterial(t);i===null&&(Be(`NodeMaterial: Material "${t.type}" is not compatible.`),i=new Rn),i.build(this)}else this.addFlow("compute",e);for(const i of sg){this.setBuildStage(i),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const s of og){this.setShaderStage(s);const o=this.flowNodes[s];for(const a of o)i==="generate"?this.flowNode(a):a.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getSharedDataFromNode(e){let t=D$.get(e);return t===void 0&&(t={}),t}getNodeUniform(e,t){const r=this.getSharedDataFromNode(e);let i=r.cache;if(i===void 0){if(t==="float"||t==="int"||t==="uint")i=new w$(e);else if(t==="vec2"||t==="ivec2"||t==="uvec2")i=new S$(e);else if(t==="vec3"||t==="ivec3"||t==="uvec3")i=new E$(e);else if(t==="vec4"||t==="ivec4"||t==="uvec4")i=new R$(e);else if(t==="color")i=new C$(e);else if(t==="mat2")i=new N$(e);else if(t==="mat3")i=new M$(e);else if(t==="mat4")i=new P$(e);else throw new Error(`Uniform "${t}" not implemented.`);r.cache=i}return i}format(e,t,r){if(t=this.getVectorType(t),r=this.getVectorType(r),t===r||r===null||this.isReference(r))return e;const i=this.getTypeLength(t),s=this.getTypeLength(r);return i===16&&s===9?`${this.getType(r)}( ${e}[ 0 ].xyz, ${e}[ 1 ].xyz, ${e}[ 2 ].xyz )`:i===9&&s===4?`${this.getType(r)}( ${e}[ 0 ].xy, ${e}[ 1 ].xy )`:i>4||s>4||s===0?e:i===s?`${this.getType(r)}( ${e} )`:i>s?(e=r==="bool"?`all( ${e} )`:`${e}.${"xyz".slice(0,s)}`,this.format(e,this.getTypeFromLength(s,this.getComponentType(t)),r)):s===4&&i>1?`${this.getType(r)}( ${this.format(e,t,"vec3")}, 1.0 )`:i===2?`${this.getType(r)}( ${this.format(e,t,"vec2")}, 0.0 )`:(i===1&&s>1&&t!==this.getComponentType(r)&&(e=`${this.getType(this.getComponentType(r))}( ${e} )`),`${this.getType(r)}( ${e} )`)}getSignature(){return`// Three.js r${of} - Node System
`}}class nb{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let r=e.get(t);return r===void 0&&(r={renderId:0,frameId:0},e.set(t,r)),r}updateBeforeNode(e){const t=e.getUpdateBeforeType(),r=e.updateReference(this);if(t===ot.FRAME){const i=this._getMaps(this.updateBeforeMap,r);if(i.frameId!==this.frameId){const s=i.frameId;i.frameId=this.frameId,e.updateBefore(this)===!1&&(i.frameId=s)}}else if(t===ot.RENDER){const i=this._getMaps(this.updateBeforeMap,r);if(i.renderId!==this.renderId){const s=i.renderId;i.renderId=this.renderId,e.updateBefore(this)===!1&&(i.renderId=s)}}else t===ot.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),r=e.updateReference(this);if(t===ot.FRAME){const i=this._getMaps(this.updateAfterMap,r);i.frameId!==this.frameId&&e.updateAfter(this)!==!1&&(i.frameId=this.frameId)}else if(t===ot.RENDER){const i=this._getMaps(this.updateAfterMap,r);i.renderId!==this.renderId&&e.updateAfter(this)!==!1&&(i.renderId=this.renderId)}else t===ot.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),r=e.updateReference(this);if(t===ot.FRAME){const i=this._getMaps(this.updateMap,r);i.frameId!==this.frameId&&e.update(this)!==!1&&(i.frameId=this.frameId)}else if(t===ot.RENDER){const i=this._getMaps(this.updateMap,r);i.renderId!==this.renderId&&e.update(this)!==!1&&(i.renderId=this.renderId)}else t===ot.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class oy{constructor(e,t,r=null,i="",s=!1){this.type=e,this.name=t,this.count=r,this.qualifier=i,this.isConst=s}}oy.isNodeFunctionInput=!0;class O$ extends el{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setupDirect(){const e=this.colorNode;return{lightDirection:ey(this.light),lightColor:e}}}const _p=new dn,e0=new dn;let $u=null;class F$ extends el{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=Ve(new ge).setGroup(Ge),this.halfWidth=Ve(new ge).setGroup(Ge),this.updateType=ot.RENDER}update(e){super.update(e);const{light:t}=this,r=e.camera.matrixWorldInverse;e0.identity(),_p.copy(t.matrixWorld),_p.premultiply(r),e0.extractRotation(_p),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(e0),this.halfHeight.value.applyMatrix4(e0)}setupDirectRectArea(e){let t,r;e.isAvailable("float32Filterable")?(t=Nt($u.LTC_FLOAT_1),r=Nt($u.LTC_FLOAT_2)):(t=Nt($u.LTC_HALF_1),r=Nt($u.LTC_HALF_2));const{colorNode:i,light:s}=this,o=J2(s);return{lightColor:i,lightPosition:o,halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:r}}static setLTC(e){$u=e}}class ay extends el{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=Ve(0).setGroup(Ge),this.penumbraCosNode=Ve(0).setGroup(Ge),this.cutoffDistanceNode=Ve(0).setGroup(Ge),this.decayExponentNode=Ve(0).setGroup(Ge),this.colorNode=Ve(this.color).setGroup(Ge)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e,t){const{coneCosNode:r,penumbraCosNode:i}=this;return Zi(r,i,t)}getLightCoord(e){const t=e.getNodeProperties(this);let r=t.projectionUV;return r===void 0&&(r=E5(this.light,e.context.positionWorld),t.projectionUV=r),r}setupDirect(e){const{colorNode:t,cutoffDistanceNode:r,decayExponentNode:i,light:s}=this,o=this.getLightVector(e),a=o.normalize(),c=a.dot(ey(s)),f=this.getSpotAttenuation(e,c),p=o.length(),g=ry({lightDistance:p,cutoffDistance:r,decayExponent:i});let v=t.mul(f).mul(g),x,T;return s.colorNode?(T=this.getLightCoord(e),x=s.colorNode(T)):s.map&&(T=this.getLightCoord(e),x=Nt(s.map,T.xy).onRenderUpdate(()=>s.map)),x&&(v=T.mul(2).sub(1).abs().lessThan(1).all().select(v.mul(x),v)),{lightColor:v,lightDirection:a}}}class I$ extends ay{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e,t){const r=this.light.iesMap;let i=null;if(r&&r.isTexture===!0){const s=t.acos().mul(1/Math.PI);i=Nt(r,we(s,0),0).r}else i=super.getSpotAttenuation(t);return i}}const k$=re(([n,e])=>{const t=n.abs().sub(e);return ws(_n(t,0)).add(zr(_n(t.x,t.y),0))});class U$ extends ay{static get type(){return"ProjectorLightNode"}update(e){super.update(e);const t=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(t.angle*(1-t.penumbra)),.99999),t.aspect===null){let r=1;t.map!==null&&(r=t.map.width/t.map.height),t.shadow.aspect=r}else t.shadow.aspect=t.aspect}getSpotAttenuation(e){const t=z(0),r=this.penumbraCosNode,i=jf(this.light).mul(e.context.positionWorld||Ss);return ze(i.w.greaterThan(0),()=>{const s=i.xyz.div(i.w),o=k$(s.xy.sub(we(.5)),we(.5)),a=ai(-1,St(1,t2(r)).sub(1));t.assign(Ef(o.mul(-2).mul(a)))}),t}}class q$ extends el{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class G$ extends el{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=Z2(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Ve(new jn).setGroup(Ge)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:r,lightDirectionNode:i}=this,o=ra.dot(i).mul(.5).add(.5),a=Tt(r,t,o);e.context.irradiance.addAssign(a)}}class V$ extends el{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let r=0;r<9;r++)t.push(new ge);this.lightProbe=mr(t)}update(e){const{light:t}=this;super.update(e);for(let r=0;r<9;r++)this.lightProbe.array[r].copy(t.sh.coefficients[r]).multiplyScalar(t.intensity)}setup(e){const t=X5(ra,this.lightProbe);e.context.irradiance.addAssign(t)}}class Z5{parseFunction(){De("Abstract function.")}}class ly{constructor(e,t,r="",i=""){this.type=e,this.inputs=t,this.name=r,this.precision=i}getCode(){De("Abstract function.")}}ly.isNodeFunction=!0;const z$=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,j$=/[a-z_0-9]+/ig,rb="#pragma main",$$=n=>{n=n.trim();const e=n.indexOf(rb),t=e!==-1?n.slice(e+rb.length):n,r=t.match(z$);if(r!==null&&r.length===5){const i=r[4],s=[];let o=null;for(;(o=j$.exec(i))!==null;)s.push(o);const a=[];let c=0;for(;c<s.length;){const T=s[c][0]==="const";T===!0&&c++;let S=s[c][0];S==="in"||S==="out"||S==="inout"?c++:S="";const E=s[c++][0];let N=Number.parseInt(s[c][0]);Number.isNaN(N)===!1?c++:N=null;const P=s[c++][0];a.push(new oy(E,P,N,S,T))}const f=t.substring(r[0].length),p=r[3]!==void 0?r[3]:"",g=r[2],v=r[1]!==void 0?r[1]:"",x=e!==-1?n.slice(0,e):"";return{type:g,inputs:a,name:p,precision:v,inputsCode:i,blockCode:f,headerCode:x}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class H$ extends ly{constructor(e){const{type:t,inputs:r,name:i,precision:s,inputsCode:o,blockCode:a,headerCode:c}=$$(e);super(t,r,i,s),this.inputsCode=o,this.blockCode=a,this.headerCode=c}getCode(e=this.name){let t;const r=this.blockCode;if(r!==""){const{type:i,inputsCode:s,headerCode:o,precision:a}=this;let c=`${i} ${e} ( ${s.trim()} )`;a!==""&&(c=`${a} ${c}`),t=o+c+r}else t="";return t}}class W$ extends Z5{parseFunction(e){return new H$(e)}}const ib=new WeakMap,ls=[],Ro=[];class Q$ extends ia{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new nb,this.nodeBuilderCache=new Map,this.callHashCache=new Ji,this.groupsData=new Ji,this.cacheLib={}}updateGroup(e){const t=e.groupNode,r=t.name;if(r===X1.name)return!0;if(r===Ge.name){const s=this.get(e),o=this.nodeFrame.renderId;return s.renderId!==o?(s.renderId=o,!0):!1}if(r===zT.name){const s=this.get(e),o=this.nodeFrame.frameId;return s.frameId!==o?(s.frameId=o,!0):!1}ls[0]=t,ls[1]=e;let i=this.groupsData.get(ls);return i===void 0&&this.groupsData.set(ls,i={}),ls.length=0,i.version!==t.version?(i.version=t.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let r=t.nodeBuilderState;if(r===void 0){const{nodeBuilderCache:i}=this,s=this.getForRenderCacheKey(e);if(r=i.get(s),r===void 0){const o=c=>{const f=this.backend.createNodeBuilder(e.object,this.renderer);return f.scene=e.scene,f.material=c,f.camera=e.camera,f.context.material=c,f.lightsNode=e.lightsNode,f.environmentNode=this.getEnvironmentNode(e.scene),f.fogNode=this.getFogNode(e.scene),f.clippingContext=e.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&f.enableMultiview(),f};let a=o(e.material);try{a.build()}catch(c){a=o(new Rn),a.build(),Be("TSL: "+c)}r=this._createNodeBuilderState(a),i.set(s,r)}r.usedTimes++,t.nodeBuilderState=r}return r}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,t.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let r=t.nodeBuilderState;if(r===void 0){const i=this.backend.createNodeBuilder(e,this.renderer);i.build(),r=this._createNodeBuilderState(i),t.nodeBuilderState=r}return r}_createNodeBuilderState(e){return new A$(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const r=this.get(e);r.environmentNode&&(t=r.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const r=this.get(e);r.backgroundNode&&(t=r.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){ls[0]=e,ls[1]=t;const r=this.renderer.info.calls,i=this.callHashCache.get(ls)||{};if(i.callId!==r){const s=this.getEnvironmentNode(e),o=this.getFogNode(e);t&&Ro.push(t.getCacheKey(!0)),s&&Ro.push(s.getCacheKey()),o&&Ro.push(o.getCacheKey()),Ro.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),Ro.push(this.renderer.shadowMap.enabled?1:0),Ro.push(this.renderer.shadowMap.type),i.callId=r,i.cacheKey=pu(Ro),this.callHashCache.set(ls,i),Ro.length=0}return ls.length=0,i.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),r=e.background;if(r){const i=e.backgroundBlurriness===0&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&t.backgroundBlurriness===0;if(t.background!==r||i){const s=this.getCacheNode("background",r,()=>{if(r.isCubeTexture===!0||r.mapping===Kg||r.mapping===Zg||r.mapping===Wp){if(e.backgroundBlurriness>0||r.mapping===Wp)return V2(r);{let o;return r.isCubeTexture===!0?o=Nr(r):o=Nt(r),Fw(o)}}else{if(r.isTexture===!0)return Nt(r,to.flipY()).setUpdateMatrix(!0);r.isColor!==!0&&Be("WebGPUNodes: Unsupported background configuration.",r)}},i);t.backgroundNode=s,t.background=r,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,r,i=!1){const s=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let o=s.get(t);return(o===void 0||i)&&(o=r(),s.set(t,o)),o}updateFog(e){const t=this.get(e),r=e.fog;if(r){if(t.fog!==r){const i=this.getCacheNode("fog",r,()=>{if(r.isFogExp2){const s=zt("color","color",r).setGroup(Ge),o=zt("density","float",r).setGroup(Ge);return $A(s,Y2(o))}else if(r.isFog){const s=zt("color","color",r).setGroup(Ge),o=zt("near","float",r).setGroup(Ge),a=zt("far","float",r).setGroup(Ge);return $A(s,X2(o,a))}else Be("Renderer: Unsupported fog configuration.",r)});t.fogNode=i,t.fog=r}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),r=e.environment;if(r){if(t.environment!==r){const i=this.getCacheNode("environment",r,()=>{if(r.isCubeTexture===!0)return Nr(r);if(r.isTexture===!0)return Nt(r);Be("Nodes: Unsupported environment configuration.",r)});t.environmentNode=i,t.environment=r}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,r=null,i=null,s=null){const o=this.nodeFrame;return o.renderer=e,o.scene=t,o.object=r,o.camera=i,o.material=s,o}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace+","+e.xr.isPresenting}hasOutputChange(e){return ib.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,r=this.getOutputCacheKey(),i=e.isArrayTexture?Gf(e,Z(to,po("gl_ViewID_OVR"))).renderOutput(t.toneMapping,t.currentColorSpace):Nt(e,to).renderOutput(t.toneMapping,t.currentColorSpace);return ib.set(e,r),i}updateBefore(e){const t=e.getNodeBuilderState();for(const r of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(r)}updateAfter(e){const t=e.getNodeBuilderState();for(const r of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(r)}updateForCompute(e){const t=this.getNodeFrame(),r=this.getForCompute(e);for(const i of r.updateNodes)t.updateNode(i)}updateForRender(e){const t=this.getNodeFrameForRender(e),r=e.getNodeBuilderState();for(const i of r.updateNodes)t.updateNode(i)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new nb,this.nodeBuilderCache=new Map,this.cacheLib={}}}const vp=new t1;class Kh{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new YA,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,e!==null&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,r){const i=e.length;for(let s=0;s<i;s++){vp.copy(e[s]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const o=t[r+s],a=vp.normal;o.x=-a.x,o.y=-a.y,o.z=-a.z,o.w=vp.constant}}updateGlobal(e,t){this.shadowPass=e.overrideMaterial!==null&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let r=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const i=t.clippingPlanes,s=i.length;let o,a;if(this.clipIntersection?(o=this.intersectionPlanes,a=e.intersectionPlanes.length):(o=this.unionPlanes,a=e.unionPlanes.length),o.length!==a+s){o.length=a+s;for(let c=0;c<s;c++)o[a+c]=new $t;r=!0}this.projectPlanes(i,o,a),r&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return t===void 0&&(t=new Kh(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class X${constructor(e,t){this.bundleGroup=e,this.camera=t}}const Hu=[];class Y${constructor(){this.bundles=new Ji}get(e,t){const r=this.bundles;Hu[0]=e,Hu[1]=t;let i=r.get(Hu);return i===void 0&&(i=new X$(e,t),r.set(Hu,i)),Hu.length=0,i}dispose(){this.bundles=new Ji}}class J5{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const r=this.getMaterialNodeClass(e.type);if(r!==null){t=new r;for(const i in e)t[i]=e[i]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,r){if(r.has(t)){De(`Redefinition of node ${t}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t=="function"||typeof t=="object")throw new Error(`Base class ${t} is not a class.`);r.set(t,e)}addClass(e,t,r){if(r.has(t)){De(`Redefinition of node ${t.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t!="function")throw new Error(`Base class ${t.name} is not a class.`);r.set(t,e)}}const K$=new ty,Wu=[];class Z$ extends Ji{constructor(){super()}createNode(e=[]){return new ty().setLights(e)}getNode(e,t){if(e.isQuadMesh)return K$;Wu[0]=e,Wu[1]=t;let r=this.get(Wu);return r===void 0&&(r=this.createNode(),this.set(Wu,r)),Wu.length=0,r}}class aA extends ea{constructor(e=1,t=1,r={}){super(e,t,r),this.isXRRenderTarget=!0,this._hasExternalTextures=!1,this._autoAllocateDepthBuffer=!0,this._isOpaqueFramebuffer=!1}copy(e){return super.copy(e),this._hasExternalTextures=e._hasExternalTextures,this._autoAllocateDepthBuffer=e._autoAllocateDepthBuffer,this._isOpaqueFramebuffer=e._isOpaqueFramebuffer,this}}const sb=new ge,ob=new ge;class J$ extends sf{constructor(e,t=!1){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new wA,this._cameraL.viewport=new $t,this._cameraR=new wA,this._cameraR.viewport=new $t,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new YR,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._sessionUsesLayers=!1,this._supportsGlBinding=typeof XRWebGLBinding<"u",this._frameBufferTargets=null,this._createXRLayer=sH.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new _t,this._onSessionEvent=nH.bind(this),this._onSessionEnd=rH.bind(this),this._onInputSourcesChange=iH.bind(this),this._onAnimationFrame=oH.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._supportsLayers=this._supportsGlBinding&&"createProjectionLayer"in XRWebGLBinding.prototype,this._useMultiviewIfPossible=t,this._useMultiview=!1}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(!(this._glProjLayer===null&&this._glBaseLayer===null))return this._foveation}setFoveation(e){this._foveation=e,this._glProjLayer!==null&&(this._glProjLayer.fixedFoveation=e),this._glBaseLayer!==null&&this._glBaseLayer.fixedFoveation!==void 0&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,this.isPresenting===!0&&De("XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,this.isPresenting===!0&&De("XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(this._session!==null)return this._session.environmentBlendMode}getBinding(){return this._glBinding===null&&this._supportsGlBinding&&(this._glBinding=new XRWebGLBinding(this._session,this._gl)),this._glBinding}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(e,t,r,i,s,o,a,c={}){const f=new KR(e,t),p=new aA(s,o,{format:zi,type:ii,depthTexture:new Wi(s,o,c.stencil?jo:Un,void 0,void 0,void 0,void 0,void 0,void 0,c.stencil?$o:Ho),stencilBuffer:c.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});p._autoAllocateDepthBuffer=!0;const g=new ds({color:16777215,side:uA});g.map=p.texture,g.map.offset.y=1,g.map.repeat.y=-1;const v=new gn(f,g);v.position.copy(r),v.quaternion.copy(i);const x={type:"quad",width:e,height:t,translation:r,quaternion:i,pixelwidth:s,pixelheight:o,plane:v,material:g,rendercall:a,renderTarget:p};if(this._layers.push(x),this._session!==null){x.plane.material=new ds({color:16777215,side:uA}),x.plane.material.blending=AA,x.plane.material.blendEquation=$s,x.plane.material.blendSrc=Bo,x.plane.material.blendDst=Bo,x.xrlayer=this._createXRLayer(x);const T=this._session.renderState.layers;T.unshift(x.xrlayer),this._session.updateRenderState({layers:T})}else p.isXRRenderTarget=!1;return v}createCylinderLayer(e,t,r,i,s,o,a,c,f={}){const p=new mx(e,e,e*t/r,64,64,!0,Math.PI-t/2,t),g=new aA(o,a,{format:zi,type:ii,depthTexture:new Wi(o,a,f.stencil?jo:Un,void 0,void 0,void 0,void 0,void 0,void 0,f.stencil?$o:Ho),stencilBuffer:f.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});g._autoAllocateDepthBuffer=!0;const v=new ds({color:16777215,side:yr});v.map=g.texture,v.map.offset.y=1,v.map.repeat.y=-1;const x=new gn(p,v);x.position.copy(i),x.quaternion.copy(s);const T={type:"cylinder",radius:e,centralAngle:t,aspectratio:r,translation:i,quaternion:s,pixelwidth:o,pixelheight:a,plane:x,material:v,rendercall:c,renderTarget:g};if(this._layers.push(T),this._session!==null){T.plane.material=new ds({color:16777215,side:yr}),T.plane.material.blending=AA,T.plane.material.blendEquation=$s,T.plane.material.blendSrc=Bo,T.plane.material.blendDst=Bo,T.xrlayer=this._createXRLayer(T);const S=this._session.renderState.layers;S.unshift(T.xrlayer),this._session.updateRenderState({layers:S})}else g.isXRRenderTarget=!1;return x}renderLayers(){const e=new ge,t=new Yl,r=this._renderer,i=this.isPresenting,s=r.getOutputRenderTarget(),o=r._frameBufferTarget;this.isPresenting=!1;const a=new _t;r.getSize(a);const c=r._quad;for(const f of this._layers)if(f.renderTarget.isXRRenderTarget=this._session!==null,f.renderTarget._hasExternalTextures=f.renderTarget.isXRRenderTarget,f.renderTarget.isXRRenderTarget&&this._sessionUsesLayers){f.xrlayer.transform=new XRRigidTransform(f.plane.getWorldPosition(e),f.plane.getWorldQuaternion(t));const p=this._glBinding.getSubImage(f.xrlayer,this._xrFrame);r.backend.setXRRenderTargetTextures(f.renderTarget,p.colorTexture,void 0),r._setXRLayerSize(f.renderTarget.width,f.renderTarget.height),r.setOutputRenderTarget(f.renderTarget),r.setRenderTarget(null),r._frameBufferTarget=null,this._frameBufferTargets||(this._frameBufferTargets=new WeakMap);const{frameBufferTarget:g,quad:v}=this._frameBufferTargets.get(f.renderTarget)||{frameBufferTarget:null,quad:null};g?(r._frameBufferTarget=g,r._quad=v):(r._quad=new Uf(new Rn),this._frameBufferTargets.set(f.renderTarget,{frameBufferTarget:r._getFrameBufferTarget(),quad:r._quad})),f.rendercall(),r._frameBufferTarget=null}else r.setRenderTarget(f.renderTarget),f.rendercall();r.setRenderTarget(null),r.setOutputRenderTarget(s),r._frameBufferTarget=o,r._setXRLayerSize(a.x,a.y),r._quad=c,this.isPresenting=i}getSession(){return this._session}async setSession(e){const t=this._renderer,r=t.backend;this._gl=t.getContext();const i=this._gl,s=i.getContextAttributes();if(this._session=e,e!==null){if(r.isWebGPUBackend===!0)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await r.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),this._supportsLayers===!0){let o=null,a=null,c=null;t.depth&&(c=t.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,o=t.stencil?$o:Ho,a=t.stencil?jo:Un);const f={colorFormat:i.RGBA8,depthFormat:c,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&t.hasFeature("OVR_multiview2")&&(f.textureType="texture-array",this._useMultiview=!0),this._glBinding=this.getBinding();const p=this._glBinding.createProjectionLayer(f),g=[p];this._glProjLayer=p,t.setPixelRatio(1),t._setXRLayerSize(p.textureWidth,p.textureHeight);const v=this._useMultiview?2:1,x=new Wi(p.textureWidth,p.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,o,v);if(this._xrRenderTarget=new aA(p.textureWidth,p.textureHeight,{format:zi,type:ii,colorSpace:t.outputColorSpace,depthTexture:x,stencilBuffer:t.stencil,samples:s.antialias?4:0,resolveDepthBuffer:p.ignoreDepthValues===!1,resolveStencilBuffer:p.ignoreDepthValues===!1,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget._hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._sessionUsesLayers=e.enabledFeatures.includes("layers"),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._sessionUsesLayers)for(const T of this._layers)T.plane.material=new ds({color:16777215,side:T.type==="cylinder"?yr:uA}),T.plane.material.blending=AA,T.plane.material.blendEquation=$s,T.plane.material.blendSrc=Bo,T.plane.material.blendDst=Bo,T.xrlayer=this._createXRLayer(T),g.unshift(T.xrlayer);e.updateRenderState({layers:g})}else{const o={antialias:t.currentSamples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},a=new XRWebGLLayer(e,i,o);this._glBaseLayer=a,e.updateRenderState({baseLayer:a}),t.setPixelRatio(1),t._setXRLayerSize(a.framebufferWidth,a.framebufferHeight),this._xrRenderTarget=new aA(a.framebufferWidth,a.framebufferHeight,{format:zi,type:ii,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:a.ignoreDepthValues===!1,resolveStencilBuffer:a.ignoreDepthValues===!1}),this._xrRenderTarget._isOpaqueFramebuffer=!0,this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(t===null)return;const r=e.near,i=e.far,s=this._cameraXR,o=this._cameraL,a=this._cameraR;s.near=a.near=o.near=r,s.far=a.far=o.far=i,s.isMultiViewCamera=this._useMultiview,(this._currentDepthNear!==s.near||this._currentDepthFar!==s.far)&&(t.updateRenderState({depthNear:s.near,depthFar:s.far}),this._currentDepthNear=s.near,this._currentDepthFar=s.far),s.layers.mask=e.layers.mask|6,o.layers.mask=s.layers.mask&3,a.layers.mask=s.layers.mask&5;const c=e.parent,f=s.cameras;ab(s,c);for(let p=0;p<f.length;p++)ab(f[p],c);f.length===2?eH(s,o,a):s.projectionMatrix.copy(o.projectionMatrix),tH(e,s,c)}_getController(e){let t=this._controllers[e];return t===void 0&&(t=new ZR,this._controllers[e]=t),t}}function eH(n,e,t){sb.setFromMatrixPosition(e.matrixWorld),ob.setFromMatrixPosition(t.matrixWorld);const r=sb.distanceTo(ob),i=e.projectionMatrix.elements,s=t.projectionMatrix.elements,o=i[14]/(i[10]-1),a=i[14]/(i[10]+1),c=(i[9]+1)/i[5],f=(i[9]-1)/i[5],p=(i[8]-1)/i[0],g=(s[8]+1)/s[0],v=o*p,x=o*g,T=r/(-p+g),S=T*-p;if(e.matrixWorld.decompose(n.position,n.quaternion,n.scale),n.translateX(S),n.translateZ(T),n.matrixWorld.compose(n.position,n.quaternion,n.scale),n.matrixWorldInverse.copy(n.matrixWorld).invert(),i[10]===-1)n.projectionMatrix.copy(e.projectionMatrix),n.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const E=o+T,N=a+T,P=v-S,B=x+(r-S),L=c*a/N*E,k=f*a/N*E;n.projectionMatrix.makePerspective(P,B,L,k,E,N),n.projectionMatrixInverse.copy(n.projectionMatrix).invert()}}function ab(n,e){e===null?n.matrixWorld.copy(n.matrix):n.matrixWorld.multiplyMatrices(e.matrixWorld,n.matrix),n.matrixWorldInverse.copy(n.matrixWorld).invert()}function tH(n,e,t){t===null?n.matrix.copy(e.matrixWorld):(n.matrix.copy(t.matrixWorld),n.matrix.invert(),n.matrix.multiply(e.matrixWorld)),n.matrix.decompose(n.position,n.quaternion,n.scale),n.updateMatrixWorld(!0),n.projectionMatrix.copy(e.projectionMatrix),n.projectionMatrixInverse.copy(e.projectionMatrixInverse),n.isPerspectiveCamera&&(n.fov=pC*2*Math.atan(1/n.projectionMatrix.elements[5]),n.zoom=1)}function nH(n){const e=this._controllerInputSources.indexOf(n.inputSource);if(e===-1)return;const t=this._controllers[e];if(t!==void 0){const r=this.getReferenceSpace();t.update(n.inputSource,n.frame,r),t.dispatchEvent({type:n.type,data:n.inputSource})}}function rH(){const n=this._session,e=this._renderer;n.removeEventListener("select",this._onSessionEvent),n.removeEventListener("selectstart",this._onSessionEvent),n.removeEventListener("selectend",this._onSessionEvent),n.removeEventListener("squeeze",this._onSessionEvent),n.removeEventListener("squeezestart",this._onSessionEvent),n.removeEventListener("squeezeend",this._onSessionEvent),n.removeEventListener("end",this._onSessionEnd),n.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let t=0;t<this._controllers.length;t++){const r=this._controllerInputSources[t];r!==null&&(this._controllerInputSources[t]=null,this._controllers[t].disconnect(r))}if(this._currentDepthNear=null,this._currentDepthFar=null,e._resetXRState(),this._session=null,this._xrRenderTarget=null,this._glBinding=null,this._glBaseLayer=null,this._glProjLayer=null,this._sessionUsesLayers===!0)for(const t of this._layers)t.renderTarget=new aA(t.pixelwidth,t.pixelheight,{format:zi,type:ii,depthTexture:new Wi(t.pixelwidth,t.pixelheight,t.stencilBuffer?jo:Un,void 0,void 0,void 0,void 0,void 0,void 0,t.stencilBuffer?$o:Ho),stencilBuffer:t.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),t.renderTarget.isXRRenderTarget=!1,t.plane.material=t.material,t.material.map=t.renderTarget.texture,t.material.map.offset.y=1,t.material.map.repeat.y=-1,delete t.xrlayer;this.isPresenting=!1,this._useMultiview=!1,e._animation.stop(),e._animation.setAnimationLoop(this._currentAnimationLoop),e._animation.setContext(this._currentAnimationContext),e._animation.start(),e.setPixelRatio(this._currentPixelRatio),e.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function iH(n){const e=this._controllers,t=this._controllerInputSources;for(let r=0;r<n.removed.length;r++){const i=n.removed[r],s=t.indexOf(i);s>=0&&(t[s]=null,e[s].disconnect(i))}for(let r=0;r<n.added.length;r++){const i=n.added[r];let s=t.indexOf(i);if(s===-1){for(let a=0;a<e.length;a++)if(a>=t.length){t.push(i),s=a;break}else if(t[a]===null){t[a]=i,s=a;break}if(s===-1)break}const o=e[s];o&&o.connect(i)}}function sH(n){return n.type==="quad"?this._glBinding.createQuadLayer({transform:new XRRigidTransform(n.translation,n.quaternion),width:n.width/2,height:n.height/2,space:this._referenceSpace,viewPixelWidth:n.pixelwidth,viewPixelHeight:n.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(n.translation,n.quaternion),radius:n.radius,centralAngle:n.centralAngle,aspectRatio:n.aspectRatio,space:this._referenceSpace,viewPixelWidth:n.pixelwidth,viewPixelHeight:n.pixelheight,clearOnAccess:!1})}function oH(n,e){if(e===void 0)return;const t=this._cameraXR,r=this._renderer,i=r.backend,s=this._glBaseLayer,o=this.getReferenceSpace(),a=e.getViewerPose(o);if(this._xrFrame=e,a!==null){const c=a.views;this._glBaseLayer!==null&&i.setXRTarget(s.framebuffer);let f=!1;c.length!==t.cameras.length&&(t.cameras.length=0,f=!0);for(let p=0;p<c.length;p++){const g=c[p];let v;if(this._supportsLayers===!0){const T=this._glBinding.getViewSubImage(this._glProjLayer,g);v=T.viewport,p===0&&i.setXRRenderTargetTextures(this._xrRenderTarget,T.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:T.depthStencilTexture)}else v=s.getViewport(g);let x=this._cameras[p];x===void 0&&(x=new wA,x.layers.enable(p),x.viewport=new $t,this._cameras[p]=x),x.matrix.fromArray(g.transform.matrix),x.matrix.decompose(x.position,x.quaternion,x.scale),x.projectionMatrix.fromArray(g.projectionMatrix),x.projectionMatrixInverse.copy(x.projectionMatrix).invert(),x.viewport.set(v.x,v.y,v.width,v.height),p===0&&(t.matrix.copy(x.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale)),f===!0&&t.cameras.push(x)}r.setOutputRenderTarget(this._xrRenderTarget)}for(let c=0;c<this._controllers.length;c++){const f=this._controllerInputSources[c],p=this._controllers[c];f!==null&&p!==void 0&&p.update(f,e,o)}this._currentAnimationLoop&&this._currentAnimationLoop(n,e),e.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:e}),this._xrFrame=null}class aH extends sf{constructor(e){super(),this.domElement=e,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new $t(0,0,this._width,this._height),this._scissor=new $t(0,0,this._width,this._height),this._scissorTest=!1,this.colorTexture=new Xg,this.depthTexture=new Wi}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,r){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=r,this.domElement.width=Math.floor(e*r),this.domElement.height=Math.floor(t*r),this.setViewport(0,0,e,t),this._dispatchResize())}setSize(e,t,r=!0){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),r===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._dispatchResize())}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,r,i){const s=this._scissor;e.isVector4?s.copy(e):s.set(e,t,r,i)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,r,i,s=0,o=1){const a=this._viewport;e.isVector4?a.copy(e):a.set(e,t,r,i),a.minDepth=s,a.maxDepth=o}_dispatchResize(){this.dispatchEvent({type:"resize"})}dispose(){this.dispatchEvent({type:"dispose"})}}const lb=new rf,Sl=new _t,bp=new $t,xp=new cx,Tp=new UR,t0=new dn,Vs=new $t;class lH{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:r=!1,alpha:i=!0,depth:s=!0,stencil:o=!1,antialias:a=!1,samples:c=0,getFallback:f=null,outputBufferType:p=or,multiview:g=!1}=t;this.backend=e,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=i,this.logarithmicDepthBuffer=r,this.outputColorSpace=XA,this.toneMapping=Ba,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=s,this.stencil=o,this.info=new KU,this.contextNode=fo(),this.library=new J5,this.lighting=new Z$,this._samples=c||a===!0?4:0,this._onCanvasTargetResize=this._onCanvasTargetResize.bind(this),this._canvasTarget=new aH(e.getDomElement()),this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize),this._canvasTarget.isDefaultCanvasTarget=!0,this._inspector=new a6,this._inspector.setRenderer(this),this._getFallback=f,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new Uf(new Rn),this._quad.name="Output Color Transform",this._quad.material.name="outputColorTransform",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const v=this.alpha===!0?0:1;this._clearColor=new z2(0,0,0,v),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._outputBufferType=p,this._cacheShadowNodes=new WeakMap,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:kR},this.xr=new J$(this,g),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(x,T,S)=>{await this.compileAsync(x,T);const E=this._renderLists.get(x,T),N=this._renderContexts.get(x,T,this._renderTarget,this._mrt),P=x.overrideMaterial||S.material,B=this._objects.get(S,P,x,T,E.lightsNode,N,N.clippingContext),{fragmentShader:L,vertexShader:k}=B.getNodeBuilderState();return{fragmentShader:L,vertexShader:k}}}}async init(){return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,t)=>{let r=this.backend;try{await r.init(this)}catch(i){if(this._getFallback!==null)try{this.backend=r=this._getFallback(i),await r.init(this)}catch(s){t(s);return}else{t(i);return}}this._nodes=new Q$(this,r),this._animation=new VU(this,this._nodes,this.info),this._attributes=new XU(r),this._background=new l$(this,this._nodes),this._geometries=new YU(this._attributes,this.info),this._textures=new hq(this,r,this.info),this._pipelines=new tq(r,this._nodes),this._bindings=new nq(r,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new HU(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new sq(this.lighting),this._bundles=new Y$,this._renderContexts=new Aq,this._animation.start(),this._initialized=!0,this._inspector.init(),e(this)}),this._initPromise)}get domElement(){return this._canvasTarget.domElement}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,r=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const i=this._nodes.nodeFrame,s=i.renderId,o=this._currentRenderContext,a=this._currentRenderObjectFunction,c=this._compilationPromises,f=e.isScene===!0?e:lb;r===null&&(r=e);const p=this._renderTarget,g=this._renderContexts.get(r,t,p,this._mrt),v=this._activeMipmapLevel,x=[];this._currentRenderContext=g,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=x,i.renderId++,i.update(),g.depth=this.depth,g.stencil=this.stencil,g.clippingContext||(g.clippingContext=new Kh),g.clippingContext.updateGlobal(f,t),f.onBeforeRender(this,e,t,p);const T=this._renderLists.get(e,t);if(T.begin(),this._projectObject(e,t,0,T,g.clippingContext),r!==e&&r.traverseVisible(function(B){B.isLight&&B.layers.test(t.layers)&&T.pushLight(B)}),T.finish(),p!==null){this._textures.updateRenderTarget(p,v);const B=this._textures.get(p);g.textures=B.textures,g.depthTexture=B.depthTexture}else g.textures=null,g.depthTexture=null;this._background.update(f,T,g);const S=T.opaque,E=T.transparent,N=T.transparentDoublePass,P=T.lightsNode;this.opaque===!0&&S.length>0&&this._renderObjects(S,t,f,P),this.transparent===!0&&E.length>0&&this._renderTransparents(E,N,t,f,P),i.renderId=s,this._currentRenderContext=o,this._currentRenderObjectFunction=a,this._compilationPromises=c,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(x)}async renderAsync(e,t){fn('Renderer: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.render(e,t)}async waitForGPU(){Be("Renderer: waitForGPU() has been removed. Read https://github.com/mrdoob/three.js/issues/32012 for more information.")}set inspector(e){this._inspector!==null&&this._inspector.setRenderer(null),this._inspector=e,this._inspector.setRenderer(this)}get inspector(){return this._inspector}set highPrecision(e){const t=this.contextNode.value;e===!0?(t.modelViewMatrix=hg,t.modelNormalViewMatrix=fg):this.highPrecision&&(delete t.modelViewMatrix,delete t.modelNormalViewMatrix)}get highPrecision(){const e=this.contextNode.value;return e.modelViewMatrix===hg&&e.modelNormalViewMatrix===fg}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getOutputBufferType(){return this._outputBufferType}getColorBufferType(){return fn('Renderer: ".getColorBufferType()" has been renamed to ".getOutputBufferType()".'),this.getOutputBufferType()}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(t+=`
Reason: ${e.reason}`),Be(t),this._isDeviceLost=!0}_renderBundle(e,t,r){const{bundleGroup:i,camera:s,renderList:o}=e,a=this._currentRenderContext,c=this._bundles.get(i,s),f=this.backend.get(c);f.renderContexts===void 0&&(f.renderContexts=new Set);const p=i.version!==f.version,g=f.renderContexts.has(a)===!1||p;if(f.renderContexts.add(a),g){this.backend.beginBundle(a),(f.renderObjects===void 0||p)&&(f.renderObjects=[]),this._currentRenderBundle=c;const{transparentDoublePass:v,transparent:x,opaque:T}=o;this.opaque===!0&&T.length>0&&this._renderObjects(T,s,t,r),this.transparent===!0&&x.length>0&&this._renderTransparents(x,v,s,t,r),this._currentRenderBundle=null,this.backend.finishBundle(a,c),f.version=i.version}else{const{renderObjects:v}=f;for(let x=0,T=v.length;x<T;x++){const S=v[x];this._nodes.needsRefresh(S)&&(this._nodes.updateBefore(S),this._nodes.updateForRender(S),this._bindings.updateForRender(S),this._nodes.updateAfter(S))}}this.backend.addBundle(a,c)}render(e,t){if(this._initialized===!1)throw new Error('Renderer: .render() called before the backend is initialized. Use "await renderer.init();" before rendering.');this._renderScene(e,t)}get initialized(){return this._initialized}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this,r=e!==Ba,i=t!==Sn.workingColorSpace;if(r===!1&&i===!1)return null;const{width:s,height:o}=this.getDrawingBufferSize(Sl),{depth:a,stencil:c}=this;let f=this._frameBufferTarget;f===null&&(f=new ea(s,o,{depthBuffer:a,stencilBuffer:c,type:this._outputBufferType,format:zi,colorSpace:Sn.workingColorSpace,generateMipmaps:!1,minFilter:Xi,magFilter:Xi,samples:this.samples}),f.isPostProcessingRenderTarget=!0,this._frameBufferTarget=f);const p=this.getOutputRenderTarget();f.depthBuffer=a,f.stencilBuffer=c,p!==null?f.setSize(p.width,p.height,p.depth):f.setSize(s,o,1);const g=this._canvasTarget;return f.viewport.copy(g._viewport),f.scissor.copy(g._scissor),f.viewport.multiplyScalar(g._pixelRatio),f.scissor.multiplyScalar(g._pixelRatio),f.scissorTest=g._scissorTest,f.multiview=p!==null?p.multiview:!1,f.resolveDepthBuffer=p!==null?p.resolveDepthBuffer:!0,f._autoAllocateDepthBuffer=p!==null?p._autoAllocateDepthBuffer:!1,f}_renderScene(e,t,r=!0){if(this._isDeviceLost===!0)return;const i=r?this._getFrameBufferTarget():null,s=this._nodes.nodeFrame,o=s.renderId,a=this._currentRenderContext,c=this._currentRenderObjectFunction,f=e.isScene===!0?e:lb,p=this._renderTarget||this._outputRenderTarget,g=this._activeCubeFace,v=this._activeMipmapLevel;let x;i!==null?(x=i,this.setRenderTarget(x)):x=p;const T=this._renderContexts.get(e,t,x,this._mrt);this._currentRenderContext=T,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,s.renderId=this.info.calls,this.backend.updateTimeStampUID(T),this.inspector.beginRender(this.backend.getTimestampUID(T),e,t,x);const S=this.coordinateSystem,E=this.xr;if(t.coordinateSystem!==S&&E.isPresenting===!1&&(t.coordinateSystem=S,t.updateProjectionMatrix(),t.isArrayCamera))for(const oe of t.cameras)oe.coordinateSystem=S,oe.updateProjectionMatrix();e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),E.enabled===!0&&E.isPresenting===!0&&(E.cameraAutoUpdate===!0&&E.updateCamera(t),t=E.getCamera());const N=this._canvasTarget;let P=N._viewport,B=N._scissor,L=N._pixelRatio;x!==null&&(P=x.viewport,B=x.scissor,L=1),this.getDrawingBufferSize(Sl),bp.set(0,0,Sl.width,Sl.height);const k=P.minDepth===void 0?0:P.minDepth,q=P.maxDepth===void 0?1:P.maxDepth;T.viewportValue.copy(P).multiplyScalar(L).floor(),T.viewportValue.width>>=v,T.viewportValue.height>>=v,T.viewportValue.minDepth=k,T.viewportValue.maxDepth=q,T.viewport=T.viewportValue.equals(bp)===!1,T.scissorValue.copy(B).multiplyScalar(L).floor(),T.scissor=N._scissorTest&&T.scissorValue.equals(bp)===!1,T.scissorValue.width>>=v,T.scissorValue.height>>=v,T.clippingContext||(T.clippingContext=new Kh),T.clippingContext.updateGlobal(f,t),f.onBeforeRender(this,e,t,x);const I=t.isArrayCamera?Tp:xp;t.isArrayCamera||(t0.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),I.setFromProjectionMatrix(t0,t.coordinateSystem,t.reversedDepth));const U=this._renderLists.get(e,t);if(U.begin(),this._projectObject(e,t,0,U,T.clippingContext),U.finish(),this.sortObjects===!0&&U.sort(this._opaqueSort,this._transparentSort),x!==null){this._textures.updateRenderTarget(x,v);const oe=this._textures.get(x);T.textures=oe.textures,T.depthTexture=oe.depthTexture,T.width=oe.width,T.height=oe.height,T.renderTarget=x,T.depth=x.depthBuffer,T.stencil=x.stencilBuffer}else T.textures=null,T.depthTexture=null,T.width=Sl.width,T.height=Sl.height,T.depth=this.depth,T.stencil=this.stencil;T.width>>=v,T.height>>=v,T.activeCubeFace=g,T.activeMipmapLevel=v,T.occlusionQueryCount=U.occlusionQueryCount,T.scissorValue.max(Vs.set(0,0,0,0)),T.scissorValue.x+T.scissorValue.width>T.width&&(T.scissorValue.width=Math.max(T.width-T.scissorValue.x,0)),T.scissorValue.y+T.scissorValue.height>T.height&&(T.scissorValue.height=Math.max(T.height-T.scissorValue.y,0)),this._background.update(f,U,T),T.camera=t,this.backend.beginRender(T);const{bundles:j,lightsNode:J,transparentDoublePass:Q,transparent:K,opaque:te}=U;return j.length>0&&this._renderBundles(j,f,J),this.opaque===!0&&te.length>0&&this._renderObjects(te,t,f,J),this.transparent===!0&&K.length>0&&this._renderTransparents(K,Q,t,f,J),this.backend.finishRender(T),s.renderId=o,this._currentRenderContext=a,this._currentRenderObjectFunction=c,i!==null&&(this.setRenderTarget(p,g,v),this._renderOutput(x)),f.onAfterRender(this,e,t,x),this.inspector.finishRender(this.backend.getTimestampUID(T)),T}_setXRLayerSize(e,t){this._canvasTarget._width=e,this._canvasTarget._height=t,this.setViewport(0,0,e,t)}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const r=this.autoClear,i=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=r,this.xr.enabled=i}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}getAnimationLoop(){return this._animation.getAnimationLoop()}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._canvasTarget.getPixelRatio()}getDrawingBufferSize(e){return this._canvasTarget.getDrawingBufferSize(e)}getSize(e){return this._canvasTarget.getSize(e)}setPixelRatio(e=1){this._canvasTarget.setPixelRatio(e)}setDrawingBufferSize(e,t,r){this.xr&&this.xr.isPresenting||this._canvasTarget.setDrawingBufferSize(e,t,r)}setSize(e,t,r=!0){this.xr&&this.xr.isPresenting||this._canvasTarget.setSize(e,t,r)}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){return this._canvasTarget.getScissor(e)}setScissor(e,t,r,i){this._canvasTarget.setScissor(e,t,r,i)}getScissorTest(){return this._canvasTarget.getScissorTest()}setScissorTest(e){this._canvasTarget.setScissorTest(e),this.backend.setScissorTest(e)}getViewport(e){return this._canvasTarget.getViewport(e)}setViewport(e,t,r,i,s=0,o=1){this._canvasTarget.setViewport(e,t,r,i,s,o)}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,r=!0){if(this._initialized===!1)throw new Error('Renderer: .clear() called before the backend is initialized. Use "await renderer.init();" before before using this method.');const i=this._renderTarget||this._getFrameBufferTarget();let s=null;if(i!==null){this._textures.updateRenderTarget(i);const o=this._textures.get(i);s=this._renderContexts.getForClear(i),s.textures=o.textures,s.depthTexture=o.depthTexture,s.width=o.width,s.height=o.height,s.renderTarget=i,s.depth=i.depthBuffer,s.stencil=i.stencilBuffer,s.clearColorValue=this.backend.getClearColor(),s.activeCubeFace=this.getActiveCubeFace(),s.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,r,s),i!==null&&this._renderTarget===null&&this._renderOutput(i)}clearColor(){this.clear(!0,!1,!1)}clearDepth(){this.clear(!1,!0,!1)}clearStencil(){this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,r=!0){fn('Renderer: "clearAsync()" has been deprecated. Use "clear()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.clear(e,t,r)}async clearColorAsync(){fn('Renderer: "clearColorAsync()" has been deprecated. Use "clearColor()" and "await renderer.init();" when creating the renderer.'),this.clear(!0,!1,!1)}async clearDepthAsync(){fn('Renderer: "clearDepthAsync()" has been deprecated. Use "clearDepth()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!0,!1)}async clearStencilAsync(){fn('Renderer: "clearStencilAsync()" has been deprecated. Use "clearStencil()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!1,!0)}get needsFrameBufferTarget(){const e=this.currentToneMapping!==Ba,t=this.currentColorSpace!==Sn.workingColorSpace;return e||t}get samples(){return this._samples}get currentSamples(){let e=this._samples;return this._renderTarget!==null?e=this._renderTarget.samples:this.needsFrameBufferTarget&&(e=0),e}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:Ba}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:Sn.workingColorSpace}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||this._renderTarget===null}dispose(){this._initialized===!0&&(this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._geometries.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this._frameBufferTarget!==null&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{e!==null&&e.dispose()})),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,r=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=r}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}setCanvasTarget(e){this._canvasTarget.removeEventListener("resize",this._onCanvasTargetResize),this._canvasTarget=e,this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize)}getCanvasTarget(){return this._canvasTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e,t=null){if(this._isDeviceLost===!0)return;if(this._initialized===!1)return De("Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e,t);const r=this._nodes.nodeFrame,i=r.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,r.renderId=this.info.calls,this.backend.updateTimeStampUID(e),this.inspector.beginCompute(this.backend.getTimestampUID(e),e);const s=this.backend,o=this._pipelines,a=this._bindings,c=this._nodes,f=Array.isArray(e)?e:[e];if(f[0]===void 0||f[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");s.beginCompute(e);for(const p of f){if(o.has(p)===!1){const x=()=>{p.removeEventListener("dispose",x),o.delete(p),a.deleteForCompute(p),c.delete(p)};p.addEventListener("dispose",x);const T=p.onInitFunction;T!==null&&T.call(p,{renderer:this})}c.updateForCompute(p),a.updateForCompute(p);const g=a.getForCompute(p),v=o.getForCompute(p,g);s.compute(e,p,g,v,t)}s.finishCompute(e),r.renderId=i,this.inspector.finishCompute(this.backend.getTimestampUID(e))}async computeAsync(e,t=null){this._initialized===!1&&await this.init(),this.compute(e,t)}async hasFeatureAsync(e){return fn('Renderer: "hasFeatureAsync()" has been deprecated. Use "hasFeature()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.hasFeature(e)}async resolveTimestampsAsync(e="render"){return this._initialized===!1&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){if(this._initialized===!1)throw new Error('Renderer: .hasFeature() called before the backend is initialized. Use "await renderer.init();" before before using this method.');return this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){fn('Renderer: "initTextureAsync()" has been deprecated. Use "initTexture()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.initTexture(e)}initTexture(e){if(this._initialized===!1)throw new Error('Renderer: .initTexture() called before the backend is initialized. Use "await renderer.init();" before before using this method.');this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(t!==null)if(t.isVector2)t=Vs.set(t.x,t.y,e.image.width,e.image.height).floor();else if(t.isVector4)t=Vs.copy(t).floor();else{Be("Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else t=Vs.set(0,0,e.image.width,e.image.height);let r=this._currentRenderContext,i;r!==null?i=r.renderTarget:(i=this._renderTarget||this._getFrameBufferTarget(),i!==null&&(this._textures.updateRenderTarget(i),r=this._textures.get(i))),this._textures.updateTexture(e,{renderTarget:i}),this.backend.copyFramebufferToTexture(e,r,t),this._inspector.copyFramebufferToTexture(e)}copyTextureToTexture(e,t,r=null,i=null,s=0,o=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,r,i,s,o),this._inspector.copyTextureToTexture(e,t)}async readRenderTargetPixelsAsync(e,t,r,i,s,o=0,a=0){return this.backend.copyTextureToBuffer(e.textures[o],t,r,i,s,a)}_projectObject(e,t,r,i,s){if(e.visible===!1)return;if(e.layers.test(t.layers)){if(e.isGroup)r=e.renderOrder,e.isClippingGroup&&e.enabled&&(s=s.getGroupContext(e));else if(e.isLOD)e.autoUpdate===!0&&e.update(t);else if(e.isLight)i.pushLight(e);else if(e.isSprite){const c=t.isArrayCamera?Tp:xp;if(!e.frustumCulled||c.intersectsSprite(e,t)){this.sortObjects===!0&&Vs.setFromMatrixPosition(e.matrixWorld).applyMatrix4(t0);const{geometry:f,material:p}=e;p.visible&&i.push(e,f,p,r,Vs.z,null,s)}}else if(e.isLineLoop)Be("Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if(e.isMesh||e.isLine||e.isPoints){const c=t.isArrayCamera?Tp:xp;if(!e.frustumCulled||c.intersectsObject(e,t)){const{geometry:f,material:p}=e;if(this.sortObjects===!0&&(f.boundingSphere===null&&f.computeBoundingSphere(),Vs.copy(f.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(t0)),Array.isArray(p)){const g=f.groups;for(let v=0,x=g.length;v<x;v++){const T=g[v],S=p[T.materialIndex];S&&S.visible&&i.push(e,f,S,r,Vs.z,T,s)}}else p.visible&&i.push(e,f,p,r,Vs.z,null,s)}}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const c=i;i=this._renderLists.get(e,t),i.begin(),c.pushBundle({bundleGroup:e,camera:t,renderList:i}),i.finish()}const a=e.children;for(let c=0,f=a.length;c<f;c++)this._projectObject(a[c],t,r,i,s)}_renderBundles(e,t,r){for(const i of e)this._renderBundle(i,t,r)}_renderTransparents(e,t,r,i,s){if(t.length>0){for(const{material:o}of t)o.side=yr;this._renderObjects(t,r,i,s,"backSide");for(const{material:o}of t)o.side=uA;this._renderObjects(e,r,i,s);for(const{material:o}of t)o.side=xi}else this._renderObjects(e,r,i,s)}_renderObjects(e,t,r,i,s=null){for(let o=0,a=e.length;o<a;o++){const{object:c,geometry:f,material:p,group:g,clippingContext:v}=e[o];this._currentRenderObjectFunction(c,r,t,f,p,g,i,v,s)}}_getShadowNodes(e){const t=e.version;let r=this._cacheShadowNodes.get(e);if(r===void 0||r.version!==t){const i=e.map!==null,s=e.colorNode&&e.colorNode.isNode,o=e.castShadowNode&&e.castShadowNode.isNode;let a=null,c=null,f=null;if(i||s||o){let p,g;o?(p=e.castShadowNode.rgb,g=e.castShadowNode.a):(p=Z(0),g=z(1)),i&&(g=g.mul(zt("map","texture",e).a)),s&&(g=g.mul(e.colorNode.a)),c=je(p,g)}e.depthNode&&e.depthNode.isNode&&(f=e.depthNode),e.castShadowPositionNode&&e.castShadowPositionNode.isNode?a=e.castShadowPositionNode:e.positionNode&&e.positionNode.isNode&&(a=e.positionNode),r={version:t,colorNode:c,depthNode:f,positionNode:a},this._cacheShadowNodes.set(e,r)}return r}renderObject(e,t,r,i,s,o,a,c=null,f=null){let p=!1,g,v,x,T;if(e.onBeforeRender(this,t,r,i,s,o),s.allowOverride===!0&&t.overrideMaterial!==null){const S=t.overrideMaterial;if(p=!0,g=t.overrideMaterial.colorNode,v=t.overrideMaterial.depthNode,x=t.overrideMaterial.positionNode,T=t.overrideMaterial.side,s.positionNode&&s.positionNode.isNode&&(S.positionNode=s.positionNode),S.alphaTest=s.alphaTest,S.alphaMap=s.alphaMap,S.transparent=s.transparent||s.transmission>0||s.transmissionNode&&s.transmissionNode.isNode||s.backdropNode&&s.backdropNode.isNode,S.isShadowPassMaterial){const{colorNode:E,depthNode:N,positionNode:P}=this._getShadowNodes(s);S.side=s.shadowSide===null?s.side:s.shadowSide,E!==null&&(S.colorNode=E),N!==null&&(S.depthNode=N),P!==null&&(S.positionNode=P)}s=S}s.transparent===!0&&s.side===xi&&s.forceSinglePass===!1?(s.side=yr,this._handleObjectFunction(e,s,t,r,a,o,c,"backSide"),s.side=uA,this._handleObjectFunction(e,s,t,r,a,o,c,f),s.side=xi):this._handleObjectFunction(e,s,t,r,a,o,c,f),p&&(t.overrideMaterial.colorNode=g,t.overrideMaterial.depthNode=v,t.overrideMaterial.positionNode=x,t.overrideMaterial.side=T),e.onAfterRender(this,t,r,i,s,o)}_renderObjectDirect(e,t,r,i,s,o,a,c){const f=this._objects.get(e,t,r,i,s,this._currentRenderContext,a,c);f.drawRange=e.geometry.drawRange,f.group=o;const p=this._nodes.needsRefresh(f);p&&(this._nodes.updateBefore(f),this._geometries.updateForRender(f),this._nodes.updateForRender(f),this._bindings.updateForRender(f)),this._pipelines.updateForRender(f),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(f),f.bundle=this._currentRenderBundle.bundleGroup),this.backend.draw(f,this.info),p&&this._nodes.updateAfter(f)}_createObjectPipeline(e,t,r,i,s,o,a,c){const f=this._objects.get(e,t,r,i,s,this._currentRenderContext,a,c);f.drawRange=e.geometry.drawRange,f.group=o,this._nodes.updateBefore(f),this._geometries.updateForRender(f),this._nodes.updateForRender(f),this._bindings.updateForRender(f),this._pipelines.getForRender(f,this._compilationPromises),this._nodes.updateAfter(f)}_onCanvasTargetResize(){this._initialized&&this.backend.updateSize()}get compile(){return this.compileAsync}}class eS{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}getVisibility(){return this.visibility}clone(){return Object.assign(new this.constructor,this)}}function uH(n){return n+(Uo-n%Uo)%Uo}class tS extends eS{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t,this._updateRanges=[]}get updateRanges(){return this._updateRanges}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}get byteLength(){return uH(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class nS extends tS{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let AH=0;class rS extends nS{constructor(e,t){super("UniformBuffer_"+AH++,e?e.value:null),this.nodeUniform=e,this.groupNode=t,this.isNodeUniformBuffer=!0}set updateRanges(e){this.nodeUniform.updateRanges=e}get updateRanges(){return this.nodeUniform.updateRanges}addUpdateRange(e,t){this.nodeUniform.addUpdateRange(e,t)}clearUpdateRanges(){this.nodeUniform.clearUpdateRanges()}get buffer(){return this.nodeUniform.value}}class cH extends nS{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){const e=this.bytesPerElement;let t=0;for(let r=0,i=this.uniforms.length;r<i;r++){const s=this.uniforms[r],o=s.boundary,a=s.itemSize*e,c=t%Uo,f=c%o,p=c+f;t+=f,p!==0&&Uo-p<a&&(t+=Uo-p),s.offset=t/e,t+=a}return Math.ceil(t/Uo)*Uo}update(){let e=!1;for(const t of this.uniforms)this.updateByType(t)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);Be("WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset,o=e.getType();if(r[s]!==i){const a=this._getBufferForType(o);a[s]=r[s]=i,t=!0}return t}updateVector2(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset,o=e.getType();if(r[s+0]!==i.x||r[s+1]!==i.y){const a=this._getBufferForType(o);a[s+0]=r[s+0]=i.x,a[s+1]=r[s+1]=i.y,t=!0}return t}updateVector3(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset,o=e.getType();if(r[s+0]!==i.x||r[s+1]!==i.y||r[s+2]!==i.z){const a=this._getBufferForType(o);a[s+0]=r[s+0]=i.x,a[s+1]=r[s+1]=i.y,a[s+2]=r[s+2]=i.z,t=!0}return t}updateVector4(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset,o=e.getType();if(r[s+0]!==i.x||r[s+1]!==i.y||r[s+2]!==i.z||r[s+4]!==i.w){const a=this._getBufferForType(o);a[s+0]=r[s+0]=i.x,a[s+1]=r[s+1]=i.y,a[s+2]=r[s+2]=i.z,a[s+3]=r[s+3]=i.w,t=!0}return t}updateColor(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset;if(r[s+0]!==i.r||r[s+1]!==i.g||r[s+2]!==i.b){const o=this.buffer;o[s+0]=r[s+0]=i.r,o[s+1]=r[s+1]=i.g,o[s+2]=r[s+2]=i.b,t=!0}return t}updateMatrix3(e){let t=!1;const r=this.values,i=e.getValue().elements,s=e.offset;if(r[s+0]!==i[0]||r[s+1]!==i[1]||r[s+2]!==i[2]||r[s+4]!==i[3]||r[s+5]!==i[4]||r[s+6]!==i[5]||r[s+8]!==i[6]||r[s+9]!==i[7]||r[s+10]!==i[8]){const o=this.buffer;o[s+0]=r[s+0]=i[0],o[s+1]=r[s+1]=i[1],o[s+2]=r[s+2]=i[2],o[s+4]=r[s+4]=i[3],o[s+5]=r[s+5]=i[4],o[s+6]=r[s+6]=i[5],o[s+8]=r[s+8]=i[6],o[s+9]=r[s+9]=i[7],o[s+10]=r[s+10]=i[8],t=!0}return t}updateMatrix4(e){let t=!1;const r=this.values,i=e.getValue().elements,s=e.offset;return fH(r,i,s)===!1&&(this.buffer.set(i,s),hH(r,i,s),t=!0),t}_getBufferForType(e){return e==="int"||e==="ivec2"||e==="ivec3"||e==="ivec4"?new Int32Array(this.buffer.buffer):e==="uint"||e==="uvec2"||e==="uvec3"||e==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function hH(n,e,t){for(let r=0,i=e.length;r<i;r++)n[t+r]=e[r]}function fH(n,e,t){for(let r=0,i=e.length;r<i;r++)if(n[t+r]!==e[r])return!1;return!0}let dH=0;class iS extends cH{constructor(e,t){super(e),this.id=dH++,this.groupNode=t,this.isNodeUniformsGroup=!0}}class sS extends eS{constructor(e,t){super(e),this._texture=null,this._onTextureDispose=()=>{this.generation=null,this.version=0},this.texture=t,this.version=t?t.version:0,this.generation=null,this.samplerKey="",this.isSampler=!0}set texture(e){this._texture!==e&&(this._texture&&this._texture.removeEventListener("dispose",this._onTextureDispose),this._texture=e,this.generation=null,this.version=0,this._texture&&this._texture.addEventListener("dispose",this._onTextureDispose))}get texture(){return this._texture}update(){const{texture:e,version:t}=this;return t!==e.version?(this.version=e.version,!0):!1}clone(){const e=super.clone();return e._texture=null,e._onTextureDispose=()=>{e.generation=null,e.version=0},e.texture=this.texture,e}}let pH=0;class mH extends sS{constructor(e,t){super(e,t),this.id=pH++,this.store=!1,this.mipLevel=0,this.isSampledTexture=!0}}class Wf extends mH{constructor(e,t,r,i=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=r,this.access=i}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class oS extends Wf{constructor(e,t,r,i=null){super(e,t,r,i),this.isSampledCubeTexture=!0}}class Rg extends Wf{constructor(e,t,r,i=null){super(e,t,r,i),this.isSampledTexture3D=!0}}const ub={bitcast_int_uint:new Zn("uint tsl_bitcast_int_to_uint ( int x ) { return floatBitsToUint( intBitsToFloat ( x ) ); }"),bitcast_uint_int:new Zn("uint tsl_bitcast_uint_to_int ( uint x ) { return floatBitsToInt( uintBitsToFloat ( x ) ); }")},gH={textureDimensions:"textureSize",equals:"equal",bitcast_float_int:"floatBitsToInt",bitcast_int_float:"intBitsToFloat",bitcast_uint_float:"uintBitsToFloat",bitcast_float_uint:"floatBitsToUint",bitcast_uint_int:"tsl_bitcast_uint_to_int",bitcast_int_uint:"tsl_bitcast_int_to_uint",floatpack_snorm_2x16:"packSnorm2x16",floatpack_unorm_2x16:"packUnorm2x16",floatpack_float16_2x16:"packHalf2x16",floatunpack_snorm_2x16:"unpackSnorm2x16",floatunpack_unorm_2x16:"unpackUnorm2x16",floatunpack_float16_2x16:"unpackHalf2x16"},yH={low:"lowp",medium:"mediump",high:"highp"},Ab={swizzleAssign:!0,storageBuffer:!1},cb={perspective:"smooth",linear:"noperspective"},hb={centroid:"centroid"},fb=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
precision lowp sampler2DArrayShadow;
precision lowp samplerCubeShadow;
`;class _H extends K5{constructor(e,t){super(e,t,new W$),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==Kl}_include(e){const t=ub[e];return t.build(this),this.addInclude(t),t}getMethod(e){return ub[e]!==void 0&&this._include(e),gH[e]||e}getBitcastMethod(e,t){return this.getMethod(`bitcast_${t}_${e}`)}getFloatPackingMethod(e){return this.getMethod(`floatpack_${e}_2x16`)}getFloatUnpackingMethod(e){return this.getMethod(`floatunpack_${e}_2x16`)}getTernary(e,t,r){return`${e} ? ${t} : ${r}`}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,r=this.flowShaderNode(e),i=[];for(const o of t.inputs)i.push(this.getType(o.type)+" "+o.name);return`${this.getType(t.type)} ${t.name}( ${i.join(", ")} ) {

	${r.vars}

${r.code}
	return ${r.result};

}`}setupPBO(e){const t=e.value;if(t.pbo===void 0){const r=t.array,i=t.count*t.itemSize,{itemSize:s}=t,o=t.array.constructor.name.toLowerCase().includes("int");let a=o?i1:r1;s===2?a=o?s1:Qs:s===3?a=o?IC:n1:s===4&&(a=o?o1:zi);const c={Float32Array:yi,Uint8Array:ii,Uint16Array:Ll,Uint32Array:Un,Int8Array:cA,Int16Array:hA,Int32Array:wr,Uint8ClampedArray:ii},f=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(i/s))));let p=Math.ceil(i/s/f);f*p*s<i&&p++;const g=f*p*s,v=new r.constructor(g);v.set(r,0),t.array=v;const x=new Wx(t.array,f,p,a,c[t.array.constructor.name]||yi);x.needsUpdate=!0,x.isPBOTexture=!0;const T=new Ms(x,null,null);T.setPrecision("high"),t.pboNode=T,t.pbo=T.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.nodeName)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:r}=e,i=t.value;if(this.renderer.backend.has(i)){const p=this.renderer.backend.get(i);p.pbo=i.pbo}const s=this.getUniformFromNode(i.pboNode,"texture",this.shaderStage,this.context.nodeName),o=this.getPropertyName(s);this.increaseUsage(r);const a=r.build(this,"uint"),c=this.getDataFromNode(e);let f=c.propertyName;if(f===void 0){const p=this.getVarFromNode(e);f=this.getPropertyName(p);const g=this.getDataFromNode(t);let v=g.propertySizeName;v===void 0&&(v=f+"Size",this.getVarFromNode(t,v,"uint"),this.addLineFlowCode(`${v} = uint( textureSize( ${o}, 0 ).x )`,e),g.propertySizeName=v);const{itemSize:x}=i,T="."+Ya.join("").slice(0,x),S=`ivec2(${a} % ${v}, ${a} / ${v})`,E=this.generateTextureLoad(null,o,S,"0",null,null);let N="vec4";i.pbo.type===Un?N="uvec4":i.pbo.type===wr&&(N="ivec4"),this.addLineFlowCode(`${f} = ${N}(${E})${T}`,e),c.propertyName=f}return f}generateTextureLoad(e,t,r,i,s,o){i===null&&(i="0");let a;return s?o?a=`texelFetchOffset( ${t}, ivec3( ${r}, ${s} ), ${i}, ${o} )`:a=`texelFetch( ${t}, ivec3( ${r}, ${s} ), ${i} )`:o?a=`texelFetchOffset( ${t}, ${r}, ${i}, ${o} )`:a=`texelFetch( ${t}, ${r}, ${i} )`,e!==null&&e.isDepthTexture&&(a+=".x"),a}generateTexture(e,t,r,i,s){return i&&(r=`vec3( ${r}, ${i} )`),e.isDepthTexture?s?`textureOffset( ${t}, ${r}, ${s} ).x`:`texture( ${t}, ${r} ).x`:s?`textureOffset( ${t}, ${r}, ${s} )`:`texture( ${t}, ${r} )`}generateTextureLevel(e,t,r,i,s){return s?`textureLodOffset( ${t}, ${r}, ${i}, ${s} )`:`textureLod( ${t}, ${r}, ${i} )`}generateTextureBias(e,t,r,i,s){return s?`textureOffset( ${t}, ${r}, ${s}, ${i} )`:`texture( ${t}, ${r}, ${i} )`}generateTextureGrad(e,t,r,i,s){return s?`textureGradOffset( ${t}, ${r}, ${i[0]}, ${i[1]}, ${s} )`:`textureGrad( ${t}, ${r}, ${i[0]}, ${i[1]} )`}generateTextureCompare(e,t,r,i,s,o,a=this.shaderStage){if(a==="fragment")return e.isCubeTexture?`texture( ${t}, vec4( ${r}, ${i} ) )`:s?o?`textureOffset( ${t}, vec4( ${r}, ${s}, ${i} ), ${o} )`:`texture( ${t}, vec4( ${r}, ${s}, ${i} ) )`:o?`textureOffset( ${t}, vec3( ${r}, ${i} ), ${o} )`:`texture( ${t}, vec3( ${r}, ${i} ) )`;Be(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${a} shader.`)}getVars(e){const t=[],r=this.vars[e];if(r!==void 0)for(const i of r)t.push(`${this.getVar(i.type,i.name,i.count)};`);return t.join(`
	`)}getUniforms(e){const t=this.uniforms[e],r=[],i={};for(const o of t){let a=null,c=!1;if(o.type==="texture"||o.type==="texture3D"){const p=o.node.value;let g="";(p.isDataTexture===!0||p.isData3DTexture===!0)&&(p.type===Un?g="u":p.type===wr&&(g="i")),o.type==="texture3D"&&p.isArrayTexture===!1?a=`${g}sampler3D ${o.name};`:p.compareFunction?p.isArrayTexture===!0?a=`sampler2DArrayShadow ${o.name};`:a=`sampler2DShadow ${o.name};`:p.isArrayTexture===!0||p.isDataArrayTexture===!0||p.isCompressedArrayTexture===!0?a=`${g}sampler2DArray ${o.name};`:a=`${g}sampler2D ${o.name};`}else if(o.type==="cubeTexture")a=`samplerCube ${o.name};`;else if(o.type==="cubeDepthTexture")a=`samplerCubeShadow ${o.name};`;else if(o.type==="buffer"){const p=o.node,g=this.getType(p.bufferType),v=p.bufferCount,x=v>0?v:"";a=`${p.name} {
	${g} ${o.name}[${x}];
};
`}else a=`${this.getVectorType(o.type)} ${this.getPropertyName(o,e)};`,c=!0;const f=o.node.precision;if(f!==null&&(a=yH[f]+" "+a),c){a="	"+a;const p=o.groupNode.name;(i[p]||(i[p]=[])).push(a)}else a="uniform "+a,r.push(a)}let s="";for(const o in i){const a=i[o];s+=this._getGLSLUniformStruct(e+"_"+o,a.join(`
`))+`
`}return s+=r.join(`
`),s}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==wr){let r=e;e.isInterleavedBufferAttribute&&(r=e.data);const i=r.array;i instanceof Uint32Array||i instanceof Int32Array||(t=t.slice(1))}return t}getAttributes(e){let t="";if(e==="vertex"||e==="compute"){const r=this.getAttributesArray();let i=0;for(const s of r)t+=`layout( location = ${i++} ) in ${s.type} ${s.name};
`}return t}getStructMembers(e){const t=[];for(const r of e.members)t.push(`	${r.type} ${r.name};`);return t.join(`
`)}getStructs(e){const t=[],r=this.structs[e],i=[];for(const s of r)if(s.output)for(const o of s.members)i.push(`layout( location = ${o.index} ) out ${o.type} ${o.name};`);else{let o="struct "+s.name+` {
`;o+=this.getStructMembers(s),o+=`
};
`,t.push(o)}return i.length===0&&i.push("layout( location = 0 ) out vec4 fragColor;"),`
`+i.join(`
`)+`

`+t.join(`
`)}getVaryings(e){let t="";const r=this.varyings;if(e==="vertex"||e==="compute")for(const i of r){e==="compute"&&(i.needsInterpolation=!0);const s=this.getType(i.type);if(i.needsInterpolation)if(i.interpolationType){const o=cb[i.interpolationType]||i.interpolationType,a=hb[i.interpolationSampling]||"";t+=`${o} ${a} out ${s} ${i.name};
`}else{const o=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${o}out ${s} ${i.name};
`}else t+=`${s} ${i.name};
`}else if(e==="fragment"){for(const i of r)if(i.needsInterpolation){const s=this.getType(i.type);if(i.interpolationType){const o=cb[i.interpolationType]||i.interpolationType,a=hb[i.interpolationSampling]||"";t+=`${o} ${a} in ${s} ${i.name};
`}else{const o=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${o}in ${s} ${i.name};
`}}}for(const i of this.builtins[e])t+=`${i};
`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((r,i)=>r*i,1)}u`}getSubgroupSize(){Be("GLSLNodeBuilder: WebGLBackend does not support the subgroupSize node")}getInvocationSubgroupIndex(){Be("GLSLNodeBuilder: WebGLBackend does not support the invocationSubgroupIndex node")}getSubgroupIndex(){Be("GLSLNodeBuilder: WebGLBackend does not support the subgroupIndex node")}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,r=this.shaderStage){const i=this.extensions[r]||(this.extensions[r]=new Map);i.has(e)===!1&&i.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if(e==="vertex"){const i=this.renderer.backend.extensions;this.object.isBatchedMesh&&i.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const r=this.extensions[e];if(r!==void 0)for(const{name:i,behavior:s}of r.values())t.push(`#extension ${i} : ${s}`);return t.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=Ab[e];if(t===void 0){let r;switch(t=!1,e){case"float32Filterable":r="OES_texture_float_linear";break;case"clipDistance":r="WEBGL_clip_cull_distance";break}if(r!==void 0){const i=this.renderer.backend.extensions;i.has(r)&&(i.get(r),t=!0)}Ab[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}enableMultiview(){this.enableExtension("GL_OVR_multiview2","require","fragment"),this.enableExtension("GL_OVR_multiview2","require","vertex"),this.builtins.vertex.push("layout(num_views = 2) in")}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let r=0;r<e.length;r++){const i=e[r],s=this.getPropertyName(i.attributeNode);s&&(t+=`${i.varyingName} = ${s};
	`)}return t}_getGLSLUniformStruct(e,t){return`
layout( std140 ) uniform ${e} {
${t}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${fb}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${fb}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let r=`// code

`;r+=this.flowCode[t];const i=this.flowNodes[t],s=i[i.length-1];for(const a of i){const c=this.getFlowData(a),f=a.name;f&&(r.length>0&&(r+=`
`),r+=`	// flow -> ${f}
	`),r+=`${c.code}
	`,a===s&&t!=="compute"&&(r+=`// result
	`,t==="vertex"?(r+="gl_Position = ",r+=`${c.result};`):t==="fragment"&&(a.outputNode.isOutputStructNode||(r+="fragColor = ",r+=`${c.result};`)))}const o=e[t];o.extensions=this.getExtensions(t),o.uniforms=this.getUniforms(t),o.attributes=this.getAttributes(t),o.varyings=this.getVaryings(t),o.vars=this.getVars(t),o.structs=this.getStructs(t),o.codes=this.getCodes(t),o.transforms=this.getTransforms(t),o.flow=r}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,r,i=null){const s=super.getUniformFromNode(e,t,r,i),o=this.getDataFromNode(e,r,this.globalCache);let a=o.uniformGPU;if(a===void 0){const c=e.groupNode,f=c.name,p=this.getBindGroupArray(f,r);if(t==="texture")a=new Wf(s.name,s.node,c),p.push(a);else if(t==="cubeTexture"||t==="cubeDepthTexture")a=new oS(s.name,s.node,c),p.push(a);else if(t==="texture3D")a=new Rg(s.name,s.node,c),p.push(a);else if(t==="buffer"){s.name=`buffer${e.id}`;const g=this.getSharedDataFromNode(e);let v=g.buffer;v===void 0&&(e.name=`NodeBuffer_${e.id}`,v=new rS(e,c),v.name=e.name,g.buffer=v),p.push(v),a=v}else{const g=this.uniformGroups[r]||(this.uniformGroups[r]={});let v=g[f];v===void 0&&(v=new iS(r+"_"+f,c),g[f]=v,p.push(v)),a=this.getNodeUniform(s,t),v.addUniform(a)}o.uniformGPU=a}return s}}let wp=null,El=null;class aS{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={[gs.RENDER]:null,[gs.COMPUTE]:null},this.trackTimestamp=e.trackTimestamp===!0}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}updateSampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}updateTimeStampUID(e){const t=this.get(e),r=this.renderer.info.frame;let i;e.isComputeNode===!0?i="c:"+this.renderer.info.compute.frameCalls:i="r:"+this.renderer.info.render.frameCalls,t.timestampUID=i+":"+e.id+":f"+r}getTimestampUID(e){return this.get(e).timestampUID}getTimestampFrames(e){const t=this.timestampQueryPool[e];return t?t.getTimestampFrames():[]}_getQueryPool(e){const t=e.startsWith("c:")?gs.COMPUTE:gs.RENDER;return this.timestampQueryPool[t]}getTimestamp(e){return this._getQueryPool(e).getTimestamp(e)}hasTimestamp(e){return this._getQueryPool(e).hasTimestamp(e)}isOccluded(){}async resolveTimestampsAsync(e="render"){if(!this.trackTimestamp){fn("WebGPURenderer: Timestamp tracking is disabled.");return}const t=this.timestampQueryPool[e];if(!t)return;const r=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=r,r}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return wp=wp||new _t,this.renderer.getDrawingBufferSize(wp)}setScissorTest(){}getClearColor(){const e=this.renderer;return El=El||new z2,e.getClearColor(El),El.getRGB(El),El}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:JR(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${of} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}deleteBindGroupData(){}dispose(){}}let vH=0;class bH{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class xH{constructor(e){this.backend=e}createAttribute(e,t){const r=this.backend,{gl:i}=r,s=e.array,o=e.usage||i.STATIC_DRAW,a=e.isInterleavedBufferAttribute?e.data:e,c=r.get(a);let f=c.bufferGPU;f===void 0&&(f=this._createBuffer(i,t,s,o),c.bufferGPU=f,c.bufferType=t,c.version=a.version);let p;if(s instanceof Float32Array)p=i.FLOAT;else if(typeof Float16Array<"u"&&s instanceof Float16Array)p=i.HALF_FLOAT;else if(s instanceof Uint16Array)e.isFloat16BufferAttribute?p=i.HALF_FLOAT:p=i.UNSIGNED_SHORT;else if(s instanceof Int16Array)p=i.SHORT;else if(s instanceof Uint32Array)p=i.UNSIGNED_INT;else if(s instanceof Int32Array)p=i.INT;else if(s instanceof Int8Array)p=i.BYTE;else if(s instanceof Uint8Array)p=i.UNSIGNED_BYTE;else if(s instanceof Uint8ClampedArray)p=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+s);let g={bufferGPU:f,bufferType:t,type:p,byteLength:s.byteLength,bytesPerElement:s.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:p===i.INT||p===i.UNSIGNED_INT||e.gpuType===wr,id:vH++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const v=this._createBuffer(i,t,s,o);g=new bH(g,v)}r.set(e,g)}updateAttribute(e){const t=this.backend,{gl:r}=t,i=e.array,s=e.isInterleavedBufferAttribute?e.data:e,o=t.get(s),a=o.bufferType,c=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(r.bindBuffer(a,o.bufferGPU),c.length===0)r.bufferSubData(a,0,i);else{for(let f=0,p=c.length;f<p;f++){const g=c[f];r.bufferSubData(a,g.start*i.BYTES_PER_ELEMENT,i,g.start,g.count)}s.clearUpdateRanges()}r.bindBuffer(a,null),o.version=s.version}destroyAttribute(e){const t=this.backend,{gl:r}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const i=t.get(e);r.deleteBuffer(i.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:r}=t,i=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:s}=t.get(i),o=e.array,a=o.byteLength;r.bindBuffer(r.COPY_READ_BUFFER,s);const c=r.createBuffer();r.bindBuffer(r.COPY_WRITE_BUFFER,c),r.bufferData(r.COPY_WRITE_BUFFER,a,r.STREAM_READ),r.copyBufferSubData(r.COPY_READ_BUFFER,r.COPY_WRITE_BUFFER,0,0,a),await t.utils._clientWaitAsync();const f=new e.array.constructor(o.length);return r.bindBuffer(r.COPY_WRITE_BUFFER,c),r.getBufferSubData(r.COPY_WRITE_BUFFER,0,f),r.deleteBuffer(c),r.bindBuffer(r.COPY_READ_BUFFER,null),r.bindBuffer(r.COPY_WRITE_BUFFER,null),f.buffer}_createBuffer(e,t,r,i){const s=e.createBuffer();return e.bindBuffer(t,s),e.bufferData(t,r,i),e.bindBuffer(t,null),s}}let Sp,Qu;class TH{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;Sp={[$s]:e.FUNC_ADD,[Ex]:e.FUNC_SUBTRACT,[Sx]:e.FUNC_REVERSE_SUBTRACT},Qu={[Bo]:e.ZERO,[Fx]:e.ONE,[Ox]:e.SRC_COLOR,[Lx]:e.SRC_ALPHA,[Dx]:e.SRC_ALPHA_SATURATE,[Bx]:e.DST_COLOR,[Px]:e.DST_ALPHA,[Mx]:e.ONE_MINUS_SRC_COLOR,[Nx]:e.ONE_MINUS_SRC_ALPHA,[Cx]:e.ONE_MINUS_DST_COLOR,[Rx]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),r=e.getParameter(e.VIEWPORT);this.currentScissor=new $t().fromArray(t),this.currentViewport=new $t().fromArray(r),this._tempVec4=new $t}enable(e){const{enabled:t}=this;t[e]!==!0&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;t[e]!==!1&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==tC?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===nC?t.cullFace(t.BACK):e===rC?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:r}=this;e!==t&&(r.lineWidth(e),this.currentLineWidth=e)}setMRTBlending(e){const t=this.gl,r=this.backend.drawBuffersIndexedExt;if(r)for(let i=1;i<e.length;i++)r.blendFuncSeparateiOES(i,t.ONE,t.ZERO,t.ONE,t.ZERO)}setBlending(e,t,r,i,s,o,a,c){const{gl:f}=this;if(e===Zl){this.currentBlendingEnabled===!0&&(this.disable(f.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(f.BLEND),this.currentBlendingEnabled=!0),e!==AA){if(e!==this.currentBlending||c!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==$s||this.currentBlendEquationAlpha!==$s)&&(f.blendEquation(f.FUNC_ADD),this.currentBlendEquation=$s,this.currentBlendEquationAlpha=$s),c)switch(e){case Ys:f.blendFuncSeparate(f.ONE,f.ONE_MINUS_SRC_ALPHA,f.ONE,f.ONE_MINUS_SRC_ALPHA);break;case X0:f.blendFunc(f.ONE,f.ONE);break;case Q0:f.blendFuncSeparate(f.ZERO,f.ONE_MINUS_SRC_COLOR,f.ZERO,f.ONE);break;case W0:f.blendFuncSeparate(f.DST_COLOR,f.ONE_MINUS_SRC_ALPHA,f.ZERO,f.ONE);break;default:Be("WebGLState: Invalid blending: ",e);break}else switch(e){case Ys:f.blendFuncSeparate(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA,f.ONE,f.ONE_MINUS_SRC_ALPHA);break;case X0:f.blendFuncSeparate(f.SRC_ALPHA,f.ONE,f.ONE,f.ONE);break;case Q0:Be("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case W0:Be("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:Be("WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=c}return}s=s||t,o=o||r,a=a||i,(t!==this.currentBlendEquation||s!==this.currentBlendEquationAlpha)&&(f.blendEquationSeparate(Sp[t],Sp[s]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=s),(r!==this.currentBlendSrc||i!==this.currentBlendDst||o!==this.currentBlendSrcAlpha||a!==this.currentBlendDstAlpha)&&(f.blendFuncSeparate(Qu[r],Qu[i],Qu[o],Qu[a]),this.currentBlendSrc=r,this.currentBlendDst=i,this.currentBlendSrcAlpha=o,this.currentBlendDstAlpha=a),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case jx:t.depthFunc(t.NEVER);break;case zx:t.depthFunc(t.ALWAYS);break;case Vx:t.depthFunc(t.LESS);break;case Gx:t.depthFunc(t.LEQUAL);break;case qx:t.depthFunc(t.EQUAL);break;case Ux:t.depthFunc(t.GEQUAL);break;case kx:t.depthFunc(t.GREATER);break;case Ix:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}scissor(e,t,r,i){const s=this._tempVec4.set(e,t,r,i);if(this.currentScissor.equals(s)===!1){const{gl:o}=this;o.scissor(s.x,s.y,s.z,s.w),this.currentScissor.copy(s)}}viewport(e,t,r,i){const s=this._tempVec4.set(e,t,r,i);if(this.currentViewport.equals(s)===!1){const{gl:o}=this;o.viewport(s.x,s.y,s.z,s.w),this.currentViewport.copy(s)}}setScissorTest(e){const t=this.gl;e?this.enable(t.SCISSOR_TEST):this.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,r){(this.currentStencilFunc!==e||this.currentStencilRef!==t||this.currentStencilFuncMask!==r)&&(this.gl.stencilFunc(e,t,r),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=r)}setStencilOp(e,t,r){(this.currentStencilFail!==e||this.currentStencilZFail!==t||this.currentStencilZPass!==r)&&(this.gl.stencilOp(e,t,r),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=r)}setMaterial(e,t,r){const{gl:i}=this;e.side===xi?this.disable(i.CULL_FACE):this.enable(i.CULL_FACE);let s=e.side===yr;t&&(s=!s),this.setFlipSided(s),e.blending===Ys&&e.transparent===!1?this.setBlending(Zl):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const o=e.stencilWrite;if(this.setStencilTest(o),o&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.currentSamples>0?this.enable(i.SAMPLE_ALPHA_TO_COVERAGE):this.disable(i.SAMPLE_ALPHA_TO_COVERAGE),r>0&&this.currentClippingPlanes!==r)for(let c=0;c<8;c++)c<r?this.enable(12288+c):this.disable(12288+c)}setPolygonOffset(e,t,r){const{gl:i}=this;e?(this.enable(i.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==t||this.currentPolygonOffsetUnits!==r)&&(i.polygonOffset(t,r),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=r)):this.disable(i.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}setVertexState(e,t=null){const r=this.gl;return this.currentVAO!==e||this.currentIndex!==t?(r.bindVertexArray(e),t!==null&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0):!1}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:r,currentBoundFramebuffers:i}=this;return i[e]!==t?(r.bindFramebuffer(e,t),i[e]=t,e===r.DRAW_FRAMEBUFFER&&(i[r.FRAMEBUFFER]=t),e===r.FRAMEBUFFER&&(i[r.DRAW_FRAMEBUFFER]=t),!0):!1}drawBuffers(e,t){const{gl:r}=this;let i=[],s=!1;if(e.textures!==null){i=this.currentDrawbuffers.get(t),i===void 0&&(i=[],this.currentDrawbuffers.set(t,i));const o=e.textures;if(i.length!==o.length||i[0]!==r.COLOR_ATTACHMENT0){for(let a=0,c=o.length;a<c;a++)i[a]=r.COLOR_ATTACHMENT0+a;i.length=o.length,s=!0}}else i[0]!==r.BACK&&(i[0]=r.BACK,s=!0);s&&r.drawBuffers(i)}activeTexture(e){const{gl:t,currentTextureSlot:r,maxTextures:i}=this;e===void 0&&(e=t.TEXTURE0+i-1),r!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,r){const{gl:i,currentTextureSlot:s,currentBoundTextures:o,maxTextures:a}=this;r===void 0&&(s===null?r=i.TEXTURE0+a-1:r=s);let c=o[r];c===void 0&&(c={type:void 0,texture:void 0},o[r]=c),(c.type!==e||c.texture!==t)&&(s!==r&&(i.activeTexture(r),this.currentTextureSlot=r),i.bindTexture(e,t),c.type=e,c.texture=t)}bindBufferBase(e,t,r){const{gl:i}=this,s=`${e}-${t}`;return this.currentBoundBufferBases[s]!==r?(i.bindBufferBase(e,t,r),this.currentBoundBufferBases[s]=r,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:r}=this,i=r[t];i!==void 0&&i.type!==void 0&&(e.bindTexture(i.type,null),i.type=void 0,i.texture=void 0)}}class wH{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=Kl){const{gl:r,extensions:i}=this;let s;const o=Sn.getTransfer(t);if(e===ii)return r.UNSIGNED_BYTE;if(e===iC)return r.UNSIGNED_SHORT_4_4_4_4;if(e===sC)return r.UNSIGNED_SHORT_5_5_5_1;if(e===$x)return r.UNSIGNED_INT_5_9_9_9_REV;if(e===Hx)return r.UNSIGNED_INT_10F_11F_11F_REV;if(e===cA)return r.BYTE;if(e===hA)return r.SHORT;if(e===Ll)return r.UNSIGNED_SHORT;if(e===wr)return r.INT;if(e===Un)return r.UNSIGNED_INT;if(e===yi)return r.FLOAT;if(e===or)return r.HALF_FLOAT;if(e===oC)return r.ALPHA;if(e===n1)return r.RGB;if(e===zi)return r.RGBA;if(e===Ho)return r.DEPTH_COMPONENT;if(e===$o)return r.DEPTH_STENCIL;if(e===r1)return r.RED;if(e===i1)return r.RED_INTEGER;if(e===Qs)return r.RG;if(e===s1)return r.RG_INTEGER;if(e===o1)return r.RGBA_INTEGER;if(e===b0||e===x0||e===T0||e===w0)if(o===ft)if(s=i.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(e===b0)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===x0)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===T0)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===w0)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=i.get("WEBGL_compressed_texture_s3tc"),s!==null){if(e===b0)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===x0)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===T0)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===w0)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===S_||e===E_||e===R_||e===C_)if(s=i.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(e===S_)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===E_)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===R_)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===C_)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===Xp||e===Yp||e===Kp||e===Zp||e===Jp||e===Y0||e===em)if(s=i.get("WEBGL_compressed_texture_etc"),s!==null){if(e===Xp||e===Yp)return o===ft?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(e===Kp)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC;if(e===Zp)return s.COMPRESSED_R11_EAC;if(e===Jp)return s.COMPRESSED_SIGNED_R11_EAC;if(e===Y0)return s.COMPRESSED_RG11_EAC;if(e===em)return s.COMPRESSED_SIGNED_RG11_EAC}else return null;if(e===tm||e===nm||e===rm||e===im||e===sm||e===om||e===am||e===lm||e===um||e===Am||e===cm||e===hm||e===fm||e===dm)if(s=i.get("WEBGL_compressed_texture_astc"),s!==null){if(e===tm)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===nm)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===rm)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===im)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===sm)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===om)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===am)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===lm)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===um)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===Am)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===cm)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===hm)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===fm)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===dm)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===pm)if(s=i.get("EXT_texture_compression_bptc"),s!==null){if(e===pm)return o===ft?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===mm||e===gm||e===K0||e===ym)if(s=i.get("EXT_texture_compression_rgtc"),s!==null){if(e===mm)return s.COMPRESSED_RED_RGTC1_EXT;if(e===gm)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===K0)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===ym)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===jo?r.UNSIGNED_INT_24_8:r[e]!==void 0?r[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((r,i)=>{function s(){const o=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(o===e.WAIT_FAILED){e.deleteSync(t),i();return}if(o===e.TIMEOUT_EXPIRED){requestAnimationFrame(s);return}e.deleteSync(t),r()}s()})}}let db=!1,n0,Ep,pb;class SH{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},this._srcFramebuffer=null,this._dstFramebuffer=null,db===!1&&(this._init(),db=!0)}_init(){const e=this.gl;n0={[lf]:e.REPEAT,[SA]:e.CLAMP_TO_EDGE,[af]:e.MIRRORED_REPEAT},Ep={[qi]:e.NEAREST,[gx]:e.NEAREST_MIPMAP_NEAREST,[EA]:e.NEAREST_MIPMAP_LINEAR,[Xi]:e.LINEAR,[Qp]:e.LINEAR_MIPMAP_NEAREST,[qa]:e.LINEAR_MIPMAP_LINEAR},pb={[wx]:e.NEVER,[Tx]:e.ALWAYS,[uf]:e.LESS,[xx]:e.LEQUAL,[bx]:e.EQUAL,[vx]:e.GEQUAL,[_x]:e.GREATER,[yx]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let r;return e.isCubeTexture===!0?r=t.TEXTURE_CUBE_MAP:e.isArrayTexture===!0||e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?r=t.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?r=t.TEXTURE_3D:r=t.TEXTURE_2D,r}getInternalFormat(e,t,r,i,s=!1){const{gl:o,extensions:a}=this;if(e!==null){if(o[e]!==void 0)return o[e];De("WebGLBackend: Attempt to use non-existing WebGL internal format '"+e+"'")}let c=t;if(t===o.RED&&(r===o.FLOAT&&(c=o.R32F),r===o.HALF_FLOAT&&(c=o.R16F),r===o.UNSIGNED_BYTE&&(c=o.R8),r===o.UNSIGNED_SHORT&&(c=o.R16),r===o.UNSIGNED_INT&&(c=o.R32UI),r===o.BYTE&&(c=o.R8I),r===o.SHORT&&(c=o.R16I),r===o.INT&&(c=o.R32I)),t===o.RED_INTEGER&&(r===o.UNSIGNED_BYTE&&(c=o.R8UI),r===o.UNSIGNED_SHORT&&(c=o.R16UI),r===o.UNSIGNED_INT&&(c=o.R32UI),r===o.BYTE&&(c=o.R8I),r===o.SHORT&&(c=o.R16I),r===o.INT&&(c=o.R32I)),t===o.RG&&(r===o.FLOAT&&(c=o.RG32F),r===o.HALF_FLOAT&&(c=o.RG16F),r===o.UNSIGNED_BYTE&&(c=o.RG8),r===o.UNSIGNED_SHORT&&(c=o.RG16),r===o.UNSIGNED_INT&&(c=o.RG32UI),r===o.BYTE&&(c=o.RG8I),r===o.SHORT&&(c=o.RG16I),r===o.INT&&(c=o.RG32I)),t===o.RG_INTEGER&&(r===o.UNSIGNED_BYTE&&(c=o.RG8UI),r===o.UNSIGNED_SHORT&&(c=o.RG16UI),r===o.UNSIGNED_INT&&(c=o.RG32UI),r===o.BYTE&&(c=o.RG8I),r===o.SHORT&&(c=o.RG16I),r===o.INT&&(c=o.RG32I)),t===o.RGB){const f=s?w_:Sn.getTransfer(i);r===o.FLOAT&&(c=o.RGB32F),r===o.HALF_FLOAT&&(c=o.RGB16F),r===o.UNSIGNED_BYTE&&(c=o.RGB8),r===o.UNSIGNED_SHORT&&(c=o.RGB16),r===o.UNSIGNED_INT&&(c=o.RGB32UI),r===o.BYTE&&(c=o.RGB8I),r===o.SHORT&&(c=o.RGB16I),r===o.INT&&(c=o.RGB32I),r===o.UNSIGNED_BYTE&&(c=f===ft?o.SRGB8:o.RGB8),r===o.UNSIGNED_SHORT_5_6_5&&(c=o.RGB565),r===o.UNSIGNED_SHORT_5_5_5_1&&(c=o.RGB5_A1),r===o.UNSIGNED_SHORT_4_4_4_4&&(c=o.RGB4),r===o.UNSIGNED_INT_5_9_9_9_REV&&(c=o.RGB9_E5),r===o.UNSIGNED_INT_10F_11F_11F_REV&&(c=o.R11F_G11F_B10F)}if(t===o.RGB_INTEGER&&(r===o.UNSIGNED_BYTE&&(c=o.RGB8UI),r===o.UNSIGNED_SHORT&&(c=o.RGB16UI),r===o.UNSIGNED_INT&&(c=o.RGB32UI),r===o.BYTE&&(c=o.RGB8I),r===o.SHORT&&(c=o.RGB16I),r===o.INT&&(c=o.RGB32I)),t===o.RGBA){const f=s?w_:Sn.getTransfer(i);r===o.FLOAT&&(c=o.RGBA32F),r===o.HALF_FLOAT&&(c=o.RGBA16F),r===o.UNSIGNED_BYTE&&(c=o.RGBA8),r===o.UNSIGNED_SHORT&&(c=o.RGBA16),r===o.UNSIGNED_INT&&(c=o.RGBA32UI),r===o.BYTE&&(c=o.RGBA8I),r===o.SHORT&&(c=o.RGBA16I),r===o.INT&&(c=o.RGBA32I),r===o.UNSIGNED_BYTE&&(c=f===ft?o.SRGB8_ALPHA8:o.RGBA8),r===o.UNSIGNED_SHORT_4_4_4_4&&(c=o.RGBA4),r===o.UNSIGNED_SHORT_5_5_5_1&&(c=o.RGB5_A1)}return t===o.RGBA_INTEGER&&(r===o.UNSIGNED_BYTE&&(c=o.RGBA8UI),r===o.UNSIGNED_SHORT&&(c=o.RGBA16UI),r===o.UNSIGNED_INT&&(c=o.RGBA32UI),r===o.BYTE&&(c=o.RGBA8I),r===o.SHORT&&(c=o.RGBA16I),r===o.INT&&(c=o.RGBA32I)),t===o.DEPTH_COMPONENT&&(r===o.UNSIGNED_SHORT&&(c=o.DEPTH_COMPONENT16),r===o.UNSIGNED_INT&&(c=o.DEPTH_COMPONENT24),r===o.FLOAT&&(c=o.DEPTH_COMPONENT32F)),t===o.DEPTH_STENCIL&&r===o.UNSIGNED_INT_24_8&&(c=o.DEPTH24_STENCIL8),(c===o.R16F||c===o.R32F||c===o.RG16F||c===o.RG32F||c===o.RGBA16F||c===o.RGBA32F)&&a.get("EXT_color_buffer_float"),c}setTextureParameters(e,t){const{gl:r,extensions:i,backend:s}=this,o=Sn.getPrimaries(Sn.workingColorSpace),a=t.colorSpace===Kl?null:Sn.getPrimaries(t.colorSpace),c=t.colorSpace===Kl||o===a?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,t.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,c),r.texParameteri(e,r.TEXTURE_WRAP_S,n0[t.wrapS]),r.texParameteri(e,r.TEXTURE_WRAP_T,n0[t.wrapT]),(e===r.TEXTURE_3D||e===r.TEXTURE_2D_ARRAY)&&(t.isArrayTexture||r.texParameteri(e,r.TEXTURE_WRAP_R,n0[t.wrapR])),r.texParameteri(e,r.TEXTURE_MAG_FILTER,Ep[t.magFilter]);const f=t.mipmaps!==void 0&&t.mipmaps.length>0,p=t.minFilter===Xi&&f?qa:t.minFilter;if(r.texParameteri(e,r.TEXTURE_MIN_FILTER,Ep[p]),t.compareFunction&&(r.texParameteri(e,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(e,r.TEXTURE_COMPARE_FUNC,pb[t.compareFunction])),i.has("EXT_texture_filter_anisotropic")===!0){if(t.magFilter===qi||t.minFilter!==EA&&t.minFilter!==qa||t.type===yi&&i.has("OES_texture_float_linear")===!1)return;if(t.anisotropy>1){const g=i.get("EXT_texture_filter_anisotropic");r.texParameterf(e,g.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,s.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:r,defaultTextures:i}=this,s=this.getGLTextureType(e);let o=i[s];o===void 0&&(o=t.createTexture(),r.state.bindTexture(s,o),t.texParameteri(s,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(s,t.TEXTURE_MAG_FILTER,t.NEAREST),i[s]=o),r.set(e,{textureGPU:o,glTextureType:s})}createTexture(e,t){const{gl:r,backend:i}=this,{levels:s,width:o,height:a,depth:c}=t,f=i.utils.convert(e.format,e.colorSpace),p=i.utils.convert(e.type),g=this.getInternalFormat(e.internalFormat,f,p,e.colorSpace,e.isVideoTexture),v=r.createTexture(),x=this.getGLTextureType(e);i.state.bindTexture(x,v),this.setTextureParameters(x,e),e.isArrayTexture||e.isDataArrayTexture||e.isCompressedArrayTexture?r.texStorage3D(r.TEXTURE_2D_ARRAY,s,g,o,a,c):e.isData3DTexture?r.texStorage3D(r.TEXTURE_3D,s,g,o,a,c):e.isVideoTexture||r.texStorage2D(x,s,g,o,a),i.set(e,{textureGPU:v,glTextureType:x,glFormat:f,glType:p,glInternalFormat:g})}copyBufferToTexture(e,t){const{gl:r,backend:i}=this,{textureGPU:s,glTextureType:o,glFormat:a,glType:c}=i.get(t),{width:f,height:p}=t.source.data;r.bindBuffer(r.PIXEL_UNPACK_BUFFER,e),i.state.bindTexture(o,s),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.texSubImage2D(o,0,0,0,f,p,a,c,0),r.bindBuffer(r.PIXEL_UNPACK_BUFFER,null),i.state.unbindTexture()}updateTexture(e,t){const{gl:r}=this,{width:i,height:s}=t,{textureGPU:o,glTextureType:a,glFormat:c,glType:f,glInternalFormat:p}=this.backend.get(e);if(!(e.isRenderTargetTexture||o===void 0))if(this.backend.state.bindTexture(a,o),this.setTextureParameters(a,e),e.isCompressedTexture){const g=e.mipmaps,v=t.image;for(let x=0;x<g.length;x++){const T=g[x];e.isCompressedArrayTexture?e.format!==r.RGBA?c!==null?r.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,x,0,0,0,T.width,T.height,v.depth,c,T.data):De("WebGLBackend: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texSubImage3D(r.TEXTURE_2D_ARRAY,x,0,0,0,T.width,T.height,v.depth,c,f,T.data):c!==null?r.compressedTexSubImage2D(r.TEXTURE_2D,x,0,0,T.width,T.height,c,T.data):De("WebGLBackend: Unsupported compressed texture format")}}else if(e.isCubeTexture){const g=t.images,v=e.mipmaps;for(let x=0;x<6;x++){const T=r0(g[x]);r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+x,0,0,0,i,s,c,f,T);for(let S=0;S<v.length;S++){const E=v[S],N=r0(E.images[x]);r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+x,S+1,0,0,N.width,N.height,c,f,N)}}}else if(e.isDataArrayTexture||e.isArrayTexture){const g=t.image;if(e.layerUpdates.size>0){const v=eC(g.width,g.height,e.format,e.type);for(const x of e.layerUpdates){const T=g.data.subarray(x*v/g.data.BYTES_PER_ELEMENT,(x+1)*v/g.data.BYTES_PER_ELEMENT);r.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,x,g.width,g.height,1,c,f,T)}e.clearLayerUpdates()}else r.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,g.width,g.height,g.depth,c,f,g.data)}else if(e.isData3DTexture){const g=t.image;r.texSubImage3D(r.TEXTURE_3D,0,0,0,0,g.width,g.height,g.depth,c,f,g.data)}else if(e.isVideoTexture)e.update(),r.texImage2D(a,0,p,c,f,t.image);else{const g=e.mipmaps;if(g.length>0)for(let v=0,x=g.length;v<x;v++){const T=g[v],S=r0(T);r.texSubImage2D(a,v,0,0,T.width,T.height,c,f,S)}else{const v=r0(t.image);r.texSubImage2D(a,0,0,0,i,s,c,f,v)}}}generateMipmaps(e){const{gl:t,backend:r}=this,{textureGPU:i,glTextureType:s}=r.get(e);r.state.bindTexture(s,i),t.generateMipmap(s)}deallocateRenderBuffers(e){const{gl:t,backend:r}=this;if(e){const i=r.get(e);if(i.renderBufferStorageSetup=void 0,i.framebuffers){for(const s in i.framebuffers)t.deleteFramebuffer(i.framebuffers[s]);delete i.framebuffers}if(i.depthRenderbuffer&&(t.deleteRenderbuffer(i.depthRenderbuffer),delete i.depthRenderbuffer),i.stencilRenderbuffer&&(t.deleteRenderbuffer(i.stencilRenderbuffer),delete i.stencilRenderbuffer),i.msaaFrameBuffer&&(t.deleteFramebuffer(i.msaaFrameBuffer),delete i.msaaFrameBuffer),i.msaaRenderbuffers){for(let s=0;s<i.msaaRenderbuffers.length;s++)t.deleteRenderbuffer(i.msaaRenderbuffers[s]);delete i.msaaRenderbuffers}}}destroyTexture(e,t=!1){const{gl:r,backend:i}=this,{textureGPU:s,renderTarget:o}=i.get(e);this.deallocateRenderBuffers(o),t===!1&&r.deleteTexture(s),i.delete(e)}copyTextureToTexture(e,t,r=null,i=null,s=0,o=0){const{gl:a,backend:c}=this,{state:f}=this.backend,{textureGPU:p,glTextureType:g,glType:v,glFormat:x}=c.get(t);f.bindTexture(g,p);let T,S,E,N,P,B,L,k,q;const I=e.isCompressedTexture?e.mipmaps[o]:e.image;if(r!==null)T=r.max.x-r.min.x,S=r.max.y-r.min.y,E=r.isBox3?r.max.z-r.min.z:1,N=r.min.x,P=r.min.y,B=r.isBox3?r.min.z:0;else{const Y=Math.pow(2,-s);T=Math.floor(I.width*Y),S=Math.floor(I.height*Y),e.isDataArrayTexture||e.isArrayTexture?E=I.depth:e.isData3DTexture?E=Math.floor(I.depth*Y):E=1,N=0,P=0,B=0}i!==null?(L=i.x,k=i.y,q=i.z):(L=0,k=0,q=0),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t.flipY),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),a.pixelStorei(a.UNPACK_ALIGNMENT,t.unpackAlignment);const U=a.getParameter(a.UNPACK_ROW_LENGTH),j=a.getParameter(a.UNPACK_IMAGE_HEIGHT),J=a.getParameter(a.UNPACK_SKIP_PIXELS),Q=a.getParameter(a.UNPACK_SKIP_ROWS),K=a.getParameter(a.UNPACK_SKIP_IMAGES);a.pixelStorei(a.UNPACK_ROW_LENGTH,I.width),a.pixelStorei(a.UNPACK_IMAGE_HEIGHT,I.height),a.pixelStorei(a.UNPACK_SKIP_PIXELS,N),a.pixelStorei(a.UNPACK_SKIP_ROWS,P),a.pixelStorei(a.UNPACK_SKIP_IMAGES,B);const te=e.isDataArrayTexture||e.isData3DTexture||t.isArrayTexture,oe=t.isDataArrayTexture||t.isData3DTexture||t.isArrayTexture;if(e.isDepthTexture){const Y=c.get(e),ae=c.get(t),he=c.get(Y.renderTarget),xe=c.get(ae.renderTarget),me=he.framebuffers[Y.cacheKey],Oe=xe.framebuffers[ae.cacheKey];f.bindFramebuffer(a.READ_FRAMEBUFFER,me),f.bindFramebuffer(a.DRAW_FRAMEBUFFER,Oe);for(let ke=0;ke<E;ke++)te&&(a.framebufferTextureLayer(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,Y.textureGPU,s,B+ke),a.framebufferTextureLayer(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,p,o,q+ke)),a.blitFramebuffer(N,P,T,S,L,k,T,S,a.DEPTH_BUFFER_BIT,a.NEAREST);f.bindFramebuffer(a.READ_FRAMEBUFFER,null),f.bindFramebuffer(a.DRAW_FRAMEBUFFER,null)}else if(s!==0||e.isRenderTargetTexture||c.has(e)){const Y=c.get(e);this._srcFramebuffer===null&&(this._srcFramebuffer=a.createFramebuffer()),this._dstFramebuffer===null&&(this._dstFramebuffer=a.createFramebuffer()),f.bindFramebuffer(a.READ_FRAMEBUFFER,this._srcFramebuffer),f.bindFramebuffer(a.DRAW_FRAMEBUFFER,this._dstFramebuffer);for(let ae=0;ae<E;ae++)te?a.framebufferTextureLayer(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,Y.textureGPU,s,B+ae):a.framebufferTexture2D(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,Y.textureGPU,s),oe?a.framebufferTextureLayer(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,p,o,q+ae):a.framebufferTexture2D(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,p,o),s!==0?a.blitFramebuffer(N,P,T,S,L,k,T,S,a.COLOR_BUFFER_BIT,a.NEAREST):oe?a.copyTexSubImage3D(g,o,L,k,q+ae,N,P,T,S):a.copyTexSubImage2D(g,o,L,k,N,P,T,S);f.bindFramebuffer(a.READ_FRAMEBUFFER,null),f.bindFramebuffer(a.DRAW_FRAMEBUFFER,null)}else oe?e.isDataTexture||e.isData3DTexture?a.texSubImage3D(g,o,L,k,q,T,S,E,x,v,I.data):t.isCompressedArrayTexture?a.compressedTexSubImage3D(g,o,L,k,q,T,S,E,x,I.data):a.texSubImage3D(g,o,L,k,q,T,S,E,x,v,I):e.isDataTexture?a.texSubImage2D(a.TEXTURE_2D,o,L,k,T,S,x,v,I.data):e.isCompressedTexture?a.compressedTexSubImage2D(a.TEXTURE_2D,o,L,k,I.width,I.height,x,I.data):a.texSubImage2D(a.TEXTURE_2D,o,L,k,T,S,x,v,I);a.pixelStorei(a.UNPACK_ROW_LENGTH,U),a.pixelStorei(a.UNPACK_IMAGE_HEIGHT,j),a.pixelStorei(a.UNPACK_SKIP_PIXELS,J),a.pixelStorei(a.UNPACK_SKIP_ROWS,Q),a.pixelStorei(a.UNPACK_SKIP_IMAGES,K),o===0&&t.generateMipmaps&&a.generateMipmap(g),f.unbindTexture()}copyFramebufferToTexture(e,t,r){const{gl:i}=this,{state:s}=this.backend,{textureGPU:o}=this.backend.get(e),{x:a,y:c,z:f,w:p}=r,g=e.isDepthTexture===!0||t.renderTarget&&t.renderTarget.samples>0,v=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(g){const x=a!==0||c!==0;let T,S;if(e.isDepthTexture===!0?(T=i.DEPTH_BUFFER_BIT,S=i.DEPTH_ATTACHMENT,t.stencil&&(T|=i.STENCIL_BUFFER_BIT)):(T=i.COLOR_BUFFER_BIT,S=i.COLOR_ATTACHMENT0),x){const E=this.backend.get(t.renderTarget),N=E.framebuffers[t.getCacheKey()],P=E.msaaFrameBuffer;s.bindFramebuffer(i.DRAW_FRAMEBUFFER,N),s.bindFramebuffer(i.READ_FRAMEBUFFER,P);const B=v-c-p;i.blitFramebuffer(a,B,a+f,B+p,a,B,a+f,B+p,T,i.NEAREST),s.bindFramebuffer(i.READ_FRAMEBUFFER,N),s.bindTexture(i.TEXTURE_2D,o),i.copyTexSubImage2D(i.TEXTURE_2D,0,0,0,a,B,f,p),s.unbindTexture()}else{const E=i.createFramebuffer();s.bindFramebuffer(i.DRAW_FRAMEBUFFER,E),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,S,i.TEXTURE_2D,o,0),i.blitFramebuffer(0,0,f,p,0,0,f,p,T,i.NEAREST),i.deleteFramebuffer(E)}}else s.bindTexture(i.TEXTURE_2D,o),i.copyTexSubImage2D(i.TEXTURE_2D,0,0,0,a,v-p-c,f,p),s.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,r,i=!1){const{gl:s}=this,o=t.renderTarget,{depthTexture:a,depthBuffer:c,stencilBuffer:f,width:p,height:g}=o;if(s.bindRenderbuffer(s.RENDERBUFFER,e),c&&!f){let v=s.DEPTH_COMPONENT24;i===!0?this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(s.RENDERBUFFER,o.samples,v,p,g):r>0?(a&&a.isDepthTexture&&a.type===s.FLOAT&&(v=s.DEPTH_COMPONENT32F),s.renderbufferStorageMultisample(s.RENDERBUFFER,r,v,p,g)):s.renderbufferStorage(s.RENDERBUFFER,v,p,g),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e)}else c&&f&&(r>0?s.renderbufferStorageMultisample(s.RENDERBUFFER,r,s.DEPTH24_STENCIL8,p,g):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,p,g),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e));s.bindRenderbuffer(s.RENDERBUFFER,null)}async copyTextureToBuffer(e,t,r,i,s,o){const{backend:a,gl:c}=this,{textureGPU:f,glFormat:p,glType:g}=this.backend.get(e),v=c.createFramebuffer();a.state.bindFramebuffer(c.READ_FRAMEBUFFER,v);const x=e.isCubeTexture?c.TEXTURE_CUBE_MAP_POSITIVE_X+o:c.TEXTURE_2D;c.framebufferTexture2D(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,x,f,0);const T=this._getTypedArrayType(g),S=this._getBytesPerTexel(g,p),N=i*s*S,P=c.createBuffer();c.bindBuffer(c.PIXEL_PACK_BUFFER,P),c.bufferData(c.PIXEL_PACK_BUFFER,N,c.STREAM_READ),c.readPixels(t,r,i,s,p,g,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),await a.utils._clientWaitAsync();const B=new T(N/T.BYTES_PER_ELEMENT);return c.bindBuffer(c.PIXEL_PACK_BUFFER,P),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,B),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),a.state.bindFramebuffer(c.READ_FRAMEBUFFER,null),c.deleteFramebuffer(v),B}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5||e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:r}=this;let i=0;if(e===r.UNSIGNED_BYTE&&(i=1),(e===r.UNSIGNED_SHORT_4_4_4_4||e===r.UNSIGNED_SHORT_5_5_5_1||e===r.UNSIGNED_SHORT_5_6_5||e===r.UNSIGNED_SHORT||e===r.HALF_FLOAT)&&(i=2),(e===r.UNSIGNED_INT||e===r.FLOAT)&&(i=4),t===r.RGBA)return i*4;if(t===r.RGB)return i*3;if(t===r.ALPHA)return i}dispose(){const{gl:e}=this;this._srcFramebuffer!==null&&e.deleteFramebuffer(this._srcFramebuffer),this._dstFramebuffer!==null&&e.deleteFramebuffer(this._dstFramebuffer)}}function r0(n){return n.isDataTexture?n.image.data:typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?n:n.data}class EH{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return t===void 0&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}}class RH{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(t.has("EXT_texture_filter_anisotropic")===!0){const r=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const mb={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-s3tc",EXT_texture_compression_bptc:"texture-compression-bc",EXT_disjoint_timer_query_webgl2:"timestamp-query",OVR_multiview2:"OVR_multiview2"};class CH{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:r,mode:i,object:s,type:o,info:a,index:c}=this;c!==0?r.drawElements(i,t,o,e):r.drawArrays(i,e,t),a.update(s,t,1)}renderInstances(e,t,r){const{gl:i,mode:s,type:o,index:a,object:c,info:f}=this;r!==0&&(a!==0?i.drawElementsInstanced(s,t,o,e,r):i.drawArraysInstanced(s,e,t,r),f.update(c,t,r))}renderMultiDraw(e,t,r){const{extensions:i,mode:s,object:o,info:a}=this;if(r===0)return;const c=i.get("WEBGL_multi_draw");if(c===null)for(let f=0;f<r;f++)this.render(e[f],t[f]);else{this.index!==0?c.multiDrawElementsWEBGL(s,t,0,this.type,e,0,r):c.multiDrawArraysWEBGL(s,e,0,t,0,r);let f=0;for(let p=0;p<r;p++)f+=t[p];a.update(o,f,1)}}renderMultiDrawInstances(e,t,r,i){const{extensions:s,mode:o,object:a,info:c}=this;if(r===0)return;const f=s.get("WEBGL_multi_draw");if(f===null)for(let p=0;p<r;p++)this.renderInstances(e[p],t[p],i[p]);else{this.index!==0?f.multiDrawElementsInstancedWEBGL(o,t,0,this.type,e,0,i,0,r):f.multiDrawArraysInstancedWEBGL(o,e,0,t,0,i,0,r);let p=0;for(let g=0;g<r;g++)p+=t[g]*i[g];c.update(a,p,1)}}}class lS{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.frames=[],this.pendingResolve=!1,this.timestamps=new Map}getTimestampFrames(){return this.frames}getTimestamp(e){let t=this.timestamps.get(e);return t===void 0&&(De(`TimestampQueryPool: No timestamp available for uid ${e}.`),t=0),t}hasTimestamp(e){return this.timestamps.has(e)}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class NH extends lS{constructor(e,t,r=2048){if(super(r),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext){De("EXT_disjoint_timer_query not supported; timestamps will be disabled."),this.trackTimestamp=!1;return}this.queries=[];for(let i=0;i<this.maxQueries;i++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return fn(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t==null||this.activeQuery!==null)return;const r=this.queries[t];if(r)try{this.queryStates.get(t)==="inactive"&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,r),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(i){Be("Error in beginQuery:",i),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t!=null&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(r){Be("Error in endQuery:",r),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=new Map;for(const[s,o]of this.queryOffsets)if(this.queryStates.get(o)==="ended"){const c=this.queries[o];e.set(s,this.resolveQuery(c))}if(e.size===0)return this.lastValue;const t={},r=[];for(const[s,o]of e){const a=s.match(/^(.*):f(\d+)$/),c=parseInt(a[2]);r.includes(c)===!1&&r.push(c),t[c]===void 0&&(t[c]=0);const f=await o;this.timestamps.set(s,f),t[c]+=f}const i=t[r[r.length-1]];return this.lastValue=i,this.frames=r,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,i}catch(e){return Be("Error resolving queries:",e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed){t(this.lastValue);return}let r,i=!1;const s=()=>{r&&(clearTimeout(r),r=null)},o=c=>{i||(i=!0,s(),t(c))},a=()=>{if(this.isDisposed){o(this.lastValue);return}try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)){o(this.lastValue);return}if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE)){r=setTimeout(a,1);return}const p=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(p)/1e6)}catch(c){Be("Error checking query:",c),t(this.lastValue)}};a()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,!!this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}class gb extends aS{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,r={antialias:e.currentSamples>0,alpha:!0,depth:e.depth,stencil:e.stencil},i=t.context!==void 0?t.context:e.domElement.getContext("webgl2",r);function s(o){o.preventDefault();const a={api:"WebGL",message:o.statusMessage||"Unknown reason",reason:null,originalEvent:o};e.onDeviceLost(a)}this._onContextLost=s,e.domElement.addEventListener("webglcontextlost",s,!1),this.gl=i,this.extensions=new EH(this),this.capabilities=new RH(this),this.attributeUtils=new xH(this),this.textureUtils=new SH(this),this.bufferRenderer=new CH(this),this.state=new TH(this),this.utils=new wH(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.extensions.get("OVR_multiview2"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile"),this.drawBuffersIndexedExt=this.extensions.get("OES_draw_buffers_indexed")}get coordinateSystem(){return $0}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async makeXRCompatible(){this.gl.getContextAttributes().xrCompatible!==!0&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,r=null){const i=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:i.RGBA8}),r!==null){const s=e.stencilBuffer?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:r,glInternalFormat:s}),this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer===!0&&e.multiview===!1&&De("WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),e._autoAllocateDepthBuffer=!1}}initTimestampQuery(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new NH(this.gl,e,2048));const r=this.timestampQueryPool[e];r.allocateQueriesForContext(t)!==null&&r.beginQuery(t)}prepareTimestampBuffer(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e].endQuery(t)}getContext(){return this.gl}beginRender(e){const{state:t}=this,r=this.get(e);if(e.viewport)this.updateViewport(e);else{const{width:s,height:o}=this.getDrawingBufferSize();t.viewport(0,0,s,o)}if(e.scissor){const{x:s,y:o,width:a,height:c}=e.scissorValue;t.scissor(s,e.height-c-o,a,c)}this.initTimestampQuery(gs.RENDER,this.getTimestampUID(e)),r.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const i=e.occlusionQueryCount;i>0&&(r.currentOcclusionQueries=r.occlusionQueries,r.currentOcclusionQueryObjects=r.occlusionQueryObjects,r.lastOcclusionObject=null,r.occlusionQueries=new Array(i),r.occlusionQueryObjects=new Array(i),r.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:r}=this,i=this.get(e),s=i.previousContext;r.resetVertexState();const o=e.occlusionQueryCount;o>0&&(o>i.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const a=e.textures;if(a!==null)for(let c=0;c<a.length;c++){const f=a[c];f.generateMipmaps&&this.generateMipmaps(f)}if(this._currentContext=s,this._resolveRenderTarget(e),s!==null)if(this._setFramebuffer(s),s.viewport)this.updateViewport(s);else{const{width:c,height:f}=this.getDrawingBufferSize();r.viewport(0,0,c,f)}this.prepareTimestampBuffer(gs.RENDER,this.getTimestampUID(e))}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:r,currentOcclusionQueryObjects:i}=t;if(r&&i){const s=new WeakSet,{gl:o}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const a=()=>{let c=0;for(let f=0;f<r.length;f++){const p=r[f];p!==null&&o.getQueryParameter(p,o.QUERY_RESULT_AVAILABLE)&&(o.getQueryParameter(p,o.QUERY_RESULT)===0&&s.add(i[f]),r[f]=null,o.deleteQuery(p),c++)}c<r.length?requestAnimationFrame(a):t.occluded=s};a()}}isOccluded(e,t){const r=this.get(e);return r.occluded&&r.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:r,y:i,width:s,height:o}=e.viewportValue;t.viewport(r,e.height-o-i,s,o)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,r,i=null,s=!0,o=!0){const{gl:a,renderer:c}=this;i===null&&(i={textures:null,clearColorValue:this.getClearColor()});let f=0;if(e&&(f|=a.COLOR_BUFFER_BIT),t&&(f|=a.DEPTH_BUFFER_BIT),r&&(f|=a.STENCIL_BUFFER_BIT),f!==0){let p;i.clearColorValue?p=i.clearColorValue:p=this.getClearColor();const g=c.getClearDepth(),v=c.getClearStencil();if(t&&this.state.setDepthMask(!0),i.textures===null)a.clearColor(p.r,p.g,p.b,p.a),a.clear(f);else{if(s&&this._setFramebuffer(i),e)for(let x=0;x<i.textures.length;x++)x===0?a.clearBufferfv(a.COLOR,x,[p.r,p.g,p.b,p.a]):a.clearBufferfv(a.COLOR,x,[0,0,0,1]);t&&r?a.clearBufferfi(a.DEPTH_STENCIL,0,g,v):t?a.clearBufferfv(a.DEPTH,0,[g]):r&&a.clearBufferiv(a.STENCIL,0,[v]),s&&o&&this._resolveRenderTarget(i)}}}beginCompute(e){const{state:t,gl:r}=this;t.bindFramebuffer(r.FRAMEBUFFER,null),this.initTimestampQuery(gs.COMPUTE,this.getTimestampUID(e))}compute(e,t,r,i,s=null){const{state:o,gl:a}=this;this.discard===!1&&(o.enable(a.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:c,transformBuffers:f,attributes:p}=this.get(i),g=this._getVaoKey(p),v=this.vaoCache[g];v===void 0?this.vaoCache[g]=this._createVao(p):o.setVertexState(v),o.useProgram(c),this._bindUniforms(r);const x=this._getTransformFeedback(f);a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,x),a.beginTransformFeedback(a.POINTS),s=s!==null?s:t.count,Array.isArray(s)?(fn("WebGLBackend.compute(): The count parameter must be a single number, not an array."),s=s[0]):s&&typeof s=="object"&&s.isIndirectStorageBufferAttribute&&(fn("WebGLBackend.compute(): The count parameter must be a single number, not IndirectStorageBufferAttribute"),s=t.count),p[0].isStorageInstancedBufferAttribute?a.drawArraysInstanced(a.POINTS,0,1,s):a.drawArrays(a.POINTS,0,s),a.endTransformFeedback(),a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,null);for(let T=0;T<f.length;T++){const S=f[T];S.pbo&&this.has(S.pbo)&&this.textureUtils.copyBufferToTexture(S.transformBuffer,S.pbo),S.switchBuffers()}}finishCompute(e){const{state:t,gl:r}=this;this.discard=!1,t.disable(r.RASTERIZER_DISCARD),this.prepareTimestampBuffer(gs.COMPUTE,this.getTimestampUID(e)),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.isArrayTexture&&e.camera.isArrayCamera}draw(e){const{object:t,pipeline:r,material:i,context:s,hardwareClippingPlanes:o}=e,{programGPU:a}=this.get(r),{gl:c,state:f}=this,p=this.get(s),g=e.getDrawParameters();if(g===null)return;this._bindUniforms(e.getBindings());const v=t.isMesh&&t.matrixWorld.determinant()<0;f.setMaterial(i,v,o),s.textures!==null&&s.textures.length>1&&f.setMRTBlending(s.textures),f.useProgram(a);const x=e.getAttributes(),T=this.get(x);let S=T.vaoGPU;if(S===void 0){const U=this._getVaoKey(x);S=this.vaoCache[U],S===void 0&&(S=this._createVao(x),this.vaoCache[U]=S,T.vaoGPU=S)}const E=e.getIndex(),N=E!==null?this.get(E).bufferGPU:null;f.setVertexState(S,N);const P=p.lastOcclusionObject;if(P!==t&&P!==void 0){if(P!==null&&P.occlusionTest===!0&&(c.endQuery(c.ANY_SAMPLES_PASSED),p.occlusionQueryIndex++),t.occlusionTest===!0){const U=c.createQuery();c.beginQuery(c.ANY_SAMPLES_PASSED,U),p.occlusionQueries[p.occlusionQueryIndex]=U,p.occlusionQueryObjects[p.occlusionQueryIndex]=t}p.lastOcclusionObject=t}const B=this.bufferRenderer;t.isPoints?B.mode=c.POINTS:t.isLineSegments?B.mode=c.LINES:t.isLine?B.mode=c.LINE_STRIP:t.isLineLoop?B.mode=c.LINE_LOOP:i.wireframe===!0?(f.setLineWidth(i.wireframeLinewidth*this.renderer.getPixelRatio()),B.mode=c.LINES):B.mode=c.TRIANGLES;const{vertexCount:L,instanceCount:k}=g;let{firstVertex:q}=g;if(B.object=t,E!==null){q*=E.array.BYTES_PER_ELEMENT;const U=this.get(E);B.index=E.count,B.type=U.type}else B.index=0;const I=()=>{t.isBatchedMesh?t._multiDrawInstances!==null?(fn("WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),B.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?B.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):fn("WebGLBackend: WEBGL_multi_draw not supported."):k>1?B.renderInstances(q,L,k):B.render(q,L)};if(e.camera.isArrayCamera===!0&&e.camera.cameras.length>0&&e.camera.isMultiViewCamera===!1){const U=this.get(e.camera),j=e.camera.cameras,J=e.getBindingGroup("cameraIndex").bindings[0];if(U.indexesGPU===void 0||U.indexesGPU.length!==j.length){const ae=new Uint32Array([0,0,0,0]),he=[];for(let xe=0,me=j.length;xe<me;xe++){const Oe=c.createBuffer();ae[0]=xe,c.bindBuffer(c.UNIFORM_BUFFER,Oe),c.bufferData(c.UNIFORM_BUFFER,ae,c.STATIC_DRAW),he.push(Oe)}U.indexesGPU=he}const Q=this.get(J),K=this.renderer.getPixelRatio(),te=this._currentContext.renderTarget,oe=this._isRenderCameraDepthArray(this._currentContext),Y=this._currentContext.activeCubeFace;if(oe){const ae=this.get(te.depthTexture);if(ae.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){ae.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;const{stencilBuffer:he}=te;for(let xe=0,me=j.length;xe<me;xe++)this.renderer._activeCubeFace=xe,this._currentContext.activeCubeFace=xe,this._setFramebuffer(this._currentContext),this.clear(!1,!0,he,this._currentContext,!1,!1);this.renderer._activeCubeFace=Y,this._currentContext.activeCubeFace=Y}}for(let ae=0,he=j.length;ae<he;ae++){const xe=j[ae];if(t.layers.test(xe.layers)){oe&&(this.renderer._activeCubeFace=ae,this._currentContext.activeCubeFace=ae,this._setFramebuffer(this._currentContext));const me=xe.viewport;if(me!==void 0){const Oe=me.x*K,ke=me.y*K,Ke=me.width*K,Ye=me.height*K;f.viewport(Math.floor(Oe),Math.floor(e.context.height-Ye-ke),Math.floor(Ke),Math.floor(Ye))}f.bindBufferBase(c.UNIFORM_BUFFER,Q.index,U.indexesGPU[ae]),I()}this._currentContext.activeCubeFace=Y,this.renderer._activeCubeFace=Y}}else I()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,r,i,s,o){return this.textureUtils.copyTextureToBuffer(e,t,r,i,s,o)}updateSampler(){return""}createNodeBuilder(e,t){return new _H(e,t)}createProgram(e){const t=this.gl,{stage:r,code:i}=e,s=r==="fragment"?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(s,i),t.compileShader(s),this.set(e,{shaderGPU:s})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const r=this.gl,i=e.pipeline,{fragmentProgram:s,vertexProgram:o}=i,a=r.createProgram(),c=this.get(s).shaderGPU,f=this.get(o).shaderGPU;if(r.attachShader(a,c),r.attachShader(a,f),r.linkProgram(a),this.set(i,{programGPU:a,fragmentShader:c,vertexShader:f}),t!==null&&this.parallel){const p=new Promise(g=>{const v=this.parallel,x=()=>{r.getProgramParameter(a,v.COMPLETION_STATUS_KHR)?(this._completeCompile(e,i),g()):requestAnimationFrame(x)};x()});t.push(p);return}this._completeCompile(e,i)}_handleSource(e,t){const r=e.split(`
`),i=[],s=Math.max(t-6,0),o=Math.min(t+6,r.length);for(let a=s;a<o;a++){const c=a+1;i.push(`${c===t?">":" "} ${c}: ${r[a]}`)}return i.join(`
`)}_getShaderErrors(e,t,r){const i=e.getShaderParameter(t,e.COMPILE_STATUS),o=(e.getShaderInfoLog(t)||"").trim();if(i&&o==="")return"";const a=/ERROR: 0:(\d+)/.exec(o);if(a){const c=parseInt(a[1]);return r.toUpperCase()+`

`+o+`

`+this._handleSource(e.getShaderSource(t),c)}else return o}_logProgramError(e,t,r){if(this.renderer.debug.checkShaderErrors){const i=this.gl,o=(i.getProgramInfoLog(e)||"").trim();if(i.getProgramParameter(e,i.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(i,e,r,t);else{const a=this._getShaderErrors(i,r,"vertex"),c=this._getShaderErrors(i,t,"fragment");Be("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(e,i.VALIDATE_STATUS)+`

Program Info Log: `+o+`
`+a+`
`+c)}else o!==""&&De("WebGLProgram: Program Info Log:",o)}}_completeCompile(e,t){const{state:r,gl:i}=this,s=this.get(t),{programGPU:o,fragmentShader:a,vertexShader:c}=s;i.getProgramParameter(o,i.LINK_STATUS)===!1&&this._logProgramError(o,a,c),r.useProgram(o);const f=e.getBindings();this._setupBindings(f,o),this.set(t,{programGPU:o})}createComputePipeline(e,t){const{state:r,gl:i}=this,s={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(s);const{computeProgram:o}=e,a=i.createProgram(),c=this.get(s).shaderGPU,f=this.get(o).shaderGPU,p=o.transforms,g=[],v=[];for(let E=0;E<p.length;E++){const N=p[E];g.push(N.varyingName),v.push(N.attributeNode)}i.attachShader(a,c),i.attachShader(a,f),i.transformFeedbackVaryings(a,g,i.SEPARATE_ATTRIBS),i.linkProgram(a),i.getProgramParameter(a,i.LINK_STATUS)===!1&&this._logProgramError(a,c,f),r.useProgram(a),this._setupBindings(t,a);const x=o.attributes,T=[],S=[];for(let E=0;E<x.length;E++){const N=x[E].node.attribute;T.push(N),this.has(N)||this.attributeUtils.createAttribute(N,i.ARRAY_BUFFER)}for(let E=0;E<v.length;E++){const N=v[E].attribute;this.has(N)||this.attributeUtils.createAttribute(N,i.ARRAY_BUFFER);const P=this.get(N);S.push(P)}this.set(e,{programGPU:a,transformBuffers:S,attributes:T})}createBindings(e,t){if(this._knownBindings.has(t)===!1){this._knownBindings.add(t);let r=0,i=0;for(const s of t){this.set(s,{textures:i,uniformBuffers:r});for(const o of s.bindings)o.isUniformBuffer&&r++,o.isSampledTexture&&i++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,r=this.get(e);let i=r.uniformBuffers,s=r.textures;for(const o of e.bindings){const a=this.get(o);if(o.isUniformsGroup||o.isUniformBuffer){const c=o.buffer;let{bufferGPU:f}=this.get(c);f===void 0?(f=t.createBuffer(),t.bindBuffer(t.UNIFORM_BUFFER,f),t.bufferData(t.UNIFORM_BUFFER,c.byteLength,t.DYNAMIC_DRAW),this.set(c,{bufferGPU:f})):t.bindBuffer(t.UNIFORM_BUFFER,f);const p=o.updateRanges;if(t.bindBuffer(t.UNIFORM_BUFFER,f),p.length===0)t.bufferData(t.UNIFORM_BUFFER,c,t.DYNAMIC_DRAW);else{const g=H0(c),v=g?1:c.BYTES_PER_ELEMENT;for(let x=0,T=p.length;x<T;x++){const S=p[x],E=S.start*v,N=S.count*v,P=E*(g?c.BYTES_PER_ELEMENT:1);t.bufferSubData(t.UNIFORM_BUFFER,P,c,E,N)}}a.index=i++,a.bufferGPU=f,this.set(o,a)}else if(o.isSampledTexture){const{textureGPU:c,glTextureType:f}=this.get(o.texture);a.index=s++,a.textureGPU=c,a.glTextureType=f,this.set(o,a)}}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const i=this.get(e).bufferGPU,s=e.buffer,o=e.updateRanges;if(t.bindBuffer(t.UNIFORM_BUFFER,i),o.length===0)t.bufferData(t.UNIFORM_BUFFER,s,t.DYNAMIC_DRAW);else{const a=H0(s),c=a?1:s.BYTES_PER_ELEMENT;for(let f=0,p=o.length;f<p;f++){const g=o[f],v=g.start*c,x=g.count*c,T=v*(a?s.BYTES_PER_ELEMENT:1);t.bufferSubData(t.UNIFORM_BUFFER,T,s,v,x)}}}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(mb).filter(i=>mb[i]===e),r=this.extensions;for(let i=0;i<t.length;i++)if(r.has(t[i]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,r=null,i=null,s=0,o=0){this.textureUtils.copyTextureToTexture(e,t,r,i,s,o)}copyFramebufferToTexture(e,t,r){this.textureUtils.copyFramebufferToTexture(e,t,r)}_setFramebuffer(e){const{gl:t,state:r}=this;let i=null;if(e.textures!==null){const s=e.renderTarget,o=this.get(s),{samples:a,depthBuffer:c,stencilBuffer:f}=s,p=s.isWebGLCubeRenderTarget===!0,g=s.isRenderTarget3D===!0,v=s.depth>1,x=s.isXRRenderTarget===!0,T=x===!0&&s._hasExternalTextures===!0;let S=o.msaaFrameBuffer,E=o.depthRenderbuffer;const N=this.extensions.get("WEBGL_multisampled_render_to_texture"),P=this.extensions.get("OVR_multiview2"),B=this._useMultisampledExtension(s),L=t5(e);let k;if(p?(o.cubeFramebuffers||(o.cubeFramebuffers={}),k=o.cubeFramebuffers[L]):x&&T===!1?k=this._xrFramebuffer:(o.framebuffers||(o.framebuffers={}),k=o.framebuffers[L]),k===void 0){k=t.createFramebuffer(),r.bindFramebuffer(t.FRAMEBUFFER,k);const q=e.textures,I=[];if(p){o.cubeFramebuffers[L]=k;const{textureGPU:j}=this.get(q[0]),J=this.renderer._activeCubeFace,Q=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+J,j,Q)}else{o.framebuffers[L]=k;for(let j=0;j<q.length;j++){const J=q[j],Q=this.get(J);Q.renderTarget=e.renderTarget,Q.cacheKey=L;const K=t.COLOR_ATTACHMENT0+j;if(s.multiview)P.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,K,Q.textureGPU,0,a,0,2);else if(g||v){const te=this.renderer._activeCubeFace,oe=this.renderer._activeMipmapLevel;t.framebufferTextureLayer(t.FRAMEBUFFER,K,Q.textureGPU,oe,te)}else if(B)N.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,K,t.TEXTURE_2D,Q.textureGPU,0,a);else{const te=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,K,t.TEXTURE_2D,Q.textureGPU,te)}}}const U=f?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(s._autoAllocateDepthBuffer===!0){const j=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(j,e,0,B),o.xrDepthRenderbuffer=j,I.push(f?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT),t.bindRenderbuffer(t.RENDERBUFFER,j),t.framebufferRenderbuffer(t.FRAMEBUFFER,U,t.RENDERBUFFER,j)}else if(e.depthTexture!==null){I.push(f?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT);const j=this.get(e.depthTexture);if(j.renderTarget=e.renderTarget,j.cacheKey=L,s.multiview)P.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,U,j.textureGPU,0,a,0,2);else if(T&&B)N.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,U,t.TEXTURE_2D,j.textureGPU,0,a);else if(e.depthTexture.isArrayTexture){const J=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,U,j.textureGPU,0,J)}else if(e.depthTexture.isCubeTexture){const J=this.renderer._activeCubeFace;t.framebufferTexture2D(t.FRAMEBUFFER,U,t.TEXTURE_CUBE_MAP_POSITIVE_X+J,j.textureGPU,0)}else t.framebufferTexture2D(t.FRAMEBUFFER,U,t.TEXTURE_2D,j.textureGPU,0)}o.depthInvalidationArray=I}else{if(this._isRenderCameraDepthArray(e)){r.bindFramebuffer(t.FRAMEBUFFER,k);const I=this.renderer._activeCubeFace,U=this.get(e.depthTexture),j=f?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.framebufferTextureLayer(t.FRAMEBUFFER,j,U.textureGPU,0,I)}if((x||B||s.multiview)&&s._isOpaqueFramebuffer!==!0){r.bindFramebuffer(t.FRAMEBUFFER,k);const I=this.get(e.textures[0]);s.multiview?P.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,I.textureGPU,0,a,0,2):B?N.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,I.textureGPU,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,I.textureGPU,0);const U=f?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(s._autoAllocateDepthBuffer===!0){const j=o.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,j),t.framebufferRenderbuffer(t.FRAMEBUFFER,U,t.RENDERBUFFER,j)}else{const j=this.get(e.depthTexture);s.multiview?P.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,U,j.textureGPU,0,a,0,2):B?N.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,U,t.TEXTURE_2D,j.textureGPU,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,U,t.TEXTURE_2D,j.textureGPU,0)}}}if(a>0&&B===!1&&!s.multiview){if(S===void 0){const q=[];S=t.createFramebuffer(),r.bindFramebuffer(t.FRAMEBUFFER,S);const I=[],U=e.textures;for(let j=0;j<U.length;j++){I[j]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,I[j]),q.push(t.COLOR_ATTACHMENT0+j);const J=e.textures[j],Q=this.get(J);t.renderbufferStorageMultisample(t.RENDERBUFFER,a,Q.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+j,t.RENDERBUFFER,I[j])}if(t.bindRenderbuffer(t.RENDERBUFFER,null),o.msaaFrameBuffer=S,o.msaaRenderbuffers=I,c&&E===void 0){E=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(E,e,a),o.depthRenderbuffer=E;const j=f?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;q.push(j)}o.invalidationArray=q}i=o.msaaFrameBuffer}else i=k;r.drawBuffers(e,k)}r.bindFramebuffer(t.FRAMEBUFFER,i)}_getVaoKey(e){let t="";for(let r=0;r<e.length;r++){const i=this.get(e[r]);t+=":"+i.id}return t}_createVao(e){const{gl:t}=this,r=t.createVertexArray();t.bindVertexArray(r);for(let i=0;i<e.length;i++){const s=e[i],o=this.get(s);t.bindBuffer(t.ARRAY_BUFFER,o.bufferGPU),t.enableVertexAttribArray(i);let a,c;s.isInterleavedBufferAttribute===!0?(a=s.data.stride*o.bytesPerElement,c=s.offset*o.bytesPerElement):(a=0,c=0),o.isInteger?t.vertexAttribIPointer(i,s.itemSize,o.type,a,c):t.vertexAttribPointer(i,s.itemSize,o.type,s.normalized,a,c),s.isInstancedBufferAttribute&&!s.isInterleavedBufferAttribute?t.vertexAttribDivisor(i,s.meshPerAttribute):s.isInterleavedBufferAttribute&&s.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(i,s.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),r}_getTransformFeedback(e){let t="";for(let s=0;s<e.length;s++)t+=":"+e[s].id;let r=this.transformFeedbackCache[t];if(r!==void 0)return r;const{gl:i}=this;r=i.createTransformFeedback(),i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,r);for(let s=0;s<e.length;s++){const o=e[s];i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,s,o.transformBuffer)}return i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=r,r}_setupBindings(e,t){const r=this.gl;for(const i of e)for(const s of i.bindings){const a=this.get(s).index;if(s.isUniformsGroup||s.isUniformBuffer){const c=r.getUniformBlockIndex(t,s.name);r.uniformBlockBinding(t,c,a)}else if(s.isSampledTexture){const c=r.getUniformLocation(t,s.name);r.uniform1i(c,a)}}}_bindUniforms(e){const{gl:t,state:r}=this;for(const i of e)for(const s of i.bindings){const o=this.get(s),a=o.index;s.isUniformsGroup||s.isUniformBuffer?r.bindBufferBase(t.UNIFORM_BUFFER,a,o.bufferGPU):s.isSampledTexture&&r.bindTexture(o.glTextureType,o.textureGPU,t.TEXTURE0+a)}}_resolveRenderTarget(e){const{gl:t,state:r}=this,i=e.renderTarget;if(e.textures!==null&&i){const s=this.get(i);if(i.samples>0&&this._useMultisampledExtension(i)===!1){const o=s.framebuffers[e.getCacheKey()];let a=t.COLOR_BUFFER_BIT;i.resolveDepthBuffer&&(i.depthBuffer&&(a|=t.DEPTH_BUFFER_BIT),i.stencilBuffer&&i.resolveStencilBuffer&&(a|=t.STENCIL_BUFFER_BIT));const c=s.msaaFrameBuffer,f=s.msaaRenderbuffers,p=e.textures,g=p.length>1;if(r.bindFramebuffer(t.READ_FRAMEBUFFER,c),r.bindFramebuffer(t.DRAW_FRAMEBUFFER,o),g)for(let v=0;v<p.length;v++)t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+v,t.RENDERBUFFER,null),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+v,t.TEXTURE_2D,null,0);for(let v=0;v<p.length;v++){if(g){const{textureGPU:x}=this.get(p[v]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,f[v]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,x,0)}if(e.scissor){const{x,y:T,width:S,height:E}=e.scissorValue,N=e.height-E-T;t.blitFramebuffer(x,N,x+S,N+E,x,N,x+S,N+E,a,t.NEAREST)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,a,t.NEAREST)}if(g)for(let v=0;v<p.length;v++){const{textureGPU:x}=this.get(p[v]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+v,t.RENDERBUFFER,f[v]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+v,t.TEXTURE_2D,x,0)}this._supportsInvalidateFramebuffer===!0&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,s.invalidationArray)}else if(i.resolveDepthBuffer===!1&&s.framebuffers){const o=s.framebuffers[e.getCacheKey()];r.bindFramebuffer(t.DRAW_FRAMEBUFFER,o),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,s.depthInvalidationArray)}}}_useMultisampledExtension(e){return e.multiview===!0?!0:e.samples>0&&this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer!==!1}dispose(){this.textureUtils!==null&&this.textureUtils.dispose();const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const Gl={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},Ua=typeof self<"u"?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},nr={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},Tr={Store:"store"},It={Load:"load",Clear:"clear"},yb={CCW:"ccw",CW:"cw"},_b={None:"none",Back:"back"},cu={Uint16:"uint16",Uint32:"uint32"},ee={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10UFloat:"rg11b10ufloat",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-unorm-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},Rp={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},Ca={Linear:"linear",Nearest:"nearest"},Et={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDst:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},va={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},vb={None:0,All:15},Co={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},Cp={Storage:"storage",ReadOnlyStorage:"read-only-storage"},Np={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},bb={NonFiltering:"non-filtering",Comparison:"comparison"},ba={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},xb={TwoD:"2d",ThreeD:"3d"},kn={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},MH={All:"all"},i0={Vertex:"vertex",Instance:"instance"},Cg={CoreFeaturesAndLimits:"core-features-and-limits",DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionBCSliced3D:"texture-compression-bc-sliced-3d",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TextureCompressionASTCSliced3D:"texture-compression-astc-sliced-3d",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",Float32Blendable:"float32-blendable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups",TextureFormatsTier1:"texture-formats-tier1",TextureFormatsTier2:"texture-formats-tier2"},Tb={"texture-compression-s3tc":"texture-compression-bc","texture-compression-etc1":"texture-compression-etc2"};class PH extends sS{constructor(e,t,r){super(e,t?t.value:null),this.textureNode=t,this.groupNode=r}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class BH extends tS{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let DH=0;class LH extends BH{constructor(e,t){super("StorageBuffer_"+DH++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:ar.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class OH extends ia{constructor(e){super(),this.device=e;const t=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,r=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,i=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:Ca.Linear}),this.flipYSampler=e.createSampler({minFilter:Ca.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:t}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:r}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:i})}getTransferPipeline(e){let t=this.transferPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Gl.TriangleStrip,stripIndexFormat:cu.Uint32},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Gl.TriangleStrip,stripIndexFormat:cu.Uint32},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t,r=0){const i=t.format,{width:s,height:o}=t.size,a=this.getTransferPipeline(i),c=this.getFlipYPipeline(i),f=this.device.createTexture({size:{width:s,height:o,depthOrArrayLayers:1},format:i,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),p=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:kn.TwoD,baseArrayLayer:r}),g=f.createView({baseMipLevel:0,mipLevelCount:1,dimension:kn.TwoD,baseArrayLayer:0}),v=this.device.createCommandEncoder({}),x=(T,S,E)=>{const N=T.getBindGroupLayout(0),P=this.device.createBindGroup({layout:N,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:S}]}),B=v.beginRenderPass({colorAttachments:[{view:E,loadOp:It.Clear,storeOp:Tr.Store,clearValue:[0,0,0,0]}]});B.setPipeline(T),B.setBindGroup(0,P),B.draw(4,1,0,0),B.end()};x(a,p,g),x(c,g,p),this.device.queue.submit([v.finish()]),f.destroy()}generateMipmaps(e,t,r=0,i=null){const s=this.get(e);s.layers===void 0&&(s.layers=[]);const o=s.layers[r]||this._mipmapCreateBundles(e,t,r),a=i||this.device.createCommandEncoder({label:"mipmapEncoder"});this._mipmapRunBundles(a,o),i===null&&this.device.queue.submit([a.finish()]),s.layers[r]=o}_mipmapCreateBundles(e,t,r){const i=this.getTransferPipeline(t.format),s=i.getBindGroupLayout(0);let o=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:kn.TwoD,baseArrayLayer:r});const a=[];for(let c=1;c<t.mipLevelCount;c++){const f=this.device.createBindGroup({layout:s,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:o}]}),p=e.createView({baseMipLevel:c,mipLevelCount:1,dimension:kn.TwoD,baseArrayLayer:r}),g={colorAttachments:[{view:p,loadOp:It.Clear,storeOp:Tr.Store,clearValue:[0,0,0,0]}]},v=this.device.createRenderBundleEncoder({colorFormats:[t.format]});v.setPipeline(i),v.setBindGroup(0,f),v.draw(4,1,0,0),a.push({renderBundles:[v.finish()],passDescriptor:g}),o=p}return a}_mipmapRunBundles(e,t){const r=t.length;for(let i=0;i<r;i++){const s=t[i],o=e.beginRenderPass(s.passDescriptor);o.executeBundles(s.renderBundles),o.end()}}}const FH={[wx]:"never",[uf]:"less",[bx]:"equal",[xx]:"less-equal",[_x]:"greater",[vx]:"greater-equal",[Tx]:"always",[yx]:"not-equal"},IH=[0,1,3,2,4,5];class kH{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this._samplerCache=new Map}updateSampler(e){const t=this.backend,r=e.minFilter+"-"+e.magFilter+"-"+e.wrapS+"-"+e.wrapT+"-"+(e.wrapR||"0")+"-"+e.anisotropy+"-"+(e.compareFunction||0);let i=this._samplerCache.get(r);if(i===void 0){const o={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};o.magFilter===Ca.Linear&&o.minFilter===Ca.Linear&&o.mipmapFilter===Ca.Linear&&(o.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(o.compare=FH[e.compareFunction]),i={sampler:t.device.createSampler(o),usedTimes:0},this._samplerCache.set(r,i)}const s=t.get(e);if(s.sampler!==i.sampler){if(s.sampler!==void 0){const o=this._samplerCache.get(s.samplerKey);o.usedTimes--,o.usedTimes===0&&this._samplerCache.delete(s.samplerKey)}s.samplerKey=r,s.sampler=i.sampler,i.usedTimes++}return r}createDefaultTexture(e){let t;const r=Ng(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(r):t=this._getDefaultTextureGPU(r),this.backend.get(e).texture=t}createTexture(e,t={}){const r=this.backend,i=r.get(e);if(i.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");if(e.isExternalTexture){i.texture=e.sourceTexture,i.initialized=!0;return}t.needsMipmaps===void 0&&(t.needsMipmaps=!1),t.levels===void 0&&(t.levels=1),t.depth===void 0&&(t.depth=1);const{width:s,height:o,depth:a,levels:c}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const f=this._getDimension(e),p=e.internalFormat||t.format||Ng(e,r.device);i.format=p;const{samples:g,primarySamples:v,isMSAA:x}=r.utils.getTextureSampleData(e);let T=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(T|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&p!==ee.RGB9E5UFloat&&(T|=GPUTextureUsage.RENDER_ATTACHMENT);const S={label:e.name,size:{width:s,height:o,depthOrArrayLayers:a},mipLevelCount:c,sampleCount:v,dimension:f,format:p,usage:T};if(p===void 0){De("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);return}if(e.isCubeTexture&&(S.textureBindingViewDimension=kn.Cube),i.texture=r.device.createTexture(S),x){const E=Object.assign({},S);E.label=E.label+"-msaa",E.sampleCount=g,E.mipLevelCount=1,i.msaaTexture=r.device.createTexture(E)}i.initialized=!0,i.textureDescriptorGPU=S}destroyTexture(e,t=!1){const r=this.backend,i=r.get(e);i.texture!==void 0&&t===!1&&i.texture.destroy(),i.msaaTexture!==void 0&&i.msaaTexture.destroy(),r.delete(e)}generateMipmaps(e,t=null){const r=this.backend.get(e);if(e.isCubeTexture)for(let i=0;i<6;i++)this._generateMipmaps(r.texture,r.textureDescriptorGPU,i,t);else{const i=e.image.depth||1;for(let s=0;s<i;s++)this._generateMipmaps(r.texture,r.textureDescriptorGPU,s,t)}}getColorBuffer(){const e=this.backend,t=e.renderer.getCanvasTarget(),{width:r,height:i}=e.getDrawingBufferSize(),s=e.renderer.currentSamples,o=t.colorTexture,a=e.get(o);if(o.width===r&&o.height===i&&o.samples===s)return a.texture;let c=a.texture;return c&&c.destroy(),c=e.device.createTexture({label:"colorBuffer",size:{width:r,height:i,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.currentSamples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),o.source.width=r,o.source.height=i,o.samples=s,a.texture=c,c}getDepthBuffer(e=!0,t=!1){const r=this.backend,i=r.renderer.getCanvasTarget(),{width:s,height:o}=r.getDrawingBufferSize(),a=r.renderer.currentSamples,c=i.depthTexture;if(c.width===s&&c.height===o&&c.samples===a&&c.depth===e&&c.stencil===t)return r.get(c).texture;const f=r.get(c).texture;let p,g;if(t?(p=$o,g=jo):e&&(p=Ho,g=Un),f!==void 0){if(c.image.width===s&&c.image.height===o&&c.format===p&&c.type===g&&c.samples===a)return f;this.destroyTexture(c)}return c.name="depthBuffer",c.format=p,c.type=g,c.image.width=s,c.image.height=o,c.samples=a,this.createTexture(c,{width:s,height:o}),r.get(c).texture}updateTexture(e,t){const r=this.backend.get(e),i=e.mipmaps,{textureDescriptorGPU:s}=r;if(!(e.isRenderTargetTexture||s===void 0)){if(e.isDataTexture)if(i.length>0)for(let o=0,a=i.length;o<a;o++){const c=i[o];this._copyBufferToTexture(c,r.texture,s,0,e.flipY,0,o)}else this._copyBufferToTexture(t.image,r.texture,s,0,e.flipY);else if(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)for(let o=0;o<t.image.depth;o++)this._copyBufferToTexture(t.image,r.texture,s,o,e.flipY,o);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,r.texture,s);else if(e.isCubeTexture)this._copyCubeMapToTexture(e,r.texture,s);else if(i.length>0)for(let o=0,a=i.length;o<a;o++){const c=i[o];this._copyImageToTexture(c,r.texture,s,0,e.flipY,e.premultiplyAlpha,o)}else this._copyImageToTexture(t.image,r.texture,s,0,e.flipY,e.premultiplyAlpha);r.version=e.version}}async copyTextureToBuffer(e,t,r,i,s,o){const a=this.backend.device,c=this.backend.get(e),f=c.texture,p=c.textureDescriptorGPU.format,g=this._getBytesPerTexel(p);let v=i*g;v=Math.ceil(v/256)*256;const x=a.createBuffer({size:(s-1)*v+i*g,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),T=a.createCommandEncoder();T.copyTextureToBuffer({texture:f,origin:{x:t,y:r,z:o}},{buffer:x,bytesPerRow:v},{width:i,height:s});const S=this._getTypedArrayType(p);a.queue.submit([T.finish()]),await x.mapAsync(GPUMapMode.READ);const E=x.getMappedRange();return new S(E)}dispose(){this._samplerCache.clear()}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const r=new e1;r.minFilter=qi,r.magFilter=qi,this.createTexture(r,{width:1,height:1,format:e}),this.defaultTexture[e]=t=r}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultCubeTexture[e];if(t===void 0){const r=new Jg;r.minFilter=qi,r.magFilter=qi,this.createTexture(r,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=r}return this.backend.get(t).texture}_copyCubeMapToTexture(e,t,r){const i=e.images,s=e.mipmaps;for(let o=0;o<6;o++){const a=i[o],c=e.flipY===!0?IH[o]:o;a.isDataTexture?this._copyBufferToTexture(a.image,t,r,c,e.flipY):this._copyImageToTexture(a,t,r,c,e.flipY,e.premultiplyAlpha);for(let f=0;f<s.length;f++){const g=s[f].images[o];g.isDataTexture?this._copyBufferToTexture(g.image,t,r,c,e.flipY,0,f+1):this._copyImageToTexture(g,t,r,c,e.flipY,e.premultiplyAlpha,f+1)}}}_copyImageToTexture(e,t,r,i,s,o,a=0){const c=this.backend.device,f=a>0?e.width:r.size.width,p=a>0?e.height:r.size.height;try{c.queue.copyExternalImageToTexture({source:e,flipY:s},{texture:t,mipLevel:a,origin:{x:0,y:0,z:i},premultipliedAlpha:o},{width:f,height:p,depthOrArrayLayers:1})}catch{}}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new OH(this.backend.device)),e}_generateMipmaps(e,t,r=0,i=null){this._getPassUtils().generateMipmaps(e,t,r,i)}_flipY(e,t,r=0){this._getPassUtils().flipY(e,t,r)}_copyBufferToTexture(e,t,r,i,s,o=0,a=0){const c=this.backend.device,f=e.data,p=this._getBytesPerTexel(r.format),g=e.width*p;c.queue.writeTexture({texture:t,mipLevel:a,origin:{x:0,y:0,z:i}},f,{offset:e.width*e.height*p*o,bytesPerRow:g},{width:e.width,height:e.height,depthOrArrayLayers:1}),s===!0&&this._flipY(t,r,i)}_copyCompressedBufferToTexture(e,t,r){const i=this.backend.device,s=this._getBlockData(r.format),o=r.size.depthOrArrayLayers>1;for(let a=0;a<e.length;a++){const c=e[a],f=c.width,p=c.height,g=o?r.size.depthOrArrayLayers:1,v=Math.ceil(f/s.width)*s.byteLength,x=v*Math.ceil(p/s.height);for(let T=0;T<g;T++)i.queue.writeTexture({texture:t,mipLevel:a,origin:{x:0,y:0,z:T}},c.data,{offset:T*x,bytesPerRow:v,rowsPerImage:Math.ceil(p/s.height)},{width:Math.ceil(f/s.width)*s.width,height:Math.ceil(p/s.height)*s.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===ee.BC1RGBAUnorm||e===ee.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===ee.BC2RGBAUnorm||e===ee.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ee.BC3RGBAUnorm||e===ee.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ee.BC4RUnorm||e===ee.BC4RSnorm)return{byteLength:8,width:4,height:4};if(e===ee.BC5RGUnorm||e===ee.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===ee.BC6HRGBUFloat||e===ee.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===ee.BC7RGBAUnorm||e===ee.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ee.ETC2RGB8Unorm||e===ee.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===ee.ETC2RGB8A1Unorm||e===ee.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===ee.ETC2RGBA8Unorm||e===ee.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===ee.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===ee.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===ee.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===ee.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===ee.ASTC4x4Unorm||e===ee.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===ee.ASTC5x4Unorm||e===ee.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===ee.ASTC5x5Unorm||e===ee.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===ee.ASTC6x5Unorm||e===ee.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===ee.ASTC6x6Unorm||e===ee.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===ee.ASTC8x5Unorm||e===ee.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===ee.ASTC8x6Unorm||e===ee.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===ee.ASTC8x8Unorm||e===ee.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===ee.ASTC10x5Unorm||e===ee.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===ee.ASTC10x6Unorm||e===ee.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===ee.ASTC10x8Unorm||e===ee.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===ee.ASTC10x10Unorm||e===ee.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===ee.ASTC12x10Unorm||e===ee.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===ee.ASTC12x12Unorm||e===ee.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let t=Rp.ClampToEdge;return e===lf?t=Rp.Repeat:e===af&&(t=Rp.MirrorRepeat),t}_convertFilterMode(e){let t=Ca.Linear;return(e===qi||e===gx||e===EA)&&(t=Ca.Nearest),t}_getBytesPerTexel(e){if(e===ee.R8Unorm||e===ee.R8Snorm||e===ee.R8Uint||e===ee.R8Sint)return 1;if(e===ee.R16Uint||e===ee.R16Sint||e===ee.R16Float||e===ee.RG8Unorm||e===ee.RG8Snorm||e===ee.RG8Uint||e===ee.RG8Sint)return 2;if(e===ee.R32Uint||e===ee.R32Sint||e===ee.R32Float||e===ee.RG16Uint||e===ee.RG16Sint||e===ee.RG16Float||e===ee.RGBA8Unorm||e===ee.RGBA8UnormSRGB||e===ee.RGBA8Snorm||e===ee.RGBA8Uint||e===ee.RGBA8Sint||e===ee.BGRA8Unorm||e===ee.BGRA8UnormSRGB||e===ee.RGB9E5UFloat||e===ee.RGB10A2Unorm||e===ee.RG11B10UFloat||e===ee.Depth32Float||e===ee.Depth24Plus||e===ee.Depth24PlusStencil8||e===ee.Depth32FloatStencil8)return 4;if(e===ee.RG32Uint||e===ee.RG32Sint||e===ee.RG32Float||e===ee.RGBA16Uint||e===ee.RGBA16Sint||e===ee.RGBA16Float)return 8;if(e===ee.RGBA32Uint||e===ee.RGBA32Sint||e===ee.RGBA32Float)return 16}_getTypedArrayType(e){if(e===ee.R8Uint)return Uint8Array;if(e===ee.R8Sint)return Int8Array;if(e===ee.R8Unorm)return Uint8Array;if(e===ee.R8Snorm)return Int8Array;if(e===ee.RG8Uint)return Uint8Array;if(e===ee.RG8Sint)return Int8Array;if(e===ee.RG8Unorm)return Uint8Array;if(e===ee.RG8Snorm)return Int8Array;if(e===ee.RGBA8Uint)return Uint8Array;if(e===ee.RGBA8Sint)return Int8Array;if(e===ee.RGBA8Unorm||e===ee.RGBA8UnormSRGB)return Uint8Array;if(e===ee.RGBA8Snorm)return Int8Array;if(e===ee.R16Uint)return Uint16Array;if(e===ee.R16Sint)return Int16Array;if(e===ee.RG16Uint)return Uint16Array;if(e===ee.RG16Sint)return Int16Array;if(e===ee.RGBA16Uint)return Uint16Array;if(e===ee.RGBA16Sint)return Int16Array;if(e===ee.R16Float||e===ee.RG16Float||e===ee.RGBA16Float)return Uint16Array;if(e===ee.R32Uint)return Uint32Array;if(e===ee.R32Sint)return Int32Array;if(e===ee.R32Float)return Float32Array;if(e===ee.RG32Uint)return Uint32Array;if(e===ee.RG32Sint)return Int32Array;if(e===ee.RG32Float)return Float32Array;if(e===ee.RGBA32Uint)return Uint32Array;if(e===ee.RGBA32Sint)return Int32Array;if(e===ee.RGBA32Float)return Float32Array;if(e===ee.BGRA8Unorm||e===ee.BGRA8UnormSRGB)return Uint8Array;if(e===ee.RGB10A2Unorm||e===ee.RGB9E5UFloat||e===ee.RG11B10UFloat)return Uint32Array;if(e===ee.Depth32Float)return Float32Array;if(e===ee.Depth24Plus||e===ee.Depth24PlusStencil8)return Uint32Array;if(e===ee.Depth32FloatStencil8)return Float32Array}_getDimension(e){let t;return e.is3DTexture||e.isData3DTexture?t=xb.ThreeD:t=xb.TwoD,t}}function Ng(n,e=null){const t=n.format,r=n.type,i=n.colorSpace,s=Sn.getTransfer(i);let o;if(n.isCompressedTexture===!0||n.isCompressedArrayTexture===!0)switch(t){case b0:case x0:o=s===ft?ee.BC1RGBAUnormSRGB:ee.BC1RGBAUnorm;break;case T0:o=s===ft?ee.BC2RGBAUnormSRGB:ee.BC2RGBAUnorm;break;case w0:o=s===ft?ee.BC3RGBAUnormSRGB:ee.BC3RGBAUnorm;break;case mm:o=ee.BC4RUnorm;break;case gm:o=ee.BC4RSnorm;break;case K0:o=ee.BC5RGUnorm;break;case ym:o=ee.BC5RGSnorm;break;case pm:o=s===ft?ee.BC7RGBAUnormSRGB:ee.BC7RGBAUnorm;break;case Yp:case Xp:o=s===ft?ee.ETC2RGB8UnormSRGB:ee.ETC2RGB8Unorm;break;case Kp:o=s===ft?ee.ETC2RGBA8UnormSRGB:ee.ETC2RGBA8Unorm;break;case Zp:o=ee.EACR11Unorm;break;case Jp:o=ee.EACR11Snorm;break;case Y0:o=ee.EACRG11Unorm;break;case em:o=ee.EACRG11Snorm;break;case tm:o=s===ft?ee.ASTC4x4UnormSRGB:ee.ASTC4x4Unorm;break;case nm:o=s===ft?ee.ASTC5x4UnormSRGB:ee.ASTC5x4Unorm;break;case rm:o=s===ft?ee.ASTC5x5UnormSRGB:ee.ASTC5x5Unorm;break;case im:o=s===ft?ee.ASTC6x5UnormSRGB:ee.ASTC6x5Unorm;break;case sm:o=s===ft?ee.ASTC6x6UnormSRGB:ee.ASTC6x6Unorm;break;case om:o=s===ft?ee.ASTC8x5UnormSRGB:ee.ASTC8x5Unorm;break;case am:o=s===ft?ee.ASTC8x6UnormSRGB:ee.ASTC8x6Unorm;break;case lm:o=s===ft?ee.ASTC8x8UnormSRGB:ee.ASTC8x8Unorm;break;case um:o=s===ft?ee.ASTC10x5UnormSRGB:ee.ASTC10x5Unorm;break;case Am:o=s===ft?ee.ASTC10x6UnormSRGB:ee.ASTC10x6Unorm;break;case cm:o=s===ft?ee.ASTC10x8UnormSRGB:ee.ASTC10x8Unorm;break;case hm:o=s===ft?ee.ASTC10x10UnormSRGB:ee.ASTC10x10Unorm;break;case fm:o=s===ft?ee.ASTC12x10UnormSRGB:ee.ASTC12x10Unorm;break;case dm:o=s===ft?ee.ASTC12x12UnormSRGB:ee.ASTC12x12Unorm;break;case zi:o=s===ft?ee.RGBA8UnormSRGB:ee.RGBA8Unorm;break;default:Be("WebGPURenderer: Unsupported texture format.",t)}else switch(t){case zi:switch(r){case cA:o=ee.RGBA8Snorm;break;case hA:o=ee.RGBA16Sint;break;case Ll:o=ee.RGBA16Uint;break;case Un:o=ee.RGBA32Uint;break;case wr:o=ee.RGBA32Sint;break;case ii:o=s===ft?ee.RGBA8UnormSRGB:ee.RGBA8Unorm;break;case or:o=ee.RGBA16Float;break;case yi:o=ee.RGBA32Float;break;default:Be("WebGPURenderer: Unsupported texture type with RGBAFormat.",r)}break;case n1:switch(r){case $x:o=ee.RGB9E5UFloat;break;case Hx:o=ee.RG11B10UFloat;break;default:Be("WebGPURenderer: Unsupported texture type with RGBFormat.",r)}break;case r1:switch(r){case cA:o=ee.R8Snorm;break;case hA:o=ee.R16Sint;break;case Ll:o=ee.R16Uint;break;case Un:o=ee.R32Uint;break;case wr:o=ee.R32Sint;break;case ii:o=ee.R8Unorm;break;case or:o=ee.R16Float;break;case yi:o=ee.R32Float;break;default:Be("WebGPURenderer: Unsupported texture type with RedFormat.",r)}break;case Qs:switch(r){case cA:o=ee.RG8Snorm;break;case hA:o=ee.RG16Sint;break;case Ll:o=ee.RG16Uint;break;case Un:o=ee.RG32Uint;break;case wr:o=ee.RG32Sint;break;case ii:o=ee.RG8Unorm;break;case or:o=ee.RG16Float;break;case yi:o=ee.RG32Float;break;default:Be("WebGPURenderer: Unsupported texture type with RGFormat.",r)}break;case Ho:switch(r){case Ll:o=ee.Depth16Unorm;break;case Un:o=ee.Depth24Plus;break;case yi:o=ee.Depth32Float;break;default:Be("WebGPURenderer: Unsupported texture type with DepthFormat.",r)}break;case $o:switch(r){case jo:o=ee.Depth24PlusStencil8;break;case yi:e&&e.features.has(Cg.Depth32FloatStencil8)===!1&&Be('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),o=ee.Depth32FloatStencil8;break;default:Be("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",r)}break;case i1:switch(r){case wr:o=ee.R32Sint;break;case Un:o=ee.R32Uint;break;default:Be("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",r)}break;case s1:switch(r){case wr:o=ee.RG32Sint;break;case Un:o=ee.RG32Uint;break;default:Be("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",r)}break;case o1:switch(r){case wr:o=ee.RGBA32Sint;break;case Un:o=ee.RGBA32Uint;break;default:Be("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",r)}break;default:Be("WebGPURenderer: Unsupported texture format.",t)}return o}const UH=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,qH=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,wb={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_2d_array:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_depth_cube:"depthTexture",texture_depth_cube_array:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},GH=n=>{n=n.trim();const e=n.match(UH);if(e!==null&&e.length===4){const t=e[2],r=[];let i=null;for(;(i=qH.exec(t))!==null;)r.push({name:i[1],type:i[2]});const s=[];for(let p=0;p<r.length;p++){const{name:g,type:v}=r[p];let x=v;x.startsWith("ptr")?x="pointer":(x.startsWith("texture")&&(x=v.split("<")[0]),x=wb[x]),s.push(new oy(x,g))}const o=n.substring(e[0].length),a=e[3]||"void",c=e[1]!==void 0?e[1]:"";return{type:wb[a]||a,inputs:s,name:c,inputsCode:t,blockCode:o,outputType:a}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class VH extends ly{constructor(e){const{type:t,inputs:r,name:i,inputsCode:s,blockCode:o,outputType:a}=GH(e);super(t,r,i),this.inputsCode=s,this.blockCode=o,this.outputType=a}getCode(e=this.name){const t=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class zH extends Z5{parseFunction(e){return new VH(e)}}const jH={[ar.READ_ONLY]:"read",[ar.WRITE_ONLY]:"write",[ar.READ_WRITE]:"read_write"},Sb={[lf]:"repeat",[SA]:"clamp",[af]:"mirror"},s0={vertex:Ua.VERTEX,fragment:Ua.FRAGMENT,compute:Ua.COMPUTE},Eb={instance:!0,swizzleAssign:!1,storageBuffer:!0},$H={"^^":"tsl_xor"},HH={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},Rb={},Xu={tsl_xor:new Zn("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new Zn("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new Zn("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new Zn("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new Zn("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new Zn("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new Zn("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new Zn("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new Zn("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new Zn("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new Zn("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new Zn("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new Zn(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},WH={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>",floatpack_snorm_2x16:"pack2x16snorm",floatpack_unorm_2x16:"pack2x16unorm",floatpack_float16_2x16:"pack2x16float",floatunpack_snorm_2x16:"unpack2x16snorm",floatunpack_unorm_2x16:"unpack2x16unorm",floatunpack_float16_2x16:"unpack2x16float"};let uS="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(uS+=`diagnostic( off, derivative_uniformity );
`);class QH extends K5{constructor(e,t){super(e,t,new zH),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}_generateTextureSample(e,t,r,i,s,o=this.shaderStage){return o==="fragment"?i?s?`textureSample( ${t}, ${t}_sampler, ${r}, ${i}, ${s} )`:`textureSample( ${t}, ${t}_sampler, ${r}, ${i} )`:s?`textureSample( ${t}, ${t}_sampler, ${r}, ${s} )`:`textureSample( ${t}, ${t}_sampler, ${r} )`:this.generateTextureSampleLevel(e,t,r,"0",i)}generateTextureSampleLevel(e,t,r,i,s,o){return this.isUnfilterable(e)===!1?o?`textureSampleLevel( ${t}, ${t}_sampler, ${r}, ${i}, ${o} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${r}, ${i} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,r,o,i):this.generateTextureLod(e,t,r,s,o,i)}generateWrapFunction(e){const t=`tsl_coord_${Sb[e.wrapS]}S_${Sb[e.wrapT]}_${e.is3DTexture||e.isData3DTexture?"3d":"2d"}T`;let r=Rb[t];if(r===void 0){const i=[],s=e.is3DTexture||e.isData3DTexture?"vec3f":"vec2f";let o=`fn ${t}( coord : ${s} ) -> ${s} {

	return ${s}(
`;const a=(c,f)=>{c===lf?(i.push(Xu.repeatWrapping_float),o+=`		tsl_repeatWrapping_float( coord.${f} )`):c===SA?(i.push(Xu.clampWrapping_float),o+=`		tsl_clampWrapping_float( coord.${f} )`):c===af?(i.push(Xu.mirrorWrapping_float),o+=`		tsl_mirrorWrapping_float( coord.${f} )`):(o+=`		coord.${f}`,De(`WebGPURenderer: Unsupported texture wrap type "${c}" for vertex shader.`))};a(e.wrapS,"x"),o+=`,
`,a(e.wrapT,"y"),(e.is3DTexture||e.isData3DTexture)&&(o+=`,
`,a(e.wrapR,"z")),o+=`
	);

}
`,Rb[t]=r=new Zn(o,i)}return r.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,r){const i=this.getDataFromNode(e,this.shaderStage,this.globalCache);i.dimensionsSnippet===void 0&&(i.dimensionsSnippet={});let s=i.dimensionsSnippet[r];if(i.dimensionsSnippet[r]===void 0){let o,a;const{primarySamples:c}=this.renderer.backend.utils.getTextureSampleData(e),f=c>1;e.is3DTexture||e.isData3DTexture?a="vec3<u32>":a="vec2<u32>",f||e.isStorageTexture?o=t:o=`${t}${r?`, u32( ${r} )`:""}`,s=new F0(new I0(`textureDimensions( ${o} )`,a)),i.dimensionsSnippet[r]=s,(e.isArrayTexture||e.isDataArrayTexture||e.is3DTexture||e.isData3DTexture)&&(i.arrayLayerCount=new F0(new I0(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(i.cubeFaceCount=new F0(new I0("6u","u32")))}return s.build(this)}generateFilteredTexture(e,t,r,i,s="0u"){this._include("biquadraticTexture");const o=this.generateWrapFunction(e),a=this.generateTextureDimension(e,t,s);return i&&(r=`${r} + vec2<f32>(${i}) / ${a}`),`tsl_biquadraticTexture( ${t}, ${o}( ${r} ), ${a}, u32( ${s} ) )`}generateTextureLod(e,t,r,i,s,o="0u"){const a=this.generateWrapFunction(e),c=this.generateTextureDimension(e,t,o),f=e.is3DTexture||e.isData3DTexture?"vec3":"vec2";s&&(r=`${r} + ${f}<f32>(${s}) / ${f}<f32>( ${c} )`);const p=`${f}<u32>( ${a}( ${r} ) * ${f}<f32>( ${c} ) )`;return this.generateTextureLoad(e,t,p,o,i,null)}generateTextureLoad(e,t,r,i,s,o){i===null&&(i="0u"),o&&(r=`${r} + ${o}`);let a;return s?a=`textureLoad( ${t}, ${r}, ${s}, u32( ${i} ) )`:(a=`textureLoad( ${t}, ${r}, u32( ${i} ) )`,this.renderer.backend.compatibilityMode&&e.isDepthTexture&&(a+=".x")),a}generateTextureStore(e,t,r,i,s){let o;return i?o=`textureStore( ${t}, ${r}, ${i}, ${s} )`:o=`textureStore( ${t}, ${r}, ${s} )`,o}isSampleCompare(e){return e.isDepthTexture===!0&&e.compareFunction!==null}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===yi||this.isSampleCompare(e)===!1&&e.minFilter===qi&&e.magFilter===qi||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,r,i,s,o=this.shaderStage){let a=null;return this.isUnfilterable(e)?a=this.generateTextureLod(e,t,r,i,s,"0",o):a=this._generateTextureSample(e,t,r,i,s,o),a}generateTextureGrad(e,t,r,i,s,o,a=this.shaderStage){if(a==="fragment")return o?`textureSampleGrad( ${t}, ${t}_sampler, ${r},  ${i[0]}, ${i[1]}, ${o} )`:`textureSampleGrad( ${t}, ${t}_sampler, ${r},  ${i[0]}, ${i[1]} )`;Be(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${a} shader.`)}generateTextureCompare(e,t,r,i,s,o,a=this.shaderStage){if(a==="fragment")return e.isDepthTexture===!0&&e.isArrayTexture===!0?o?`textureSampleCompare( ${t}, ${t}_sampler, ${r}, ${s}, ${i}, ${o} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${r}, ${s}, ${i} )`:o?`textureSampleCompare( ${t}, ${t}_sampler, ${r}, ${i}, ${o} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${r}, ${i} )`;Be(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${a} shader.`)}generateTextureLevel(e,t,r,i,s,o){return this.isUnfilterable(e)===!1?o?`textureSampleLevel( ${t}, ${t}_sampler, ${r}, ${i}, ${o} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${r}, ${i} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,r,o,i):this.generateTextureLod(e,t,r,s,o,i)}generateTextureBias(e,t,r,i,s,o,a=this.shaderStage){if(a==="fragment")return o?`textureSampleBias( ${t}, ${t}_sampler, ${r}, ${i}, ${o} )`:`textureSampleBias( ${t}, ${t}_sampler, ${r}, ${i} )`;Be(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${a} shader.`)}getPropertyName(e,t=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(t==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const r=e.name,i=e.type;return i==="texture"||i==="cubeTexture"||i==="cubeDepthTexture"||i==="storageTexture"||i==="texture3D"?r:i==="buffer"||i==="storageBuffer"||i==="indirectStorageBuffer"?this.isCustomStruct(e)?r:r+".value":e.groupNode.name+"."+r}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=$H[e];return t!==void 0?(this._include(t),t):null}getNodeAccess(e,t){return t!=="compute"?e.isAtomic===!0?(De("WebGPURenderer: Atomic operations are only supported in compute shaders."),ar.READ_WRITE):ar.READ_ONLY:e.access}getStorageAccess(e,t){return jH[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,r,i=null){const s=super.getUniformFromNode(e,t,r,i),o=this.getDataFromNode(e,r,this.globalCache);if(o.uniformGPU===void 0){let a;const c=e.groupNode,f=c.name,p=this.getBindGroupArray(f,r);if(t==="texture"||t==="cubeTexture"||t==="cubeDepthTexture"||t==="storageTexture"||t==="texture3D"){let g=null;const v=this.getNodeAccess(e,r);if(t==="texture"||t==="storageTexture"?e.value.is3DTexture===!0?g=new Rg(s.name,s.node,c,v):g=new Wf(s.name,s.node,c,v):t==="cubeTexture"||t==="cubeDepthTexture"?g=new oS(s.name,s.node,c,v):t==="texture3D"&&(g=new Rg(s.name,s.node,c,v)),g.store=e.isStorageTextureNode===!0,g.mipLevel=g.store?e.mipLevel:0,g.setVisibility(s0[r]),this.isUnfilterable(e.value)===!1&&g.store===!1){const x=new PH(`${s.name}_sampler`,s.node,c);x.setVisibility(s0[r]),p.push(x,g),a=[x,g]}else p.push(g),a=[g]}else if(t==="buffer"||t==="storageBuffer"||t==="indirectStorageBuffer"){const g=this.getSharedDataFromNode(e);let v=g.buffer;if(v===void 0){const x=t==="buffer"?rS:LH;v=new x(e,c),g.buffer=v}v.setVisibility(v.getVisibility()|s0[r]),p.push(v),a=v,s.name=i||"NodeBuffer_"+s.id}else{const g=this.uniformGroups[r]||(this.uniformGroups[r]={});let v=g[f];v===void 0&&(v=new iS(f,c),v.setVisibility(s0[r]),g[f]=v,p.push(v)),a=this.getNodeUniform(s,t),v.addUniform(a)}o.uniformGPU=a}return s}getBuiltin(e,t,r,i=this.shaderStage){const s=this.builtins[i]||(this.builtins[i]=new Map);return s.has(e)===!1&&s.set(e,{name:e,property:t,type:r}),t}hasBuiltin(e,t=this.shaderStage){return this.builtins[t]!==void 0&&this.builtins[t].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,r=this.flowShaderNode(e),i=[];for(const o of t.inputs)i.push(o.name+" : "+this.getType(o.type));let s=`fn ${t.name}( ${i.join(", ")} ) -> ${this.getType(t.type)} {
${r.vars}
${r.code}
`;return r.result&&(s+=`	return ${r.result};
`),s+=`
}
`,s}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],r=this.directives[e];if(r!==void 0)for(const i of r)t.push(`enable ${i};`);return t.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],r=this.builtins[e];if(r!==void 0)for(const{name:i,property:s,type:o}of r.values())t.push(`@builtin( ${i} ) ${s} : ${o}`);return t.join(`,
	`)}getScopedArray(e,t,r,i){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:r,bufferCount:i}),e}getScopedArrays(e){if(e!=="compute")return;const t=[];for(const{name:r,scope:i,bufferType:s,bufferCount:o}of this.scopedArrays.values()){const a=this.getType(s);t.push(`var<${i}> ${r}: array< ${a}, ${o} >;`)}return t.join(`
`)}getAttributes(e){const t=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const r=this.getBuiltins("attribute");r&&t.push(r);const i=this.getAttributesArray();for(let s=0,o=i.length;s<o;s++){const a=i[s],c=a.name,f=this.getType(a.type);t.push(`@location( ${s} ) ${c} : ${f}`)}}return t.join(`,
	`)}getStructMembers(e){const t=[];for(const r of e.members){const i=e.output?"@location( "+r.index+" ) ":"";let s=this.getType(r.type);r.atomic&&(s="atomic< "+s+" >"),t.push(`	${i+r.name} : ${s}`)}return e.output&&t.push(`	${this.getBuiltins("output")}`),t.join(`,
`)}getStructs(e){let t="";const r=this.structs[e];if(r.length>0){const i=[];for(const s of r){let o=`struct ${s.name} {
`;o+=this.getStructMembers(s),o+=`
};`,i.push(o)}t=`
`+i.join(`

`)+`
`}return t}getVar(e,t,r=null){let i=`var ${t} : `;return r!==null?i+=this.generateArrayDeclaration(e,r):i+=this.getType(e),i}getVars(e){const t=[],r=this.vars[e];if(r!==void 0)for(const i of r)t.push(`	${this.getVar(i.type,i.name,i.count)};`);return`
${t.join(`
`)}
`}getVaryings(e){const t=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const s=this.varyings,o=this.vars[e];for(let a=0;a<s.length;a++){const c=s[a];if(c.needsInterpolation){let f=`@location( ${a} )`;if(c.interpolationType){const p=c.interpolationSampling!==null?`, ${c.interpolationSampling} )`:" )";f+=` @interpolate( ${c.interpolationType}${p}`}else/^(int|uint|ivec|uvec)/.test(c.type)&&(f+=` @interpolate( ${this.renderer.backend.compatibilityMode?"flat, either":"flat"} )`);t.push(`${f} ${c.name} : ${this.getType(c.type)}`)}else e==="vertex"&&o.includes(c)===!1&&o.push(c)}}const r=this.getBuiltins(e);r&&t.push(r);const i=t.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+i):i}isCustomStruct(e){const t=e.value,r=e.node,i=(t.isBufferAttribute||t.isInstancedBufferAttribute)&&r.structTypeNode!==null,s=r.value&&r.value.array&&typeof r.value.itemSize=="number"&&r.value.array.length>r.value.itemSize;return i&&!s}getUniforms(e){const t=this.uniforms[e],r=[],i=[],s=[],o={};for(const c of t){const f=c.groupNode.name,p=this.bindingsIndexes[f];if(c.type==="texture"||c.type==="cubeTexture"||c.type==="cubeDepthTexture"||c.type==="storageTexture"||c.type==="texture3D"){const g=c.node.value;this.isUnfilterable(g)===!1&&c.node.isStorageTextureNode!==!0&&(this.isSampleCompare(g)?r.push(`@binding( ${p.binding++} ) @group( ${p.group} ) var ${c.name}_sampler : sampler_comparison;`):r.push(`@binding( ${p.binding++} ) @group( ${p.group} ) var ${c.name}_sampler : sampler;`));let v,x="";const{primarySamples:T}=this.renderer.backend.utils.getTextureSampleData(g);if(T>1&&(x="_multisampled"),g.isCubeTexture===!0&&g.isDepthTexture===!0)v="texture_depth_cube";else if(g.isCubeTexture===!0)v="texture_cube<f32>";else if(g.isDepthTexture===!0)this.renderer.backend.compatibilityMode&&g.compareFunction===null?v=`texture${x}_2d<f32>`:v=`texture_depth${x}_2d${g.isArrayTexture===!0?"_array":""}`;else if(c.node.isStorageTextureNode===!0){const S=Ng(g),E=this.getStorageAccess(c.node,e),N=c.node.value.is3DTexture,P=c.node.value.isArrayTexture;v=`texture_storage_${N?"3d":`2d${P?"_array":""}`}<${S}, ${E}>`}else if(g.isArrayTexture===!0||g.isDataArrayTexture===!0||g.isCompressedArrayTexture===!0)v="texture_2d_array<f32>";else if(g.is3DTexture===!0||g.isData3DTexture===!0)v="texture_3d<f32>";else{const S=this.getComponentTypeFromTexture(g).charAt(0);v=`texture${x}_2d<${S}32>`}r.push(`@binding( ${p.binding++} ) @group( ${p.group} ) var ${c.name} : ${v};`)}else if(c.type==="buffer"||c.type==="storageBuffer"||c.type==="indirectStorageBuffer"){const g=c.node,v=this.getType(g.getNodeType(this)),x=g.bufferCount,T=x>0&&c.type==="buffer"?", "+x:"",S=g.isStorageBufferNode?`storage, ${this.getStorageAccess(g,e)}`:"uniform";if(this.isCustomStruct(c))i.push(`@binding( ${p.binding++} ) @group( ${p.group} ) var<${S}> ${c.name} : ${v};`);else{const N=`	value : array< ${g.isAtomic?`atomic<${v}>`:`${v}`}${T} >`;i.push(this._getWGSLStructBinding(c.name,N,S,p.binding++,p.group))}}else{const g=this.getType(this.getVectorType(c.type)),v=c.groupNode.name;(o[v]||(o[v]={index:p.binding++,id:p.group,snippets:[]})).snippets.push(`	${c.name} : ${g}`)}}for(const c in o){const f=o[c];s.push(this._getWGSLStructBinding(c,f.snippets.join(`,
`),"uniform",f.index,f.id))}return[...r,...i,...s].join(`
`)}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const r=e[t];r.uniforms=this.getUniforms(t),r.attributes=this.getAttributes(t),r.varyings=this.getVaryings(t),r.structs=this.getStructs(t),r.vars=this.getVars(t),r.codes=this.getCodes(t),r.directives=this.getDirectives(t),r.scopedArrays=this.getScopedArrays(t);let i=`// code

`;i+=this.flowCode[t];const s=this.flowNodes[t],o=s[s.length-1],a=o.outputNode,c=a!==void 0&&a.isOutputStructNode===!0;for(const f of s){const p=this.getFlowData(f),g=f.name;if(g&&(i.length>0&&(i+=`
`),i+=`	// flow -> ${g}
`),i+=`${p.code}
	`,f===o&&t!=="compute"){if(i+=`// result

	`,t==="vertex")i+=`varyings.Vertex = ${p.result};`;else if(t==="fragment")if(c)r.returnType=a.getNodeType(this),r.structs+="var<private> output : "+r.returnType+";",i+=`return ${p.result};`;else{let v="	@location(0) color: vec4<f32>";const x=this.getBuiltins("output");x&&(v+=`,
	`+x),r.returnType="OutputStruct",r.structs+=this._getWGSLStruct("OutputStruct",v),r.structs+=`
var<private> output : OutputStruct;`,i+=`output.color = ${p.result};

	return output;`}}}r.flow=i}if(this.shaderStage=null,this.material!==null)this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment);else{const t=this.object.workgroupSize;this.computeShader=this._getWGSLComputeCode(e.compute,t)}}getMethod(e,t=null){let r;return t!==null&&(r=this._getWGSLMethod(e+"_"+t)),r===void 0&&(r=this._getWGSLMethod(e)),r||e}getBitcastMethod(e){return`bitcast<${this.getType(e)}>`}getFloatPackingMethod(e){return this.getMethod(`floatpack_${e}_2x16`)}getFloatUnpackingMethod(e){return this.getMethod(`floatunpack_${e}_2x16`)}getTernary(e,t,r){return`select( ${r}, ${t}, ${e} )`}getType(e){return HH[e]||e}isAvailable(e){let t=Eb[e];return t===void 0&&(e==="float32Filterable"?t=this.renderer.hasFeature("float32-filterable"):e==="clipDistance"&&(t=this.renderer.hasFeature("clip-distances")),Eb[e]=t),t}_getWGSLMethod(e){return Xu[e]!==void 0&&this._include(e),WH[e]}_include(e){const t=Xu[e];return t.build(this),this.addInclude(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${uS}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,t){const[r,i,s]=t;return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${r}, ${i}, ${s} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = globalId.x
		+ globalId.y * ( ${r} * numWorkgroups.x )
		+ globalId.z * ( ${r} * numWorkgroups.x ) * ( ${i} * numWorkgroups.y );

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,t){return`
struct ${e} {
${t}
};`}_getWGSLStructBinding(e,t,r,i=0,s=0){const o=e+"Struct";return`${this._getWGSLStruct(o,t)}
@binding( ${i} ) @group( ${s} )
var<${r}> ${e} : ${o};`}}class XH{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return e.depthTexture!==null?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=ee.Depth24PlusStencil8:e.depth&&(t=ee.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const s=this.backend.renderer,o=s.getRenderTarget();t=o?o.samples:s.currentSamples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const r=t>1&&e.renderTarget!==null&&e.isDepthTexture!==!0&&e.isFramebufferTexture!==!0;return{samples:t,primarySamples:r?1:t,isMSAA:r}}getCurrentColorFormat(e){let t;return e.textures!==null?t=this.getTextureFormatGPU(e.textures[0]):t=this.getPreferredCanvasFormat(),t}getCurrentColorFormats(e){return e.textures!==null?e.textures.map(t=>this.getTextureFormatGPU(t)):[this.getPreferredCanvasFormat()]}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){if(e.isPoints)return Gl.PointList;if(e.isLineSegments||e.isMesh&&t.wireframe===!0)return Gl.LineList;if(e.isLine)return Gl.LineStrip;if(e.isMesh)return Gl.TriangleList}getSampleCount(e){return e>=4?4:1}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.currentSamples)}getPreferredCanvasFormat(){const t=this.backend.parameters.outputType;if(t===void 0)return navigator.gpu.getPreferredCanvasFormat();if(t===ii)return ee.BGRA8Unorm;if(t===or)return ee.RGBA16Float;throw new Error("Unsupported output buffer type.")}}const AS=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]);typeof Float16Array<"u"&&AS.set(Float16Array,["float16"]);const YH=new Map([[Kx,["float16"]]]),KH=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class ZH{constructor(e){this.backend=e}createAttribute(e,t){const r=this._getBufferAttribute(e),i=this.backend,s=i.get(r);let o=s.buffer;if(o===void 0){const a=i.device;let c=r.array;if(e.normalized===!1){if(c.constructor===Int16Array||c.constructor===Int8Array)c=new Int32Array(c);else if((c.constructor===Uint16Array||c.constructor===Uint8Array)&&(c=new Uint32Array(c),t&GPUBufferUsage.INDEX))for(let g=0;g<c.length;g++)c[g]===65535&&(c[g]=4294967295)}if(r.array=c,(r.isStorageBufferAttribute||r.isStorageInstancedBufferAttribute)&&r.itemSize===3){c=new c.constructor(r.count*4);for(let g=0;g<r.count;g++)c.set(r.array.subarray(g*3,g*3+3),g*4);r.itemSize=4,r.array=c,s._force3to4BytesAlignment=!0}const f=c.byteLength,p=f+(4-f%4)%4;o=a.createBuffer({label:r.name,size:p,usage:t,mappedAtCreation:!0}),new c.constructor(o.getMappedRange()).set(c),o.unmap(),s.buffer=o}}updateAttribute(e){const t=this._getBufferAttribute(e),r=this.backend,i=r.device,s=r.get(t),o=r.get(t).buffer;let a=t.array;if(s._force3to4BytesAlignment===!0){a=new a.constructor(t.count*4);for(let f=0;f<t.count;f++)a.set(t.array.subarray(f*3,f*3+3),f*4);t.array=a}const c=t.updateRanges;if(c.length===0)i.queue.writeBuffer(o,0,a,0);else{const f=H0(a),p=f?1:a.BYTES_PER_ELEMENT;for(let g=0,v=c.length;g<v;g++){const x=c[g];let T,S;if(s._force3to4BytesAlignment===!0){const N=Math.floor(x.start/3),P=Math.ceil(x.count/3);T=N*4*p,S=P*4*p}else T=x.start*p,S=x.count*p;const E=T*(f?a.BYTES_PER_ELEMENT:1);i.queue.writeBuffer(o,E,a,T,S)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),r=new Map;for(let i=0;i<t.length;i++){const s=t[i],o=s.array.BYTES_PER_ELEMENT,a=this._getBufferAttribute(s);let c=r.get(a);if(c===void 0){let g,v;s.isInterleavedBufferAttribute===!0?(g=s.data.stride*o,v=s.data.isInstancedInterleavedBuffer?i0.Instance:i0.Vertex):(g=s.itemSize*o,v=s.isInstancedBufferAttribute?i0.Instance:i0.Vertex),s.normalized===!1&&(s.array.constructor===Int16Array||s.array.constructor===Uint16Array)&&(g=4),c={arrayStride:g,attributes:[],stepMode:v},r.set(a,c)}const f=this._getVertexFormat(s),p=s.isInterleavedBufferAttribute===!0?s.offset*o:0;c.attributes.push({shaderLocation:i,offset:p,format:f})}return Array.from(r.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,r=t.device,s=t.get(this._getBufferAttribute(e)).buffer,o=s.size,a=r.createBuffer({label:`${e.name}_readback`,size:o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),c=r.createCommandEncoder({label:`readback_encoder_${e.name}`});c.copyBufferToBuffer(s,0,a,0,o);const f=c.finish();r.queue.submit([f]),await a.mapAsync(GPUMapMode.READ);const p=a.getMappedRange(),g=new e.array.constructor(p.slice(0));return a.unmap(),g.buffer}_getVertexFormat(e){const{itemSize:t,normalized:r}=e,i=e.array.constructor,s=e.constructor;let o;if(t===1)o=KH.get(i);else{const c=(YH.get(s)||AS.get(i))[r?1:0];if(c){const f=i.BYTES_PER_ELEMENT*t,g=Math.floor((f+3)/4)*4/i.BYTES_PER_ELEMENT;if(g%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");o=`${c}x${g}`}}return o||Be("WebGPUAttributeUtils: Vertex format not supported yet."),o}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class JH{constructor(e){this.layoutGPU=e,this.usedTimes=0}}class eW{constructor(e){this.backend=e,this._bindGroupLayoutCache=new Map}createBindingsLayout(e){const t=this.backend,r=t.device,i=t.get(e);if(i.layout)return i.layout.layoutGPU;const s=this._createLayoutEntries(e),o=JSON.stringify(s);let a=this._bindGroupLayoutCache.get(o);return a===void 0&&(a=new JH(r.createBindGroupLayout({entries:s})),this._bindGroupLayoutCache.set(o,a)),a.usedTimes++,i.layout=a,i.layoutKey=o,a.layoutGPU}createBindings(e,t,r,i=0){const{backend:s}=this,o=s.get(e),a=this.createBindingsLayout(e);let c;r>0&&(o.groups===void 0&&(o.groups=[],o.versions=[]),o.versions[r]===i&&(c=o.groups[r])),c===void 0&&(c=this.createBindGroup(e,a),r>0&&(o.groups[r]=c,o.versions[r]=i)),o.group=c}updateBinding(e){const t=this.backend,r=t.device,i=e.buffer,s=t.get(e).buffer,o=e.updateRanges;if(o.length===0)r.queue.writeBuffer(s,0,i,0);else{const a=H0(i),c=a?1:i.BYTES_PER_ELEMENT;for(let f=0,p=o.length;f<p;f++){const g=o[f],v=g.start*c,x=g.count*c,T=v*(a?i.BYTES_PER_ELEMENT:1);r.queue.writeBuffer(s,T,i,v,x)}e.clearUpdateRanges()}}createBindGroupIndex(e,t){const i=this.backend.device,s=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,o=e[0],a=i.createBuffer({label:"bindingCameraIndex_"+o,size:16,usage:s});i.queue.writeBuffer(a,0,e,0);const c=[{binding:0,resource:{buffer:a}}];return i.createBindGroup({label:"bindGroupCameraIndex_"+o,layout:t,entries:c})}createBindGroup(e,t){const r=this.backend,i=r.device;let s=0;const o=[];for(const a of e.bindings){if(a.isUniformBuffer){const c=r.get(a);if(c.buffer===void 0){const f=a.byteLength,p=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,g=[];a.visibility&Ua.VERTEX&&g.push("vertex"),a.visibility&Ua.FRAGMENT&&g.push("fragment"),a.visibility&Ua.COMPUTE&&g.push("compute");const v=`(${g.join(",")})`,x=i.createBuffer({label:`bindingBuffer${a.id}_${a.name}_${v}`,size:f,usage:p});c.buffer=x}o.push({binding:s,resource:{buffer:c.buffer}})}else if(a.isStorageBuffer){const c=r.get(a);if(c.buffer===void 0){const f=a.attribute;c.buffer=r.get(f).buffer}o.push({binding:s,resource:{buffer:c.buffer}})}else if(a.isSampledTexture){const c=r.get(a.texture);let f;if(c.externalTexture!==void 0)f=i.importExternalTexture({source:c.externalTexture});else{const p=a.store?1:c.texture.mipLevelCount,g=a.store?a.mipLevel:0;let v=`view-${c.texture.width}-${c.texture.height}`;if(c.texture.depthOrArrayLayers>1&&(v+=`-${c.texture.depthOrArrayLayers}`),v+=`-${p}-${g}`,f=c[v],f===void 0){const x=MH.All;let T;a.isSampledCubeTexture?T=kn.Cube:a.isSampledTexture3D?T=kn.ThreeD:a.texture.isArrayTexture||a.texture.isDataArrayTexture||a.texture.isCompressedArrayTexture?T=kn.TwoDArray:T=kn.TwoD,f=c[v]=c.texture.createView({aspect:x,dimension:T,mipLevelCount:p,baseMipLevel:g})}}o.push({binding:s,resource:f})}else if(a.isSampler){const c=r.get(a.texture);o.push({binding:s,resource:c.sampler})}s++}return i.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:o})}_createLayoutEntries(e){const t=[];let r=0;for(const i of e.bindings){const s=this.backend,o={binding:r,visibility:i.visibility};if(i.isUniformBuffer||i.isStorageBuffer){const a={};i.isStorageBuffer&&(i.visibility&Ua.COMPUTE&&(i.access===ar.READ_WRITE||i.access===ar.WRITE_ONLY)?a.type=Cp.Storage:a.type=Cp.ReadOnlyStorage),o.buffer=a}else if(i.isSampledTexture&&i.store){const a={};a.format=this.backend.get(i.texture).texture.format;const c=i.access;c===ar.READ_WRITE?a.access=Np.ReadWrite:c===ar.WRITE_ONLY?a.access=Np.WriteOnly:a.access=Np.ReadOnly,i.texture.isArrayTexture?a.viewDimension=kn.TwoDArray:i.texture.is3DTexture&&(a.viewDimension=kn.ThreeD),o.storageTexture=a}else if(i.isSampledTexture){const a={},{primarySamples:c}=s.utils.getTextureSampleData(i.texture);if(c>1&&(a.multisampled=!0,i.texture.isDepthTexture||(a.sampleType=ba.UnfilterableFloat)),i.texture.isDepthTexture)s.compatibilityMode&&i.texture.compareFunction===null?a.sampleType=ba.UnfilterableFloat:a.sampleType=ba.Depth;else if(i.texture.isDataTexture||i.texture.isDataArrayTexture||i.texture.isData3DTexture){const f=i.texture.type;f===wr?a.sampleType=ba.SInt:f===Un?a.sampleType=ba.UInt:f===yi&&(this.backend.hasFeature("float32-filterable")?a.sampleType=ba.Float:a.sampleType=ba.UnfilterableFloat)}i.isSampledCubeTexture?a.viewDimension=kn.Cube:i.texture.isArrayTexture||i.texture.isDataArrayTexture||i.texture.isCompressedArrayTexture?a.viewDimension=kn.TwoDArray:i.isSampledTexture3D&&(a.viewDimension=kn.ThreeD),o.texture=a}else if(i.isSampler){const a={};i.texture.isDepthTexture&&(i.texture.compareFunction!==null?a.type=bb.Comparison:s.compatibilityMode&&(a.type=bb.NonFiltering)),o.sampler=a}else Be(`WebGPUBindingUtils: Unsupported binding "${i}".`);t.push(o),r++}return t}deleteBindGroupData(e){const{backend:t}=this,r=t.get(e);r.layout&&(r.layout.usedTimes--,r.layout.usedTimes===0&&this._bindGroupLayoutCache.delete(r.layoutKey),r.layout=void 0,r.layoutKey=void 0)}dispose(){this._bindGroupLayoutCache.clear()}}class tW{constructor(e){this.backend=e,this._activePipelines=new WeakMap}setPipeline(e,t){this._activePipelines.get(e)!==t&&(e.setPipeline(t),this._activePipelines.set(e,t))}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:r,material:i,geometry:s,pipeline:o}=e,{vertexProgram:a,fragmentProgram:c}=o,f=this.backend,p=f.device,g=f.utils,v=f.get(o),x=[];for(const te of e.getBindings()){const oe=f.get(te),{layoutGPU:Y}=oe.layout;x.push(Y)}const T=f.attributeUtils.createShaderVertexBuffers(e);let S;i.blending!==Zl&&(i.blending!==Ys||i.transparent!==!1)&&(S=this._getBlending(i));let E={};i.stencilWrite===!0&&(E={compare:this._getStencilCompare(i),failOp:this._getStencilOperation(i.stencilFail),depthFailOp:this._getStencilOperation(i.stencilZFail),passOp:this._getStencilOperation(i.stencilZPass)});const N=this._getColorWriteMask(i),P=[];if(e.context.textures!==null){const te=e.context.textures;for(let oe=0;oe<te.length;oe++){const Y=g.getTextureFormatGPU(te[oe]);oe===0?P.push({format:Y,blend:S,writeMask:N}):P.push({format:Y,writeMask:N})}}else{const te=g.getCurrentColorFormat(e.context);P.push({format:te,blend:S,writeMask:N})}const B=f.get(a).module,L=f.get(c).module,k=this._getPrimitiveState(r,s,i),q=this._getDepthCompare(i),I=g.getCurrentDepthStencilFormat(e.context),U=this._getSampleCount(e.context),j={label:`renderPipeline_${i.name||i.type}_${i.id}`,vertex:Object.assign({},B,{buffers:T}),fragment:Object.assign({},L,{targets:P}),primitive:k,multisample:{count:U,alphaToCoverageEnabled:i.alphaToCoverage&&U>1},layout:p.createPipelineLayout({bindGroupLayouts:x})},J={},Q=e.context.depth,K=e.context.stencil;if((Q===!0||K===!0)&&(Q===!0&&(J.format=I,J.depthWriteEnabled=i.depthWrite,J.depthCompare=q),K===!0&&(J.stencilFront=E,J.stencilBack={},J.stencilReadMask=i.stencilFuncMask,J.stencilWriteMask=i.stencilWriteMask),i.polygonOffset===!0&&(J.depthBias=i.polygonOffsetUnits,J.depthBiasSlopeScale=i.polygonOffsetFactor,J.depthBiasClamp=0),j.depthStencil=J),p.pushErrorScope("validation"),t===null)v.pipeline=p.createRenderPipeline(j),p.popErrorScope().then(te=>{te!==null&&(v.error=!0,Be(te.message))});else{const te=new Promise(async oe=>{try{v.pipeline=await p.createRenderPipelineAsync(j)}catch{}const Y=await p.popErrorScope();Y!==null&&(v.error=!0,Be(Y.message)),oe()});t.push(te)}}createBundleEncoder(e,t="renderBundleEncoder"){const r=this.backend,{utils:i,device:s}=r,o=i.getCurrentDepthStencilFormat(e),a=i.getCurrentColorFormats(e),c=this._getSampleCount(e),f={label:t,colorFormats:a,depthStencilFormat:o,sampleCount:c};return s.createRenderBundleEncoder(f)}createComputePipeline(e,t){const r=this.backend,i=r.device,s=r.get(e.computeProgram).module,o=r.get(e),a=[];for(const c of t){const f=r.get(c),{layoutGPU:p}=f.layout;a.push(p)}o.pipeline=i.createComputePipeline({compute:s,layout:i.createPipelineLayout({bindGroupLayouts:a})})}_getBlending(e){let t,r;const i=e.blending,s=e.blendSrc,o=e.blendDst,a=e.blendEquation;if(i===AA){const c=e.blendSrcAlpha!==null?e.blendSrcAlpha:s,f=e.blendDstAlpha!==null?e.blendDstAlpha:o,p=e.blendEquationAlpha!==null?e.blendEquationAlpha:a;t={srcFactor:this._getBlendFactor(s),dstFactor:this._getBlendFactor(o),operation:this._getBlendOperation(a)},r={srcFactor:this._getBlendFactor(c),dstFactor:this._getBlendFactor(f),operation:this._getBlendOperation(p)}}else{const c=e.premultipliedAlpha,f=(p,g,v,x)=>{t={srcFactor:p,dstFactor:g,operation:va.Add},r={srcFactor:v,dstFactor:x,operation:va.Add}};if(c)switch(i){case Ys:f(Et.One,Et.OneMinusSrcAlpha,Et.One,Et.OneMinusSrcAlpha);break;case X0:f(Et.One,Et.One,Et.One,Et.One);break;case Q0:f(Et.Zero,Et.OneMinusSrc,Et.Zero,Et.One);break;case W0:f(Et.Dst,Et.OneMinusSrcAlpha,Et.Zero,Et.One);break}else switch(i){case Ys:f(Et.SrcAlpha,Et.OneMinusSrcAlpha,Et.One,Et.OneMinusSrcAlpha);break;case X0:f(Et.SrcAlpha,Et.One,Et.One,Et.One);break;case Q0:Be("WebGPURenderer: SubtractiveBlending requires material.premultipliedAlpha = true");break;case W0:Be("WebGPURenderer: MultiplyBlending requires material.premultipliedAlpha = true");break}}if(t!==void 0&&r!==void 0)return{color:t,alpha:r};Be("WebGPURenderer: Invalid blending: ",i)}_getBlendFactor(e){let t;switch(e){case Bo:t=Et.Zero;break;case Fx:t=Et.One;break;case Ox:t=Et.Src;break;case Mx:t=Et.OneMinusSrc;break;case Lx:t=Et.SrcAlpha;break;case Nx:t=Et.OneMinusSrcAlpha;break;case Bx:t=Et.Dst;break;case Cx:t=Et.OneMinusDst;break;case Px:t=Et.DstAlpha;break;case Rx:t=Et.OneMinusDstAlpha;break;case Dx:t=Et.SrcAlphaSaturated;break;case WU:t=Et.Constant;break;case QU:t=Et.OneMinusConstant;break;default:Be("WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const r=e.stencilFunc;switch(r){case EC:t=nr.Never;break;case SC:t=nr.Always;break;case wC:t=nr.Less;break;case TC:t=nr.LessEqual;break;case xC:t=nr.Equal;break;case bC:t=nr.GreaterEqual;break;case vC:t=nr.Greater;break;case _C:t=nr.NotEqual;break;default:Be("WebGPURenderer: Invalid stencil function.",r)}return t}_getStencilOperation(e){let t;switch(e){case LC:t=Co.Keep;break;case DC:t=Co.Zero;break;case BC:t=Co.Replace;break;case PC:t=Co.Invert;break;case MC:t=Co.IncrementClamp;break;case NC:t=Co.DecrementClamp;break;case CC:t=Co.IncrementWrap;break;case RC:t=Co.DecrementWrap;break;default:Be("WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case $s:t=va.Add;break;case Ex:t=va.Subtract;break;case Sx:t=va.ReverseSubtract;break;case FC:t=va.Min;break;case OC:t=va.Max;break;default:Be("WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,r){const i={},s=this.backend.utils;i.topology=s.getPrimitiveTopology(e,r),t.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(i.stripIndexFormat=t.index.array instanceof Uint16Array?cu.Uint16:cu.Uint32);let o=r.side===yr;return e.isMesh&&e.matrixWorld.determinant()<0&&(o=!o),i.frontFace=o===!0?yb.CW:yb.CCW,i.cullMode=r.side===xi?_b.None:_b.Back,i}_getColorWriteMask(e){return e.colorWrite===!0?vb.All:vb.None}_getDepthCompare(e){let t;if(e.depthTest===!1)t=nr.Always;else{const r=e.depthFunc;switch(r){case jx:t=nr.Never;break;case zx:t=nr.Always;break;case Vx:t=nr.Less;break;case Gx:t=nr.LessEqual;break;case qx:t=nr.Equal;break;case Ux:t=nr.GreaterEqual;break;case kx:t=nr.Greater;break;case Ix:t=nr.NotEqual;break;default:Be("WebGPUPipelineUtils: Invalid depth function.",r)}}return t}}class nW extends lS{constructor(e,t,r=2048){super(r),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const i=this.maxQueries*8;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:i,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return fn(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||this.currentQueryIndex===0||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if(this.resultBuffer.mapState!=="unmapped")return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,r=t*8;this.currentQueryIndex=0,this.queryOffsets.clear();const i=this.device.createCommandEncoder();i.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),i.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,r);const s=i.finish();if(this.device.queue.submit([s]),this.resultBuffer.mapState!=="unmapped")return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,r),this.isDisposed)return this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue;const o=new BigUint64Array(this.resultBuffer.getMappedRange(0,r)),a={},c=[];for(const[p,g]of e){const v=p.match(/^(.*):f(\d+)$/),x=parseInt(v[2]);c.includes(x)===!1&&c.push(x),a[x]===void 0&&(a[x]=0);const T=o[g],S=o[g+1],E=Number(S-T)/1e6;this.timestamps.set(p,E),a[x]+=E}const f=a[c[c.length-1]];return this.resultBuffer.unmap(),this.lastValue=f,this.frames=c,f}catch(e){return Be("Error resolving queries:",e),this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){Be("Error waiting for pending resolve:",e)}if(this.resultBuffer&&this.resultBuffer.mapState==="mapped")try{this.resultBuffer.unmap()}catch(e){Be("Error unmapping buffer:",e)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class rW extends aS{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.compatibilityMode=e.compatibilityMode===void 0?!1:e.compatibilityMode,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.compatibilityMode=this.parameters.compatibilityMode,this.device=null,this.defaultRenderPassdescriptor=null,this.utils=new XH(this),this.attributeUtils=new ZH(this),this.bindingUtils=new eW(this),this.pipelineUtils=new tW(this),this.textureUtils=new kH(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let r;if(t.device===void 0){const i={powerPreference:t.powerPreference,featureLevel:t.compatibilityMode?"compatibility":void 0},s=typeof navigator<"u"?await navigator.gpu.requestAdapter(i):null;if(s===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const o=Object.values(Cg),a=[];for(const f of o)s.features.has(f)&&a.push(f);const c={requiredFeatures:a,requiredLimits:t.requiredLimits};r=await s.requestDevice(c)}else r=t.device;r.lost.then(i=>{if(i.reason==="destroyed")return;const s={api:"WebGPU",message:i.message||"Unknown reason",reason:i.reason||null,originalEvent:i};e.onDeviceLost(s)}),this.device=r,this.trackTimestamp=this.trackTimestamp&&this.hasFeature(Cg.TimestampQuery),this.updateSize()}get context(){const e=this.renderer.getCanvasTarget(),t=this.get(e);let r=t.context;if(r===void 0){const i=this.parameters;e.isDefaultCanvasTarget===!0&&i.context!==void 0?r=i.context:r=e.domElement.getContext("webgpu"),"setAttribute"in e.domElement&&e.domElement.setAttribute("data-engine",`three.js r${of} webgpu`);const s=i.alpha?"premultiplied":"opaque",o=i.outputType===or?"extended":"standard";r.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:s,toneMapping:{mode:o}}),t.context=r}return r}get coordinateSystem(){return Qo}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){const e=this.renderer,t=e.getCanvasTarget(),r=this.get(t),i=e.currentSamples;let s=r.descriptor;if(s===void 0||r.samples!==i){s={colorAttachments:[{view:null}]},(e.depth===!0||e.stencil===!0)&&(s.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(e.depth,e.stencil).createView()});const a=s.colorAttachments[0];i>0?a.view=this.textureUtils.getColorBuffer().createView():a.resolveTarget=void 0,r.descriptor=s,r.samples=i}const o=s.colorAttachments[0];return i>0?o.resolveTarget=this.context.getCurrentTexture().createView():o.view=this.context.getCurrentTexture().createView(),s}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.image.depth>1&&e.camera.isArrayCamera}_getRenderPassDescriptor(e,t={}){const r=e.renderTarget,i=this.get(r);let s=i.descriptors;(s===void 0||i.width!==r.width||i.height!==r.height||i.samples!==r.samples)&&(s={},i.descriptors=s);const o=e.getCacheKey();let a=s[o];if(a===void 0){const f=e.textures,p=[];let g;const v=this._isRenderCameraDepthArray(e);for(let x=0;x<f.length;x++){const T=this.get(f[x]),S={label:`colorAttachment_${x}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:kn.TwoD};if(r.isRenderTarget3D)g=e.activeCubeFace,S.baseArrayLayer=0,S.dimension=kn.ThreeD,S.depthOrArrayLayers=f[x].image.depth;else if(r.isRenderTarget&&f[x].image.depth>1)if(v===!0){const E=e.camera.cameras;for(let N=0;N<E.length;N++){const P={...S,baseArrayLayer:N,arrayLayerCount:1,dimension:kn.TwoD},B=T.texture.createView(P);p.push({view:B,resolveTarget:void 0,depthSlice:void 0})}}else S.dimension=kn.TwoDArray,S.depthOrArrayLayers=f[x].image.depth;if(v!==!0){const E=T.texture.createView(S);let N,P;T.msaaTexture!==void 0?(N=T.msaaTexture.createView(),P=E):(N=E,P=void 0),p.push({view:N,resolveTarget:P,depthSlice:g})}}if(a={textureViews:p},e.depth){const x=this.get(e.depthTexture),T={};(e.depthTexture.isArrayTexture||e.depthTexture.isCubeTexture)&&(T.dimension=kn.TwoD,T.arrayLayerCount=1,T.baseArrayLayer=e.activeCubeFace),a.depthStencilView=x.texture.createView(T)}s[o]=a,i.width=r.width,i.height=r.height,i.samples=r.samples,i.activeMipmapLevel=e.activeMipmapLevel,i.activeCubeFace=e.activeCubeFace}const c={colorAttachments:[]};for(let f=0;f<a.textureViews.length;f++){const p=a.textureViews[f];let g={r:0,g:0,b:0,a:1};f===0&&t.clearValue&&(g=t.clearValue),c.colorAttachments.push({view:p.view,depthSlice:p.depthSlice,resolveTarget:p.resolveTarget,loadOp:t.loadOp||It.Load,storeOp:t.storeOp||Tr.Store,clearValue:g})}return a.depthStencilView&&(c.depthStencilAttachment={view:a.depthStencilView}),c}beginRender(e){const t=this.get(e),r=this.device,i=e.occlusionQueryCount;let s;i>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,s=r.createQuerySet({type:"occlusion",count:i,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=s,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(i),t.lastOcclusionObject=null);let o;e.textures===null?o=this._getDefaultRenderPassDescriptor():o=this._getRenderPassDescriptor(e,{loadOp:It.Load}),this.initTimestampQuery(gs.RENDER,this.getTimestampUID(e),o),o.occlusionQuerySet=s;const a=o.depthStencilAttachment;if(e.textures!==null){const f=o.colorAttachments;for(let p=0;p<f.length;p++){const g=f[p];e.clearColor?(g.clearValue=p===0?e.clearColorValue:{r:0,g:0,b:0,a:1},g.loadOp=It.Clear):g.loadOp=It.Load,g.storeOp=Tr.Store}}else{const f=o.colorAttachments[0];e.clearColor?(f.clearValue=e.clearColorValue,f.loadOp=It.Clear):f.loadOp=It.Load,f.storeOp=Tr.Store}e.depth&&(e.clearDepth?(a.depthClearValue=e.clearDepthValue,a.depthLoadOp=It.Clear):a.depthLoadOp=It.Load,a.depthStoreOp=Tr.Store),e.stencil&&(e.clearStencil?(a.stencilClearValue=e.clearStencilValue,a.stencilLoadOp=It.Clear):a.stencilLoadOp=It.Load,a.stencilStoreOp=Tr.Store);const c=r.createCommandEncoder({label:"renderContext_"+e.id});if(this._isRenderCameraDepthArray(e)===!0){const f=e.camera.cameras;!t.layerDescriptors||t.layerDescriptors.length!==f.length?this._createDepthLayerDescriptors(e,t,o,f):this._updateDepthLayerDescriptors(e,t,f),t.bundleEncoders=[],t.bundleSets=[];for(let p=0;p<f.length;p++){const g=this.pipelineUtils.createBundleEncoder(e,"renderBundleArrayCamera_"+p),v={attributes:{},bindingGroups:[],pipeline:null,index:null};t.bundleEncoders.push(g),t.bundleSets.push(v)}t.currentPass=null}else{const f=c.beginRenderPass(o);t.currentPass=f,e.viewport&&this.updateViewport(e),e.scissor&&this.updateScissor(e)}t.descriptor=o,t.encoder=c,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[]}_createDepthLayerDescriptors(e,t,r,i){const s=r.depthStencilAttachment;t.layerDescriptors=[];const o=this.get(e.depthTexture);o.viewCache||(o.viewCache=[]);for(let a=0;a<i.length;a++){const c={...r,colorAttachments:[{...r.colorAttachments[0],view:r.colorAttachments[a].view}]};if(r.depthStencilAttachment){const f=a;o.viewCache[f]||(o.viewCache[f]=o.texture.createView({dimension:kn.TwoD,baseArrayLayer:a,arrayLayerCount:1})),c.depthStencilAttachment={view:o.viewCache[f],depthLoadOp:s.depthLoadOp||It.Clear,depthStoreOp:s.depthStoreOp||Tr.Store,depthClearValue:s.depthClearValue||1},e.stencil&&(c.depthStencilAttachment.stencilLoadOp=s.stencilLoadOp,c.depthStencilAttachment.stencilStoreOp=s.stencilStoreOp,c.depthStencilAttachment.stencilClearValue=s.stencilClearValue)}else c.depthStencilAttachment={...s};t.layerDescriptors.push(c)}}_updateDepthLayerDescriptors(e,t,r){for(let i=0;i<r.length;i++){const s=t.layerDescriptors[i];if(s.depthStencilAttachment){const o=s.depthStencilAttachment;e.depth&&(e.clearDepth?(o.depthClearValue=e.clearDepthValue,o.depthLoadOp=It.Clear):o.depthLoadOp=It.Load),e.stencil&&(e.clearStencil?(o.stencilClearValue=e.clearStencilValue,o.stencilLoadOp=It.Clear):o.stencilLoadOp=It.Load)}}}finishRender(e){const t=this.get(e),r=e.occlusionQueryCount;t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),r>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery();const i=t.encoder;if(this._isRenderCameraDepthArray(e)===!0){const s=[];for(let o=0;o<t.bundleEncoders.length;o++){const a=t.bundleEncoders[o];s.push(a.finish())}for(let o=0;o<t.layerDescriptors.length;o++)if(o<s.length){const a=t.layerDescriptors[o],c=i.beginRenderPass(a);if(e.viewport){const{x:f,y:p,width:g,height:v,minDepth:x,maxDepth:T}=e.viewportValue;c.setViewport(f,p,g,v,x,T)}if(e.scissor){const{x:f,y:p,width:g,height:v}=e.scissorValue;c.setScissorRect(f,p,g,v)}c.executeBundles([s[o]]),c.end()}}else t.currentPass&&t.currentPass.end();if(r>0){const s=r*8;let o=this.occludedResolveCache.get(s);o===void 0&&(o=this.device.createBuffer({size:s,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(s,o));const a=this.device.createBuffer({size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,r,o,0),t.encoder.copyBufferToBuffer(o,0,a,0,s),t.occlusionQueryBuffer=a,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),e.textures!==null){const s=e.textures;for(let o=0;o<s.length;o++){const a=s[o];a.generateMipmaps===!0&&this.textureUtils.generateMipmaps(a)}}}isOccluded(e,t){const r=this.get(e);return r.occluded&&r.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:r,currentOcclusionQueryObjects:i}=t;if(r&&i){const s=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await r.mapAsync(GPUMapMode.READ);const o=r.getMappedRange(),a=new BigUint64Array(o);for(let c=0;c<i.length;c++)a[c]===BigInt(0)&&s.add(i[c]);r.destroy(),t.occluded=s}}updateViewport(e){const{currentPass:t}=this.get(e),{x:r,y:i,width:s,height:o,minDepth:a,maxDepth:c}=e.viewportValue;t.setViewport(r,i,s,o,a,c)}updateScissor(e){const{currentPass:t}=this.get(e),{x:r,y:i,width:s,height:o}=e.scissorValue;t.setScissorRect(r,i,s,o)}getClearColor(){const e=super.getClearColor();return this.renderer.alpha===!0&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,r,i=null){const s=this.device,o=this.renderer;let a=[],c,f,p,g;if(e){const T=this.getClearColor();f={r:T.r,g:T.g,b:T.b,a:T.a}}if(i===null){p=o.depth,g=o.stencil;const T=this._getDefaultRenderPassDescriptor();if(e){a=T.colorAttachments;const S=a[0];S.clearValue=f,S.loadOp=It.Clear,S.storeOp=Tr.Store}(p||g)&&(c=T.depthStencilAttachment)}else{p=i.depth,g=i.stencil;const T={loadOp:e?It.Clear:It.Load,clearValue:e?f:void 0};p&&(T.depthLoadOp=t?It.Clear:It.Load,T.depthClearValue=t?o.getClearDepth():void 0,T.depthStoreOp=Tr.Store),g&&(T.stencilLoadOp=r?It.Clear:It.Load,T.stencilClearValue=r?o.getClearStencil():void 0,T.stencilStoreOp=Tr.Store);const S=this._getRenderPassDescriptor(i,T);a=S.colorAttachments,c=S.depthStencilAttachment}p&&c&&(t?(c.depthLoadOp=It.Clear,c.depthClearValue=o.getClearDepth(),c.depthStoreOp=Tr.Store):(c.depthLoadOp=It.Load,c.depthStoreOp=Tr.Store)),g&&c&&(r?(c.stencilLoadOp=It.Clear,c.stencilClearValue=o.getClearStencil(),c.stencilStoreOp=Tr.Store):(c.stencilLoadOp=It.Load,c.stencilStoreOp=Tr.Store));const v=s.createCommandEncoder({label:"clear"});v.beginRenderPass({colorAttachments:a,depthStencilAttachment:c}).end(),s.queue.submit([v.finish()])}beginCompute(e){const t=this.get(e),r={label:"computeGroup_"+e.id};this.initTimestampQuery(gs.COMPUTE,this.getTimestampUID(e),r),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(r)}compute(e,t,r,i,s=null){const o=this.get(t),{passEncoderGPU:a}=this.get(e),c=this.get(i).pipeline;this.pipelineUtils.setPipeline(a,c);for(let f=0,p=r.length;f<p;f++){const g=r[f],v=this.get(g);a.setBindGroup(f,v.group)}if(s===null&&(s=t.count),s&&typeof s=="object"&&s.isIndirectStorageBufferAttribute){const f=this.get(s).buffer;a.dispatchWorkgroupsIndirect(f,0);return}if(typeof s=="number"){const f=s;if(o.dispatchSize===void 0||o.count!==f){o.dispatchSize=[0,1,1],o.count=f;const p=t.workgroupSize;let g=p[0];for(let T=1;T<p.length;T++)g*=p[T];const v=Math.ceil(f/g),x=this.device.limits.maxComputeWorkgroupsPerDimension;s=[v,1,1],v>x&&(s[0]=Math.min(v,x),s[1]=Math.ceil(v/x)),o.dispatchSize=s}s=o.dispatchSize}a.dispatchWorkgroups(s[0],s[1]||1,s[2]||1)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}draw(e,t){const{object:r,material:i,context:s,pipeline:o}=e,a=e.getBindings(),c=this.get(s),f=this.get(o),p=f.pipeline;if(f.error===!0)return;const g=e.getIndex(),v=g!==null,x=e.getDrawParameters();if(x===null)return;const T=(E,N)=>{this.pipelineUtils.setPipeline(E,p),N.pipeline=p;const P=N.bindingGroups;for(let L=0,k=a.length;L<k;L++){const q=a[L],I=this.get(q);P[q.index]!==q.id&&(E.setBindGroup(q.index,I.group),P[q.index]=q.id)}if(v===!0&&N.index!==g){const L=this.get(g).buffer,k=g.array instanceof Uint16Array?cu.Uint16:cu.Uint32;E.setIndexBuffer(L,k),N.index=g}const B=e.getVertexBuffers();for(let L=0,k=B.length;L<k;L++){const q=B[L];if(N.attributes[L]!==q){const I=this.get(q).buffer;E.setVertexBuffer(L,I),N.attributes[L]=q}}s.stencil===!0&&i.stencilWrite===!0&&c.currentStencilRef!==i.stencilRef&&(E.setStencilReference(i.stencilRef),c.currentStencilRef=i.stencilRef)},S=(E,N)=>{if(T(E,N),r.isBatchedMesh===!0){const P=r._multiDrawStarts,B=r._multiDrawCounts,L=r._multiDrawCount,k=r._multiDrawInstances;k!==null&&fn("WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let q=0;q<L;q++){const I=k?k[q]:1,U=I>1?0:q;v===!0?E.drawIndexed(B[q],I,P[q]/g.array.BYTES_PER_ELEMENT,0,U):E.draw(B[q],I,P[q],U),t.update(r,B[q],I)}}else if(v===!0){const{vertexCount:P,instanceCount:B,firstVertex:L}=x,k=e.getIndirect();if(k!==null){const q=this.get(k).buffer,I=e.getIndirectOffset(),U=Array.isArray(I)?I:[I];for(let j=0;j<U.length;j++)E.drawIndexedIndirect(q,U[j])}else E.drawIndexed(P,B,L,0,0);t.update(r,P,B)}else{const{vertexCount:P,instanceCount:B,firstVertex:L}=x,k=e.getIndirect();if(k!==null){const q=this.get(k).buffer,I=e.getIndirectOffset(),U=Array.isArray(I)?I:[I];for(let j=0;j<U.length;j++)E.drawIndirect(q,U[j])}else E.draw(P,B,L,0);t.update(r,P,B)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const E=this.get(e.camera),N=e.camera.cameras,P=e.getBindingGroup("cameraIndex");if(E.indexesGPU===void 0||E.indexesGPU.length!==N.length){const L=this.get(P),k=[],q=new Uint32Array([0,0,0,0]);for(let I=0,U=N.length;I<U;I++){q[0]=I;const{layoutGPU:j}=L.layout,J=this.bindingUtils.createBindGroupIndex(q,j);k.push(J)}E.indexesGPU=k}const B=this.renderer.getPixelRatio();for(let L=0,k=N.length;L<k;L++){const q=N[L];if(r.layers.test(q.layers)){const I=q.viewport;let U=c.currentPass,j=c.currentSets;if(c.bundleEncoders){const J=c.bundleEncoders[L],Q=c.bundleSets[L];U=J,j=Q}I&&U.setViewport(Math.floor(I.x*B),Math.floor(I.y*B),Math.floor(I.width*B),Math.floor(I.height*B),s.viewportValue.minDepth,s.viewportValue.maxDepth),P&&E.indexesGPU&&(U.setBindGroup(P.index,E.indexesGPU[L]),j.bindingGroups[P.index]=P.id),S(U,j)}}}else if(c.currentPass){if(c.occlusionQuerySet!==void 0){const E=c.lastOcclusionObject;E!==r&&(E!==null&&E.occlusionTest===!0&&(c.currentPass.endOcclusionQuery(),c.occlusionQueryIndex++),r.occlusionTest===!0&&(c.currentPass.beginOcclusionQuery(c.occlusionQueryIndex),c.occlusionQueryObjects[c.occlusionQueryIndex]=r),c.lastOcclusionObject=r)}S(c.currentPass,c.currentSets)}}needsRenderUpdate(e){const t=this.get(e),{object:r,material:i}=e,s=this.utils,o=s.getSampleCountRenderContext(e.context),a=s.getCurrentColorSpace(e.context),c=s.getCurrentColorFormat(e.context),f=s.getCurrentDepthStencilFormat(e.context),p=s.getPrimitiveTopology(r,i);let g=!1;return(t.material!==i||t.materialVersion!==i.version||t.transparent!==i.transparent||t.blending!==i.blending||t.premultipliedAlpha!==i.premultipliedAlpha||t.blendSrc!==i.blendSrc||t.blendDst!==i.blendDst||t.blendEquation!==i.blendEquation||t.blendSrcAlpha!==i.blendSrcAlpha||t.blendDstAlpha!==i.blendDstAlpha||t.blendEquationAlpha!==i.blendEquationAlpha||t.colorWrite!==i.colorWrite||t.depthWrite!==i.depthWrite||t.depthTest!==i.depthTest||t.depthFunc!==i.depthFunc||t.stencilWrite!==i.stencilWrite||t.stencilFunc!==i.stencilFunc||t.stencilFail!==i.stencilFail||t.stencilZFail!==i.stencilZFail||t.stencilZPass!==i.stencilZPass||t.stencilFuncMask!==i.stencilFuncMask||t.stencilWriteMask!==i.stencilWriteMask||t.side!==i.side||t.alphaToCoverage!==i.alphaToCoverage||t.sampleCount!==o||t.colorSpace!==a||t.colorFormat!==c||t.depthStencilFormat!==f||t.primitiveTopology!==p||t.clippingContextCacheKey!==e.clippingContextCacheKey)&&(t.material=i,t.materialVersion=i.version,t.transparent=i.transparent,t.blending=i.blending,t.premultipliedAlpha=i.premultipliedAlpha,t.blendSrc=i.blendSrc,t.blendDst=i.blendDst,t.blendEquation=i.blendEquation,t.blendSrcAlpha=i.blendSrcAlpha,t.blendDstAlpha=i.blendDstAlpha,t.blendEquationAlpha=i.blendEquationAlpha,t.colorWrite=i.colorWrite,t.depthWrite=i.depthWrite,t.depthTest=i.depthTest,t.depthFunc=i.depthFunc,t.stencilWrite=i.stencilWrite,t.stencilFunc=i.stencilFunc,t.stencilFail=i.stencilFail,t.stencilZFail=i.stencilZFail,t.stencilZPass=i.stencilZPass,t.stencilFuncMask=i.stencilFuncMask,t.stencilWriteMask=i.stencilWriteMask,t.side=i.side,t.alphaToCoverage=i.alphaToCoverage,t.sampleCount=o,t.colorSpace=a,t.colorFormat=c,t.depthStencilFormat=f,t.primitiveTopology=p,t.clippingContextCacheKey=e.clippingContextCacheKey,g=!0),g}getRenderCacheKey(e){const{object:t,material:r}=e,i=this.utils,s=e.context,o=t.isMesh&&t.matrixWorld.determinant()<0;return[r.transparent,r.blending,r.premultipliedAlpha,r.blendSrc,r.blendDst,r.blendEquation,r.blendSrcAlpha,r.blendDstAlpha,r.blendEquationAlpha,r.colorWrite,r.depthWrite,r.depthTest,r.depthFunc,r.stencilWrite,r.stencilFunc,r.stencilFail,r.stencilZFail,r.stencilZPass,r.stencilFuncMask,r.stencilWriteMask,r.side,o,i.getSampleCountRenderContext(s),i.getCurrentColorSpace(s),i.getCurrentColorFormat(s),i.getCurrentDepthStencilFormat(s),i.getPrimitiveTopology(t,r),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}updateSampler(e){return this.textureUtils.updateSampler(e)}createDefaultTexture(e){return this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,r,i,s,o){return this.textureUtils.copyTextureToBuffer(e,t,r,i,s,o)}initTimestampQuery(e,t,r){if(!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new nW(this.device,e,2048));const i=this.timestampQueryPool[e],s=i.allocateQueriesForContext(t);r.timestampWrites={querySet:i.querySet,beginningOfPassWriteIndex:s,endOfPassWriteIndex:s+1}}createNodeBuilder(e,t){return new QH(e,t)}createProgram(e){const t=this.get(e);t.module={module:this.device.createShaderModule({code:e.code,label:e.stage+(e.name!==""?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const r=this.get(e),s=r.currentPass.finish();this.get(t).bundleGPU=s,r.currentSets=r._currentSets,r.currentPass=r._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,r,i){this.bindingUtils.createBindings(e,t,r,i)}updateBindings(e,t,r,i){this.bindingUtils.createBindings(e,t,r,i)}updateBinding(e){this.bindingUtils.updateBinding(e)}deleteBindGroupData(e){this.bindingUtils.deleteBindGroupData(e)}createIndexAttribute(e){let t=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(t|=GPUBufferUsage.STORAGE),this.attributeUtils.createAttribute(e,t)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.delete(this.renderer.getCanvasTarget())}getMaxAnisotropy(){return 16}hasFeature(e){return Tb[e]!==void 0&&(e=Tb[e]),this.device.features.has(e)}copyTextureToTexture(e,t,r=null,i=null,s=0,o=0){let a=0,c=0,f=0,p=0,g=0,v=0,x=e.image.width,T=e.image.height,S=1;r!==null&&(r.isBox3===!0?(p=r.min.x,g=r.min.y,v=r.min.z,x=r.max.x-r.min.x,T=r.max.y-r.min.y,S=r.max.z-r.min.z):(p=r.min.x,g=r.min.y,x=r.max.x-r.min.x,T=r.max.y-r.min.y,S=1)),i!==null&&(a=i.x,c=i.y,f=i.z||0);const E=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),N=this.get(e).texture,P=this.get(t).texture;E.copyTextureToTexture({texture:N,mipLevel:s,origin:{x:p,y:g,z:v}},{texture:P,mipLevel:o,origin:{x:a,y:c,z:f}},[x,T,S]),this.device.queue.submit([E.finish()]),o===0&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,r){const i=this.get(t);let s=null;t.renderTarget?e.isDepthTexture?s=this.get(t.depthTexture).texture:s=this.get(t.textures[0]).texture:e.isDepthTexture?s=this.textureUtils.getDepthBuffer(t.depth,t.stencil):s=this.context.getCurrentTexture();const o=this.get(e).texture;if(s.format!==o.format){Be("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",s.format,o.format);return}let a;if(i.currentPass?(i.currentPass.end(),a=i.encoder):a=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),a.copyTextureToTexture({texture:s,origin:[r.x,r.y,0]},{texture:o},[r.z,r.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e,a),i.currentPass){const{descriptor:c}=i;for(let f=0;f<c.colorAttachments.length;f++)c.colorAttachments[f].loadOp=It.Load;t.depth&&(c.depthStencilAttachment.depthLoadOp=It.Load),t.stencil&&(c.depthStencilAttachment.stencilLoadOp=It.Load),i.currentPass=a.beginRenderPass(c),i.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor&&this.updateScissor(t)}else this.device.queue.submit([a.finish()])}dispose(){if(this.bindingUtils.dispose(),this.textureUtils.dispose(),this.occludedResolveCache){for(const e of this.occludedResolveCache.values())e.destroy();this.occludedResolveCache.clear()}if(this.timestampQueryPool)for(const e of Object.values(this.timestampQueryPool))e!==null&&e.dispose();this.parameters.device===void 0&&this.device!==null&&this.device.destroy()}}class iW extends Qg{constructor(e,t,r,i,s,o){super(e,t,r,i,s,o),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class sW extends Qg{constructor(e,t,r,i,s,o){super(e,t,r,i,s,o),this.aspect=null}copy(e,t){return super.copy(e,t),this.aspect=e.aspect,this}}class oW extends J5{constructor(){super(),this.addMaterial(Ok,"MeshPhongMaterial"),this.addMaterial(Yw,"MeshStandardMaterial"),this.addMaterial(EU,"MeshPhysicalMaterial"),this.addMaterial(MU,"MeshToonMaterial"),this.addMaterial(Ck,"MeshBasicMaterial"),this.addMaterial(Dk,"MeshLambertMaterial"),this.addMaterial(Tk,"MeshNormalMaterial"),this.addMaterial(BU,"MeshMatcapMaterial"),this.addMaterial(gk,"LineBasicMaterial"),this.addMaterial(_k,"LineDashedMaterial"),this.addMaterial(IU,"PointsMaterial"),this.addMaterial(Zw,"SpriteMaterial"),this.addMaterial(GU,"ShadowMaterial"),this.addLight(wz,qR),this.addLight(O$,dx),this.addLight(F$,GR),this.addLight(ay,Qg),this.addLight(q$,px),this.addLight(G$,VR),this.addLight(V$,zR),this.addLight(I$,iW),this.addLight(U$,sW),this.addToneMapping(m5,jR),this.addToneMapping(g5,$R),this.addToneMapping(y5,HR),this.addToneMapping(_5,WR),this.addToneMapping(v5,QR),this.addToneMapping(b5,XR)}}class cS extends lH{constructor(e={}){let t;e.forceWebGL?t=gb:(t=rW,e.getFallback=()=>(De("WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new gb(e)));const r=new t(e);super(r,e),this.library=new oW,this.isWebGPURenderer=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */C.BRDF_GGX;C.BRDF_Lambert;C.BasicPointShadowFilter;C.BasicShadowFilter;C.Break;C.Const;C.Continue;C.DFGLUT;C.D_GGX;C.Discard;C.EPSILON;C.F_Schlick;const aW=C.Fn;C.INFINITY;const lW=C.If,uW=C.Loop;C.NodeAccess;C.NodeShaderStage;C.NodeType;C.NodeUpdateType;C.PCFShadowFilter;C.PCFSoftShadowFilter;C.PI;C.PI2;C.TWO_PI;C.HALF_PI;C.PointShadowFilter;C.Return;C.Schlick_to_F0;C.ScriptableNodeResources;C.ShaderNode;C.Stack;C.Switch;C.TBNViewMatrix;C.VSMShadowFilter;C.V_GGX_SmithCorrelated;C.Var;C.VarIntent;C.abs;C.acesFilmicToneMapping;C.acos;C.add;C.addMethodChaining;C.addNodeElement;C.agxToneMapping;C.all;C.alphaT;C.and;C.anisotropy;C.anisotropyB;C.anisotropyT;C.any;C.append;C.array;C.arrayBuffer;const AW=C.asin;C.assign;C.atan;C.atan2;C.atomicAdd;C.atomicAnd;C.atomicFunc;C.atomicLoad;C.atomicMax;C.atomicMin;C.atomicOr;C.atomicStore;C.atomicSub;C.atomicXor;C.attenuationColor;C.attenuationDistance;C.attribute;C.attributeArray;C.backgroundBlurriness;C.backgroundIntensity;C.backgroundRotation;C.batch;C.bentNormalView;C.billboarding;C.bitAnd;C.bitNot;C.bitOr;C.bitXor;C.bitangentGeometry;C.bitangentLocal;C.bitangentView;C.bitangentWorld;C.bitcast;C.blendBurn;C.blendColor;C.blendDodge;C.blendOverlay;C.blendScreen;C.blur;C.bool;C.buffer;C.bufferAttribute;C.bumpMap;C.burn;C.builtin;C.builtinAOContext;C.builtinShadowContext;C.bvec2;C.bvec3;C.bvec4;C.bypass;C.cache;C.call;C.cameraFar;C.cameraIndex;C.cameraNear;C.cameraNormalMatrix;C.cameraPosition;C.cameraProjectionMatrix;C.cameraProjectionMatrixInverse;C.cameraViewMatrix;C.cameraViewport;C.cameraWorldMatrix;C.cbrt;C.cdl;C.ceil;C.checker;C.cineonToneMapping;C.clamp;C.clearcoat;C.clearcoatNormalView;C.clearcoatRoughness;C.code;C.color;C.colorSpaceToWorking;C.colorToDirection;C.compute;C.computeKernel;C.computeSkinning;C.context;C.convert;C.convertColorSpace;C.convertToTexture;C.countLeadingZeros;C.countOneBits;C.countTrailingZeros;const cW=C.cos;C.cross;C.cubeTexture;C.cubeTextureBase;C.dFdx;C.dFdy;C.dashSize;C.debug;C.decrement;C.decrementBefore;C.defaultBuildStages;C.defaultShaderStages;C.defined;C.degrees;C.deltaTime;C.densityFog;C.densityFogFactor;C.depth;C.depthPass;C.determinant;C.difference;C.diffuseColor;C.directPointLight;C.directionToColor;C.directionToFaceDirection;C.dispersion;C.distance;C.div;C.dodge;C.dot;C.drawIndex;C.dynamicBufferAttribute;C.element;C.emissive;C.equal;C.equals;C.equirectUV;const hW=C.exp;C.exp2;C.expression;C.faceDirection;C.faceForward;C.faceforward;const fW=C.float;C.floatBitsToInt;C.floatBitsToUint;C.floor;C.fog;C.fract;C.frameGroup;C.frameId;C.frontFacing;C.fwidth;C.gain;C.gapSize;C.getConstNodeType;C.getCurrentStack;C.getDirection;C.getDistanceAttenuation;C.getGeometryRoughness;C.getNormalFromDepth;C.interleavedGradientNoise;C.vogelDiskSample;C.getParallaxCorrectNormal;C.getRoughness;C.getScreenPosition;C.getShIrradianceAt;C.getShadowMaterial;C.getShadowRenderObjectFunction;C.getTextureIndex;C.getViewPosition;C.globalId;C.glsl;C.glslFn;C.grayscale;C.greaterThan;C.greaterThanEqual;C.hash;C.highpModelNormalViewMatrix;C.highpModelViewMatrix;C.hue;C.increment;C.incrementBefore;C.instance;const dW=C.instanceIndex;C.instancedArray;C.instancedBufferAttribute;C.instancedDynamicBufferAttribute;C.instancedMesh;C.int;C.intBitsToFloat;C.inverse;C.inverseSqrt;C.inversesqrt;C.invocationLocalIndex;C.invocationSubgroupIndex;C.ior;C.iridescence;C.iridescenceIOR;C.iridescenceThickness;C.ivec2;C.ivec3;C.ivec4;C.js;C.label;C.length;C.lengthSq;C.lessThan;C.lessThanEqual;C.lightPosition;C.lightProjectionUV;C.lightShadowMatrix;C.lightTargetDirection;C.lightTargetPosition;C.lightViewPosition;C.lightingContext;C.lights;C.linearDepth;C.linearToneMapping;C.localId;C.log;C.log2;C.logarithmicDepthToViewZ;C.luminance;C.mat2;C.mat3;C.mat4;C.matcapUV;C.materialAO;C.materialAlphaTest;C.materialAnisotropy;C.materialAnisotropyVector;C.materialAttenuationColor;C.materialAttenuationDistance;C.materialClearcoat;C.materialClearcoatNormal;C.materialClearcoatRoughness;C.materialColor;C.materialDispersion;C.materialEmissive;C.materialEnvIntensity;C.materialEnvRotation;C.materialIOR;C.materialIridescence;C.materialIridescenceIOR;C.materialIridescenceThickness;C.materialLightMap;C.materialLineDashOffset;C.materialLineDashSize;C.materialLineGapSize;C.materialLineScale;C.materialLineWidth;C.materialMetalness;C.materialNormal;C.materialOpacity;C.materialPointSize;C.materialReference;C.materialReflectivity;C.materialRefractionRatio;C.materialRotation;C.materialRoughness;C.materialSheen;C.materialSheenRoughness;C.materialShininess;C.materialSpecular;C.materialSpecularColor;C.materialSpecularIntensity;C.materialSpecularStrength;C.materialThickness;C.materialTransmission;C.max;C.maxMipLevel;C.mediumpModelViewMatrix;C.metalness;C.min;C.mix;C.mixElement;C.mod;C.modInt;C.modelDirection;C.modelNormalMatrix;C.modelPosition;C.modelRadius;C.modelScale;C.modelViewMatrix;C.modelViewPosition;C.modelViewProjection;C.modelWorldMatrix;C.modelWorldMatrixInverse;C.morphReference;C.mrt;C.mul;C.mx_aastep;C.mx_add;C.mx_atan2;C.mx_cell_noise_float;C.mx_contrast;C.mx_divide;C.mx_fractal_noise_float;C.mx_fractal_noise_vec2;C.mx_fractal_noise_vec3;C.mx_fractal_noise_vec4;C.mx_frame;C.mx_heighttonormal;C.mx_hsvtorgb;C.mx_ifequal;C.mx_ifgreater;C.mx_ifgreatereq;C.mx_invert;C.mx_modulo;C.mx_multiply;C.mx_noise_float;C.mx_noise_vec3;C.mx_noise_vec4;C.mx_place2d;C.mx_power;C.mx_ramp4;C.mx_ramplr;C.mx_ramptb;C.mx_rgbtohsv;C.mx_rotate2d;C.mx_rotate3d;C.mx_safepower;C.mx_separate;C.mx_splitlr;C.mx_splittb;C.mx_srgb_texture_to_lin_rec709;C.mx_subtract;C.mx_timer;C.mx_transform_uv;C.mx_unifiednoise2d;C.mx_unifiednoise3d;C.mx_worley_noise_float;C.mx_worley_noise_vec2;C.mx_worley_noise_vec3;const pW=C.negate;C.neutralToneMapping;C.nodeArray;C.nodeImmutable;C.nodeObject;C.nodeObjectIntent;C.nodeObjects;C.nodeProxy;C.nodeProxyIntent;C.normalFlat;C.normalGeometry;C.normalLocal;C.normalMap;C.normalView;C.normalViewGeometry;C.normalWorld;C.normalWorldGeometry;C.normalize;C.not;C.notEqual;C.numWorkgroups;C.objectDirection;C.objectGroup;C.objectPosition;C.objectRadius;C.objectScale;C.objectViewPosition;C.objectWorldMatrix;C.OnBeforeObjectUpdate;C.OnBeforeMaterialUpdate;C.OnObjectUpdate;C.OnMaterialUpdate;C.oneMinus;C.or;C.orthographicDepthToViewZ;C.oscSawtooth;C.oscSine;C.oscSquare;C.oscTriangle;C.output;C.outputStruct;C.overlay;C.overloadingFn;C.packHalf2x16;C.packSnorm2x16;C.packUnorm2x16;C.parabola;C.parallaxDirection;C.parallaxUV;C.parameter;C.pass;C.passTexture;C.pcurve;C.perspectiveDepthToViewZ;C.pmremTexture;C.pointShadow;C.pointUV;C.pointWidth;C.positionGeometry;C.positionLocal;C.positionPrevious;C.positionView;C.positionViewDirection;C.positionWorld;C.positionWorldDirection;C.posterize;C.pow;C.pow2;C.pow3;C.pow4;C.premultiplyAlpha;C.property;C.radians;C.rand;C.range;C.rangeFog;C.rangeFogFactor;C.reciprocal;C.reference;C.referenceBuffer;C.reflect;C.reflectVector;C.reflectView;C.reflector;C.refract;C.refractVector;C.refractView;C.reinhardToneMapping;C.remap;C.remapClamp;C.renderGroup;C.renderOutput;C.rendererReference;C.replaceDefaultUV;C.rotate;C.rotateUV;C.roughness;C.round;C.rtt;C.sRGBTransferEOTF;C.sRGBTransferOETF;C.sample;C.sampler;C.samplerComparison;C.saturate;C.saturation;C.screen;C.screenCoordinate;C.screenDPR;C.screenSize;C.screenUV;C.scriptable;C.scriptableValue;C.select;C.setCurrentStack;C.setName;C.shaderStages;C.shadow;C.shadowPositionWorld;C.shapeCircle;C.sharedUniformGroup;C.sheen;C.sheenRoughness;C.shiftLeft;C.shiftRight;C.shininess;C.sign;const mW=C.sin;C.sinc;C.skinning;C.smoothstep;C.smoothstepElement;C.specularColor;C.specularF90;C.spherizeUV;C.split;C.spritesheetUV;const gW=C.sqrt;C.stack;C.step;C.stepElement;const yW=C.storage;C.storageBarrier;C.storageObject;C.storageTexture;C.string;C.struct;C.sub;C.subgroupAdd;C.subgroupAll;C.subgroupAnd;C.subgroupAny;C.subgroupBallot;C.subgroupBroadcast;C.subgroupBroadcastFirst;C.subBuild;C.subgroupElect;C.subgroupExclusiveAdd;C.subgroupExclusiveMul;C.subgroupInclusiveAdd;C.subgroupInclusiveMul;C.subgroupIndex;C.subgroupMax;C.subgroupMin;C.subgroupMul;C.subgroupOr;C.subgroupShuffle;C.subgroupShuffleDown;C.subgroupShuffleUp;C.subgroupShuffleXor;C.subgroupSize;C.subgroupXor;C.tan;C.tangentGeometry;C.tangentLocal;C.tangentView;C.tangentWorld;C.texture;C.texture3D;C.textureBarrier;C.textureBicubic;C.textureBicubicLevel;C.textureCubeUV;C.textureLoad;C.textureSize;C.textureLevel;C.textureStore;C.thickness;C.time;C.toneMapping;C.toneMappingExposure;C.toonOutlinePass;C.transformDirection;C.transformNormal;C.transformNormalToView;C.transformedClearcoatNormalView;C.transformedNormalView;C.transformedNormalWorld;C.transmission;C.transpose;C.triNoise3D;C.triplanarTexture;C.triplanarTextures;C.trunc;C.uint;C.uintBitsToFloat;const _W=C.uniform;C.uniformArray;C.uniformCubeTexture;C.uniformGroup;C.uniformFlow;C.uniformTexture;C.unpackHalf2x16;C.unpackSnorm2x16;C.unpackUnorm2x16;C.unpremultiplyAlpha;C.userData;C.uv;C.uvec2;C.uvec3;C.uvec4;C.varying;C.varyingProperty;C.vec2;C.vec3;C.vec4;C.vectorComponents;C.velocity;C.vertexColor;C.vertexIndex;C.vertexStage;C.vibrance;C.viewZToLogarithmicDepth;C.viewZToOrthographicDepth;C.viewZToPerspectiveDepth;C.viewport;C.viewportCoordinate;C.viewportDepthTexture;C.viewportLinearDepth;C.viewportMipTexture;C.viewportResolution;C.viewportSafeUV;C.viewportSharedTexture;C.viewportSize;C.viewportTexture;C.viewportUV;C.wgsl;C.wgslFn;C.workgroupArray;C.workgroupBarrier;C.workgroupId;C.workingToColorSpace;C.xor;const Cb=new cf,o0=new ge;class hS extends KC{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],r=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(r),this.setAttribute("position",new Cs(e,3)),this.setAttribute("uv",new Cs(t,2))}applyMatrix4(e){const t=this.attributes.instanceStart,r=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),r.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const r=new eh(t,6,1);return this.setAttribute("instanceStart",new qo(r,3,0)),this.setAttribute("instanceEnd",new qo(r,3,3)),this.instanceCount=this.attributes.instanceStart.count,this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const r=new eh(t,6,1);return this.setAttribute("instanceColorStart",new qo(r,3,0)),this.setAttribute("instanceColorEnd",new qo(r,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new ZC(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new cf);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),Cb.setFromBufferAttribute(t),this.boundingBox.union(Cb))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new l1),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const r=this.boundingSphere.center;this.boundingBox.getCenter(r);let i=0;for(let s=0,o=e.count;s<o;s++)o0.fromBufferAttribute(e,s),i=Math.max(i,r.distanceToSquared(o0)),o0.fromBufferAttribute(t,s),i=Math.max(i,r.distanceToSquared(o0));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}}R0.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new _t(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};E0.line={uniforms:A1.merge([R0.common,R0.fog,R0.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			float alpha = opacity;
			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class uy extends eu{constructor(e){super({type:"LineMaterial",uniforms:A1.clone(E0.line.uniforms),vertexShader:E0.line.vertexShader,fragmentShader:E0.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}}const Mp=new $t,Nb=new ge,Mb=new ge,rr=new $t,ir=new $t,us=new $t,Pp=new ge,Bp=new dn,sr=new JC,Pb=new ge,a0=new cf,l0=new l1,As=new $t;let ms,ja;function Bb(n,e,t){return As.set(0,0,-e,1).applyMatrix4(n.projectionMatrix),As.multiplyScalar(1/As.w),As.x=ja/t.width,As.y=ja/t.height,As.applyMatrix4(n.projectionMatrixInverse),As.multiplyScalar(1/As.w),Math.abs(Math.max(As.x,As.y))}function vW(n,e){const t=n.matrixWorld,r=n.geometry,i=r.attributes.instanceStart,s=r.attributes.instanceEnd,o=Math.min(r.instanceCount,i.count);for(let a=0,c=o;a<c;a++){sr.start.fromBufferAttribute(i,a),sr.end.fromBufferAttribute(s,a),sr.applyMatrix4(t);const f=new ge,p=new ge;ms.distanceSqToSegment(sr.start,sr.end,p,f),p.distanceTo(f)<ja*.5&&e.push({point:p,pointOnLine:f,distance:ms.origin.distanceTo(p),object:n,face:null,faceIndex:a,uv:null,uv1:null})}}function bW(n,e,t){const r=e.projectionMatrix,s=n.material.resolution,o=n.matrixWorld,a=n.geometry,c=a.attributes.instanceStart,f=a.attributes.instanceEnd,p=Math.min(a.instanceCount,c.count),g=-e.near;ms.at(1,us),us.w=1,us.applyMatrix4(e.matrixWorldInverse),us.applyMatrix4(r),us.multiplyScalar(1/us.w),us.x*=s.x/2,us.y*=s.y/2,us.z=0,Pp.copy(us),Bp.multiplyMatrices(e.matrixWorldInverse,o);for(let v=0,x=p;v<x;v++){if(rr.fromBufferAttribute(c,v),ir.fromBufferAttribute(f,v),rr.w=1,ir.w=1,rr.applyMatrix4(Bp),ir.applyMatrix4(Bp),rr.z>g&&ir.z>g)continue;if(rr.z>g){const B=rr.z-ir.z,L=(rr.z-g)/B;rr.lerp(ir,L)}else if(ir.z>g){const B=ir.z-rr.z,L=(ir.z-g)/B;ir.lerp(rr,L)}rr.applyMatrix4(r),ir.applyMatrix4(r),rr.multiplyScalar(1/rr.w),ir.multiplyScalar(1/ir.w),rr.x*=s.x/2,rr.y*=s.y/2,ir.x*=s.x/2,ir.y*=s.y/2,sr.start.copy(rr),sr.start.z=0,sr.end.copy(ir),sr.end.z=0;const S=sr.closestPointToPointParameter(Pp,!0);sr.at(S,Pb);const E=Jl.lerp(rr.z,ir.z,S),N=E>=-1&&E<=1,P=Pp.distanceTo(Pb)<ja*.5;if(N&&P){sr.start.fromBufferAttribute(c,v),sr.end.fromBufferAttribute(f,v),sr.start.applyMatrix4(o),sr.end.applyMatrix4(o);const B=new ge,L=new ge;ms.distanceSqToSegment(sr.start,sr.end,L,B),t.push({point:L,pointOnLine:B,distance:ms.origin.distanceTo(L),object:n,face:null,faceIndex:v,uv:null,uv1:null})}}}class xW extends gn{constructor(e=new hS,t=new uy({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,r=e.attributes.instanceEnd,i=new Float32Array(2*t.count);for(let o=0,a=0,c=t.count;o<c;o++,a+=2)Nb.fromBufferAttribute(t,o),Mb.fromBufferAttribute(r,o),i[a]=a===0?0:i[a-1],i[a+1]=i[a]+Nb.distanceTo(Mb);const s=new eh(i,2,1);return e.setAttribute("instanceDistanceStart",new qo(s,1,0)),e.setAttribute("instanceDistanceEnd",new qo(s,1,1)),this}raycast(e,t){const r=this.material.worldUnits,i=e.camera;i===null&&!r&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const s=e.params.Line2!==void 0&&e.params.Line2.threshold||0;ms=e.ray;const o=this.matrixWorld,a=this.geometry,c=this.material;ja=c.linewidth+s,a.boundingSphere===null&&a.computeBoundingSphere(),l0.copy(a.boundingSphere).applyMatrix4(o);let f;if(r)f=ja*.5;else{const g=Math.max(i.near,l0.distanceToPoint(ms.origin));f=Bb(i,g,c.resolution)}if(l0.radius+=f,ms.intersectsSphere(l0)===!1)return;a.boundingBox===null&&a.computeBoundingBox(),a0.copy(a.boundingBox).applyMatrix4(o);let p;if(r)p=ja*.5;else{const g=Math.max(i.near,a0.distanceToPoint(ms.origin));p=Bb(i,g,c.resolution)}a0.expandByScalar(p),ms.intersectsBox(a0)!==!1&&(r?vW(this,t):bW(this,i,t))}onBeforeRender(e){const t=this.material.uniforms;t&&t.resolution&&(e.getViewport(Mp),this.material.uniforms.resolution.value.set(Mp.z,Mp.w))}}class fS extends hS{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,r=new Float32Array(2*t);for(let i=0;i<t;i+=3)r[2*i]=e[i],r[2*i+1]=e[i+1],r[2*i+2]=e[i+2],r[2*i+3]=e[i+3],r[2*i+4]=e[i+4],r[2*i+5]=e[i+5];return super.setPositions(r),this}setColors(e){const t=e.length-3,r=new Float32Array(2*t);for(let i=0;i<t;i+=3)r[2*i]=e[i],r[2*i+1]=e[i+1],r[2*i+2]=e[i+2],r[2*i+3]=e[i+3],r[2*i+4]=e[i+4],r[2*i+5]=e[i+5];return super.setColors(r),this}setFromPoints(e){const t=e.length-1,r=new Float32Array(6*t);for(let i=0;i<t;i++)r[6*i]=e[i].x,r[6*i+1]=e[i].y,r[6*i+2]=e[i].z||0,r[6*i+3]=e[i+1].x,r[6*i+4]=e[i+1].y,r[6*i+5]=e[i+1].z||0;return super.setPositions(r),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class TW extends xW{constructor(e=new fS,t=new uy({color:Math.random()*16777215})){super(e,t),this.isLine2=!0,this.type="Line2"}}class Db extends eN{constructor(e,t={}){const r=t.font;if(r===void 0)super();else{const i=r.generateShapes(e,t.size,t.direction);t.depth===void 0&&(t.depth=50),t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),super(i,t)}this.type="TextGeometry"}}class wW{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,t=100,r="ltr"){const i=[],s=SW(e,t,this.data,r);for(let o=0,a=s.length;o<a;o++)i.push(...s[o].toShapes());return i}}function SW(n,e,t,r){const i=Array.from(n),s=e/t.resolution,o=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*s,a=[];let c=0,f=0;(r=="rtl"||r=="tb")&&i.reverse();for(let p=0;p<i.length;p++){const g=i[p];if(g===`
`)c=0,f-=o;else{const v=EW(g,s,c,f,t);r=="tb"?(c=0,f+=t.ascender*s):c+=v.offsetX,a.push(v.path)}}return a}function EW(n,e,t,r,i){const s=i.glyphs[n]||i.glyphs["?"];if(!s){console.error('THREE.Font: character "'+n+'" does not exists in font family '+i.familyName+".");return}const o=new tN;let a,c,f,p,g,v,x,T;if(s.o){const S=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let E=0,N=S.length;E<N;)switch(S[E++]){case"m":a=S[E++]*e+t,c=S[E++]*e+r,o.moveTo(a,c);break;case"l":a=S[E++]*e+t,c=S[E++]*e+r,o.lineTo(a,c);break;case"q":f=S[E++]*e+t,p=S[E++]*e+r,g=S[E++]*e+t,v=S[E++]*e+r,o.quadraticCurveTo(g,v,f,p);break;case"b":f=S[E++]*e+t,p=S[E++]*e+r,g=S[E++]*e+t,v=S[E++]*e+r,x=S[E++]*e+t,T=S[E++]*e+r,o.bezierCurveTo(g,v,x,T,f,p);break}}return{offsetX:s.ha*e,path:o}}function Mg(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function RW(n){if(Array.isArray(n))return n}function CW(n){if(Array.isArray(n))return Mg(n)}function dS(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function NW(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Lb(n,e,t,r,i,s,o){try{var a=n[s](o),c=a.value}catch(f){return void t(f)}a.done?e(c):Promise.resolve(c).then(r,i)}function MW(n){return function(){var e=this,t=arguments;return new Promise(function(r,i){var s=n.apply(e,t);function o(c){Lb(s,r,i,o,a,"next",c)}function a(c){Lb(s,r,i,o,a,"throw",c)}o(void 0)})}}function Qf(n,e,t){return e=hu(e),UW(n,cy()?Reflect.construct(e,t||[],hu(n).constructor):e.apply(n,t))}function PW(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Xf(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function Yu(n,e){return n.get(dS(n,e))}function Dp(n,e,t){PW(n,e),e.set(n,t)}function Lp(n,e,t){return n.set(dS(n,e),t),t}function Ay(n,e,t){if(cy())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(n.bind.apply(n,r));return i}function BW(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,pS(r.key),r)}}function Yf(n,e,t){return e&&BW(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function tr(n,e,t){return(e=pS(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Pg(){return Pg=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(n,e,t){var r=qW(n,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?n:t):i.value}},Pg.apply(null,arguments)}function hu(n){return hu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},hu(n)}function Kf(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Dg(n,e)}function cy(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(cy=function(){return!!n})()}function DW(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function LW(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function OW(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function FW(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ob(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function Vt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ob(Object(t),!0).forEach(function(r){tr(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ob(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function IW(n,e){if(n==null)return{};var t,r,i=kW(n,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)t=s[r],e.indexOf(t)===-1&&{}.propertyIsEnumerable.call(n,t)&&(i[t]=n[t])}return i}function kW(n,e){if(n==null)return{};var t={};for(var r in n)if({}.hasOwnProperty.call(n,r)){if(e.indexOf(r)!==-1)continue;t[r]=n[r]}return t}function UW(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return NW(n)}function Bg(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var n,e,t=typeof Symbol=="function"?Symbol:{},r=t.iterator||"@@iterator",i=t.toStringTag||"@@toStringTag";function s(x,T,S,E){var N=T&&T.prototype instanceof a?T:a,P=Object.create(N.prototype);return Jr(P,"_invoke",(function(B,L,k){var q,I,U,j=0,J=k||[],Q=!1,K={p:0,n:0,v:n,a:te,f:te.bind(n,4),d:function(oe,Y){return q=oe,I=0,U=n,K.n=Y,o}};function te(oe,Y){for(I=oe,U=Y,e=0;!Q&&j&&!ae&&e<J.length;e++){var ae,he=J[e],xe=K.p,me=he[2];oe>3?(ae=me===Y)&&(U=he[(I=he[4])?5:(I=3,3)],he[4]=he[5]=n):he[0]<=xe&&((ae=oe<2&&xe<he[1])?(I=0,K.v=Y,K.n=he[1]):xe<me&&(ae=oe<3||he[0]>Y||Y>me)&&(he[4]=oe,he[5]=Y,K.n=me,I=0))}if(ae||oe>1)return o;throw Q=!0,Y}return function(oe,Y,ae){if(j>1)throw TypeError("Generator is already running");for(Q&&Y===1&&te(Y,ae),I=Y,U=ae;(e=I<2?n:U)||!Q;){q||(I?I<3?(I>1&&(K.n=-1),te(I,U)):K.n=U:K.v=U);try{if(j=2,q){if(I||(oe="next"),e=q[oe]){if(!(e=e.call(q,U)))throw TypeError("iterator result is not an object");if(!e.done)return e;U=e.value,I<2&&(I=0)}else I===1&&(e=q.return)&&e.call(q),I<2&&(U=TypeError("The iterator does not provide a '"+oe+"' method"),I=1);q=n}else if((e=(Q=K.n<0)?U:B.call(L,K))!==o)break}catch(he){q=n,I=1,U=he}finally{j=1}}return{value:e,done:Q}}})(x,S,E),!0),P}var o={};function a(){}function c(){}function f(){}e=Object.getPrototypeOf;var p=[][r]?e(e([][r]())):(Jr(e={},r,function(){return this}),e),g=f.prototype=a.prototype=Object.create(p);function v(x){return Object.setPrototypeOf?Object.setPrototypeOf(x,f):(x.__proto__=f,Jr(x,i,"GeneratorFunction")),x.prototype=Object.create(g),x}return c.prototype=f,Jr(g,"constructor",f),Jr(f,"constructor",c),c.displayName="GeneratorFunction",Jr(f,i,"GeneratorFunction"),Jr(g),Jr(g,i,"Generator"),Jr(g,r,function(){return this}),Jr(g,"toString",function(){return"[object Generator]"}),(Bg=function(){return{w:s,m:v}})()}function Jr(n,e,t,r){var i=Object.defineProperty;try{i({},"",{})}catch{i=0}Jr=function(s,o,a,c){function f(p,g){Jr(s,p,function(v){return this._invoke(p,g,v)})}o?i?i(s,o,{value:a,enumerable:!c,configurable:!c,writable:!c}):s[o]=a:(f("next",0),f("throw",1),f("return",2))},Jr(n,e,t,r)}function Dg(n,e){return Dg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Dg(n,e)}function un(n,e){return RW(n)||LW(n,e)||mS(n,e)||OW()}function qW(n,e){for(;!{}.hasOwnProperty.call(n,e)&&(n=hu(n))!==null;);return n}function Op(n,e,t,r){var i=Pg(hu(n.prototype),e,t);return typeof i=="function"?function(s){return i.apply(t,s)}:i}function Kt(n){return CW(n)||DW(n)||mS(n)||FW()}function GW(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function pS(n){var e=GW(n,"string");return typeof e=="symbol"?e:e+""}function mS(n,e){if(n){if(typeof n=="string")return Mg(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Mg(n,e):void 0}}var gS=function(e){e instanceof Array?e.forEach(gS):(e.map&&e.map.dispose(),e.dispose())},hy=function(e){e.geometry&&e.geometry.dispose(),e.material&&gS(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(hy)},tn=function(e){if(e&&e.children)for(;e.children.length;){var t=e.children[0];e.remove(t),hy(t)}};function Pr(n,e){var t=new e;return{linkProp:function(i){return{default:t[i](),onChange:function(o,a){a[n][i](o)},triggerUpdate:!1}},linkMethod:function(i){return function(s){for(var o=s[n],a=arguments.length,c=new Array(a>1?a-1:0),f=1;f<a;f++)c[f-1]=arguments[f];var p=o[i].apply(o,c);return p===o?this:p}}}}var on=100;function Fb(){return on}function Ni(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=(90-n)*Math.PI/180,i=(90-e)*Math.PI/180,s=on*(1+t),o=Math.sin(r);return{x:s*o*Math.cos(i),y:s*Math.cos(r),z:s*o*Math.sin(i)}}function yS(n){var e=n.x,t=n.y,r=n.z,i=Math.sqrt(e*e+t*t+r*r),s=Math.acos(t/i),o=Math.atan2(r,e);return{lat:90-s*180/Math.PI,lng:90-o*180/Math.PI-(o<-Math.PI/2?360:0),altitude:i/on-1}}function Na(n){return n*Math.PI/180}var HA=window.THREE?window.THREE:{BackSide:yr,BufferAttribute:Hi,Color:jn,Mesh:gn,ShaderMaterial:eu},VW=`
uniform float hollowRadius;

varying vec3 vVertexWorldPosition;
varying vec3 vVertexNormal;
varying float vCameraDistanceToObjCenter;
varying float vVertexAngularDistanceToHollowRadius;

void main() {    
  vVertexNormal	= normalize(normalMatrix * normal);
  vVertexWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;
  
  vec4 objCenterViewPosition = modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);
  vCameraDistanceToObjCenter = length(objCenterViewPosition);
  
  float edgeAngle = atan(hollowRadius / vCameraDistanceToObjCenter);
  float vertexAngle = acos(dot(normalize(modelViewMatrix * vec4(position, 1.0)), normalize(objCenterViewPosition)));
  vVertexAngularDistanceToHollowRadius = vertexAngle - edgeAngle;

  gl_Position	= projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`,zW=`
uniform vec3 color;
uniform float coefficient;
uniform float power;
uniform float hollowRadius;

varying vec3 vVertexNormal;
varying vec3 vVertexWorldPosition;
varying float vCameraDistanceToObjCenter;
varying float vVertexAngularDistanceToHollowRadius;

void main() {
  if (vCameraDistanceToObjCenter < hollowRadius) discard; // inside the hollowRadius
  if (vVertexAngularDistanceToHollowRadius < 0.0) discard; // frag position is within the hollow radius

  vec3 worldCameraToVertex = vVertexWorldPosition - cameraPosition;
  vec3 viewCameraToVertex	= (viewMatrix * vec4(worldCameraToVertex, 0.0)).xyz;
  viewCameraToVertex = normalize(viewCameraToVertex);
  float intensity	= pow(
    coefficient + dot(vVertexNormal, viewCameraToVertex),
    power
  );
  gl_FragColor = vec4(color, intensity);
}`;function jW(n,e,t,r){return new HA.ShaderMaterial({depthWrite:!1,transparent:!0,vertexShader:VW,fragmentShader:zW,uniforms:{coefficient:{value:n},color:{value:new HA.Color(e)},power:{value:t},hollowRadius:{value:r}}})}function $W(n,e){for(var t=n.clone(),r=new Float32Array(n.attributes.position.count*3),i=0,s=r.length;i<s;i++){var o=n.attributes.normal.array[i],a=n.attributes.position.array[i];r[i]=a+o*e}return t.setAttribute("position",new HA.BufferAttribute(r,3)),t}var HW=(function(n){function e(t){var r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=i.color,o=s===void 0?"gold":s,a=i.size,c=a===void 0?2:a,f=i.coefficient,p=f===void 0?.5:f,g=i.power,v=g===void 0?1:g,x=i.hollowRadius,T=x===void 0?0:x,S=i.backside,E=S===void 0?!0:S;Xf(this,e),r=Qf(this,e);var N=$W(t,c),P=jW(p,o,v,T);return E&&(P.side=HA.BackSide),r.geometry=N,r.material=P,r}return Kf(e,n),Yf(e)})(HA.Mesh),cs=window.THREE?window.THREE:{Color:jn,Group:Os,LineBasicMaterial:Af,LineSegments:t4,Mesh:gn,MeshPhongMaterial:Qx,SphereGeometry:Jo,SRGBColorSpace:XA,TextureLoader:Wg},_S=$n({props:{globeImageUrl:{},bumpImageUrl:{},showGlobe:{default:!0,onChange:function(e,t){t.globeGroup.visible=!!e},triggerUpdate:!1},showGraticules:{default:!1,onChange:function(e,t){t.graticulesObj.visible=!!e},triggerUpdate:!1},showAtmosphere:{default:!0,onChange:function(e,t){t.atmosphereObj&&(t.atmosphereObj.visible=!!e)},triggerUpdate:!1},atmosphereColor:{default:"lightskyblue"},atmosphereAltitude:{default:.15},globeCurvatureResolution:{default:4},globeTileEngineUrl:{onChange:function(e,t){t.tileEngine.tileUrl=e}},globeTileEngineMaxLevel:{default:17,onChange:function(e,t){t.tileEngine.maxLevel=e},triggerUpdate:!1},updatePov:{onChange:function(e,t){t.tileEngine.updatePov(e)},triggerUpdate:!1},onReady:{default:function(){},triggerUpdate:!1}},methods:{globeMaterial:function(e,t){return t!==void 0?(e.globeObj.material=t||e.defaultGlobeMaterial,this):e.globeObj.material},globeTileEngineClearCache:function(e){e.tileEngine.clearTiles()},_destructor:function(e){tn(e.globeObj),tn(e.tileEngine),tn(e.graticulesObj)}},stateInit:function(){var e=new cs.MeshPhongMaterial({color:0}),t=new cs.Mesh(void 0,e);t.rotation.y=-Math.PI/2;var r=new XP(on),i=new cs.Group;i.__globeObjType="globe",i.add(t),i.add(r);var s=new cs.LineSegments(new rT(fP(),on,2),new cs.LineBasicMaterial({color:"lightgrey",transparent:!0,opacity:.1}));return{globeGroup:i,globeObj:t,graticulesObj:s,defaultGlobeMaterial:e,tileEngine:r}},init:function(e,t){tn(e),t.scene=e,t.scene.add(t.globeGroup),t.scene.add(t.graticulesObj),t.ready=!1},update:function(e,t){var r=e.globeObj.material;if(e.tileEngine.visible=!(e.globeObj.visible=!e.globeTileEngineUrl),t.hasOwnProperty("globeCurvatureResolution")){var i;(i=e.globeObj.geometry)===null||i===void 0||i.dispose();var s=Math.max(4,Math.round(360/e.globeCurvatureResolution));e.globeObj.geometry=new cs.SphereGeometry(on,s,s/2),e.tileEngine.curvatureResolution=e.globeCurvatureResolution}if(t.hasOwnProperty("globeImageUrl")&&(e.globeImageUrl?new cs.TextureLoader().load(e.globeImageUrl,function(a){a.colorSpace=cs.SRGBColorSpace,r.map=a,r.color=null,r.needsUpdate=!0,!e.ready&&(e.ready=!0)&&setTimeout(e.onReady)}):!r.color&&(r.color=new cs.Color(0))),t.hasOwnProperty("bumpImageUrl")&&(e.bumpImageUrl?e.bumpImageUrl&&new cs.TextureLoader().load(e.bumpImageUrl,function(a){r.bumpMap=a,r.needsUpdate=!0}):(r.bumpMap=null,r.needsUpdate=!0)),(t.hasOwnProperty("atmosphereColor")||t.hasOwnProperty("atmosphereAltitude"))&&(e.atmosphereObj&&(e.scene.remove(e.atmosphereObj),tn(e.atmosphereObj)),e.atmosphereColor&&e.atmosphereAltitude)){var o=e.atmosphereObj=new HW(e.globeObj.geometry,{color:e.atmosphereColor,size:on*e.atmosphereAltitude,hollowRadius:on,coefficient:.1,power:3.5});o.visible=!!e.showAtmosphere,o.__globeObjType="atmosphere",e.scene.add(o)}!e.ready&&(!e.globeImageUrl||e.globeTileEngineUrl)&&(e.ready=!0,e.onReady())}}),Bs=function(e){return isNaN(e)?parseInt(Xe(e).toHex(),16):e},Qi=function(e){return e&&isNaN(e)?$a(e).opacity:1},Zo=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i,s=1,o=/^rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.eE+-]+)\s*\)$/.exec(e.trim().toLowerCase());if(o){var a=o.slice(1),c=un(a,4),f=c[0],p=c[1],g=c[2],v=c[3];i=new jn("rgb(".concat(+f,",").concat(+p,",").concat(+g,")")),s=Math.min(+v,1)}else i=new jn(e);r&&i.convertLinearToSRGB();var x=i.toArray();return t?[].concat(Kt(x),[s]):x};function WW(n,e,t){return n.opacity=e,n.transparent=e<1,n.depthWrite=e>=1,n}var Ib=window.THREE?window.THREE:{BufferAttribute:Hi};function Ds(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float32Array;if(e===1)return new Ib.BufferAttribute(new t(n),e);for(var r=new Ib.BufferAttribute(new t(n.length*e),e),i=0,s=n.length;i<s;i++)r.set(n[i],i*e);return r}function QW(n){for(var e=n.itemSize,t=[],r=0;r<n.count;r++)t.push(n.array.slice(r*e,(r+1)*e));return t}var Fp=new WeakMap,u0=new WeakMap,A0=new WeakMap,Wr=(function(n){function e(t){var r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=i.dataBindAttr,o=s===void 0?"__data":s,a=i.objBindAttr,c=a===void 0?"__threeObj":a,f=i.removeDelay,p=f===void 0?0:f;return Xf(this,e),r=Qf(this,e),tr(r,"scene",void 0),Dp(r,Fp,void 0),Dp(r,u0,void 0),Dp(r,A0,void 0),r.scene=t,Lp(Fp,r,o),Lp(u0,r,c),Lp(A0,r,p),r.onRemoveObj(function(){}),r}return Kf(e,n),Yf(e,[{key:"onCreateObj",value:function(r){var i=this;return Op(e,"onCreateObj",this)([function(s){var o=r(s);return s[Yu(u0,i)]=o,o[Yu(Fp,i)]=s,i.scene.add(o),o}]),this}},{key:"onRemoveObj",value:function(r){var i=this;return Op(e,"onRemoveObj",this)([function(s,o){var a=Op(e,"getData",i)([s]);r(s,o);var c=function(){i.scene.remove(s),tn(s),delete a[Yu(u0,i)]};Yu(A0,i)?setTimeout(c,Yu(A0,i)):c()}]),this}}])})(wD),Oi=window.THREE?window.THREE:{BufferGeometry:Hr,CylinderGeometry:mx,Matrix4:dn,Mesh:gn,MeshLambertMaterial:ho,Object3D:nf,Vector3:ge},kb=Object.assign({},E1),Ub=kb.BufferGeometryUtils||kb,vS=$n({props:{pointsData:{default:[]},pointLat:{default:"lat"},pointLng:{default:"lng"},pointColor:{default:function(){return"#ffffaa"}},pointAltitude:{default:.1},pointRadius:{default:.25},pointResolution:{default:12,triggerUpdate:!1},pointsMerge:{default:!1},pointsTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,r){var i=r.tweenGroup;tn(e),t.scene=e,t.tweenGroup=i,t.dataMapper=new Wr(e,{objBindAttr:"__threeObjPoint"})},update:function(e,t){var r=be(e.pointLat),i=be(e.pointLng),s=be(e.pointAltitude),o=be(e.pointRadius),a=be(e.pointColor),c=new Oi.CylinderGeometry(1,1,1,e.pointResolution);c.applyMatrix4(new Oi.Matrix4().makeRotationX(Math.PI/2)),c.applyMatrix4(new Oi.Matrix4().makeTranslation(0,0,-.5));var f=2*Math.PI*on/360,p={};if(!e.pointsMerge&&t.hasOwnProperty("pointsMerge")&&tn(e.scene),e.dataMapper.scene=e.pointsMerge?new Oi.Object3D:e.scene,e.dataMapper.onCreateObj(x).onUpdateObj(T).digest(e.pointsData),e.pointsMerge){var g=e.pointsData.length?(Ub.mergeGeometries||Ub.mergeBufferGeometries)(e.pointsData.map(function(S){var E=e.dataMapper.getObj(S),N=E.geometry.clone();E.updateMatrix(),N.applyMatrix4(E.matrix);var P=Zo(a(S));return N.setAttribute("color",Ds(Array(N.getAttribute("position").count).fill(P),4)),N})):new Oi.BufferGeometry,v=new Oi.Mesh(g,new Oi.MeshLambertMaterial({color:16777215,transparent:!0,vertexColors:!0}));v.__globeObjType="points",v.__data=e.pointsData,e.dataMapper.clear(),tn(e.scene),e.scene.add(v)}function x(){var S=new Oi.Mesh(c);return S.__globeObjType="point",S}function T(S,E){var N=function(U){var j=S.__currentTargetD=U,J=j.r,Q=j.alt,K=j.lat,te=j.lng;Object.assign(S.position,Ni(K,te));var oe=e.pointsMerge?new Oi.Vector3(0,0,0):e.scene.localToWorld(new Oi.Vector3(0,0,0));S.lookAt(oe),S.scale.x=S.scale.y=Math.min(30,J)*f,S.scale.z=Math.max(Q*on,.1)},P={alt:+s(E),r:+o(E),lat:+r(E),lng:+i(E)},B=S.__currentTargetD||Object.assign({},P,{alt:-.001});if(Object.keys(P).some(function(I){return B[I]!==P[I]})&&(e.pointsMerge||!e.pointsTransitionDuration||e.pointsTransitionDuration<0?N(P):e.tweenGroup.add(new Gr(B).to(P,e.pointsTransitionDuration).easing(er.Quadratic.InOut).onUpdate(N).start())),!e.pointsMerge){var L=a(E),k=L?Qi(L):0,q=!!k;S.visible=q,q&&(p.hasOwnProperty(L)||(p[L]=new Oi.MeshLambertMaterial({color:Bs(L),transparent:k<1,opacity:k})),S.material=p[L])}}}}),bS=function(){return{uniforms:{dashOffset:{value:0},dashSize:{value:1},gapSize:{value:0},dashTranslate:{value:0}},vertexShader:`
    `.concat(Cu.common,`
    `).concat(Cu.logdepthbuf_pars_vertex,`
  
    uniform float dashTranslate; 

    attribute vec4 color;
    varying vec4 vColor;
    
    attribute float relDistance;
    varying float vRelDistance;

    void main() {
      // pass through colors and distances
      vColor = color;
      vRelDistance = relDistance + dashTranslate;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  
      `).concat(Cu.logdepthbuf_vertex,`
    }
  `),fragmentShader:`
    `.concat(Cu.logdepthbuf_pars_fragment,`

    uniform float dashOffset; 
    uniform float dashSize;
    uniform float gapSize; 
    
    varying vec4 vColor;
    varying float vRelDistance;
    
    void main() {
      // ignore pixels in the gap
      if (vRelDistance < dashOffset) discard;
      if (mod(vRelDistance - dashOffset, dashSize + gapSize) > dashSize) discard;
    
      // set px color: [r, g, b, a], interpolated between vertices 
      gl_FragColor = vColor; 
  
      `).concat(Cu.logdepthbuf_fragment,`
    }
  `)}},Lg=function(e){return e.uniforms.uSurfaceRadius={type:"float",value:0},e.vertexShader=(`attribute float surfaceRadius;
varying float vSurfaceRadius;
varying vec3 vPos;
`+e.vertexShader).replace("void main() {",["void main() {","vSurfaceRadius = surfaceRadius;","vPos = position;"].join(`
`)),e.fragmentShader=(`uniform float uSurfaceRadius;
varying float vSurfaceRadius;
varying vec3 vPos;
`+e.fragmentShader).replace("void main() {",["void main() {","if (length(vPos) < max(uSurfaceRadius, vSurfaceRadius)) discard;"].join(`
`)),e},XW=function(e){return e.vertexShader=`
    attribute float r;
    
    const float PI = 3.1415926535897932384626433832795;
    float toRad(in float a) {
      return a * PI / 180.0;
    }
    
    vec3 Polar2Cartesian(in vec3 c) { // [lat, lng, r]
      float phi = toRad(90.0 - c.x);
      float theta = toRad(90.0 - c.y);
      float r = c.z;
      return vec3( // x,y,z
        r * sin(phi) * cos(theta),
        r * cos(phi),
        r * sin(phi) * sin(theta)
      );
    }
    
    vec2 Cartesian2Polar(in vec3 p) {
      float r = sqrt(p.x * p.x + p.y * p.y + p.z * p.z);
      float phi = acos(p.y / r);
      float theta = atan(p.z, p.x);
      return vec2( // lat,lng
        90.0 - phi * 180.0 / PI,
        90.0 - theta * 180.0 / PI - (theta < -PI / 2.0 ? 360.0 : 0.0)
      );
    }
    `.concat(e.vertexShader.replace("}",`                  
        vec3 pos = Polar2Cartesian(vec3(Cartesian2Polar(position), r));
        gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
      }
    `),`
  `),e},fy=function(e,t){return e.onBeforeCompile=function(r){e.userData.shader=t(r)},e},YW=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(i){return i};if(e.userData.shader)t(e.userData.shader.uniforms);else{var r=e.onBeforeCompile;e.onBeforeCompile=function(i){r(i),t(i.uniforms)}}},KW=["stroke"],Fi=window.THREE?window.THREE:{BufferGeometry:Hr,CubicBezierCurve3:iN,Curve:sN,Group:Os,Line:c1,Mesh:gn,NormalBlending:Ys,ShaderMaterial:eu,TubeGeometry:rN,Vector3:ge},ZW=ou.default||ou,xS=$n({props:{arcsData:{default:[]},arcStartLat:{default:"startLat"},arcStartLng:{default:"startLng"},arcStartAltitude:{default:0},arcEndLat:{default:"endLat"},arcEndLng:{default:"endLng"},arcEndAltitude:{default:0},arcColor:{default:function(){return"#ffffaa"}},arcAltitude:{},arcAltitudeAutoScale:{default:.5},arcStroke:{},arcCurveResolution:{default:64,triggerUpdate:!1},arcCircularResolution:{default:6,triggerUpdate:!1},arcDashLength:{default:1},arcDashGap:{default:0},arcDashInitialGap:{default:0},arcDashAnimateTime:{default:0},arcsTransitionDuration:{default:1e3,triggerUpdate:!1}},methods:{pauseAnimation:function(e){var t;(t=e.ticker)===null||t===void 0||t.pause()},resumeAnimation:function(e){var t;(t=e.ticker)===null||t===void 0||t.resume()},_destructor:function(e){var t;e.sharedMaterial.dispose(),(t=e.ticker)===null||t===void 0||t.dispose()}},stateInit:function(e){var t=e.tweenGroup;return{tweenGroup:t,ticker:new ZW,sharedMaterial:new Fi.ShaderMaterial(Vt(Vt({},bS()),{},{transparent:!0,blending:Fi.NormalBlending}))}},init:function(e,t){tn(e),t.scene=e,t.dataMapper=new Wr(e,{objBindAttr:"__threeObjArc"}).onCreateObj(function(){var r=new Fi.Group;return r.__globeObjType="arc",r}),t.ticker.onTick.add(function(r,i){t.dataMapper.entries().map(function(s){var o=un(s,2),a=o[1];return a}).filter(function(s){return s.children.length&&s.children[0].material&&s.children[0].__dashAnimateStep}).forEach(function(s){var o=s.children[0],a=o.__dashAnimateStep*i,c=o.material.uniforms.dashTranslate.value%1e9;o.material.uniforms.dashTranslate.value=c+a})})},update:function(e){var t=be(e.arcStartLat),r=be(e.arcStartLng),i=be(e.arcStartAltitude),s=be(e.arcEndLat),o=be(e.arcEndLng),a=be(e.arcEndAltitude),c=be(e.arcAltitude),f=be(e.arcAltitudeAutoScale),p=be(e.arcStroke),g=be(e.arcColor),v=be(e.arcDashLength),x=be(e.arcDashGap),T=be(e.arcDashInitialGap),S=be(e.arcDashAnimateTime);e.dataMapper.onUpdateObj(function(B,L){var k=p(L),q=k!=null;if(!B.children.length||q!==(B.children[0].type==="Mesh")){tn(B);var I=q?new Fi.Mesh:new Fi.Line(new Fi.BufferGeometry);I.material=e.sharedMaterial.clone(),B.add(I)}var U=B.children[0];Object.assign(U.material.uniforms,{dashSize:{value:v(L)},gapSize:{value:x(L)},dashOffset:{value:T(L)}});var j=S(L);U.__dashAnimateStep=j>0?1e3/j:0;var J=N(g(L),e.arcCurveResolution,q?e.arcCircularResolution+1:1),Q=P(e.arcCurveResolution,q?e.arcCircularResolution+1:1,!0);U.geometry.setAttribute("color",J),U.geometry.setAttribute("relDistance",Q);var K=function(ae){var he=B.__currentTargetD=ae,xe=he.stroke,me=IW(he,KW),Oe=E(me);q?(U.geometry&&U.geometry.dispose(),U.geometry=new Fi.TubeGeometry(Oe,e.arcCurveResolution,xe/2,e.arcCircularResolution),U.geometry.setAttribute("color",J),U.geometry.setAttribute("relDistance",Q)):U.geometry.setFromPoints(Oe.getPoints(e.arcCurveResolution))},te={stroke:k,alt:c(L),altAutoScale:+f(L),startLat:+t(L),startLng:+r(L),startAlt:+i(L),endLat:+s(L),endLng:+o(L),endAlt:+a(L)},oe=B.__currentTargetD||Object.assign({},te,{altAutoScale:-.001});Object.keys(te).some(function(Y){return oe[Y]!==te[Y]})&&(!e.arcsTransitionDuration||e.arcsTransitionDuration<0?K(te):e.tweenGroup.add(new Gr(oe).to(te,e.arcsTransitionDuration).easing(er.Quadratic.InOut).onUpdate(K).start()))}).digest(e.arcsData);function E(B){var L=B.alt,k=B.altAutoScale,q=B.startLat,I=B.startLng,U=B.startAlt,j=B.endLat,J=B.endLng,Q=B.endAlt,K=function(Lt){var Wt=un(Lt,3),Pn=Wt[0],Gn=Wt[1],bn=Wt[2],xn=Ni(Gn,Pn,bn),Bn=xn.x,Vn=xn.y,Qr=xn.z;return new Fi.Vector3(Bn,Vn,Qr)},te=[I,q],oe=[J,j],Y=L;if(Y==null&&(Y=Xo(te,oe)/2*k+Math.max(U,Q)),Y||U||Q){var ae=b1(te,oe),he=function(Lt,Wt){return Wt+(Wt-Lt)*(Lt<Wt?.5:.25)},xe=[.25,.75].map(function(mt){return[].concat(Kt(ae(mt)),[he(mt<.5?U:Q,Y)])}),me=un(xe,2),Oe=me[0],ke=me[1],Ke=Ay(Fi.CubicBezierCurve3,Kt([[].concat(te,[U]),Oe,ke,[].concat(oe,[Q])].map(K)));return Ke}else{var Ye=.001;return Ft.apply(void 0,Kt([[].concat(te,[Ye]),[].concat(oe,[Ye])].map(K)))}function Ft(mt,Lt){var Wt=mt.angleTo(Lt),Pn=Wt===0?function(){return mt.clone()}:function(bn){return new Fi.Vector3().addVectors(mt.clone().multiplyScalar(Math.sin((1-bn)*Wt)),Lt.clone().multiplyScalar(Math.sin(bn*Wt))).divideScalar(Math.sin(Wt))},Gn=new Fi.Curve;return Gn.getPoint=Pn,Gn}}function N(B,L){var k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,q=L+1,I;if(B instanceof Array||B instanceof Function){var U=B instanceof Array?io().domain(B.map(function(Y,ae){return ae/(B.length-1)})).range(B):B;I=function(ae){return Zo(U(ae),!0,!0)}}else{var j=Zo(B,!0,!0);I=function(){return j}}for(var J=[],Q=0,K=q;Q<K;Q++)for(var te=I(Q/(K-1)),oe=0;oe<k;oe++)J.push(te);return Ds(J,4)}function P(B){for(var L=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,q=B+1,I=[],U=0,j=q;U<j;U++)for(var J=U/(j-1),Q=0;Q<L;Q++)I.push(J);return k&&I.reverse(),Ds(I,1)}}}),No=window.THREE?window.THREE:{BufferGeometry:Hr,DoubleSide:xi,Mesh:gn,MeshLambertMaterial:ho,Object3D:nf},qb=Object.assign({},E1),Gb=qb.BufferGeometryUtils||qb,TS=$n({props:{hexBinPointsData:{default:[]},hexBinPointLat:{default:"lat"},hexBinPointLng:{default:"lng"},hexBinPointWeight:{default:1},hexBinResolution:{default:4},hexMargin:{default:.2},hexTopCurvatureResolution:{default:5},hexTopColor:{default:function(){return"#ffffaa"}},hexSideColor:{default:function(){return"#ffffaa"}},hexAltitude:{default:function(e){var t=e.sumWeight;return t*.01}},hexBinMerge:{default:!1},hexTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,r){var i=r.tweenGroup;tn(e),t.scene=e,t.tweenGroup=i,t.dataMapper=new Wr(e,{objBindAttr:"__threeObjHexbin"})},update:function(e,t){var r=be(e.hexBinPointLat),i=be(e.hexBinPointLng),s=be(e.hexBinPointWeight),o=be(e.hexAltitude),a=be(e.hexTopColor),c=be(e.hexSideColor),f=be(e.hexMargin),p=HL(e.hexBinPointsData.map(function(P){return Vt(Vt({},P),{},{h3Idx:PO(r(P),i(P),e.hexBinResolution)})}),"h3Idx"),g=Object.entries(p).map(function(P){var B=un(P,2),L=B[0],k=B[1];return{h3Idx:L,points:k,sumWeight:k.reduce(function(q,I){return q+ +s(I)},0)}}),v={};if(!e.hexBinMerge&&t.hasOwnProperty("hexBinMerge")&&tn(e.scene),e.dataMapper.scene=e.hexBinMerge?new No.Object3D:e.scene,e.dataMapper.id(function(P){return P.h3Idx}).onCreateObj(E).onUpdateObj(N).digest(g),e.hexBinMerge){var x=g.length?(Gb.mergeGeometries||Gb.mergeBufferGeometries)(g.map(function(P){var B=e.dataMapper.getObj(P),L=B.geometry.toNonIndexed();B.updateMatrix(),L.applyMatrix4(B.matrix);var k=Zo(a(P)),q=Zo(c(P)),I=L.getAttribute("position").count,U=L.groups[0].count;return L.setAttribute("color",Ds(Kt(new Array(I)).map(function(j,J){return J>=U?k:q}),4)),L})):new No.BufferGeometry,T=new No.MeshLambertMaterial({color:16777215,transparent:!0,vertexColors:!0,side:No.DoubleSide});T.onBeforeCompile=function(P){T.userData.shader=Lg(P)};var S=new No.Mesh(x,T);S.__globeObjType="hexBinPoints",S.__data=g,e.dataMapper.clear(),tn(e.scene),e.scene.add(S)}function E(P){var B=new No.Mesh;B.__hexCenter=xT(P.h3Idx),B.__hexGeoJson=TT(P.h3Idx,!0).reverse();var L=B.__hexCenter[1];return B.__hexGeoJson.forEach(function(k){var q=k[0];Math.abs(L-q)>170&&(k[0]+=L>q?360:-360)}),B.__globeObjType="hexbin",B}function N(P,B){var L=function(he,xe,me){return he-(he-xe)*me},k=Math.max(0,Math.min(1,+f(B))),q=un(P.__hexCenter,2),I=q[0],U=q[1],j=k===0?P.__hexGeoJson:P.__hexGeoJson.map(function(ae){var he=un(ae,2),xe=he[0],me=he[1];return[[xe,U],[me,I]].map(function(Oe){var ke=un(Oe,2),Ke=ke[0],Ye=ke[1];return L(Ke,Ye,k)})}),J=e.hexTopCurvatureResolution;P.geometry&&P.geometry.dispose(),P.geometry=new P1([j],0,on,!1,!0,!0,J);var Q={alt:+o(B)},K=function(he){var xe=P.__currentTargetD=he,me=xe.alt;P.scale.x=P.scale.y=P.scale.z=1+me;var Oe=on/(me+1);P.geometry.setAttribute("surfaceRadius",Ds(Array(P.geometry.getAttribute("position").count).fill(Oe),1))},te=P.__currentTargetD||Object.assign({},Q,{alt:-.001});if(Object.keys(Q).some(function(ae){return te[ae]!==Q[ae]})&&(e.hexBinMerge||!e.hexTransitionDuration||e.hexTransitionDuration<0?K(Q):e.tweenGroup.add(new Gr(te).to(Q,e.hexTransitionDuration).easing(er.Quadratic.InOut).onUpdate(K).start())),!e.hexBinMerge){var oe=c(B),Y=a(B);[oe,Y].forEach(function(ae){if(!v.hasOwnProperty(ae)){var he=Qi(ae);v[ae]=fy(new No.MeshLambertMaterial({color:Bs(ae),transparent:he<1,opacity:he,side:No.DoubleSide}),Lg)}}),P.material=[oe,Y].map(function(ae){return v[ae]})}}}}),wS=function(e){return e*e},Ws=function(e){return e*Math.PI/180};function JW(n,e){var t=Math.sqrt,r=Math.cos,i=function(p){return wS(Math.sin(p/2))},s=Ws(n[1]),o=Ws(e[1]),a=Ws(n[0]),c=Ws(e[0]);return 2*Math.asin(t(i(o-s)+r(s)*r(o)*i(c-a)))}var eQ=Math.sqrt(2*Math.PI);function tQ(n,e){return Math.exp(-wS(n/e)/2)/(e*eQ)}var nQ=function(e){var t=un(e,2),r=t[0],i=t[1],s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=o.lngAccessor,c=a===void 0?function(E){return E[0]}:a,f=o.latAccessor,p=f===void 0?function(E){return E[1]}:f,g=o.weightAccessor,v=g===void 0?function(){return 1}:g,x=o.bandwidth,T=[r,i],S=x*Math.PI/180;return zM(s.map(function(E){var N=v(E);if(!N)return 0;var P=JW(T,[c(E),p(E)]);return tQ(P,S)*N}))},rQ=(function(){var n=MW(Bg().m(function e(t){var r,i,s,o,a,c,f,p,g,v,x,T,S,E,N,P,B,L,k,q,I,U,j,J,Q,K,te,oe,Y,ae,he,xe,me,Oe,ke,Ke,Ye,Ft,mt,Lt,Wt=arguments,Pn,Gn,bn;return Bg().w(function(xn){for(;;)switch(xn.n){case 0:if(i=Wt.length>1&&Wt[1]!==void 0?Wt[1]:[],s=Wt.length>2&&Wt[2]!==void 0?Wt[2]:{},o=s.lngAccessor,a=o===void 0?function(Bn){return Bn[0]}:o,c=s.latAccessor,f=c===void 0?function(Bn){return Bn[1]}:c,p=s.weightAccessor,g=p===void 0?function(){return 1}:p,v=s.bandwidth,(r=navigator)!==null&&r!==void 0&&r.gpu){xn.n=1;break}return console.warn("WebGPU not enabled in browser. Please consider enabling it to improve performance."),xn.a(2,t.map(function(Bn){return nQ(Bn,i,{lngAccessor:a,latAccessor:f,weightAccessor:g,bandwidth:v})}));case 1:return x=4,T=aW,S=lW,E=_W,N=yW,P=fW,B=dW,L=uW,k=gW,q=mW,I=cW,U=AW,j=hW,J=pW,Q=N(new G0(new Float32Array(t.flat().map(Ws)),2),"vec2",t.length),K=N(new G0(new Float32Array(i.map(function(Bn){return[Ws(a(Bn)),Ws(f(Bn)),g(Bn)]}).flat()),3),"vec3",i.length),te=new G0(t.length,1),oe=N(te,"float",t.length),Y=P(Math.PI),ae=k(Y.mul(2)),he=function(Vn){return Vn.mul(Vn)},xe=function(Vn){return he(q(Vn.div(2)))},me=function(Vn,Qr){var mo=P(Vn[1]),la=P(Qr[1]),ui=P(Vn[0]),Di=P(Qr[0]);return P(2).mul(U(k(xe(la.sub(mo)).add(I(mo).mul(I(la)).mul(xe(Di.sub(ui)))))))},Oe=function(Vn,Qr){return j(J(he(Vn.div(Qr)).div(2))).div(Qr.mul(ae))},ke=E(Ws(v)),Ke=E(Ws(v*x)),Ye=E(i.length),Ft=T(function(){var Bn=Q.element(B),Vn=oe.element(B);Vn.assign(0),L(Ye,function(Qr){var mo=Qr.i,la=K.element(mo),ui=la.z;S(ui,function(){var Di=me(la.xy,Bn.xy);S(Di&&Di.lessThan(Ke),function(){Vn.addAssign(Oe(Di,ke).mul(ui))})})})}),mt=Ft().compute(t.length),Lt=new cS,xn.n=2,Lt.computeAsync(mt);case 2:return Pn=Array,Gn=Float32Array,xn.n=3,Lt.getArrayBufferAsync(te);case 3:return bn=xn.v,xn.a(2,Pn.from.call(Pn,new Gn(bn)))}},e)}));return function(t){return n.apply(this,arguments)}})(),c0=window.THREE?window.THREE:{Mesh:gn,MeshLambertMaterial:ho,SphereGeometry:Jo},iQ=3.5,sQ=.1,Vb=100,oQ=function(e){var t=$a(DO(e));return t.opacity=Math.cbrt(e),t.formatRgb()},SS=$n({props:{heatmapsData:{default:[]},heatmapPoints:{default:function(e){return e}},heatmapPointLat:{default:function(e){return e[0]}},heatmapPointLng:{default:function(e){return e[1]}},heatmapPointWeight:{default:1},heatmapBandwidth:{default:2.5},heatmapColorFn:{default:function(){return oQ}},heatmapColorSaturation:{default:1.5},heatmapBaseAltitude:{default:.01},heatmapTopAltitude:{},heatmapsTransitionDuration:{default:0,triggerUpdate:!1}},init:function(e,t,r){var i=r.tweenGroup;tn(e),t.scene=e,t.tweenGroup=i,t.dataMapper=new Wr(e,{objBindAttr:"__threeObjHeatmap"}).onCreateObj(function(){var s=new c0.Mesh(new c0.SphereGeometry(on),fy(new c0.MeshLambertMaterial({vertexColors:!0,transparent:!0}),XW));return s.__globeObjType="heatmap",s})},update:function(e){var t=be(e.heatmapPoints),r=be(e.heatmapPointLat),i=be(e.heatmapPointLng),s=be(e.heatmapPointWeight),o=be(e.heatmapBandwidth),a=be(e.heatmapColorFn),c=be(e.heatmapColorSaturation),f=be(e.heatmapBaseAltitude),p=be(e.heatmapTopAltitude);e.dataMapper.onUpdateObj(function(g,v){var x=o(v),T=a(v),S=c(v),E=f(v),N=p(v),P=t(v).map(function(I){var U=r(I),j=i(I),J=Ni(U,j),Q=J.x,K=J.y,te=J.z;return{x:Q,y:K,z:te,lat:U,lng:j,weight:s(I)}}),B=Math.max(sQ,x/iQ),L=Math.ceil(360/(B||-1));g.geometry.parameters.widthSegments!==L&&(g.geometry.dispose(),g.geometry=new c0.SphereGeometry(on,L,L/2));var k=QW(g.geometry.getAttribute("position")),q=k.map(function(I){var U=un(I,3),j=U[0],J=U[1],Q=U[2],K=yS({x:j,y:J,z:Q}),te=K.lng,oe=K.lat;return[te,oe]});rQ(q,P,{latAccessor:function(U){return U.lat},lngAccessor:function(U){return U.lng},weightAccessor:function(U){return U.weight},bandwidth:x}).then(function(I){var U=Kt(new Array(Vb)).map(function(K,te){return Zo(T(te/(Vb-1)))}),j=function(te){var oe=g.__currentTargetD=te,Y=oe.kdeVals,ae=oe.topAlt,he=oe.saturation,xe=qM(Y.map(Math.abs))||1e-15,me=T4([0,xe/he],U);g.geometry.setAttribute("color",Ds(Y.map(function(ke){return me(Math.abs(ke))}),4));var Oe=io([0,xe],[on*(1+E),on*(1+(ae||E))]);g.geometry.setAttribute("r",Ds(Y.map(Oe)))},J={kdeVals:I,topAlt:N,saturation:S},Q=g.__currentTargetD||Object.assign({},J,{kdeVals:I.map(function(){return 0}),topAlt:N&&E,saturation:.5});Q.kdeVals.length!==I.length&&(Q.kdeVals=I.slice()),Object.keys(J).some(function(K){return Q[K]!==J[K]})&&(!e.heatmapsTransitionDuration||e.heatmapsTransitionDuration<0?j(J):e.tweenGroup.add(new Gr(Q).to(J,e.heatmapsTransitionDuration).easing(er.Quadratic.InOut).onUpdate(j).start()))})}).digest(e.heatmapsData)}}),Mo=window.THREE?window.THREE:{DoubleSide:xi,Group:Os,LineBasicMaterial:Af,LineSegments:t4,Mesh:gn,MeshBasicMaterial:ds},ES=$n({props:{polygonsData:{default:[]},polygonGeoJsonGeometry:{default:"geometry"},polygonSideColor:{default:function(){return"#ffffaa"}},polygonSideMaterial:{},polygonCapColor:{default:function(){return"#ffffaa"}},polygonCapMaterial:{},polygonStrokeColor:{},polygonAltitude:{default:.01},polygonCapCurvatureResolution:{default:5},polygonsTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,r){var i=r.tweenGroup;tn(e),t.scene=e,t.tweenGroup=i,t.dataMapper=new Wr(e,{objBindAttr:"__threeObjPolygon"}).id(function(s){return s.id}).onCreateObj(function(){var s=new Mo.Group;return s.__defaultSideMaterial=fy(new Mo.MeshBasicMaterial({side:Mo.DoubleSide,depthWrite:!0}),Lg),s.__defaultCapMaterial=new Mo.MeshBasicMaterial({side:Mo.DoubleSide,depthWrite:!0}),s.add(new Mo.Mesh(void 0,[s.__defaultSideMaterial,s.__defaultCapMaterial])),s.add(new Mo.LineSegments(void 0,new Mo.LineBasicMaterial)),s.__globeObjType="polygon",s})},update:function(e){var t=be(e.polygonGeoJsonGeometry),r=be(e.polygonAltitude),i=be(e.polygonCapCurvatureResolution),s=be(e.polygonCapColor),o=be(e.polygonCapMaterial),a=be(e.polygonSideColor),c=be(e.polygonSideMaterial),f=be(e.polygonStrokeColor),p=[];e.polygonsData.forEach(function(g){var v={data:g,capColor:s(g),capMaterial:o(g),sideColor:a(g),sideMaterial:c(g),strokeColor:f(g),altitude:+r(g),capCurvatureResolution:+i(g)},x=t(g),T=g.__id||"".concat(Math.round(Math.random()*1e9));g.__id=T,x.type==="Polygon"?p.push(Vt({id:"".concat(T,"_0"),coords:x.coordinates},v)):x.type==="MultiPolygon"?p.push.apply(p,Kt(x.coordinates.map(function(S,E){return Vt({id:"".concat(T,"_").concat(E),coords:S},v)}))):console.warn("Unsupported GeoJson geometry type: ".concat(x.type,". Skipping geometry..."))}),e.dataMapper.onUpdateObj(function(g,v){var x=v.coords,T=v.capColor,S=v.capMaterial,E=v.sideColor,N=v.sideMaterial,P=v.strokeColor,B=v.altitude,L=v.capCurvatureResolution,k=un(g.children,2),q=k[0],I=k[1],U=!!P;I.visible=U;var j=!!(T||S),J=!!(E||N);aQ(q.geometry.parameters||{},{polygonGeoJson:x,curvatureResolution:L,closedTop:j,includeSides:J})||(q.geometry&&q.geometry.dispose(),q.geometry=new P1(x,0,on,!1,j,J,L)),U&&(!I.geometry.parameters||I.geometry.parameters.geoJson.coordinates!==x||I.geometry.parameters.resolution!==L)&&(I.geometry&&I.geometry.dispose(),I.geometry=new rT({type:"Polygon",coordinates:x},on,L));var Q=J?0:-1,K=j?J?1:0:-1;if(Q>=0&&(q.material[Q]=N||g.__defaultSideMaterial),K>=0&&(q.material[K]=S||g.__defaultCapMaterial),[[!N&&E,Q],[!S&&T,K]].forEach(function(xe){var me=un(xe,2),Oe=me[0],ke=me[1];if(!(!Oe||ke<0)){var Ke=q.material[ke],Ye=Qi(Oe);Ke.color.set(Bs(Oe)),Ke.transparent=Ye<1,Ke.opacity=Ye}}),U){var te=I.material,oe=Qi(P);te.color.set(Bs(P)),te.transparent=oe<1,te.opacity=oe}var Y={alt:B},ae=function(me){var Oe=g.__currentTargetD=me,ke=Oe.alt;q.scale.x=q.scale.y=q.scale.z=1+ke,U&&(I.scale.x=I.scale.y=I.scale.z=1+ke+1e-4),YW(g.__defaultSideMaterial,function(Ke){return Ke.uSurfaceRadius.value=on/(ke+1)})},he=g.__currentTargetD||Object.assign({},Y,{alt:-.001});Object.keys(Y).some(function(xe){return he[xe]!==Y[xe]})&&(!e.polygonsTransitionDuration||e.polygonsTransitionDuration<0||he.alt===Y.alt?ae(Y):e.tweenGroup.add(new Gr(he).to(Y,e.polygonsTransitionDuration).easing(er.Quadratic.InOut).onUpdate(ae).start()))}).digest(p)}});function aQ(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){return function(r,i){return r===i}};return Object.entries(e).every(function(r){var i=un(r,2),s=i[0],o=i[1];return n.hasOwnProperty(s)&&t(s)(n[s],o)})}var Rl=window.THREE?window.THREE:{BufferGeometry:Hr,DoubleSide:xi,Mesh:gn,MeshLambertMaterial:ho,Vector3:ge},zb=Object.assign({},E1),jb=zb.BufferGeometryUtils||zb,RS=$n({props:{hexPolygonsData:{default:[]},hexPolygonGeoJsonGeometry:{default:"geometry"},hexPolygonColor:{default:function(){return"#ffffaa"}},hexPolygonAltitude:{default:.001},hexPolygonResolution:{default:3},hexPolygonMargin:{default:.2},hexPolygonUseDots:{default:!1},hexPolygonCurvatureResolution:{default:5},hexPolygonDotResolution:{default:12},hexPolygonsTransitionDuration:{default:0,triggerUpdate:!1}},init:function(e,t,r){var i=r.tweenGroup;tn(e),t.scene=e,t.tweenGroup=i,t.dataMapper=new Wr(e,{objBindAttr:"__threeObjHexPolygon"}).onCreateObj(function(){var s=new Rl.Mesh(void 0,new Rl.MeshLambertMaterial({side:Rl.DoubleSide}));return s.__globeObjType="hexPolygon",s})},update:function(e){var t=be(e.hexPolygonGeoJsonGeometry),r=be(e.hexPolygonColor),i=be(e.hexPolygonAltitude),s=be(e.hexPolygonResolution),o=be(e.hexPolygonMargin),a=be(e.hexPolygonUseDots),c=be(e.hexPolygonCurvatureResolution),f=be(e.hexPolygonDotResolution);e.dataMapper.onUpdateObj(function(p,g){var v=t(g),x=s(g),T=i(g),S=Math.max(0,Math.min(1,+o(g))),E=a(g),N=c(g),P=f(g),B=r(g),L=Qi(B);p.material.color.set(Bs(B)),p.material.transparent=L<1,p.material.opacity=L;var k={alt:T,margin:S,curvatureResolution:N},q={geoJson:v,h3Res:x},I=p.__currentTargetD||Object.assign({},k,{alt:-.001}),U=p.__currentMemD||q;if(Object.keys(k).some(function(K){return I[K]!==k[K]})||Object.keys(q).some(function(K){return U[K]!==q[K]})){p.__currentMemD=q;var j=[];v.type==="Polygon"?ov(v.coordinates,x,!0).forEach(function(K){return j.push(K)}):v.type==="MultiPolygon"?v.coordinates.forEach(function(K){return ov(K,x,!0).forEach(function(te){return j.push(te)})}):console.warn("Unsupported GeoJson geometry type: ".concat(v.type,". Skipping geometry..."));var J=j.map(function(K){var te=xT(K),oe=TT(K,!0).reverse(),Y=te[1];return oe.forEach(function(ae){var he=ae[0];Math.abs(Y-he)>170&&(ae[0]+=Y>he?360:-360)}),{h3Idx:K,hexCenter:te,hexGeoJson:oe}}),Q=function(te){var oe=p.__currentTargetD=te,Y=oe.alt,ae=oe.margin,he=oe.curvatureResolution;p.geometry&&p.geometry.dispose(),p.geometry=J.length?(jb.mergeGeometries||jb.mergeBufferGeometries)(J.map(function(xe){var me=un(xe.hexCenter,2),Oe=me[0],ke=me[1];if(E){var Ke=Ni(Oe,ke,Y),Ye=Ni(xe.hexGeoJson[0][1],xe.hexGeoJson[0][0],Y),Ft=.85*(1-ae)*new Rl.Vector3(Ke.x,Ke.y,Ke.z).distanceTo(new Rl.Vector3(Ye.x,Ye.y,Ye.z)),mt=new e4(Ft,P);return mt.rotateX(Na(-Oe)),mt.rotateY(Na(ke)),mt.translate(Ke.x,Ke.y,Ke.z),mt}else{var Lt=function(Gn,bn,xn){return Gn-(Gn-bn)*xn},Wt=ae===0?xe.hexGeoJson:xe.hexGeoJson.map(function(Pn){var Gn=un(Pn,2),bn=Gn[0],xn=Gn[1];return[[bn,ke],[xn,Oe]].map(function(Bn){var Vn=un(Bn,2),Qr=Vn[0],mo=Vn[1];return Lt(Qr,mo,ae)})});return new P1([Wt],on,on*(1+Y),!1,!0,!1,he)}})):new Rl.BufferGeometry};!e.hexPolygonsTransitionDuration||e.hexPolygonsTransitionDuration<0?Q(k):e.tweenGroup.add(new Gr(I).to(k,e.hexPolygonsTransitionDuration).easing(er.Quadratic.InOut).onUpdate(Q).start())}}).digest(e.hexPolygonsData)}}),lQ=window.THREE?window.THREE:{Vector3:ge};function uQ(n,e){var t=function(o,a){var c=o[o.length-1];return[].concat(Kt(o),Kt(Array(a-o.length).fill(c)))},r=Math.max(n.length,e.length),i=s9.apply(void 0,Kt([n,e].map(function(s){return s.map(function(o){var a=o.x,c=o.y,f=o.z;return[a,c,f]})}).map(function(s){return t(s,r)})));return function(s){return s===0?n:s===1?e:i(s).map(function(o){var a=un(o,3),c=a[0],f=a[1],p=a[2];return new lQ.Vector3(c,f,p)})}}var xa=window.THREE?window.THREE:{BufferGeometry:Hr,Color:jn,Group:Os,Line:c1,NormalBlending:Ys,ShaderMaterial:eu,Vector3:ge},AQ=ou.default||ou,CS=$n({props:{pathsData:{default:[]},pathPoints:{default:function(e){return e}},pathPointLat:{default:function(e){return e[0]}},pathPointLng:{default:function(e){return e[1]}},pathPointAlt:{default:.001},pathResolution:{default:2},pathColor:{default:function(){return"#ffffaa"}},pathStroke:{},pathDashLength:{default:1},pathDashGap:{default:0},pathDashInitialGap:{default:0},pathDashAnimateTime:{default:0},pathTransitionDuration:{default:1e3,triggerUpdate:!1},rendererSize:{}},methods:{pauseAnimation:function(e){var t;(t=e.ticker)===null||t===void 0||t.pause()},resumeAnimation:function(e){var t;(t=e.ticker)===null||t===void 0||t.resume()},_destructor:function(e){var t;(t=e.ticker)===null||t===void 0||t.dispose()}},stateInit:function(e){var t=e.tweenGroup;return{tweenGroup:t,ticker:new AQ,sharedMaterial:new xa.ShaderMaterial(Vt(Vt({},bS()),{},{transparent:!0,blending:xa.NormalBlending}))}},init:function(e,t){tn(e),t.scene=e,t.dataMapper=new Wr(e,{objBindAttr:"__threeObjPath"}).onCreateObj(function(){var r=new xa.Group;return r.__globeObjType="path",r}),t.ticker.onTick.add(function(r,i){t.dataMapper.entries().map(function(s){var o=un(s,2),a=o[1];return a}).filter(function(s){return s.children.length&&s.children[0].material&&s.children[0].__dashAnimateStep}).forEach(function(s){var o=s.children[0],a=o.__dashAnimateStep*i;if(o.type==="Line"){var c=o.material.uniforms.dashTranslate.value%1e9;o.material.uniforms.dashTranslate.value=c+a}else if(o.type==="Line2"){for(var f=o.material.dashOffset-a,p=o.material.dashSize+o.material.gapSize;f<=-p;)f+=p;o.material.dashOffset=f}})})},update:function(e){var t=be(e.pathPoints),r=be(e.pathPointLat),i=be(e.pathPointLng),s=be(e.pathPointAlt),o=be(e.pathStroke),a=be(e.pathColor),c=be(e.pathDashLength),f=be(e.pathDashGap),p=be(e.pathDashInitialGap),g=be(e.pathDashAnimateTime);e.dataMapper.onUpdateObj(function(E,N){var P=o(N),B=P!=null;if(!E.children.length||B===(E.children[0].type==="Line")){tn(E);var L=B?new TW(new fS,new uy):new xa.Line(new xa.BufferGeometry,e.sharedMaterial.clone());E.add(L)}var k=E.children[0],q=x(t(N),r,i,s,e.pathResolution),I=g(N);if(k.__dashAnimateStep=I>0?1e3/I:0,B){k.material.resolution=e.rendererSize;{var J=c(N),Q=f(N),K=p(N);k.material.dashed=Q>0,k.material.dashed?k.material.defines.USE_DASH="":delete k.material.defines.USE_DASH,k.material.dashed&&(k.material.dashScale=1/v(q),k.material.dashSize=J,k.material.gapSize=Q,k.material.dashOffset=-K)}{var te=a(N);if(te instanceof Array){var oe=T(a(N),q.length-1,1,!1);k.geometry.setColors(oe.array),k.material.vertexColors=!0}else{var Y=te,ae=Qi(Y);k.material.color=new xa.Color(Bs(Y)),k.material.transparent=ae<1,k.material.opacity=ae,k.material.vertexColors=!1}}k.material.needsUpdate=!0}else{Object.assign(k.material.uniforms,{dashSize:{value:c(N)},gapSize:{value:f(N)},dashOffset:{value:p(N)}});var U=T(a(N),q.length),j=S(q.length,1,!0);k.geometry.setAttribute("color",U),k.geometry.setAttribute("relDistance",j)}var he=uQ(E.__currentTargetD&&E.__currentTargetD.points||[q[0]],q),xe=function(Ke){var Ye=E.__currentTargetD=Ke,Ft=Ye.stroke,mt=Ye.interpolK,Lt=E.__currentTargetD.points=he(mt);if(B){var Wt;k.geometry.setPositions((Wt=[]).concat.apply(Wt,Kt(Lt.map(function(Pn){var Gn=Pn.x,bn=Pn.y,xn=Pn.z;return[Gn,bn,xn]})))),k.material.linewidth=Ft,k.material.dashed&&k.computeLineDistances()}else k.geometry.setFromPoints(Lt),k.geometry.computeBoundingSphere()},me={stroke:P,interpolK:1},Oe=Object.assign({},E.__currentTargetD||me,{interpolK:0});Object.keys(me).some(function(ke){return Oe[ke]!==me[ke]})&&(!e.pathTransitionDuration||e.pathTransitionDuration<0?xe(me):e.tweenGroup.add(new Gr(Oe).to(me,e.pathTransitionDuration).easing(er.Quadratic.InOut).onUpdate(xe).start()))}).digest(e.pathsData);function v(E){var N=0,P;return E.forEach(function(B){P&&(N+=P.distanceTo(B)),P=B}),N}function x(E,N,P,B,L){var k=function(j,J,Q){for(var K=[],te=1;te<=Q;te++)K.push(j+(J-j)*te/(Q+1));return K},q=function(){var j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],J=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,Q=[],K=null;return j.forEach(function(te){if(K){for(;Math.abs(K[1]-te[1])>180;)K[1]+=360*(K[1]<te[1]?1:-1);var oe=Math.sqrt(Math.pow(te[0]-K[0],2)+Math.pow(te[1]-K[1],2));if(oe>J)for(var Y=Math.floor(oe/J),ae=k(K[0],te[0],Y),he=k(K[1],te[1],Y),xe=k(K[2],te[2],Y),me=0,Oe=ae.length;me<Oe;me++)Q.push([ae[me],he[me],xe[me]])}Q.push(K=te)}),Q},I=function(j){var J=un(j,3),Q=J[0],K=J[1],te=J[2],oe=Ni(Q,K,te),Y=oe.x,ae=oe.y,he=oe.z;return new xa.Vector3(Y,ae,he)};return q(E.map(function(U){return[N(U),P(U),B(U)]}),L).map(I)}function T(E,N){var P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,L=N+1,k;if(E instanceof Array||E instanceof Function){var q=E instanceof Array?io().domain(E.map(function(te,oe){return oe/(E.length-1)})).range(E):E;k=function(oe){return Zo(q(oe),B,!0)}}else{var I=Zo(E,B,!0);k=function(){return I}}for(var U=[],j=0,J=L;j<J;j++)for(var Q=k(j/(J-1)),K=0;K<P;K++)U.push(Q);return Ds(U,B?4:3)}function S(E){for(var N=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,B=E+1,L=[],k=0,q=B;k<q;k++)for(var I=k/(q-1),U=0;U<N;U++)L.push(I);return P&&L.reverse(),Ds(L,1)}}}),h0=window.THREE?window.THREE:{Euler:RA,Mesh:gn,MeshLambertMaterial:ho,SphereGeometry:Jo},NS=$n({props:{tilesData:{default:[]},tileLat:{default:"lat"},tileLng:{default:"lng"},tileAltitude:{default:.01},tileWidth:{default:1},tileHeight:{default:1},tileUseGlobeProjection:{default:!0},tileMaterial:{default:function(){return new h0.MeshLambertMaterial({color:"#ffbb88",opacity:.4,transparent:!0})}},tileCurvatureResolution:{default:5},tilesTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,r){var i=r.tweenGroup;tn(e),t.scene=e,t.tweenGroup=i,t.dataMapper=new Wr(e,{objBindAttr:"__threeObjTile"}).onCreateObj(function(){var s=new h0.Mesh;return s.__globeObjType="tile",s})},update:function(e){var t=be(e.tileLat),r=be(e.tileLng),i=be(e.tileAltitude),s=be(e.tileWidth),o=be(e.tileHeight),a=be(e.tileUseGlobeProjection),c=be(e.tileMaterial),f=be(e.tileCurvatureResolution);e.dataMapper.onUpdateObj(function(p,g){p.material=c(g);var v=a(g),x=f(g),T=function(P){var B=p.__currentTargetD=P,L=B.lat,k=B.lng,q=B.alt,I=B.width,U=B.height,j=Cl(k),J=Cl(-L);p.geometry&&p.geometry.dispose(),p.geometry=new h0.SphereGeometry(on*(1+q),Math.ceil(I/(x||-1)),Math.ceil(U/(x||-1)),Cl(90-I/2)+(v?j:0),Cl(I),Cl(90-U/2)+(v?J:0),Cl(U)),v||p.setRotationFromEuler(new h0.Euler(J,j,0,"YXZ"))},S={lat:+t(g),lng:+r(g),alt:+i(g),width:+s(g),height:+o(g)},E=p.__currentTargetD||Object.assign({},S,{width:0,height:0});Object.keys(S).some(function(N){return E[N]!==S[N]})&&(!e.tilesTransitionDuration||e.tilesTransitionDuration<0?T(S):e.tweenGroup.add(new Gr(E).to(S,e.tilesTransitionDuration).easing(er.Quadratic.InOut).onUpdate(T).start()))}).digest(e.tilesData)}}),Cl=function(e){return e*Math.PI/180},Ku=window.THREE?window.THREE:{BufferGeometry:Hr,Color:jn,Points:nN,PointsMaterial:Xx},MS=$n({props:{particlesData:{default:[]},particlesList:{default:function(e){return e}},particleLat:{default:"lat"},particleLng:{default:"lng"},particleAltitude:{default:.01},particlesSize:{default:.5},particlesSizeAttenuation:{default:!0},particlesColor:{default:function(){return"white"}},particlesTexture:{}},init:function(e,t){tn(e),t.scene=e,t.dataMapper=new Wr(e,{objBindAttr:"__threeObjParticles"}).onCreateObj(function(){var r=new Ku.Points(new Ku.BufferGeometry,new Ku.PointsMaterial);return r.__globeObjType="particles",r}).onUpdateObj(function(r,i){var s=be(t.particlesList),o=be(t.particleLat),a=be(t.particleLng),c=be(t.particleAltitude);r.geometry.setAttribute("position",Ds(s(i).map(function(f){return Object.values(Ni(o(f),a(f),c(f)))}),3))})},update:function(e,t){["particlesData","particlesList","particleLat","particleLng","particleAltitude"].some(function(a){return t.hasOwnProperty(a)})&&e.dataMapper.digest(e.particlesData);var r=be(e.particlesColor),i=be(e.particlesSize),s=be(e.particlesSizeAttenuation),o=be(e.particlesTexture);e.dataMapper.entries().forEach(function(a){var c=un(a,2),f=c[0],p=c[1];if(p.material.size=i(f),p.material.sizeAttenuation=s(f),e.particlesTexture)p.material.color=new Ku.Color(16777215),p.material.transparent=!1,p.material.alphaTest=.5,p.material.map=o(f);else{var g=r(f),v=Qi(g);p.material.color=new Ku.Color(Bs(g)),p.material.transparent=v<1,p.material.opacity=v,p.material.alphaTest=0}})}}),cQ=window.THREE?window.THREE:{BufferGeometry:Hr},hQ=(function(n){function e(){var t,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:32;Xf(this,e),t=Qf(this,e),t.type="CircleLineGeometry",t.parameters={radius:r,segmentCount:i};for(var s=[],o=0;o<=i;o++){var a=(o/i-.25)*Math.PI*2;s.push({x:Math.cos(a)*r,y:Math.sin(a)*r,z:0})}return t.setFromPoints(s),t}return Kf(e,n),Yf(e)})(cQ.BufferGeometry),Nl=window.THREE?window.THREE:{Color:jn,Group:Os,Line:c1,LineBasicMaterial:Af,Vector3:ge},fQ=ou.default||ou,PS=$n({props:{ringsData:{default:[]},ringLat:{default:"lat"},ringLng:{default:"lng"},ringAltitude:{default:.0015},ringColor:{default:function(){return"#ffffaa"},triggerUpdate:!1},ringResolution:{default:64,triggerUpdate:!1},ringMaxRadius:{default:2,triggerUpdate:!1},ringPropagationSpeed:{default:1,triggerUpdate:!1},ringRepeatPeriod:{default:700,triggerUpdate:!1}},methods:{pauseAnimation:function(e){var t;(t=e.ticker)===null||t===void 0||t.pause()},resumeAnimation:function(e){var t;(t=e.ticker)===null||t===void 0||t.resume()},_destructor:function(e){var t;(t=e.ticker)===null||t===void 0||t.dispose()}},init:function(e,t,r){var i=r.tweenGroup;tn(e),t.scene=e,t.tweenGroup=i,t.dataMapper=new Wr(e,{objBindAttr:"__threeObjRing",removeDelay:3e4}).onCreateObj(function(){var s=new Nl.Group;return s.__globeObjType="ring",s}),t.ticker=new fQ,t.ticker.onTick.add(function(s){if(t.ringsData.length){var o=be(t.ringColor),a=be(t.ringAltitude),c=be(t.ringMaxRadius),f=be(t.ringPropagationSpeed),p=be(t.ringRepeatPeriod);t.dataMapper.entries().filter(function(g){var v=un(g,2),x=v[1];return x}).forEach(function(g){var v=un(g,2),x=v[0],T=v[1];if((T.__nextRingTime||0)<=s){var S=p(x)/1e3;T.__nextRingTime=s+(S<=0?1/0:S);var E=new Nl.Line(new hQ(1,t.ringResolution),new Nl.LineBasicMaterial),N=o(x),P=N instanceof Array||N instanceof Function,B;P?N instanceof Array?(B=io().domain(N.map(function(Q,K){return K/(N.length-1)})).range(N),E.material.transparent=N.some(function(Q){return Qi(Q)<1})):(B=N,E.material.transparent=!0):(E.material.color=new Nl.Color(Bs(N)),WW(E.material,Qi(N)));var L=on*(1+a(x)),k=c(x),q=k*Math.PI/180,I=f(x),U=I<=0,j=function(K){var te=K.t,oe=(U?1-te:te)*q;if(E.scale.x=E.scale.y=L*Math.sin(oe),E.position.z=L*(1-Math.cos(oe)),P){var Y=B(te);E.material.color=new Nl.Color(Bs(Y)),E.material.transparent&&(E.material.opacity=Qi(Y))}};if(I===0)j({t:0}),T.add(E);else{var J=Math.abs(k/I)*1e3;t.tweenGroup.add(new Gr({t:0}).to({t:1},J).onUpdate(j).onStart(function(){return T.add(E)}).onComplete(function(){T.remove(E),hy(E)}).start())}}})}})},update:function(e){var t=be(e.ringLat),r=be(e.ringLng),i=be(e.ringAltitude),s=e.scene.localToWorld(new Nl.Vector3(0,0,0));e.dataMapper.onUpdateObj(function(o,a){var c=t(a),f=r(a),p=i(a);Object.assign(o.position,Ni(c,f,p)),o.lookAt(s)}).digest(e.ringsData)}}),dQ={0:{x_min:73,x_max:715,ha:792,o:"m 394 -29 q 153 129 242 -29 q 73 479 73 272 q 152 829 73 687 q 394 989 241 989 q 634 829 545 989 q 715 479 715 684 q 635 129 715 270 q 394 -29 546 -29 m 394 89 q 546 211 489 89 q 598 479 598 322 q 548 748 598 640 q 394 871 491 871 q 241 748 298 871 q 190 479 190 637 q 239 211 190 319 q 394 89 296 89 "},1:{x_min:215.671875,x_max:574,ha:792,o:"m 574 0 l 442 0 l 442 697 l 215 697 l 215 796 q 386 833 330 796 q 475 986 447 875 l 574 986 l 574 0 "},2:{x_min:59,x_max:731,ha:792,o:"m 731 0 l 59 0 q 197 314 59 188 q 457 487 199 315 q 598 691 598 580 q 543 819 598 772 q 411 867 488 867 q 272 811 328 867 q 209 630 209 747 l 81 630 q 182 901 81 805 q 408 986 271 986 q 629 909 536 986 q 731 694 731 826 q 613 449 731 541 q 378 316 495 383 q 201 122 235 234 l 731 122 l 731 0 "},3:{x_min:54,x_max:737,ha:792,o:"m 737 284 q 635 55 737 141 q 399 -25 541 -25 q 156 52 248 -25 q 54 308 54 140 l 185 308 q 245 147 185 202 q 395 96 302 96 q 539 140 484 96 q 602 280 602 190 q 510 429 602 390 q 324 454 451 454 l 324 565 q 487 584 441 565 q 565 719 565 617 q 515 835 565 791 q 395 879 466 879 q 255 824 307 879 q 203 661 203 769 l 78 661 q 166 909 78 822 q 387 992 250 992 q 603 921 513 992 q 701 723 701 844 q 669 607 701 656 q 578 524 637 558 q 696 434 655 499 q 737 284 737 369 "},4:{x_min:48,x_max:742.453125,ha:792,o:"m 742 243 l 602 243 l 602 0 l 476 0 l 476 243 l 48 243 l 48 368 l 476 958 l 602 958 l 602 354 l 742 354 l 742 243 m 476 354 l 476 792 l 162 354 l 476 354 "},5:{x_min:54.171875,x_max:738,ha:792,o:"m 738 314 q 626 60 738 153 q 382 -23 526 -23 q 155 47 248 -23 q 54 256 54 125 l 183 256 q 259 132 204 174 q 382 91 314 91 q 533 149 471 91 q 602 314 602 213 q 538 469 602 411 q 386 528 475 528 q 284 506 332 528 q 197 439 237 484 l 81 439 l 159 958 l 684 958 l 684 840 l 254 840 l 214 579 q 306 627 258 612 q 407 643 354 643 q 636 552 540 643 q 738 314 738 457 "},6:{x_min:53,x_max:739,ha:792,o:"m 739 312 q 633 62 739 162 q 400 -31 534 -31 q 162 78 257 -31 q 53 439 53 206 q 178 859 53 712 q 441 986 284 986 q 643 912 559 986 q 732 713 732 833 l 601 713 q 544 830 594 786 q 426 875 494 875 q 268 793 331 875 q 193 517 193 697 q 301 597 240 570 q 427 624 362 624 q 643 540 552 624 q 739 312 739 451 m 603 298 q 540 461 603 400 q 404 516 484 516 q 268 461 323 516 q 207 300 207 401 q 269 137 207 198 q 405 83 325 83 q 541 137 486 83 q 603 298 603 197 "},7:{x_min:58.71875,x_max:730.953125,ha:792,o:"m 730 839 q 469 448 560 641 q 335 0 378 255 l 192 0 q 328 441 235 252 q 593 830 421 630 l 58 830 l 58 958 l 730 958 l 730 839 "},8:{x_min:55,x_max:736,ha:792,o:"m 571 527 q 694 424 652 491 q 736 280 736 358 q 648 71 736 158 q 395 -26 551 -26 q 142 69 238 -26 q 55 279 55 157 q 96 425 55 359 q 220 527 138 491 q 120 615 153 562 q 88 726 88 668 q 171 904 88 827 q 395 986 261 986 q 618 905 529 986 q 702 727 702 830 q 670 616 702 667 q 571 527 638 565 m 394 565 q 519 610 475 565 q 563 717 563 655 q 521 823 563 781 q 392 872 474 872 q 265 824 312 872 q 224 720 224 783 q 265 613 224 656 q 394 565 312 565 m 395 91 q 545 150 488 91 q 597 280 597 204 q 546 408 597 355 q 395 465 492 465 q 244 408 299 465 q 194 280 194 356 q 244 150 194 203 q 395 91 299 91 "},9:{x_min:53,x_max:739,ha:792,o:"m 739 524 q 619 94 739 241 q 362 -32 516 -32 q 150 47 242 -32 q 59 244 59 126 l 191 244 q 246 129 191 176 q 373 82 301 82 q 526 161 466 82 q 597 440 597 255 q 363 334 501 334 q 130 432 216 334 q 53 650 53 521 q 134 880 53 786 q 383 986 226 986 q 659 841 566 986 q 739 524 739 719 m 388 449 q 535 514 480 449 q 585 658 585 573 q 535 805 585 744 q 388 873 480 873 q 242 809 294 873 q 191 658 191 745 q 239 514 191 572 q 388 449 292 449 "},:{x_min:0,x_max:712,ha:815,o:"m 356 -25 q 96 88 192 -25 q 0 368 0 201 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 "},S:{x_min:0,x_max:788,ha:890,o:"m 788 291 q 662 54 788 144 q 397 -26 550 -26 q 116 68 226 -26 q 0 337 0 168 l 131 337 q 200 152 131 220 q 384 85 269 85 q 557 129 479 85 q 650 270 650 183 q 490 429 650 379 q 194 513 341 470 q 33 739 33 584 q 142 964 33 881 q 388 1041 242 1041 q 644 957 543 1041 q 756 716 756 867 l 625 716 q 561 874 625 816 q 395 933 497 933 q 243 891 309 933 q 164 759 164 841 q 325 609 164 656 q 625 526 475 568 q 788 291 788 454 "},"":{x_min:343,x_max:449,ha:792,o:"m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 "},"/":{x_min:183.25,x_max:608.328125,ha:792,o:"m 608 1041 l 266 -129 l 183 -129 l 520 1041 l 608 1041 "},:{x_min:-.4375,x_max:777.453125,ha:839,o:"m 777 893 l 458 893 l 458 0 l 319 0 l 319 892 l 0 892 l 0 1013 l 777 1013 l 777 893 "},y:{x_min:0,x_max:684.78125,ha:771,o:"m 684 738 l 388 -83 q 311 -216 356 -167 q 173 -279 252 -279 q 97 -266 133 -279 l 97 -149 q 132 -155 109 -151 q 168 -160 155 -160 q 240 -114 213 -160 q 274 -26 248 -98 l 0 738 l 137 737 l 341 139 l 548 737 l 684 738 "},:{x_min:0,x_max:803,ha:917,o:"m 803 0 l 667 0 l 667 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 803 1012 l 803 0 "},:{x_min:-111,x_max:339,ha:361,o:"m 339 800 l 229 800 l 229 925 l 339 925 l 339 800 m -1 800 l -111 800 l -111 925 l -1 925 l -1 800 m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 m 302 1040 l 113 819 l 30 819 l 165 1040 l 302 1040 "},g:{x_min:0,x_max:686,ha:838,o:"m 686 34 q 586 -213 686 -121 q 331 -306 487 -306 q 131 -252 216 -306 q 31 -84 31 -190 l 155 -84 q 228 -174 166 -138 q 345 -207 284 -207 q 514 -109 454 -207 q 564 89 564 -27 q 461 6 521 36 q 335 -23 401 -23 q 88 100 184 -23 q 0 370 0 215 q 87 634 0 522 q 330 758 183 758 q 457 728 398 758 q 564 644 515 699 l 564 737 l 686 737 l 686 34 m 582 367 q 529 560 582 481 q 358 652 468 652 q 189 561 250 652 q 135 369 135 482 q 189 176 135 255 q 361 85 251 85 q 529 176 468 85 q 582 367 582 255 "},"":{x_min:0,x_max:442,ha:539,o:"m 442 383 l 0 383 q 91 566 0 492 q 260 668 176 617 q 354 798 354 727 q 315 875 354 845 q 227 905 277 905 q 136 869 173 905 q 99 761 99 833 l 14 761 q 82 922 14 864 q 232 974 141 974 q 379 926 316 974 q 442 797 442 878 q 351 635 442 704 q 183 539 321 611 q 92 455 92 491 l 442 455 l 442 383 "},"":{x_min:0,x_max:705.5625,ha:803,o:"m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 "},:{x_min:0,x_max:819.5625,ha:893,o:"m 819 0 l 650 0 l 294 509 l 139 356 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 "},:{x_min:-46.265625,x_max:392,ha:513,o:"m 392 651 l 259 651 l 79 -279 l -46 -278 l 134 651 l 14 651 l 14 751 l 135 751 q 151 948 135 900 q 304 1041 185 1041 q 334 1040 319 1041 q 392 1034 348 1039 l 392 922 q 337 931 360 931 q 271 883 287 931 q 260 793 260 853 l 260 751 l 392 751 l 392 651 "},e:{x_min:0,x_max:714,ha:813,o:"m 714 326 l 140 326 q 200 157 140 227 q 359 87 260 87 q 488 130 431 87 q 561 245 545 174 l 697 245 q 577 48 670 123 q 358 -26 484 -26 q 97 85 195 -26 q 0 363 0 197 q 94 642 0 529 q 358 765 195 765 q 626 627 529 765 q 714 326 714 503 m 576 429 q 507 583 564 522 q 355 650 445 650 q 206 583 266 650 q 140 429 152 522 l 576 429 "},:{x_min:0,x_max:712,ha:815,o:"m 356 -25 q 94 91 194 -25 q 0 368 0 202 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 m 576 1040 l 387 819 l 303 819 l 438 1040 l 576 1040 "},J:{x_min:0,x_max:588,ha:699,o:"m 588 279 q 287 -26 588 -26 q 58 73 126 -26 q 0 327 0 158 l 133 327 q 160 172 133 227 q 288 96 198 96 q 426 171 391 96 q 449 336 449 219 l 449 1013 l 588 1013 l 588 279 "},"":{x_min:-1,x_max:503,ha:601,o:"m 503 302 l 280 136 l 281 256 l 429 373 l 281 486 l 280 608 l 503 440 l 503 302 m 221 302 l 0 136 l 0 255 l 145 372 l 0 486 l -1 608 l 221 440 l 221 302 "},"":{x_min:-3,x_max:1008,ha:1106,o:"m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 741 394 q 661 246 731 302 q 496 190 591 190 q 294 285 369 190 q 228 497 228 370 q 295 714 228 625 q 499 813 370 813 q 656 762 588 813 q 733 625 724 711 l 634 625 q 589 704 629 673 q 498 735 550 735 q 377 666 421 735 q 334 504 334 597 q 374 340 334 408 q 490 272 415 272 q 589 304 549 272 q 638 394 628 337 l 741 394 "},:{x_min:0,x_max:922,ha:1030,o:"m 687 1040 l 498 819 l 415 819 l 549 1040 l 687 1040 m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 338 0 202 q 45 551 0 444 q 161 737 84 643 l 302 737 q 175 552 219 647 q 124 336 124 446 q 155 179 124 248 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 341 797 257 q 745 555 797 450 q 619 737 705 637 l 760 737 q 874 551 835 640 q 922 339 922 444 "},"^":{x_min:193.0625,x_max:598.609375,ha:792,o:"m 598 772 l 515 772 l 395 931 l 277 772 l 193 772 l 326 1013 l 462 1013 l 598 772 "},"":{x_min:0,x_max:507.203125,ha:604,o:"m 506 136 l 284 302 l 284 440 l 506 608 l 507 485 l 360 371 l 506 255 l 506 136 m 222 136 l 0 302 l 0 440 l 222 608 l 221 486 l 73 373 l 222 256 l 222 136 "},D:{x_min:0,x_max:828,ha:935,o:"m 389 1013 q 714 867 593 1013 q 828 521 828 729 q 712 161 828 309 q 382 0 587 0 l 0 0 l 0 1013 l 389 1013 m 376 124 q 607 247 523 124 q 681 510 681 355 q 607 771 681 662 q 376 896 522 896 l 139 896 l 139 124 l 376 124 "},"":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 "},:{x_min:0,x_max:47,ha:125,o:"m 47 3 q 37 -7 47 -7 q 28 0 30 -7 q 39 -4 32 -4 q 45 3 45 -1 l 37 0 q 28 9 28 0 q 39 19 28 19 l 47 16 l 47 19 l 47 3 m 37 1 q 44 8 44 1 q 37 16 44 16 q 30 8 30 16 q 37 1 30 1 m 26 1 l 23 22 l 14 0 l 3 22 l 3 3 l 0 25 l 13 1 l 22 25 l 26 1 "},w:{x_min:0,x_max:1009.71875,ha:1100,o:"m 1009 738 l 783 0 l 658 0 l 501 567 l 345 0 l 222 0 l 0 738 l 130 738 l 284 174 l 432 737 l 576 738 l 721 173 l 881 737 l 1009 738 "},$:{x_min:0,x_max:700,ha:793,o:"m 664 717 l 542 717 q 490 825 531 785 q 381 872 450 865 l 381 551 q 620 446 540 522 q 700 241 700 370 q 618 45 700 116 q 381 -25 536 -25 l 381 -152 l 307 -152 l 307 -25 q 81 62 162 -25 q 0 297 0 149 l 124 297 q 169 146 124 204 q 307 81 215 89 l 307 441 q 80 536 148 469 q 13 725 13 603 q 96 910 13 839 q 307 982 180 982 l 307 1077 l 381 1077 l 381 982 q 574 917 494 982 q 664 717 664 845 m 307 565 l 307 872 q 187 831 233 872 q 142 724 142 791 q 180 618 142 656 q 307 565 218 580 m 381 76 q 562 237 562 96 q 517 361 562 313 q 381 423 472 409 l 381 76 "},"\\":{x_min:-.015625,x_max:425.0625,ha:522,o:"m 425 -129 l 337 -129 l 0 1041 l 83 1041 l 425 -129 "},:{x_min:0,x_max:697.21875,ha:747,o:"m 697 -4 q 629 -14 658 -14 q 498 97 513 -14 q 422 9 470 41 q 313 -23 374 -23 q 207 4 258 -23 q 119 81 156 32 l 119 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 173 124 246 q 308 83 216 83 q 452 178 402 83 q 493 359 493 255 l 493 738 l 617 738 l 617 214 q 623 136 617 160 q 673 92 637 92 q 697 96 684 92 l 697 -4 "},:{x_min:42,x_max:181,ha:297,o:"m 181 0 l 42 0 l 42 1013 l 181 1013 l 181 0 "},:{x_min:0,x_max:1144.5,ha:1214,o:"m 1144 1012 l 807 416 l 807 0 l 667 0 l 667 416 l 325 1012 l 465 1012 l 736 533 l 1004 1012 l 1144 1012 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"":{x_min:0,x_max:139,ha:236,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 "},:{x_min:0,x_max:801,ha:915,o:"m 801 0 l 651 0 l 131 822 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 191 l 670 1013 l 801 1013 l 801 0 "},"-":{x_min:8.71875,x_max:350.390625,ha:478,o:"m 350 317 l 8 317 l 8 428 l 350 428 l 350 317 "},Q:{x_min:0,x_max:968,ha:1072,o:"m 954 5 l 887 -79 l 744 35 q 622 -11 687 2 q 483 -26 556 -26 q 127 130 262 -26 q 0 504 0 279 q 127 880 0 728 q 484 1041 262 1041 q 841 884 708 1041 q 968 507 968 735 q 933 293 968 398 q 832 104 899 188 l 954 5 m 723 191 q 802 330 777 248 q 828 499 828 412 q 744 790 828 673 q 483 922 650 922 q 228 791 322 922 q 142 505 142 673 q 227 221 142 337 q 487 91 323 91 q 632 123 566 91 l 520 215 l 587 301 l 723 191 "},:{x_min:1,x_max:676.28125,ha:740,o:"m 676 460 l 551 460 q 498 595 542 546 q 365 651 448 651 q 199 578 263 651 q 136 401 136 505 q 266 178 136 241 q 508 106 387 142 q 640 -50 640 62 q 625 -158 640 -105 q 583 -278 611 -211 l 465 -278 q 498 -182 490 -211 q 515 -80 515 -126 q 381 12 515 -15 q 134 91 197 51 q 1 388 1 179 q 100 651 1 542 q 354 761 199 761 q 587 680 498 761 q 676 460 676 599 "},M:{x_min:0,x_max:954,ha:1067,o:"m 954 0 l 819 0 l 819 869 l 537 0 l 405 0 l 128 866 l 128 0 l 0 0 l 0 1013 l 200 1013 l 472 160 l 757 1013 l 954 1013 l 954 0 "},:{x_min:0,x_max:1006,ha:1094,o:"m 1006 678 q 914 319 1006 429 q 571 200 814 200 l 571 0 l 433 0 l 433 200 q 92 319 194 200 q 0 678 0 429 l 0 1013 l 139 1013 l 139 679 q 191 417 139 492 q 433 326 255 326 l 433 1013 l 571 1013 l 571 326 l 580 326 q 813 423 747 326 q 868 679 868 502 l 868 1013 l 1006 1013 l 1006 678 "},C:{x_min:0,x_max:886,ha:944,o:"m 886 379 q 760 87 886 201 q 455 -26 634 -26 q 112 136 236 -26 q 0 509 0 283 q 118 882 0 737 q 469 1041 245 1041 q 748 955 630 1041 q 879 708 879 859 l 745 708 q 649 862 724 805 q 473 920 573 920 q 219 791 312 920 q 136 509 136 675 q 217 229 136 344 q 470 99 311 99 q 672 179 591 99 q 753 379 753 259 l 886 379 "},"!":{x_min:0,x_max:138,ha:236,o:"m 138 684 q 116 409 138 629 q 105 244 105 299 l 33 244 q 16 465 33 313 q 0 684 0 616 l 0 1013 l 138 1013 l 138 684 m 138 0 l 0 0 l 0 151 l 138 151 l 138 0 "},"{":{x_min:0,x_max:480.5625,ha:578,o:"m 480 -286 q 237 -213 303 -286 q 187 -45 187 -159 q 194 48 187 -15 q 201 141 201 112 q 164 264 201 225 q 0 314 118 314 l 0 417 q 164 471 119 417 q 201 605 201 514 q 199 665 201 644 q 193 772 193 769 q 241 941 193 887 q 480 1015 308 1015 l 480 915 q 336 866 375 915 q 306 742 306 828 q 310 662 306 717 q 314 577 314 606 q 288 452 314 500 q 176 365 256 391 q 289 275 257 337 q 314 143 314 226 q 313 84 314 107 q 310 -11 310 -5 q 339 -131 310 -94 q 480 -182 377 -182 l 480 -286 "},X:{x_min:-.015625,x_max:854.15625,ha:940,o:"m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 428 637 l 675 1013 l 836 1013 l 504 520 l 854 0 "},"#":{x_min:0,x_max:963.890625,ha:1061,o:"m 963 690 l 927 590 l 719 590 l 655 410 l 876 410 l 840 310 l 618 310 l 508 -3 l 393 -2 l 506 309 l 329 310 l 215 -2 l 102 -3 l 212 310 l 0 310 l 36 410 l 248 409 l 312 590 l 86 590 l 120 690 l 347 690 l 459 1006 l 573 1006 l 462 690 l 640 690 l 751 1006 l 865 1006 l 754 690 l 963 690 m 606 590 l 425 590 l 362 410 l 543 410 l 606 590 "},:{x_min:42,x_max:284,ha:361,o:"m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 738 l 167 738 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 "},:{x_min:0,x_max:906.953125,ha:982,o:"m 283 1040 l 88 799 l 5 799 l 145 1040 l 283 1040 m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1012 l 529 1012 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 "},")":{x_min:0,x_max:318,ha:415,o:"m 318 365 q 257 25 318 191 q 87 -290 197 -141 l 0 -290 q 140 21 93 -128 q 193 360 193 189 q 141 704 193 537 q 0 1024 97 850 l 87 1024 q 257 706 197 871 q 318 365 318 542 "},:{x_min:0,x_max:634.71875,ha:714,o:"m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 314 0 265 q 128 390 67 353 q 56 460 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 "},:{x_min:0,x_max:952.78125,ha:1028,o:"m 952 0 l 0 0 l 400 1013 l 551 1013 l 952 0 m 762 124 l 476 867 l 187 124 l 762 124 "},"}":{x_min:0,x_max:481,ha:578,o:"m 481 314 q 318 262 364 314 q 282 136 282 222 q 284 65 282 97 q 293 -58 293 -48 q 241 -217 293 -166 q 0 -286 174 -286 l 0 -182 q 143 -130 105 -182 q 171 -2 171 -93 q 168 81 171 22 q 165 144 165 140 q 188 275 165 229 q 306 365 220 339 q 191 455 224 391 q 165 588 165 505 q 168 681 165 624 q 171 742 171 737 q 141 865 171 827 q 0 915 102 915 l 0 1015 q 243 942 176 1015 q 293 773 293 888 q 287 675 293 741 q 282 590 282 608 q 318 466 282 505 q 481 417 364 417 l 481 314 "},"":{x_min:-3,x_max:1672,ha:1821,o:"m 846 0 q 664 76 732 0 q 603 244 603 145 q 662 412 603 344 q 846 489 729 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 846 0 962 0 m 845 103 q 945 143 910 103 q 981 243 981 184 q 947 340 981 301 q 845 385 910 385 q 745 342 782 385 q 709 243 709 300 q 742 147 709 186 q 845 103 781 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 m 1428 0 q 1246 76 1314 0 q 1185 244 1185 145 q 1244 412 1185 344 q 1428 489 1311 489 q 1610 412 1542 489 q 1672 244 1672 343 q 1612 76 1672 144 q 1428 0 1545 0 m 1427 103 q 1528 143 1492 103 q 1564 243 1564 184 q 1530 340 1564 301 q 1427 385 1492 385 q 1327 342 1364 385 q 1291 243 1291 300 q 1324 147 1291 186 q 1427 103 1363 103 "},a:{x_min:0,x_max:698.609375,ha:794,o:"m 698 0 q 661 -12 679 -7 q 615 -17 643 -17 q 536 12 564 -17 q 500 96 508 41 q 384 6 456 37 q 236 -25 312 -25 q 65 31 130 -25 q 0 194 0 88 q 118 390 0 334 q 328 435 180 420 q 488 483 476 451 q 495 523 495 504 q 442 619 495 584 q 325 654 389 654 q 209 617 257 654 q 152 513 161 580 l 33 513 q 123 705 33 633 q 332 772 207 772 q 528 712 448 772 q 617 531 617 645 l 617 163 q 624 108 617 126 q 664 90 632 90 l 698 94 l 698 0 m 491 262 l 491 372 q 272 329 350 347 q 128 201 128 294 q 166 113 128 144 q 264 83 205 83 q 414 130 346 83 q 491 262 491 183 "},"":{x_min:0,x_max:941.671875,ha:1039,o:"m 941 334 l 0 334 l 0 410 l 941 410 l 941 334 "},"=":{x_min:8.71875,x_max:780.953125,ha:792,o:"m 780 510 l 8 510 l 8 606 l 780 606 l 780 510 m 780 235 l 8 235 l 8 332 l 780 332 l 780 235 "},N:{x_min:0,x_max:801,ha:914,o:"m 801 0 l 651 0 l 131 823 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 193 l 670 1013 l 801 1013 l 801 0 "},:{x_min:0,x_max:712,ha:797,o:"m 712 369 q 620 94 712 207 q 362 -26 521 -26 q 230 2 292 -26 q 119 83 167 30 l 119 -278 l 0 -278 l 0 362 q 91 643 0 531 q 355 764 190 764 q 617 647 517 764 q 712 369 712 536 m 583 366 q 530 559 583 480 q 359 651 469 651 q 190 562 252 651 q 135 370 135 483 q 189 176 135 257 q 359 85 250 85 q 528 175 466 85 q 583 366 583 254 "},"":{x_min:0,x_max:941.671875,ha:938,o:"m 941 1033 l 0 1033 l 0 1109 l 941 1109 l 941 1033 "},Z:{x_min:0,x_max:779,ha:849,o:"m 779 0 l 0 0 l 0 113 l 621 896 l 40 896 l 40 1013 l 779 1013 l 778 887 l 171 124 l 779 124 l 779 0 "},u:{x_min:0,x_max:617,ha:729,o:"m 617 0 l 499 0 l 499 110 q 391 10 460 45 q 246 -25 322 -25 q 61 58 127 -25 q 0 258 0 136 l 0 738 l 125 738 l 125 284 q 156 148 125 202 q 273 82 197 82 q 433 165 369 82 q 493 340 493 243 l 493 738 l 617 738 l 617 0 "},k:{x_min:0,x_max:612.484375,ha:697,o:"m 612 738 l 338 465 l 608 0 l 469 0 l 251 382 l 121 251 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 402 l 456 738 l 612 738 "},:{x_min:0,x_max:803,ha:917,o:"m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 "},:{x_min:0,x_max:906.953125,ha:985,o:"m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 "},s:{x_min:0,x_max:604,ha:697,o:"m 604 217 q 501 36 604 104 q 292 -23 411 -23 q 86 43 166 -23 q 0 238 0 114 l 121 237 q 175 122 121 164 q 300 85 223 85 q 415 112 363 85 q 479 207 479 147 q 361 309 479 276 q 140 372 141 370 q 21 544 21 426 q 111 708 21 647 q 298 761 190 761 q 492 705 413 761 q 583 531 583 643 l 462 531 q 412 625 462 594 q 298 657 363 657 q 199 636 242 657 q 143 558 143 608 q 262 454 143 486 q 484 394 479 397 q 604 217 604 341 "},B:{x_min:0,x_max:778,ha:876,o:"m 580 546 q 724 469 670 535 q 778 311 778 403 q 673 83 778 171 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 892 q 691 633 732 693 q 580 546 650 572 m 393 899 l 139 899 l 139 588 l 379 588 q 521 624 462 588 q 592 744 592 667 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 303 635 219 q 559 436 635 389 q 402 477 494 477 l 139 477 l 139 124 l 419 124 "},"":{x_min:0,x_max:614,ha:708,o:"m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 m 378 0 l 236 0 l 236 151 l 378 151 l 378 0 m 614 0 l 472 0 l 472 151 l 614 151 l 614 0 "},"?":{x_min:0,x_max:607,ha:704,o:"m 607 777 q 543 599 607 674 q 422 474 482 537 q 357 272 357 391 l 236 272 q 297 487 236 395 q 411 619 298 490 q 474 762 474 691 q 422 885 474 838 q 301 933 371 933 q 179 880 228 933 q 124 706 124 819 l 0 706 q 94 963 0 872 q 302 1044 177 1044 q 511 973 423 1044 q 607 777 607 895 m 370 0 l 230 0 l 230 151 l 370 151 l 370 0 "},H:{x_min:0,x_max:803,ha:915,o:"m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 "},:{x_min:0,x_max:675,ha:761,o:"m 675 738 l 404 0 l 272 0 l 0 738 l 133 738 l 340 147 l 541 738 l 675 738 "},c:{x_min:1,x_max:701.390625,ha:775,o:"m 701 264 q 584 53 681 133 q 353 -26 487 -26 q 91 91 188 -26 q 1 370 1 201 q 92 645 1 537 q 353 761 190 761 q 572 688 479 761 q 690 493 666 615 l 556 493 q 487 606 545 562 q 356 650 428 650 q 186 563 246 650 q 134 372 134 487 q 188 179 134 258 q 359 88 250 88 q 492 136 437 88 q 566 264 548 185 l 701 264 "},"":{x_min:0,x_max:566.671875,ha:678,o:"m 21 892 l 52 892 l 98 761 l 145 892 l 176 892 l 178 741 l 157 741 l 157 867 l 108 741 l 88 741 l 40 871 l 40 741 l 21 741 l 21 892 m 308 854 l 308 731 q 252 691 308 691 q 227 691 240 691 q 207 696 213 695 l 207 712 l 253 706 q 288 733 288 706 l 288 763 q 244 741 279 741 q 193 797 193 741 q 261 860 193 860 q 287 860 273 860 q 308 854 302 855 m 288 842 l 263 843 q 213 796 213 843 q 248 756 213 756 q 288 796 288 756 l 288 842 m 566 988 l 502 988 l 502 -1 l 439 -1 l 439 988 l 317 988 l 317 -1 l 252 -1 l 252 602 q 81 653 155 602 q 0 805 0 711 q 101 989 0 918 q 309 1053 194 1053 l 566 1053 l 566 988 "},:{x_min:0,x_max:660,ha:745,o:"m 471 550 q 610 450 561 522 q 660 280 660 378 q 578 64 660 151 q 367 -22 497 -22 q 239 5 299 -22 q 126 82 178 32 l 126 -278 l 0 -278 l 0 593 q 54 903 0 801 q 318 1042 127 1042 q 519 964 436 1042 q 603 771 603 887 q 567 644 603 701 q 471 550 532 586 m 337 79 q 476 138 418 79 q 535 279 535 198 q 427 437 535 386 q 226 477 344 477 l 226 583 q 398 620 329 583 q 486 762 486 668 q 435 884 486 833 q 312 935 384 935 q 169 861 219 935 q 126 698 126 797 l 126 362 q 170 169 126 242 q 337 79 224 79 "},:{x_min:0,x_max:954,ha:1068,o:"m 954 0 l 819 0 l 819 868 l 537 0 l 405 0 l 128 865 l 128 0 l 0 0 l 0 1013 l 199 1013 l 472 158 l 758 1013 l 954 1013 l 954 0 "},:{x_min:.109375,x_max:1120,ha:1217,o:"m 1120 505 q 994 132 1120 282 q 642 -29 861 -29 q 290 130 422 -29 q 167 505 167 280 q 294 883 167 730 q 650 1046 430 1046 q 999 882 868 1046 q 1120 505 1120 730 m 977 504 q 896 784 977 669 q 644 915 804 915 q 391 785 484 915 q 307 504 307 669 q 391 224 307 339 q 644 95 486 95 q 894 224 803 95 q 977 504 977 339 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},:{x_min:0,x_max:1158,ha:1275,o:"m 1158 0 l 1022 0 l 1022 475 l 496 475 l 496 0 l 356 0 l 356 1012 l 496 1012 l 496 599 l 1022 599 l 1022 1012 l 1158 1012 l 1158 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"":{x_min:0,x_max:663.890625,ha:775,o:"m 663 529 q 566 293 663 391 q 331 196 469 196 q 97 294 194 196 q 0 529 0 393 q 96 763 0 665 q 331 861 193 861 q 566 763 469 861 q 663 529 663 665 "},"":{x_min:.1875,x_max:819.546875,ha:886,o:"m 563 561 l 697 561 l 696 487 l 520 487 l 482 416 l 482 380 l 697 380 l 695 308 l 482 308 l 482 0 l 342 0 l 342 308 l 125 308 l 125 380 l 342 380 l 342 417 l 303 487 l 125 487 l 125 561 l 258 561 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 l 563 561 "},"(":{x_min:0,x_max:318.0625,ha:415,o:"m 318 -290 l 230 -290 q 61 23 122 -142 q 0 365 0 190 q 62 712 0 540 q 230 1024 119 869 l 318 1024 q 175 705 219 853 q 125 360 125 542 q 176 22 125 187 q 318 -290 223 -127 "},U:{x_min:0,x_max:796,ha:904,o:"m 796 393 q 681 93 796 212 q 386 -25 566 -25 q 101 95 208 -25 q 0 393 0 211 l 0 1013 l 138 1013 l 138 391 q 204 191 138 270 q 394 107 276 107 q 586 191 512 107 q 656 391 656 270 l 656 1013 l 796 1013 l 796 393 "},:{x_min:.5,x_max:744.953125,ha:822,o:"m 744 737 l 463 54 l 463 -278 l 338 -278 l 338 54 l 154 495 q 104 597 124 569 q 13 651 67 651 l 0 651 l 0 751 l 39 753 q 168 711 121 753 q 242 594 207 676 l 403 208 l 617 737 l 744 737 "},:{x_min:0,x_max:765.5625,ha:809,o:"m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 728 407 760 q 563 637 524 696 l 563 739 l 685 739 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 96 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 "},F:{x_min:0,x_max:683.328125,ha:717,o:"m 683 888 l 140 888 l 140 583 l 613 583 l 613 458 l 140 458 l 140 0 l 0 0 l 0 1013 l 683 1013 l 683 888 "},"":{x_min:0,x_max:705.5625,ha:803,o:"m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 "},":":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 "},:{x_min:0,x_max:854.171875,ha:935,o:"m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 427 637 l 675 1013 l 836 1013 l 504 521 l 854 0 "},"*":{x_min:116,x_max:674,ha:792,o:"m 674 768 l 475 713 l 610 544 l 517 477 l 394 652 l 272 478 l 178 544 l 314 713 l 116 766 l 153 876 l 341 812 l 342 1013 l 446 1013 l 446 811 l 635 874 l 674 768 "},"":{x_min:0,x_max:777,ha:835,o:"m 458 804 l 777 804 l 777 683 l 458 683 l 458 0 l 319 0 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 "},"":{x_min:0,x_max:347,ha:444,o:"m 173 802 q 43 856 91 802 q 0 977 0 905 q 45 1101 0 1049 q 173 1153 90 1153 q 303 1098 255 1153 q 347 977 347 1049 q 303 856 347 905 q 173 802 256 802 m 173 884 q 238 910 214 884 q 262 973 262 937 q 239 1038 262 1012 q 173 1064 217 1064 q 108 1037 132 1064 q 85 973 85 1010 q 108 910 85 937 q 173 884 132 884 "},V:{x_min:0,x_max:862.71875,ha:940,o:"m 862 1013 l 505 0 l 361 0 l 0 1013 l 143 1013 l 434 165 l 718 1012 l 862 1013 "},:{x_min:0,x_max:734.71875,ha:763,o:"m 723 889 l 9 889 l 9 1013 l 723 1013 l 723 889 m 673 463 l 61 463 l 61 589 l 673 589 l 673 463 m 734 0 l 0 0 l 0 124 l 734 124 l 734 0 "},"":{x_min:0,x_max:0,ha:853},:{x_min:.328125,x_max:819.515625,ha:889,o:"m 588 1046 l 460 1046 l 460 1189 l 588 1189 l 588 1046 m 360 1046 l 232 1046 l 232 1189 l 360 1189 l 360 1046 m 819 1012 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1012 l 140 1012 l 411 533 l 679 1012 l 819 1012 "},"":{x_min:0,x_max:347,ha:454,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 m 347 851 q 310 737 347 784 q 208 669 273 690 l 208 734 q 267 787 250 741 q 280 873 280 821 l 208 873 l 208 1013 l 347 1013 l 347 851 "},"@":{x_min:0,x_max:1260,ha:1357,o:"m 1098 -45 q 877 -160 1001 -117 q 633 -203 752 -203 q 155 -29 327 -203 q 0 360 0 127 q 176 802 0 616 q 687 1008 372 1008 q 1123 854 969 1008 q 1260 517 1260 718 q 1155 216 1260 341 q 868 82 1044 82 q 772 106 801 82 q 737 202 737 135 q 647 113 700 144 q 527 82 594 82 q 367 147 420 82 q 314 312 314 212 q 401 565 314 452 q 639 690 498 690 q 810 588 760 690 l 849 668 l 938 668 q 877 441 900 532 q 833 226 833 268 q 853 182 833 198 q 902 167 873 167 q 1088 272 1012 167 q 1159 512 1159 372 q 1051 793 1159 681 q 687 925 925 925 q 248 747 415 925 q 97 361 97 586 q 226 26 97 159 q 627 -122 370 -122 q 856 -87 737 -122 q 1061 8 976 -53 l 1098 -45 m 786 488 q 738 580 777 545 q 643 615 700 615 q 483 517 548 615 q 425 322 425 430 q 457 203 425 250 q 552 156 490 156 q 722 273 665 156 q 786 488 738 309 "},:{x_min:0,x_max:499,ha:613,o:"m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 m 499 0 l 360 0 l 360 1012 l 499 1012 l 499 0 "},i:{x_min:14,x_max:136,ha:275,o:"m 136 873 l 14 873 l 14 1013 l 136 1013 l 136 873 m 136 0 l 14 0 l 14 737 l 136 737 l 136 0 "},:{x_min:0,x_max:778,ha:877,o:"m 580 545 q 724 468 671 534 q 778 310 778 402 q 673 83 778 170 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 891 q 691 632 732 692 q 580 545 650 571 m 393 899 l 139 899 l 139 587 l 379 587 q 521 623 462 587 q 592 744 592 666 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 302 635 219 q 559 435 635 388 q 402 476 494 476 l 139 476 l 139 124 l 419 124 "},:{x_min:0,x_max:617,ha:725,o:"m 617 352 q 540 94 617 199 q 308 -24 455 -24 q 76 94 161 -24 q 0 352 0 199 l 0 739 l 126 739 l 126 355 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 355 492 257 l 492 739 l 617 739 l 617 352 "},"]":{x_min:0,x_max:275,ha:372,o:"m 275 -281 l 0 -281 l 0 -187 l 151 -187 l 151 920 l 0 920 l 0 1013 l 275 1013 l 275 -281 "},m:{x_min:0,x_max:1019,ha:1128,o:"m 1019 0 l 897 0 l 897 454 q 860 591 897 536 q 739 660 816 660 q 613 586 659 660 q 573 436 573 522 l 573 0 l 447 0 l 447 455 q 412 591 447 535 q 294 657 372 657 q 165 586 213 657 q 122 437 122 521 l 122 0 l 0 0 l 0 738 l 117 738 l 117 640 q 202 730 150 697 q 316 763 254 763 q 437 730 381 763 q 525 642 494 697 q 621 731 559 700 q 753 763 682 763 q 943 694 867 763 q 1019 512 1019 625 l 1019 0 "},:{x_min:8.328125,x_max:780.5625,ha:815,o:"m 780 -278 q 715 -294 747 -294 q 616 -257 663 -294 q 548 -175 576 -227 l 379 133 l 143 -277 l 9 -277 l 313 254 l 163 522 q 127 586 131 580 q 36 640 91 640 q 8 637 27 640 l 8 752 l 52 757 q 162 719 113 757 q 236 627 200 690 l 383 372 l 594 737 l 726 737 l 448 250 l 625 -69 q 670 -153 647 -110 q 743 -188 695 -188 q 780 -184 759 -188 l 780 -278 "},:{x_min:42,x_max:326.71875,ha:361,o:"m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 102 239 101 q 284 112 257 104 l 284 3 m 326 1040 l 137 819 l 54 819 l 189 1040 l 326 1040 "},:{x_min:0,x_max:779.171875,ha:850,o:"m 779 0 l 0 0 l 0 113 l 620 896 l 40 896 l 40 1013 l 779 1013 l 779 887 l 170 124 l 779 124 l 779 0 "},R:{x_min:0,x_max:781.953125,ha:907,o:"m 781 0 l 623 0 q 587 242 590 52 q 407 433 585 433 l 138 433 l 138 0 l 0 0 l 0 1013 l 396 1013 q 636 946 539 1013 q 749 731 749 868 q 711 597 749 659 q 608 502 674 534 q 718 370 696 474 q 729 207 722 352 q 781 26 736 62 l 781 0 m 373 551 q 533 594 465 551 q 614 731 614 645 q 532 859 614 815 q 373 896 465 896 l 138 896 l 138 551 l 373 551 "},o:{x_min:0,x_max:713,ha:821,o:"m 357 -25 q 94 91 194 -25 q 0 368 0 202 q 93 642 0 533 q 357 761 193 761 q 618 644 518 761 q 713 368 713 533 q 619 91 713 201 q 357 -25 521 -25 m 357 85 q 528 175 465 85 q 584 369 584 255 q 529 562 584 484 q 357 651 467 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 357 85 250 85 "},K:{x_min:0,x_max:819.46875,ha:906,o:"m 819 0 l 649 0 l 294 509 l 139 355 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 "},",":{x_min:0,x_max:142,ha:239,o:"m 142 -12 q 105 -132 142 -82 q 0 -205 68 -182 l 0 -138 q 57 -82 40 -124 q 70 0 70 -51 l 0 0 l 0 151 l 142 151 l 142 -12 "},d:{x_min:0,x_max:683,ha:796,o:"m 683 0 l 564 0 l 564 93 q 456 6 516 38 q 327 -25 395 -25 q 87 100 181 -25 q 0 365 0 215 q 90 639 0 525 q 343 763 187 763 q 564 647 486 763 l 564 1013 l 683 1013 l 683 0 m 582 373 q 529 562 582 484 q 361 653 468 653 q 190 561 253 653 q 135 365 135 479 q 189 175 135 254 q 358 85 251 85 q 529 178 468 85 q 582 373 582 258 "},"":{x_min:-109,x_max:247,ha:232,o:"m 247 1046 l 119 1046 l 119 1189 l 247 1189 l 247 1046 m 19 1046 l -109 1046 l -109 1189 l 19 1189 l 19 1046 "},E:{x_min:0,x_max:736.109375,ha:789,o:"m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 "},Y:{x_min:0,x_max:820,ha:886,o:"m 820 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 534 l 679 1012 l 820 1013 "},'"':{x_min:0,x_max:299,ha:396,o:"m 299 606 l 203 606 l 203 988 l 299 988 l 299 606 m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 "},"":{x_min:17.984375,x_max:773.609375,ha:792,o:"m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 "},"":{x_min:0,x_max:364,ha:467,o:"m 141 -12 q 104 -132 141 -82 q 0 -205 67 -182 l 0 -138 q 56 -82 40 -124 q 69 0 69 -51 l 0 0 l 0 151 l 141 151 l 141 -12 m 364 -12 q 327 -132 364 -82 q 222 -205 290 -182 l 222 -138 q 279 -82 262 -124 q 292 0 292 -51 l 222 0 l 222 151 l 364 151 l 364 -12 "},:{x_min:1,x_max:710,ha:810,o:"m 710 360 q 616 87 710 196 q 356 -28 518 -28 q 99 82 197 -28 q 1 356 1 192 q 100 606 1 509 q 355 703 199 703 q 180 829 288 754 q 70 903 124 866 l 70 1012 l 643 1012 l 643 901 l 258 901 q 462 763 422 794 q 636 592 577 677 q 710 360 710 485 m 584 365 q 552 501 584 447 q 451 602 521 555 q 372 611 411 611 q 197 541 258 611 q 136 355 136 472 q 190 171 136 245 q 358 85 252 85 q 528 173 465 85 q 584 365 584 252 "},:{x_min:0,x_max:634.71875,ha:714,o:"m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 313 0 265 q 128 390 67 352 q 56 459 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 m 520 1040 l 331 819 l 248 819 l 383 1040 l 520 1040 "},:{x_min:0,x_max:922,ha:1031,o:"m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 339 0 203 q 45 551 0 444 q 161 738 84 643 l 302 738 q 175 553 219 647 q 124 336 124 446 q 155 179 124 249 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 342 797 257 q 745 556 797 450 q 619 738 705 638 l 760 738 q 874 551 835 640 q 922 339 922 444 "},"":{x_min:0,x_max:96,ha:251,o:"m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 "},"":{x_min:11,x_max:781,ha:792,o:"m 781 490 l 446 490 l 446 255 l 349 255 l 349 490 l 11 490 l 11 586 l 349 586 l 349 819 l 446 819 l 446 586 l 781 586 l 781 490 m 781 21 l 11 21 l 11 115 l 781 115 l 781 21 "},"|":{x_min:343,x_max:449,ha:792,o:"m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 "},:{x_min:0,x_max:617,ha:725,o:"m 482 800 l 372 800 l 372 925 l 482 925 l 482 800 m 239 800 l 129 800 l 129 925 l 239 925 l 239 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 "},"":{x_min:0,x_max:593,ha:690,o:"m 593 425 q 554 312 593 369 q 467 233 516 254 q 537 83 537 172 q 459 -74 537 -12 q 288 -133 387 -133 q 115 -69 184 -133 q 47 96 47 -6 l 166 96 q 199 7 166 40 q 288 -26 232 -26 q 371 -5 332 -26 q 420 60 420 21 q 311 201 420 139 q 108 309 210 255 q 0 490 0 383 q 33 602 0 551 q 124 687 66 654 q 75 743 93 712 q 58 812 58 773 q 133 984 58 920 q 300 1043 201 1043 q 458 987 394 1043 q 529 814 529 925 l 411 814 q 370 908 404 877 q 289 939 336 939 q 213 911 246 939 q 180 841 180 883 q 286 720 180 779 q 484 612 480 615 q 593 425 593 534 m 467 409 q 355 544 467 473 q 196 630 228 612 q 146 587 162 609 q 124 525 124 558 q 239 387 124 462 q 398 298 369 315 q 448 345 429 316 q 467 409 467 375 "},b:{x_min:0,x_max:685,ha:783,o:"m 685 372 q 597 99 685 213 q 347 -25 501 -25 q 219 5 277 -25 q 121 93 161 36 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 634 q 214 723 157 692 q 341 754 272 754 q 591 637 493 754 q 685 372 685 526 m 554 356 q 499 550 554 470 q 328 644 437 644 q 162 556 223 644 q 108 369 108 478 q 160 176 108 256 q 330 83 221 83 q 498 169 435 83 q 554 356 554 245 "},q:{x_min:0,x_max:683,ha:876,o:"m 683 -278 l 564 -278 l 564 97 q 474 8 533 39 q 345 -23 415 -23 q 91 93 188 -23 q 0 364 0 203 q 87 635 0 522 q 337 760 184 760 q 466 727 408 760 q 564 637 523 695 l 564 737 l 683 737 l 683 -278 m 582 375 q 527 564 582 488 q 358 652 466 652 q 190 565 253 652 q 135 377 135 488 q 189 179 135 261 q 361 84 251 84 q 530 179 469 84 q 582 375 582 260 "},:{x_min:-.171875,x_max:969.5625,ha:1068,o:"m 969 0 l 555 0 l 555 123 q 744 308 675 194 q 814 558 814 423 q 726 812 814 709 q 484 922 633 922 q 244 820 334 922 q 154 567 154 719 q 223 316 154 433 q 412 123 292 199 l 412 0 l 0 0 l 0 124 l 217 124 q 68 327 122 210 q 15 572 15 444 q 144 911 15 781 q 484 1041 274 1041 q 822 909 691 1041 q 953 569 953 777 q 899 326 953 443 q 750 124 846 210 l 969 124 l 969 0 "},:{x_min:0,x_max:617,ha:725,o:"m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 535 1040 l 346 819 l 262 819 l 397 1040 l 535 1040 "},z:{x_min:-.015625,x_max:613.890625,ha:697,o:"m 613 0 l 0 0 l 0 100 l 433 630 l 20 630 l 20 738 l 594 738 l 593 636 l 163 110 l 613 110 l 613 0 "},"":{x_min:0,x_max:894,ha:1e3,o:"m 389 951 l 229 951 l 229 503 l 160 503 l 160 951 l 0 951 l 0 1011 l 389 1011 l 389 951 m 894 503 l 827 503 l 827 939 l 685 503 l 620 503 l 481 937 l 481 503 l 417 503 l 417 1011 l 517 1011 l 653 580 l 796 1010 l 894 1011 l 894 503 "},:{x_min:.78125,x_max:697,ha:810,o:"m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 721 124 755 q 200 630 193 687 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 m 479 1040 l 290 819 l 207 819 l 341 1040 l 479 1040 "},:{x_min:0,x_max:960,ha:1056,o:"m 960 507 q 833 129 960 280 q 476 -32 698 -32 q 123 129 255 -32 q 0 507 0 280 q 123 883 0 732 q 476 1045 255 1045 q 832 883 696 1045 q 960 507 960 732 m 817 500 q 733 789 817 669 q 476 924 639 924 q 223 792 317 924 q 142 507 142 675 q 222 222 142 339 q 476 89 315 89 q 730 218 636 89 q 817 500 817 334 m 716 449 l 243 449 l 243 571 l 716 571 l 716 449 "},"":{x_min:-3,x_max:1008,ha:1106,o:"m 503 532 q 614 562 566 532 q 672 658 672 598 q 614 747 672 716 q 503 772 569 772 l 338 772 l 338 532 l 503 532 m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 788 146 l 678 146 q 653 316 655 183 q 527 449 652 449 l 338 449 l 338 146 l 241 146 l 241 854 l 518 854 q 688 808 621 854 q 766 658 766 755 q 739 563 766 607 q 668 497 713 519 q 751 331 747 472 q 788 164 756 190 l 788 146 "},"~":{x_min:0,x_max:833,ha:931,o:"m 833 958 q 778 753 833 831 q 594 665 716 665 q 402 761 502 665 q 240 857 302 857 q 131 795 166 857 q 104 665 104 745 l 0 665 q 54 867 0 789 q 237 958 116 958 q 429 861 331 958 q 594 765 527 765 q 704 827 670 765 q 729 958 729 874 l 833 958 "},:{x_min:0,x_max:736.21875,ha:778,o:"m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 "},"":{x_min:0,x_max:450,ha:547,o:"m 450 552 q 379 413 450 464 q 220 366 313 366 q 69 414 130 366 q 0 567 0 470 l 85 567 q 126 470 85 504 q 225 437 168 437 q 320 467 280 437 q 360 552 360 498 q 318 632 360 608 q 213 657 276 657 q 195 657 203 657 q 176 657 181 657 l 176 722 q 279 733 249 722 q 334 815 334 752 q 300 881 334 856 q 220 907 267 907 q 133 875 169 907 q 97 781 97 844 l 15 781 q 78 926 15 875 q 220 972 135 972 q 364 930 303 972 q 426 817 426 888 q 344 697 426 733 q 421 642 392 681 q 450 552 450 603 "},"[":{x_min:0,x_max:273.609375,ha:371,o:"m 273 -281 l 0 -281 l 0 1013 l 273 1013 l 273 920 l 124 920 l 124 -187 l 273 -187 l 273 -281 "},L:{x_min:0,x_max:645.828125,ha:696,o:"m 645 0 l 0 0 l 0 1013 l 140 1013 l 140 126 l 645 126 l 645 0 "},:{x_min:0,x_max:803.390625,ha:894,o:"m 803 628 l 633 628 q 713 368 713 512 q 618 93 713 204 q 357 -25 518 -25 q 94 91 194 -25 q 0 368 0 201 q 94 644 0 533 q 356 761 194 761 q 481 750 398 761 q 608 739 564 739 l 803 739 l 803 628 m 360 85 q 529 180 467 85 q 584 374 584 262 q 527 566 584 490 q 352 651 463 651 q 187 559 247 651 q 135 368 135 478 q 189 175 135 254 q 360 85 251 85 "},:{x_min:0,x_max:573,ha:642,o:"m 573 -40 q 553 -162 573 -97 q 510 -278 543 -193 l 400 -278 q 441 -187 428 -219 q 462 -90 462 -132 q 378 -14 462 -14 q 108 45 197 -14 q 0 290 0 117 q 108 631 0 462 q 353 901 194 767 l 55 901 l 55 1012 l 561 1012 l 561 924 q 261 669 382 831 q 128 301 128 489 q 243 117 128 149 q 458 98 350 108 q 573 -40 573 80 "},:{x_min:0,x_max:674,ha:778,o:"m 674 496 q 601 160 674 304 q 336 -26 508 -26 q 73 153 165 -26 q 0 485 0 296 q 72 840 0 683 q 343 1045 166 1045 q 605 844 516 1045 q 674 496 674 692 m 546 579 q 498 798 546 691 q 336 935 437 935 q 178 798 237 935 q 126 579 137 701 l 546 579 m 546 475 l 126 475 q 170 233 126 348 q 338 80 230 80 q 504 233 447 80 q 546 475 546 346 "},:{x_min:0,x_max:958,ha:1054,o:"m 485 1042 q 834 883 703 1042 q 958 511 958 735 q 834 136 958 287 q 481 -26 701 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 729 q 485 1042 263 1042 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 670 q 480 913 640 913 q 226 785 321 913 q 142 504 142 671 q 226 224 142 339 q 480 98 319 98 "},:{x_min:0,x_max:705.28125,ha:749,o:"m 705 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 705 1012 l 705 886 "}," ":{x_min:0,x_max:0,ha:375},"%":{x_min:-3,x_max:1089,ha:1186,o:"m 845 0 q 663 76 731 0 q 602 244 602 145 q 661 412 602 344 q 845 489 728 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 845 0 962 0 m 844 103 q 945 143 909 103 q 981 243 981 184 q 947 340 981 301 q 844 385 909 385 q 744 342 781 385 q 708 243 708 300 q 741 147 708 186 q 844 103 780 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 "},P:{x_min:0,x_max:726,ha:806,o:"m 424 1013 q 640 931 555 1013 q 726 719 726 850 q 637 506 726 587 q 413 426 548 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 379 889 l 140 889 l 140 548 l 372 548 q 522 589 459 548 q 593 720 593 637 q 528 845 593 801 q 379 889 463 889 "},:{x_min:0,x_max:1078.21875,ha:1118,o:"m 1078 0 l 342 0 l 342 1013 l 1067 1013 l 1067 889 l 481 889 l 481 585 l 1019 585 l 1019 467 l 481 467 l 481 125 l 1078 125 l 1078 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},:{x_min:.125,x_max:1136.546875,ha:1235,o:"m 1136 0 l 722 0 l 722 123 q 911 309 842 194 q 981 558 981 423 q 893 813 981 710 q 651 923 800 923 q 411 821 501 923 q 321 568 321 720 q 390 316 321 433 q 579 123 459 200 l 579 0 l 166 0 l 166 124 l 384 124 q 235 327 289 210 q 182 572 182 444 q 311 912 182 782 q 651 1042 441 1042 q 989 910 858 1042 q 1120 569 1120 778 q 1066 326 1120 443 q 917 124 1013 210 l 1136 124 l 1136 0 m 277 1040 l 83 800 l 0 800 l 140 1041 l 277 1040 "},_:{x_min:0,x_max:705.5625,ha:803,o:"m 705 -334 l 0 -334 l 0 -234 l 705 -234 l 705 -334 "},:{x_min:-110,x_max:246,ha:275,o:"m 246 1046 l 118 1046 l 118 1189 l 246 1189 l 246 1046 m 18 1046 l -110 1046 l -110 1189 l 18 1189 l 18 1046 m 136 0 l 0 0 l 0 1012 l 136 1012 l 136 0 "},"+":{x_min:23,x_max:768,ha:792,o:"m 768 372 l 444 372 l 444 0 l 347 0 l 347 372 l 23 372 l 23 468 l 347 468 l 347 840 l 444 840 l 444 468 l 768 468 l 768 372 "},"":{x_min:0,x_max:1050,ha:1149,o:"m 1050 0 l 625 0 q 712 178 625 108 q 878 277 722 187 q 967 385 967 328 q 932 456 967 429 q 850 484 897 484 q 759 450 798 484 q 721 352 721 416 l 640 352 q 706 502 640 448 q 851 551 766 551 q 987 509 931 551 q 1050 385 1050 462 q 976 251 1050 301 q 829 179 902 215 q 717 68 740 133 l 1050 68 l 1050 0 m 834 985 l 215 -28 l 130 -28 l 750 984 l 834 985 m 224 422 l 142 422 l 142 811 l 0 811 l 0 867 q 104 889 62 867 q 164 973 157 916 l 224 973 l 224 422 "},:{x_min:0,x_max:720,ha:783,o:"m 424 1013 q 637 933 554 1013 q 720 723 720 853 q 633 508 720 591 q 413 426 546 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 378 889 l 140 889 l 140 548 l 371 548 q 521 589 458 548 q 592 720 592 637 q 527 845 592 801 q 378 889 463 889 "},"'":{x_min:0,x_max:139,ha:236,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 "},:{x_min:0,x_max:350,ha:397,o:"m 350 625 q 307 616 328 616 q 266 631 281 616 q 247 673 251 645 q 190 628 225 644 q 116 613 156 613 q 32 641 64 613 q 0 722 0 669 q 72 826 0 800 q 247 866 159 846 l 247 887 q 220 934 247 916 q 162 953 194 953 q 104 934 129 953 q 76 882 80 915 l 16 882 q 60 976 16 941 q 166 1011 104 1011 q 266 979 224 1011 q 308 891 308 948 l 308 706 q 311 679 308 688 q 331 670 315 670 l 350 672 l 350 625 m 247 757 l 247 811 q 136 790 175 798 q 64 726 64 773 q 83 682 64 697 q 132 667 103 667 q 207 690 174 667 q 247 757 247 718 "},"":{x_min:0,x_max:450,ha:553,o:"m 450 800 l 340 800 l 340 925 l 450 925 l 450 800 m 406 1040 l 212 800 l 129 800 l 269 1040 l 406 1040 m 110 800 l 0 800 l 0 925 l 110 925 l 110 800 "},T:{x_min:0,x_max:777,ha:835,o:"m 777 894 l 458 894 l 458 0 l 319 0 l 319 894 l 0 894 l 0 1013 l 777 1013 l 777 894 "},:{x_min:0,x_max:915,ha:997,o:"m 527 0 l 389 0 l 389 122 q 110 231 220 122 q 0 509 0 340 q 110 785 0 677 q 389 893 220 893 l 389 1013 l 527 1013 l 527 893 q 804 786 693 893 q 915 509 915 679 q 805 231 915 341 q 527 122 696 122 l 527 0 m 527 226 q 712 310 641 226 q 779 507 779 389 q 712 705 779 627 q 527 787 641 787 l 527 226 m 389 226 l 389 787 q 205 698 275 775 q 136 505 136 620 q 206 308 136 391 q 389 226 276 226 "},"":{x_min:0,x_max:0,ha:694},j:{x_min:-77.78125,x_max:167,ha:349,o:"m 167 871 l 42 871 l 42 1013 l 167 1013 l 167 871 m 167 -80 q 121 -231 167 -184 q -26 -278 76 -278 l -77 -278 l -77 -164 l -41 -164 q 26 -143 11 -164 q 42 -65 42 -122 l 42 737 l 167 737 l 167 -80 "},:{x_min:0,x_max:756.953125,ha:819,o:"m 756 0 l 0 0 l 0 107 l 395 523 l 22 904 l 22 1013 l 745 1013 l 745 889 l 209 889 l 566 523 l 187 125 l 756 125 l 756 0 "},"":{x_min:18.0625,x_max:774,ha:792,o:"m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 "},"<":{x_min:17.984375,x_max:773.609375,ha:792,o:"m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 "},"":{x_min:0,x_max:704.484375,ha:801,o:"m 704 41 q 623 -10 664 5 q 543 -26 583 -26 q 359 15 501 -26 q 243 36 288 36 q 158 23 197 36 q 73 -21 119 10 l 6 76 q 125 195 90 150 q 175 331 175 262 q 147 443 175 383 l 0 443 l 0 512 l 108 512 q 43 734 43 623 q 120 929 43 854 q 358 1010 204 1010 q 579 936 487 1010 q 678 729 678 857 l 678 684 l 552 684 q 504 838 552 780 q 362 896 457 896 q 216 852 263 896 q 176 747 176 815 q 199 627 176 697 q 248 512 217 574 l 468 512 l 468 443 l 279 443 q 297 356 297 398 q 230 194 297 279 q 153 107 211 170 q 227 133 190 125 q 293 142 264 142 q 410 119 339 142 q 516 96 482 96 q 579 105 550 96 q 648 142 608 115 l 704 41 "},t:{x_min:0,x_max:367,ha:458,o:"m 367 0 q 312 -5 339 -2 q 262 -8 284 -8 q 145 28 183 -8 q 108 143 108 64 l 108 638 l 0 638 l 0 738 l 108 738 l 108 944 l 232 944 l 232 738 l 367 738 l 367 638 l 232 638 l 232 185 q 248 121 232 140 q 307 102 264 102 q 345 104 330 102 q 367 107 360 107 l 367 0 "},"":{x_min:0,x_max:706,ha:803,o:"m 706 411 l 706 158 l 630 158 l 630 335 l 0 335 l 0 411 l 706 411 "},:{x_min:0,x_max:750,ha:803,o:"m 750 -7 q 679 -15 716 -15 q 538 59 591 -15 q 466 214 512 97 l 336 551 l 126 0 l 0 0 l 270 705 q 223 837 247 770 q 116 899 190 899 q 90 898 100 899 l 90 1004 q 152 1011 125 1011 q 298 938 244 1011 q 373 783 326 901 l 605 192 q 649 115 629 136 q 716 95 669 95 l 736 95 q 750 97 745 97 l 750 -7 "},W:{x_min:0,x_max:1263.890625,ha:1351,o:"m 1263 1013 l 995 0 l 859 0 l 627 837 l 405 0 l 265 0 l 0 1013 l 136 1013 l 342 202 l 556 1013 l 701 1013 l 921 207 l 1133 1012 l 1263 1013 "},">":{x_min:18.0625,x_max:774,ha:792,o:"m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 "},v:{x_min:0,x_max:675.15625,ha:761,o:"m 675 738 l 404 0 l 272 0 l 0 738 l 133 737 l 340 147 l 541 737 l 675 738 "},:{x_min:.28125,x_max:644.5,ha:703,o:"m 644 628 l 382 628 l 382 179 q 388 120 382 137 q 436 91 401 91 q 474 94 447 91 q 504 97 501 97 l 504 0 q 454 -9 482 -5 q 401 -14 426 -14 q 278 67 308 -14 q 260 233 260 118 l 260 628 l 0 628 l 0 739 l 644 739 l 644 628 "},:{x_min:0,x_max:624.9375,ha:699,o:"m 624 -37 q 608 -153 624 -96 q 563 -278 593 -211 l 454 -278 q 491 -183 486 -200 q 511 -83 511 -126 q 484 -23 511 -44 q 370 1 452 1 q 323 0 354 1 q 283 -1 293 -1 q 84 76 169 -1 q 0 266 0 154 q 56 431 0 358 q 197 538 108 498 q 94 613 134 562 q 54 730 54 665 q 77 823 54 780 q 143 901 101 867 l 27 901 l 27 1012 l 576 1012 l 576 901 l 380 901 q 244 863 303 901 q 178 745 178 820 q 312 600 178 636 q 532 582 380 582 l 532 479 q 276 455 361 479 q 118 281 118 410 q 165 173 118 217 q 274 120 208 133 q 494 101 384 110 q 624 -37 624 76 "},"&":{x_min:-3,x_max:894.25,ha:992,o:"m 894 0 l 725 0 l 624 123 q 471 0 553 40 q 306 -41 390 -41 q 168 -7 231 -41 q 62 92 105 26 q 14 187 31 139 q -3 276 -3 235 q 55 433 -3 358 q 248 581 114 508 q 170 689 196 640 q 137 817 137 751 q 214 985 137 922 q 384 1041 284 1041 q 548 988 483 1041 q 622 824 622 928 q 563 666 622 739 q 431 556 516 608 l 621 326 q 649 407 639 361 q 663 493 653 426 l 781 493 q 703 229 781 352 l 894 0 m 504 818 q 468 908 504 877 q 384 940 433 940 q 293 907 331 940 q 255 818 255 875 q 289 714 255 767 q 363 628 313 678 q 477 729 446 682 q 504 818 504 771 m 556 209 l 314 499 q 179 395 223 449 q 135 283 135 341 q 146 222 135 253 q 183 158 158 192 q 333 80 241 80 q 556 209 448 80 "},:{x_min:0,x_max:862.5,ha:942,o:"m 862 0 l 719 0 l 426 847 l 143 0 l 0 0 l 356 1013 l 501 1013 l 862 0 "},I:{x_min:41,x_max:180,ha:293,o:"m 180 0 l 41 0 l 41 1013 l 180 1013 l 180 0 "},G:{x_min:0,x_max:921,ha:1011,o:"m 921 0 l 832 0 l 801 136 q 655 15 741 58 q 470 -28 568 -28 q 126 133 259 -28 q 0 499 0 284 q 125 881 0 731 q 486 1043 259 1043 q 763 957 647 1043 q 905 709 890 864 l 772 709 q 668 866 747 807 q 486 926 589 926 q 228 795 322 926 q 142 507 142 677 q 228 224 142 342 q 483 94 323 94 q 712 195 625 94 q 796 435 796 291 l 477 435 l 477 549 l 921 549 l 921 0 "},:{x_min:0,x_max:617,ha:725,o:"m 524 800 l 414 800 l 414 925 l 524 925 l 524 800 m 183 800 l 73 800 l 73 925 l 183 925 l 183 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 489 1040 l 300 819 l 216 819 l 351 1040 l 489 1040 "},"`":{x_min:0,x_max:138.890625,ha:236,o:"m 138 699 l 0 699 l 0 861 q 36 974 0 929 q 138 1041 72 1020 l 138 977 q 82 931 95 969 q 69 839 69 893 l 138 839 l 138 699 "},"":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 "},:{x_min:.328125,x_max:819.515625,ha:889,o:"m 819 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 "},r:{x_min:0,x_max:355.5625,ha:432,o:"m 355 621 l 343 621 q 179 569 236 621 q 122 411 122 518 l 122 0 l 0 0 l 0 737 l 117 737 l 117 604 q 204 719 146 686 q 355 753 262 753 l 355 621 "},x:{x_min:0,x_max:675,ha:764,o:"m 675 0 l 525 0 l 331 286 l 144 0 l 0 0 l 256 379 l 12 738 l 157 737 l 336 473 l 516 738 l 661 738 l 412 380 l 675 0 "},:{x_min:0,x_max:696.609375,ha:747,o:"m 696 -4 q 628 -14 657 -14 q 498 97 513 -14 q 422 8 470 41 q 313 -24 374 -24 q 207 3 258 -24 q 120 80 157 31 l 120 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 172 124 246 q 308 82 216 82 q 451 177 402 82 q 492 358 492 254 l 492 738 l 616 738 l 616 214 q 623 136 616 160 q 673 92 636 92 q 696 95 684 92 l 696 -4 "},h:{x_min:0,x_max:615,ha:724,o:"m 615 472 l 615 0 l 490 0 l 490 454 q 456 590 490 535 q 338 654 416 654 q 186 588 251 654 q 122 436 122 522 l 122 0 l 0 0 l 0 1013 l 122 1013 l 122 633 q 218 727 149 694 q 362 760 287 760 q 552 676 484 760 q 615 472 615 600 "},".":{x_min:0,x_max:142,ha:239,o:"m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 "},:{x_min:-2,x_max:878,ha:974,o:"m 496 -279 l 378 -279 l 378 -17 q 101 88 204 -17 q -2 367 -2 194 q 68 626 -2 510 q 283 758 151 758 l 283 646 q 167 537 209 626 q 133 373 133 462 q 192 177 133 254 q 378 93 259 93 l 378 758 q 445 764 426 763 q 476 765 464 765 q 765 659 653 765 q 878 377 878 553 q 771 96 878 209 q 496 -17 665 -17 l 496 -279 m 496 93 l 514 93 q 687 183 623 93 q 746 380 746 265 q 691 569 746 491 q 522 658 629 658 l 496 656 l 496 93 "},";":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 -12 q 105 -132 142 -82 q 0 -206 68 -182 l 0 -138 q 58 -82 43 -123 q 68 0 68 -56 l 0 0 l 0 151 l 142 151 l 142 -12 "},f:{x_min:0,x_max:378,ha:472,o:"m 378 638 l 246 638 l 246 0 l 121 0 l 121 638 l 0 638 l 0 738 l 121 738 q 137 935 121 887 q 290 1028 171 1028 q 320 1027 305 1028 q 378 1021 334 1026 l 378 908 q 323 918 346 918 q 257 870 273 918 q 246 780 246 840 l 246 738 l 378 738 l 378 638 "},"":{x_min:1,x_max:348.21875,ha:454,o:"m 140 670 l 1 670 l 1 830 q 37 943 1 897 q 140 1011 74 990 l 140 947 q 82 900 97 940 q 68 810 68 861 l 140 810 l 140 670 m 348 670 l 209 670 l 209 830 q 245 943 209 897 q 348 1011 282 990 l 348 947 q 290 900 305 940 q 276 810 276 861 l 348 810 l 348 670 "},A:{x_min:.03125,x_max:906.953125,ha:1008,o:"m 906 0 l 756 0 l 648 303 l 251 303 l 142 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 610 421 l 452 867 l 293 421 l 610 421 "},"":{x_min:1,x_max:139.890625,ha:236,o:"m 139 670 l 1 670 l 1 830 q 37 943 1 897 q 139 1011 74 990 l 139 947 q 82 900 97 940 q 68 810 68 861 l 139 810 l 139 670 "},:{x_min:-70,x_max:283,ha:361,o:"m 283 800 l 173 800 l 173 925 l 283 925 l 283 800 m 40 800 l -70 800 l -70 925 l 40 925 l 40 800 m 283 3 q 232 -10 257 -5 q 181 -15 206 -15 q 84 26 118 -15 q 41 200 41 79 l 41 737 l 166 737 l 167 215 q 171 141 167 157 q 225 101 182 101 q 247 103 238 101 q 283 112 256 104 l 283 3 "},:{x_min:-.21875,x_max:773.21875,ha:857,o:"m 773 -7 l 707 -11 q 575 40 607 -11 q 552 174 552 77 l 552 226 l 552 626 l 222 626 l 222 0 l 97 0 l 97 626 l 0 626 l 0 737 l 773 737 l 773 626 l 676 626 l 676 171 q 695 103 676 117 q 773 90 714 90 l 773 -7 "},:{x_min:0,x_max:765.5625,ha:809,o:"m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 727 407 760 q 563 637 524 695 l 563 738 l 685 738 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 95 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 m 604 1040 l 415 819 l 332 819 l 466 1040 l 604 1040 "},O:{x_min:0,x_max:958,ha:1057,o:"m 485 1041 q 834 882 702 1041 q 958 512 958 734 q 834 136 958 287 q 481 -26 702 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 728 q 485 1041 263 1041 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 669 q 480 912 640 912 q 226 784 321 912 q 142 504 142 670 q 226 224 142 339 q 480 98 319 98 "},n:{x_min:0,x_max:615,ha:724,o:"m 615 463 l 615 0 l 490 0 l 490 454 q 453 592 490 537 q 331 656 410 656 q 178 585 240 656 q 117 421 117 514 l 117 0 l 0 0 l 0 738 l 117 738 l 117 630 q 218 728 150 693 q 359 764 286 764 q 552 675 484 764 q 615 463 615 593 "},l:{x_min:41,x_max:166,ha:279,o:"m 166 0 l 41 0 l 41 1013 l 166 1013 l 166 0 "},"":{x_min:40.09375,x_max:728.796875,ha:825,o:"m 728 304 l 649 224 l 512 363 q 383 331 458 331 q 256 363 310 331 l 119 224 l 40 304 l 177 441 q 150 553 150 493 q 184 673 150 621 l 40 818 l 119 898 l 267 749 q 321 766 291 759 q 384 773 351 773 q 447 766 417 773 q 501 749 477 759 l 649 898 l 728 818 l 585 675 q 612 618 604 648 q 621 553 621 587 q 591 441 621 491 l 728 304 m 384 682 q 280 643 318 682 q 243 551 243 604 q 279 461 243 499 q 383 423 316 423 q 487 461 449 423 q 525 553 525 500 q 490 641 525 605 q 384 682 451 682 "},:{x_min:0,x_max:632.328125,ha:679,o:"m 632 0 l 482 0 l 225 384 l 124 288 l 124 0 l 0 0 l 0 738 l 124 738 l 124 446 l 433 738 l 596 738 l 312 466 l 632 0 "},p:{x_min:0,x_max:685,ha:786,o:"m 685 364 q 598 96 685 205 q 350 -23 504 -23 q 121 89 205 -23 l 121 -278 l 0 -278 l 0 738 l 121 738 l 121 633 q 220 726 159 691 q 351 761 280 761 q 598 636 504 761 q 685 364 685 522 m 557 371 q 501 560 557 481 q 330 651 437 651 q 162 559 223 651 q 108 366 108 479 q 162 177 108 254 q 333 87 224 87 q 502 178 441 87 q 557 371 557 258 "},"":{x_min:0,x_max:777,ha:835,o:"m 458 238 l 458 0 l 319 0 l 319 238 l 0 238 l 0 360 l 319 360 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 l 777 804 l 777 683 l 458 683 l 458 360 l 777 360 l 777 238 l 458 238 "},:{x_min:0,x_max:808,ha:907,o:"m 465 -278 l 341 -278 l 341 -15 q 87 102 180 -15 q 0 378 0 210 l 0 739 l 133 739 l 133 379 q 182 195 133 275 q 341 98 242 98 l 341 922 l 465 922 l 465 98 q 623 195 563 98 q 675 382 675 278 l 675 742 l 808 742 l 808 381 q 720 104 808 213 q 466 -13 627 -13 l 465 -278 "},:{x_min:.78125,x_max:697,ha:810,o:"m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 720 124 755 q 200 630 193 686 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 "}},pQ="normal",mQ=1189,gQ=-100,yQ="normal",_Q={yMin:-334,xMin:-111,yMax:1189,xMax:1672},vQ=1e3,bQ={postscript_name:"Helvetiker-Regular",version_string:"Version 1.00 2004 initial release",vendor_url:"http://www.magenta.gr/",full_font_name:"Helvetiker",font_family_name:"Helvetiker",copyright:"Copyright (c) agenta ltd, 2004",description:"",trademark:"",designer:"",designer_url:"",unique_font_identifier:"agenta ltd:Helvetiker:22-10-104",license_url:"http://www.ellak.gr/fonts/MgOpen/license.html",license_description:`Copyright (c) 2004 by MAGENTA Ltd. All Rights Reserved.\r
\r
Permission is hereby granted, free of charge, to any person obtaining a copy of the fonts accompanying this license ("Fonts") and associated documentation files (the "Font Software"), to reproduce and distribute the Font Software, including without limitation the rights to use, copy, merge, publish, distribute, and/or sell copies of the Font Software, and to permit persons to whom the Font Software is furnished to do so, subject to the following conditions: \r
\r
The above copyright and this permission notice shall be included in all copies of one or more of the Font Software typefaces.\r
\r
The Font Software may be modified, altered, or added to, and in particular the designs of glyphs or characters in the Fonts may be modified and additional glyphs or characters may be added to the Fonts, only if the fonts are renamed to names not containing the word "MgOpen", or if the modifications are accepted for inclusion in the Font Software itself by the each appointed Administrator.\r
\r
This License becomes null and void to the extent applicable to Fonts or Font Software that has been modified and is distributed under the "MgOpen" name.\r
\r
The Font Software may be sold as part of a larger software package but no copy of one or more of the Font Software typefaces may be sold by itself. \r
\r
THE FONT SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT OF COPYRIGHT, PATENT, TRADEMARK, OR OTHER RIGHT. IN NO EVENT SHALL MAGENTA OR PERSONS OR BODIES IN CHARGE OF ADMINISTRATION AND MAINTENANCE OF THE FONT SOFTWARE BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, INCLUDING ANY GENERAL, SPECIAL, INDIRECT, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF THE USE OR INABILITY TO USE THE FONT SOFTWARE OR FROM OTHER DEALINGS IN THE FONT SOFTWARE.`,manufacturer_name:"agenta ltd",font_sub_family_name:"Regular"},xQ=-334,TQ="Helvetiker",wQ=1522,SQ=50,EQ={glyphs:dQ,cssFontWeight:pQ,ascender:mQ,underlinePosition:gQ,cssFontStyle:yQ,boundingBox:_Q,resolution:vQ,original_font_information:bQ,descender:xQ,familyName:TQ,lineHeight:wQ,underlineThickness:SQ},Ii=Vt(Vt({},window.THREE?window.THREE:{BoxGeometry:a1,CircleGeometry:e4,DoubleSide:xi,Group:Os,Mesh:gn,MeshLambertMaterial:ho,TextGeometry:Db,Vector3:ge}),{},{Font:wW,TextGeometry:Db}),BS=$n({props:{labelsData:{default:[]},labelLat:{default:"lat"},labelLng:{default:"lng"},labelAltitude:{default:.002},labelText:{default:"text"},labelSize:{default:.5},labelTypeFace:{default:EQ,onChange:function(e,t){t.font=new Ii.Font(e)}},labelColor:{default:function(){return"lightgrey"}},labelRotation:{default:0},labelResolution:{default:3},labelIncludeDot:{default:!0},labelDotRadius:{default:.1},labelDotOrientation:{default:function(){return"bottom"}},labelsTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,r){var i=r.tweenGroup;tn(e),t.scene=e,t.tweenGroup=i;var s=new Ii.CircleGeometry(1,32);t.dataMapper=new Wr(e,{objBindAttr:"__threeObjLabel"}).onCreateObj(function(){var o=new Ii.MeshLambertMaterial;o.side=xi;var a=new Ii.Group;a.add(new Ii.Mesh(s,o));var c=new Ii.Mesh(void 0,o);a.add(c);var f=new Ii.Mesh;return f.visible=!1,c.add(f),a.__globeObjType="label",a})},update:function(e){var t=be(e.labelLat),r=be(e.labelLng),i=be(e.labelAltitude),s=be(e.labelText),o=be(e.labelSize),a=be(e.labelRotation),c=be(e.labelColor),f=be(e.labelIncludeDot),p=be(e.labelDotRadius),g=be(e.labelDotOrientation),v=new Set(["right","top","bottom"]),x=2*Math.PI*on/360;e.dataMapper.onUpdateObj(function(T,S){var E=un(T.children,2),N=E[0],P=E[1],B=un(P.children,1),L=B[0],k=c(S),q=Qi(k);P.material.color.set(Bs(k)),P.material.transparent=q<1,P.material.opacity=q;var I=f(S),U=g(S);!I||!v.has(U)&&(U="bottom");var j=I?+p(S)*x:1e-12;N.scale.x=N.scale.y=j;var J=+o(S)*x;if(P.geometry&&P.geometry.dispose(),P.geometry=new Ii.TextGeometry(s(S),{font:e.font,size:J,depth:0,bevelEnabled:!0,bevelThickness:0,bevelSize:0,curveSegments:e.labelResolution}),L.geometry&&L.geometry.dispose(),P.geometry.computeBoundingBox(),L.geometry=Ay(Ii.BoxGeometry,Kt(new Ii.Vector3().subVectors(P.geometry.boundingBox.max,P.geometry.boundingBox.min).clampScalar(0,1/0).toArray())),U!=="right"&&P.geometry.center(),I){var Q=j+J/2;U==="right"&&(P.position.x=Q),P.position.y={right:-J/2,top:Q+J/2,bottom:-Q-J/2}[U]}var K=function(ae){var he=T.__currentTargetD=ae,xe=he.lat,me=he.lng,Oe=he.alt,ke=he.rot,Ke=he.scale;Object.assign(T.position,Ni(xe,me,Oe)),T.lookAt(e.scene.localToWorld(new Ii.Vector3(0,0,0))),T.rotateY(Math.PI),T.rotateZ(-ke*Math.PI/180),T.scale.x=T.scale.y=T.scale.z=Ke},te={lat:+t(S),lng:+r(S),alt:+i(S),rot:+a(S),scale:1},oe=T.__currentTargetD||Object.assign({},te,{scale:1e-12});Object.keys(te).some(function(Y){return oe[Y]!==te[Y]})&&(!e.labelsTransitionDuration||e.labelsTransitionDuration<0?K(te):e.tweenGroup.add(new Gr(oe).to(te,e.labelsTransitionDuration).easing(er.Quadratic.InOut).onUpdate(K).start()))}).digest(e.labelsData)}}),RQ=Vt(Vt({},window.THREE?window.THREE:{}),{},{CSS2DObject:NN}),DS=$n({props:{htmlElementsData:{default:[]},htmlLat:{default:"lat"},htmlLng:{default:"lng"},htmlAltitude:{default:0},htmlElement:{},htmlElementVisibilityModifier:{triggerUpdate:!1},htmlTransitionDuration:{default:1e3,triggerUpdate:!1},isBehindGlobe:{onChange:function(){this.updateObjVisibility()},triggerUpdate:!1}},methods:{updateObjVisibility:function(e,t){if(e.dataMapper){var r=t?[t]:e.dataMapper.entries().map(function(i){var s=un(i,2),o=s[1];return o}).filter(function(i){return i});r.forEach(function(i){var s=!e.isBehindGlobe||!e.isBehindGlobe(i.position);e.htmlElementVisibilityModifier?(i.visible=!0,e.htmlElementVisibilityModifier(i.element,s)):i.visible=s})}}},init:function(e,t,r){var i=r.tweenGroup;tn(e),t.scene=e,t.tweenGroup=i,t.dataMapper=new Wr(e,{objBindAttr:"__threeObjHtml"}).onCreateObj(function(s){var o=be(t.htmlElement)(s),a=new RQ.CSS2DObject(o);return a.__globeObjType="html",a})},update:function(e,t){var r=this,i=be(e.htmlLat),s=be(e.htmlLng),o=be(e.htmlAltitude);t.hasOwnProperty("htmlElement")&&e.dataMapper.clear(),e.dataMapper.onUpdateObj(function(a,c){var f=function(v){var x=a.__currentTargetD=v,T=x.alt,S=x.lat,E=x.lng;Object.assign(a.position,Ni(S,E,T)),r.updateObjVisibility(a)},p={lat:+i(c),lng:+s(c),alt:+o(c)};!e.htmlTransitionDuration||e.htmlTransitionDuration<0||!a.__currentTargetD?f(p):e.tweenGroup.add(new Gr(a.__currentTargetD).to(p,e.htmlTransitionDuration).easing(er.Quadratic.InOut).onUpdate(f).start())}).digest(e.htmlElementsData)}}),f0=window.THREE?window.THREE:{Group:Os,Mesh:gn,MeshLambertMaterial:ho,SphereGeometry:Jo},LS=$n({props:{objectsData:{default:[]},objectLat:{default:"lat"},objectLng:{default:"lng"},objectAltitude:{default:.01},objectFacesSurface:{default:!0},objectRotation:{},objectThreeObject:{default:new f0.Mesh(new f0.SphereGeometry(1,16,8),new f0.MeshLambertMaterial({color:"#ffffaa",transparent:!0,opacity:.7}))}},init:function(e,t){tn(e),t.scene=e,t.dataMapper=new Wr(e,{objBindAttr:"__threeObjObject"}).onCreateObj(function(r){var i=be(t.objectThreeObject)(r);t.objectThreeObject===i&&(i=i.clone());var s=new f0.Group;return s.add(i),s.__globeObjType="object",s})},update:function(e,t){var r=be(e.objectLat),i=be(e.objectLng),s=be(e.objectAltitude),o=be(e.objectFacesSurface),a=be(e.objectRotation);t.hasOwnProperty("objectThreeObject")&&e.dataMapper.clear(),e.dataMapper.onUpdateObj(function(c,f){var p=+r(f),g=+i(f),v=+s(f);Object.assign(c.position,Ni(p,g,v)),o(f)?c.setRotationFromEuler(new RA(Na(-p),Na(g),0,"YXZ")):c.rotation.set(0,0,0);var x=c.children[0],T=a(f);T&&x.setRotationFromEuler(new RA(Na(T.x||0),Na(T.y||0),Na(T.z||0)))}).digest(e.objectsData)}}),OS=$n({props:{customLayerData:{default:[]},customThreeObject:{},customThreeObjectUpdate:{triggerUpdate:!1}},init:function(e,t){tn(e),t.scene=e,t.dataMapper=new Wr(e,{objBindAttr:"__threeObjCustom"}).onCreateObj(function(r){var i=be(t.customThreeObject)(r,on);return i&&(t.customThreeObject===i&&(i=i.clone()),i.__globeObjType="custom"),i})},update:function(e,t){e.customThreeObjectUpdate||tn(e.scene);var r=be(e.customThreeObjectUpdate);t.hasOwnProperty("customThreeObject")&&e.dataMapper.clear(),e.dataMapper.onUpdateObj(function(i,s){return r(i,s,on)}).digest(e.customLayerData)}}),d0=window.THREE?window.THREE:{Camera:Hg,Group:Os,Vector2:_t,Vector3:ge},CQ=["globeLayer","pointsLayer","arcsLayer","hexBinLayer","heatmapsLayer","polygonsLayer","hexedPolygonsLayer","pathsLayer","tilesLayer","particlesLayer","ringsLayer","labelsLayer","htmlElementsLayer","objectsLayer","customLayer"],FS=Pr("globeLayer",_S),NQ=Object.assign.apply(Object,Kt(["globeImageUrl","bumpImageUrl","globeCurvatureResolution","globeTileEngineUrl","globeTileEngineMaxLevel","showGlobe","showGraticules","showAtmosphere","atmosphereColor","atmosphereAltitude"].map(function(n){return tr({},n,FS.linkProp(n))}))),MQ=Object.assign.apply(Object,Kt(["globeMaterial","globeTileEngineClearCache"].map(function(n){return tr({},n,FS.linkMethod(n))}))),PQ=Pr("pointsLayer",vS),BQ=Object.assign.apply(Object,Kt(["pointsData","pointLat","pointLng","pointColor","pointAltitude","pointRadius","pointResolution","pointsMerge","pointsTransitionDuration"].map(function(n){return tr({},n,PQ.linkProp(n))}))),DQ=Pr("arcsLayer",xS),LQ=Object.assign.apply(Object,Kt(["arcsData","arcStartLat","arcStartLng","arcStartAltitude","arcEndLat","arcEndLng","arcEndAltitude","arcColor","arcAltitude","arcAltitudeAutoScale","arcStroke","arcCurveResolution","arcCircularResolution","arcDashLength","arcDashGap","arcDashInitialGap","arcDashAnimateTime","arcsTransitionDuration"].map(function(n){return tr({},n,DQ.linkProp(n))}))),OQ=Pr("hexBinLayer",TS),FQ=Object.assign.apply(Object,Kt(["hexBinPointsData","hexBinPointLat","hexBinPointLng","hexBinPointWeight","hexBinResolution","hexMargin","hexTopCurvatureResolution","hexTopColor","hexSideColor","hexAltitude","hexBinMerge","hexTransitionDuration"].map(function(n){return tr({},n,OQ.linkProp(n))}))),IQ=Pr("heatmapsLayer",SS),kQ=Object.assign.apply(Object,Kt(["heatmapsData","heatmapPoints","heatmapPointLat","heatmapPointLng","heatmapPointWeight","heatmapBandwidth","heatmapColorFn","heatmapColorSaturation","heatmapBaseAltitude","heatmapTopAltitude","heatmapsTransitionDuration"].map(function(n){return tr({},n,IQ.linkProp(n))}))),UQ=Pr("hexedPolygonsLayer",RS),qQ=Object.assign.apply(Object,Kt(["hexPolygonsData","hexPolygonGeoJsonGeometry","hexPolygonColor","hexPolygonAltitude","hexPolygonResolution","hexPolygonMargin","hexPolygonUseDots","hexPolygonCurvatureResolution","hexPolygonDotResolution","hexPolygonsTransitionDuration"].map(function(n){return tr({},n,UQ.linkProp(n))}))),GQ=Pr("polygonsLayer",ES),VQ=Object.assign.apply(Object,Kt(["polygonsData","polygonGeoJsonGeometry","polygonCapColor","polygonCapMaterial","polygonSideColor","polygonSideMaterial","polygonStrokeColor","polygonAltitude","polygonCapCurvatureResolution","polygonsTransitionDuration"].map(function(n){return tr({},n,GQ.linkProp(n))}))),zQ=Pr("pathsLayer",CS),jQ=Object.assign.apply(Object,Kt(["pathsData","pathPoints","pathPointLat","pathPointLng","pathPointAlt","pathResolution","pathColor","pathStroke","pathDashLength","pathDashGap","pathDashInitialGap","pathDashAnimateTime","pathTransitionDuration"].map(function(n){return tr({},n,zQ.linkProp(n))}))),$Q=Pr("tilesLayer",NS),HQ=Object.assign.apply(Object,Kt(["tilesData","tileLat","tileLng","tileAltitude","tileWidth","tileHeight","tileUseGlobeProjection","tileMaterial","tileCurvatureResolution","tilesTransitionDuration"].map(function(n){return tr({},n,$Q.linkProp(n))}))),WQ=Pr("particlesLayer",MS),QQ=Object.assign.apply(Object,Kt(["particlesData","particlesList","particleLat","particleLng","particleAltitude","particlesSize","particlesSizeAttenuation","particlesColor","particlesTexture"].map(function(n){return tr({},n,WQ.linkProp(n))}))),XQ=Pr("ringsLayer",PS),YQ=Object.assign.apply(Object,Kt(["ringsData","ringLat","ringLng","ringAltitude","ringColor","ringResolution","ringMaxRadius","ringPropagationSpeed","ringRepeatPeriod"].map(function(n){return tr({},n,XQ.linkProp(n))}))),KQ=Pr("labelsLayer",BS),ZQ=Object.assign.apply(Object,Kt(["labelsData","labelLat","labelLng","labelAltitude","labelRotation","labelText","labelSize","labelTypeFace","labelColor","labelResolution","labelIncludeDot","labelDotRadius","labelDotOrientation","labelsTransitionDuration"].map(function(n){return tr({},n,KQ.linkProp(n))}))),JQ=Pr("htmlElementsLayer",DS),eX=Object.assign.apply(Object,Kt(["htmlElementsData","htmlLat","htmlLng","htmlAltitude","htmlElement","htmlElementVisibilityModifier","htmlTransitionDuration"].map(function(n){return tr({},n,JQ.linkProp(n))}))),tX=Pr("objectsLayer",LS),nX=Object.assign.apply(Object,Kt(["objectsData","objectLat","objectLng","objectAltitude","objectRotation","objectFacesSurface","objectThreeObject"].map(function(n){return tr({},n,tX.linkProp(n))}))),rX=Pr("customLayer",OS),iX=Object.assign.apply(Object,Kt(["customLayerData","customThreeObject","customThreeObjectUpdate"].map(function(n){return tr({},n,rX.linkProp(n))}))),sX=$n({props:Vt(Vt(Vt(Vt(Vt(Vt(Vt(Vt(Vt(Vt(Vt(Vt(Vt(Vt(Vt({onGlobeReady:{triggerUpdate:!1},rendererSize:{default:new d0.Vector2(window.innerWidth,window.innerHeight),onChange:function(e,t){t.pathsLayer.rendererSize(e)},triggerUpdate:!1}},NQ),BQ),LQ),FQ),kQ),VQ),qQ),jQ),HQ),QQ),YQ),ZQ),eX),nX),iX),methods:Vt({getGlobeRadius:Fb,getCoords:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return Ni.apply(void 0,r)},toGeoCoords:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return yS.apply(void 0,r)},setPointOfView:function(e,t){var r=t instanceof d0.Camera?t.position:t,i=Fb(),s=void 0;if(e.scene&&r){var o,a,c,f;s=function(g){o===void 0&&(o=r.clone().applyMatrix4(e.scene.matrixWorld.clone().invert())),a===void 0&&(a=o.length()),c===void 0&&(c=Math.sqrt(Math.pow(a,2)-Math.pow(i,2))),f===void 0&&(f=Math.acos(c/a));var v=o.distanceTo(g);if(v<c)return!1;var x=g.length(),T=Math.acos((Math.pow(a,2)+Math.pow(v,2)-Math.pow(x,2))/(2*a*v));return T<f}}e.layersThatNeedUpdatePov.forEach(function(p){return p.updatePov(t)}),e.layersThatNeedBehindGlobeChecker.forEach(function(p){return p.isBehindGlobe(s)})},pauseAnimation:function(e){return e.animationFrameRequestId!==null&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),e.pausableLayers.forEach(function(t){var r;return(r=t.pauseAnimation)===null||r===void 0?void 0:r.call(t)}),this},resumeAnimation:function(e){return e.animationFrameRequestId===null&&this._animationCycle(),e.pausableLayers.forEach(function(t){var r;return(r=t.resumeAnimation)===null||r===void 0?void 0:r.call(t)}),this},_animationCycle:function(e){e.animationFrameRequestId=requestAnimationFrame(this._animationCycle),e.tweenGroup.update()},_destructor:function(e){this.pauseAnimation(),e.destructableLayers.forEach(function(t){return t._destructor()})}},MQ),stateInit:function(){var e=new f1,t={tweenGroup:e},r={globeLayer:_S(t),pointsLayer:vS(t),arcsLayer:xS(t),hexBinLayer:TS(t),heatmapsLayer:SS(t),polygonsLayer:ES(t),hexedPolygonsLayer:RS(t),pathsLayer:CS(t),tilesLayer:NS(t),particlesLayer:MS(t),ringsLayer:PS(t),labelsLayer:BS(t),htmlElementsLayer:DS(t),objectsLayer:LS(t),customLayer:OS(t)};return Vt(Vt({tweenGroup:e},r),{},{layersThatNeedUpdatePov:Object.values(r).filter(function(i){return i.hasOwnProperty("updatePov")}),layersThatNeedBehindGlobeChecker:Object.values(r).filter(function(i){return i.hasOwnProperty("isBehindGlobe")}),destructableLayers:Object.values(r).filter(function(i){return i.hasOwnProperty("_destructor")}),pausableLayers:Object.values(r).filter(function(i){return i.hasOwnProperty("pauseAnimation")})})},init:function(e,t,r){var i=r.animateIn,s=i===void 0?!0:i,o=r.waitForGlobeReady,a=o===void 0?!0:o;tn(e),t.scene=e,t.scene.visible=!1,CQ.forEach(function(f){var p=new d0.Group;t.scene.add(p),t[f](p)});var c=function(){if(s){t.scene.scale.set(1e-6,1e-6,1e-6),t.tweenGroup.add(new Gr({k:1e-6}).to({k:1},600).easing(er.Quadratic.Out).onUpdate(function(g){var v=g.k;return t.scene.scale.set(v,v,v)}).start());var p=new d0.Vector3(0,1,0);t.tweenGroup.add(new Gr({rot:Math.PI*2}).to({rot:0},1200).easing(er.Quintic.Out).onUpdate(function(g){var v=g.rot;return t.scene.setRotationFromAxisAngle(p,v)}).start())}t.scene.visible=!0,t.onGlobeReady&&t.onGlobeReady()};a?t.globeLayer.onReady(c):c(),this._animationCycle()},update:function(e){}});function oX(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Object,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=(function(i){function s(){var o;Xf(this,s);for(var a=arguments.length,c=new Array(a),f=0;f<a;f++)c[f]=arguments[f];return o=Qf(this,s,[].concat(c)),o.__kapsuleInstance=Ay(n,[].concat(Kt(t?[o]:[]),c)),o}return Kf(s,i),Yf(s)})(e);return Object.keys(n()).forEach(function(i){return r.prototype[i]=function(){var s,o=(s=this.__kapsuleInstance)[i].apply(s,arguments);return o===this.__kapsuleInstance?this:o}}),r}var aX=window.THREE?window.THREE:{Group:Os},IS=oX(sX,aX.Group,!0);const Ip={type:"change"},dy={type:"start"},py={type:"end"},$b=1e-6,Ut={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},p0=new _t,Po=new _t,lX=new ge,m0=new ge,kp=new ge,Ml=new Yl,Hb=new ge,g0=new ge,Up=new ge,y0=new ge;class uX extends h1{constructor(e,t=null){super(e,t),this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:Ti.ROTATE,MIDDLE:Ti.DOLLY,RIGHT:Ti.PAN},this.target=new ge,this.state=Ut.NONE,this.keyState=Ut.NONE,this._lastPosition=new ge,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new ge,this._movePrev=new _t,this._moveCurr=new _t,this._lastAxis=new ge,this._zoomStart=new _t,this._zoomEnd=new _t,this._panStart=new _t,this._panEnd=new _t,this._pointers=[],this._pointerPositions={},this._onPointerMove=cX.bind(this),this._onPointerDown=AX.bind(this),this._onPointerUp=hX.bind(this),this._onPointerCancel=fX.bind(this),this._onContextMenu=vX.bind(this),this._onMouseWheel=_X.bind(this),this._onKeyDown=pX.bind(this),this._onKeyUp=dX.bind(this),this._onTouchStart=bX.bind(this),this._onTouchMove=xX.bind(this),this._onTouchEnd=TX.bind(this),this._onMouseDown=mX.bind(this),this._onMouseMove=gX.bind(this),this._onMouseUp=yX.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,t!==null&&(this.connect(t),this.handleResize()),this.update()}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>$b&&(this.dispatchEvent(Ip),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>$b||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(Ip),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=Ut.NONE,this.keyState=Ut.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(Ip),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(Po.copy(this._panEnd).sub(this._panStart),Po.lengthSq()){if(this.object.isOrthographicCamera){const e=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,t=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;Po.x*=e,Po.y*=t}Po.multiplyScalar(this._eye.length()*this.panSpeed),m0.copy(this._eye).cross(this.object.up).setLength(Po.x),m0.add(lX.copy(this.object.up).setLength(Po.y)),this.object.position.add(m0),this.target.add(m0),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(Po.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){y0.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let e=y0.length();e?(this._eye.copy(this.object.position).sub(this.target),Hb.copy(this._eye).normalize(),g0.copy(this.object.up).normalize(),Up.crossVectors(g0,Hb).normalize(),g0.setLength(this._moveCurr.y-this._movePrev.y),Up.setLength(this._moveCurr.x-this._movePrev.x),y0.copy(g0.add(Up)),kp.crossVectors(y0,this._eye).normalize(),e*=this.rotateSpeed,Ml.setFromAxisAngle(kp,e),this._eye.applyQuaternion(Ml),this.object.up.applyQuaternion(Ml),this._lastAxis.copy(kp),this._lastAngle=e):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),Ml.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(Ml),this.object.up.applyQuaternion(Ml)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let e;this.state===Ut.TOUCH_ZOOM_PAN?(e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=Jl.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,e!==1&&e>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=Jl.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(e,t){return p0.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),p0}_getMouseOnCircle(e,t){return p0.set((e-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-t))/this.screen.width),p0}_addPointer(e){this._pointers.push(e)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId==e.pointerId){this._pointers.splice(t,1);return}}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new _t,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[t.pointerId]}_checkDistances(){(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function AX(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.ownerDocument.addEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this._onPointerUp)),this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n))}function cX(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function hX(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchEnd(n):this._onMouseUp(),this._removePointer(n),this._pointers.length===0&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp)))}function fX(n){this._removePointer(n)}function dX(){this.enabled!==!1&&(this.keyState=Ut.NONE,window.addEventListener("keydown",this._onKeyDown))}function pX(n){this.enabled!==!1&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===Ut.NONE&&(n.code===this.keys[Ut.ROTATE]&&!this.noRotate?this.keyState=Ut.ROTATE:n.code===this.keys[Ut.ZOOM]&&!this.noZoom?this.keyState=Ut.ZOOM:n.code===this.keys[Ut.PAN]&&!this.noPan&&(this.keyState=Ut.PAN)))}function mX(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Ti.DOLLY:this.state=Ut.ZOOM;break;case Ti.ROTATE:this.state=Ut.ROTATE;break;case Ti.PAN:this.state=Ut.PAN;break;default:this.state=Ut.NONE}const t=this.keyState!==Ut.NONE?this.keyState:this.state;t===Ut.ROTATE&&!this.noRotate?(this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY)),this._movePrev.copy(this._moveCurr)):t===Ut.ZOOM&&!this.noZoom?(this._zoomStart.copy(this._getMouseOnScreen(n.pageX,n.pageY)),this._zoomEnd.copy(this._zoomStart)):t===Ut.PAN&&!this.noPan&&(this._panStart.copy(this._getMouseOnScreen(n.pageX,n.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent(dy)}function gX(n){const e=this.keyState!==Ut.NONE?this.keyState:this.state;e===Ut.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY))):e===Ut.ZOOM&&!this.noZoom?this._zoomEnd.copy(this._getMouseOnScreen(n.pageX,n.pageY)):e===Ut.PAN&&!this.noPan&&this._panEnd.copy(this._getMouseOnScreen(n.pageX,n.pageY))}function yX(){this.state=Ut.NONE,this.dispatchEvent(py)}function _X(n){if(this.enabled!==!1&&this.noZoom!==!0){switch(n.preventDefault(),n.deltaMode){case 2:this._zoomStart.y-=n.deltaY*.025;break;case 1:this._zoomStart.y-=n.deltaY*.01;break;default:this._zoomStart.y-=n.deltaY*25e-5;break}this.dispatchEvent(dy),this.dispatchEvent(py)}}function vX(n){this.enabled!==!1&&n.preventDefault()}function bX(n){switch(this._trackPointer(n),this._pointers.length){case 1:this.state=Ut.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this.state=Ut.TOUCH_ZOOM_PAN;const e=this._pointers[0].pageX-this._pointers[1].pageX,t=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+t*t);const r=(this._pointers[0].pageX+this._pointers[1].pageX)/2,i=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(r,i)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(dy)}function xX(n){switch(this._trackPointer(n),this._pointers.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY));break;default:const e=this._getSecondPointerPosition(n),t=n.pageX-e.x,r=n.pageY-e.y;this._touchZoomDistanceEnd=Math.sqrt(t*t+r*r);const i=(n.pageX+e.x)/2,s=(n.pageY+e.y)/2;this._panEnd.copy(this._getMouseOnScreen(i,s));break}}function TX(n){switch(this._pointers.length){case 0:this.state=Ut.NONE;break;case 1:this.state=Ut.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=Ut.TOUCH_ZOOM_PAN;for(let e=0;e<this._pointers.length;e++)if(this._pointers[e].pointerId!==n.pointerId){const t=this._pointerPositions[this._pointers[e].pointerId];this._moveCurr.copy(this._getMouseOnCircle(t.x,t.y)),this._movePrev.copy(this._moveCurr);break}break}this.dispatchEvent(py)}const Wb={type:"change"},my={type:"start"},kS={type:"end"},_0=new oN,Qb=new t1,wX=Math.cos(70*Jl.DEG2RAD),zn=new ge,Lr=2*Math.PI,Jt={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},qp=1e-6;class SX extends h1{constructor(e,t=null){super(e,t),this.state=Jt.NONE,this.target=new ge,this.cursor=new ge,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Ti.ROTATE,MIDDLE:Ti.DOLLY,RIGHT:Ti.PAN},this.touches={ONE:Ol.ROTATE,TWO:Ol.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new ge,this._lastQuaternion=new Yl,this._lastTargetPosition=new ge,this._quat=new Yl().setFromUnitVectors(e.up,new ge(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new N_,this._sphericalDelta=new N_,this._scale=1,this._panOffset=new ge,this._rotateStart=new _t,this._rotateEnd=new _t,this._rotateDelta=new _t,this._panStart=new _t,this._panEnd=new _t,this._panDelta=new _t,this._dollyStart=new _t,this._dollyEnd=new _t,this._dollyDelta=new _t,this._dollyDirection=new ge,this._mouse=new _t,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=RX.bind(this),this._onPointerDown=EX.bind(this),this._onPointerUp=CX.bind(this),this._onContextMenu=OX.bind(this),this._onMouseWheel=PX.bind(this),this._onKeyDown=BX.bind(this),this._onTouchStart=DX.bind(this),this._onTouchMove=LX.bind(this),this._onMouseDown=NX.bind(this),this._onMouseMove=MX.bind(this),this._interceptControlDown=FX.bind(this),this._interceptControlUp=IX.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(Wb),this.update(),this.state=Jt.NONE}update(e=null){const t=this.object.position;zn.copy(t).sub(this.target),zn.applyQuaternion(this._quat),this._spherical.setFromVector3(zn),this.autoRotate&&this.state===Jt.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let r=this.minAzimuthAngle,i=this.maxAzimuthAngle;isFinite(r)&&isFinite(i)&&(r<-Math.PI?r+=Lr:r>Math.PI&&(r-=Lr),i<-Math.PI?i+=Lr:i>Math.PI&&(i-=Lr),r<=i?this._spherical.theta=Math.max(r,Math.min(i,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(r+i)/2?Math.max(r,this._spherical.theta):Math.min(i,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let s=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),s=o!=this._spherical.radius}if(zn.setFromSpherical(this._spherical),zn.applyQuaternion(this._quatInverse),t.copy(this.target).add(zn),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const a=zn.length();o=this._clampDistance(a*this._scale);const c=a-o;this.object.position.addScaledVector(this._dollyDirection,c),this.object.updateMatrixWorld(),s=!!c}else if(this.object.isOrthographicCamera){const a=new ge(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const c=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),s=c!==this.object.zoom;const f=new ge(this._mouse.x,this._mouse.y,0);f.unproject(this.object),this.object.position.sub(f).add(a),this.object.updateMatrixWorld(),o=zn.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(_0.origin.copy(this.object.position),_0.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(_0.direction))<wX?this.object.lookAt(this.target):(Qb.setFromNormalAndCoplanarPoint(this.object.up,this.target),_0.intersectPlane(Qb,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),s=!0)}return this._scale=1,this._performCursorZoom=!1,s||this._lastPosition.distanceToSquared(this.object.position)>qp||8*(1-this._lastQuaternion.dot(this.object.quaternion))>qp||this._lastTargetPosition.distanceToSquared(this.target)>qp?(this.dispatchEvent(Wb),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Lr/60*this.autoRotateSpeed*e:Lr/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){zn.setFromMatrixColumn(t,0),zn.multiplyScalar(-e),this._panOffset.add(zn)}_panUp(e,t){this.screenSpacePanning===!0?zn.setFromMatrixColumn(t,1):(zn.setFromMatrixColumn(t,0),zn.crossVectors(this.object.up,zn)),zn.multiplyScalar(e),this._panOffset.add(zn)}_pan(e,t){const r=this.domElement;if(this.object.isPerspectiveCamera){const i=this.object.position;zn.copy(i).sub(this.target);let s=zn.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*s/r.clientHeight,this.object.matrix),this._panUp(2*t*s/r.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/r.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/r.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const r=this.domElement.getBoundingClientRect(),i=e-r.left,s=t-r.top,o=r.width,a=r.height;this._mouse.x=i/o*2-1,this._mouse.y=-(s/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Lr*this._rotateDelta.x/t.clientHeight),this._rotateUp(Lr*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(Lr*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-Lr*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(Lr*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-Lr*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._rotateStart.set(r,i)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panStart.set(r,i)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),r=e.pageX-t.x,i=e.pageY-t.y,s=Math.sqrt(r*r+i*i);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const r=this._getSecondPointerPosition(e),i=.5*(e.pageX+r.x),s=.5*(e.pageY+r.y);this._rotateEnd.set(i,s)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Lr*this._rotateDelta.x/t.clientHeight),this._rotateUp(Lr*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panEnd.set(r,i)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),r=e.pageX-t.x,i=e.pageY-t.y,s=Math.sqrt(r*r+i*i);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(e.pageX+t.x)*.5,a=(e.pageY+t.y)*.5;this._updateZoomParameters(o,a)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new _t,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,r={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:r.deltaY*=16;break;case 2:r.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(r.deltaY*=10),r}}function EX(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.ownerDocument.addEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(n)&&(this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n)))}function RX(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function CX(n){switch(this._removePointer(n),this._pointers.length){case 0:this.domElement.releasePointerCapture(n.pointerId),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(kS),this.state=Jt.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function NX(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Ti.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(n),this.state=Jt.DOLLY;break;case Ti.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=Jt.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=Jt.ROTATE}break;case Ti.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=Jt.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=Jt.PAN}break;default:this.state=Jt.NONE}this.state!==Jt.NONE&&this.dispatchEvent(my)}function MX(n){switch(this.state){case Jt.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(n);break;case Jt.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(n);break;case Jt.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(n);break}}function PX(n){this.enabled===!1||this.enableZoom===!1||this.state!==Jt.NONE||(n.preventDefault(),this.dispatchEvent(my),this._handleMouseWheel(this._customWheelEvent(n)),this.dispatchEvent(kS))}function BX(n){this.enabled!==!1&&this._handleKeyDown(n)}function DX(n){switch(this._trackPointer(n),this._pointers.length){case 1:switch(this.touches.ONE){case Ol.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(n),this.state=Jt.TOUCH_ROTATE;break;case Ol.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(n),this.state=Jt.TOUCH_PAN;break;default:this.state=Jt.NONE}break;case 2:switch(this.touches.TWO){case Ol.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(n),this.state=Jt.TOUCH_DOLLY_PAN;break;case Ol.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(n),this.state=Jt.TOUCH_DOLLY_ROTATE;break;default:this.state=Jt.NONE}break;default:this.state=Jt.NONE}this.state!==Jt.NONE&&this.dispatchEvent(my)}function LX(n){switch(this._trackPointer(n),this.state){case Jt.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(n),this.update();break;case Jt.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(n),this.update();break;case Jt.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(n),this.update();break;case Jt.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(n),this.update();break;default:this.state=Jt.NONE}}function OX(n){this.enabled!==!1&&n.preventDefault()}function FX(n){n.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function IX(n){n.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const kX={type:"change"},Xb=1e-6,Yb=new Yl;class UX extends h1{constructor(e,t=null){super(e,t),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new ge(0,0,0),this._rotationVector=new ge(0,0,0),this._lastQuaternion=new Yl,this._lastPosition=new ge,this._status=0,this._onKeyDown=qX.bind(this),this._onKeyUp=GX.bind(this),this._onPointerMove=zX.bind(this),this._onPointerDown=VX.bind(this),this._onPointerUp=jX.bind(this),this._onPointerCancel=$X.bind(this),this._onContextMenu=HX.bind(this),t!==null&&this.connect(t)}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(e){if(this.enabled===!1)return;const t=this.object,r=e*this.movementSpeed,i=e*this.rollSpeed;t.translateX(this._moveVector.x*r),t.translateY(this._moveVector.y*r),t.translateZ(this._moveVector.z*r),Yb.set(this._rotationVector.x*i,this._rotationVector.y*i,this._rotationVector.z*i,1).normalize(),t.quaternion.multiply(Yb),(this._lastPosition.distanceToSquared(t.position)>Xb||8*(1-this._lastQuaternion.dot(t.quaternion))>Xb)&&(this.dispatchEvent(kX),this._lastQuaternion.copy(t.quaternion),this._lastPosition.copy(t.position))}_updateMovementVector(){const e=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-e+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function qX(n){if(!(n.altKey||this.enabled===!1)){switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1;break}this._updateMovementVector(),this._updateRotationVector()}}function GX(n){if(this.enabled!==!1){switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0;break}this._updateMovementVector(),this._updateRotationVector()}}function VX(n){if(this.enabled!==!1)if(this.dragToLook)this._status++;else{switch(n.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1;break}this._updateMovementVector()}}function zX(n){if(this.enabled!==!1&&(!this.dragToLook||this._status>0)){const e=this._getContainerDimensions(),t=e.size[0]/2,r=e.size[1]/2;this._moveState.yawLeft=-(n.pageX-e.offset[0]-t)/t,this._moveState.pitchDown=(n.pageY-e.offset[1]-r)/r,this._updateRotationVector()}}function jX(n){if(this.enabled!==!1){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(n.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0;break}this._updateMovementVector()}this._updateRotationVector()}}function $X(){this.enabled!==!1&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function HX(n){this.enabled!==!1&&n.preventDefault()}const WX={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class Zf{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const QX=new Yg(-1,1,1,-1,0,1);class XX extends Hr{constructor(){super(),this.setAttribute("position",new Cs([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Cs([0,2,0,0,2,0],2))}}const YX=new XX;class KX{constructor(e){this._mesh=new gn(YX,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,QX)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class ZX extends Zf{constructor(e,t="tDiffuse"){super(),this.textureID=t,this.uniforms=null,this.material=null,e instanceof eu?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=A1.clone(e.uniforms),this.material=new eu({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this._fsQuad=new KX(this.material)}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this._fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this._fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this._fsQuad.render(e))}dispose(){this.material.dispose(),this._fsQuad.dispose()}}class Kb extends Zf{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,r){const i=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let o,a;this.inverse?(o=0,a=1):(o=1,a=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),s.buffers.stencil.setFunc(i.ALWAYS,o,4294967295),s.buffers.stencil.setClear(a),s.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.color.setMask(!0),s.buffers.depth.setMask(!0),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(i.EQUAL,1,4294967295),s.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),s.buffers.stencil.setLocked(!0)}}class JX extends Zf{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class eY{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const r=e.getSize(new _t);this._width=r.width,this._height=r.height,t=new aN(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:or}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new ZX(WX),this.copyPass.material.blending=Zl,this.clock=new n4}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let r=!1;for(let i=0,s=this.passes.length;i<s;i++){const o=this.passes[i];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),o.needsSwap){if(r){const a=this.renderer.getContext(),c=this.renderer.state.buffers.stencil;c.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),c.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}Kb!==void 0&&(o instanceof Kb?r=!0:o instanceof JX&&(r=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new _t);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const r=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(r,i),this.renderTarget2.setSize(r,i);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(r,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class tY extends Zf{constructor(e,t,r=null,i=null,s=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=i,this.clearAlpha=s,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this.isRenderPass=!0,this._oldClearColor=new jn}render(e,t,r){const i=e.autoClear;e.autoClear=!1;let s,o;this.overrideMaterial!==null&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(s=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(s),this.overrideMaterial!==null&&(this.scene.overrideMaterial=o),e.autoClear=i}}function $r(){return $r=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},$r.apply(null,arguments)}function nY(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function WA(n,e){return WA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},WA(n,e)}function rY(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,WA(n,e)}function Og(n){return Og=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Og(n)}function iY(n){try{return Function.toString.call(n).indexOf("[native code]")!==-1}catch{return typeof n=="function"}}function US(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(US=function(){return!!n})()}function sY(n,e,t){if(US())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(n.bind.apply(n,r));return t&&WA(i,t.prototype),i}function Fg(n){var e=typeof Map=="function"?new Map:void 0;return Fg=function(r){if(r===null||!iY(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(r))return e.get(r);e.set(r,i)}function i(){return sY(r,arguments,Og(this).constructor)}return i.prototype=Object.create(r.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),WA(i,r)},Fg(n)}var ys=(function(n){rY(e,n);function e(t){var r;return r=n.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+t+" for more information.")||this,nY(r)}return e})(Fg(Error));function Gp(n){return Math.round(n*255)}function oY(n,e,t){return Gp(n)+","+Gp(e)+","+Gp(t)}function Zh(n,e,t,r){if(r===void 0&&(r=oY),e===0)return r(t,t,t);var i=(n%360+360)%360/60,s=(1-Math.abs(2*t-1))*e,o=s*(1-Math.abs(i%2-1)),a=0,c=0,f=0;i>=0&&i<1?(a=s,c=o):i>=1&&i<2?(a=o,c=s):i>=2&&i<3?(c=s,f=o):i>=3&&i<4?(c=o,f=s):i>=4&&i<5?(a=o,f=s):i>=5&&i<6&&(a=s,f=o);var p=t-s/2,g=a+p,v=c+p,x=f+p;return r(g,v,x)}var Zb={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};function aY(n){if(typeof n!="string")return n;var e=n.toLowerCase();return Zb[e]?"#"+Zb[e]:n}var lY=/^#[a-fA-F0-9]{6}$/,uY=/^#[a-fA-F0-9]{8}$/,AY=/^#[a-fA-F0-9]{3}$/,cY=/^#[a-fA-F0-9]{4}$/,Vp=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,hY=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,fY=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,dY=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function fu(n){if(typeof n!="string")throw new ys(3);var e=aY(n);if(e.match(lY))return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16)};if(e.match(uY)){var t=parseFloat((parseInt(""+e[7]+e[8],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16),alpha:t}}if(e.match(AY))return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16)};if(e.match(cY)){var r=parseFloat((parseInt(""+e[4]+e[4],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16),alpha:r}}var i=Vp.exec(e);if(i)return{red:parseInt(""+i[1],10),green:parseInt(""+i[2],10),blue:parseInt(""+i[3],10)};var s=hY.exec(e.substring(0,50));if(s)return{red:parseInt(""+s[1],10),green:parseInt(""+s[2],10),blue:parseInt(""+s[3],10),alpha:parseFloat(""+s[4])>1?parseFloat(""+s[4])/100:parseFloat(""+s[4])};var o=fY.exec(e);if(o){var a=parseInt(""+o[1],10),c=parseInt(""+o[2],10)/100,f=parseInt(""+o[3],10)/100,p="rgb("+Zh(a,c,f)+")",g=Vp.exec(p);if(!g)throw new ys(4,e,p);return{red:parseInt(""+g[1],10),green:parseInt(""+g[2],10),blue:parseInt(""+g[3],10)}}var v=dY.exec(e.substring(0,50));if(v){var x=parseInt(""+v[1],10),T=parseInt(""+v[2],10)/100,S=parseInt(""+v[3],10)/100,E="rgb("+Zh(x,T,S)+")",N=Vp.exec(E);if(!N)throw new ys(4,e,E);return{red:parseInt(""+N[1],10),green:parseInt(""+N[2],10),blue:parseInt(""+N[3],10),alpha:parseFloat(""+v[4])>1?parseFloat(""+v[4])/100:parseFloat(""+v[4])}}throw new ys(5)}function pY(n){var e=n.red/255,t=n.green/255,r=n.blue/255,i=Math.max(e,t,r),s=Math.min(e,t,r),o=(i+s)/2;if(i===s)return n.alpha!==void 0?{hue:0,saturation:0,lightness:o,alpha:n.alpha}:{hue:0,saturation:0,lightness:o};var a,c=i-s,f=o>.5?c/(2-i-s):c/(i+s);switch(i){case e:a=(t-r)/c+(t<r?6:0);break;case t:a=(r-e)/c+2;break;default:a=(e-t)/c+4;break}return a*=60,n.alpha!==void 0?{hue:a,saturation:f,lightness:o,alpha:n.alpha}:{hue:a,saturation:f,lightness:o}}function oa(n){return pY(fu(n))}var mY=function(e){return e.length===7&&e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e},Ig=mY;function Sa(n){var e=n.toString(16);return e.length===1?"0"+e:e}function zp(n){return Sa(Math.round(n*255))}function gY(n,e,t){return Ig("#"+zp(n)+zp(e)+zp(t))}function qS(n,e,t){return Zh(n,e,t,gY)}function yY(n,e,t){if(typeof n=="object"&&e===void 0&&t===void 0)return qS(n.hue,n.saturation,n.lightness);throw new ys(1)}function _Y(n,e,t,r){if(typeof n=="object"&&e===void 0&&t===void 0&&r===void 0)return n.alpha>=1?qS(n.hue,n.saturation,n.lightness):"rgba("+Zh(n.hue,n.saturation,n.lightness)+","+n.alpha+")";throw new ys(2)}function GS(n,e,t){if(typeof n=="number"&&typeof e=="number"&&typeof t=="number")return Ig("#"+Sa(n)+Sa(e)+Sa(t));if(typeof n=="object"&&e===void 0&&t===void 0)return Ig("#"+Sa(n.red)+Sa(n.green)+Sa(n.blue));throw new ys(6)}function Jf(n,e,t,r){if(typeof n=="object"&&e===void 0&&t===void 0&&r===void 0)return n.alpha>=1?GS(n.red,n.green,n.blue):"rgba("+n.red+","+n.green+","+n.blue+","+n.alpha+")";throw new ys(7)}var vY=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},bY=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&typeof e.alpha=="number"},xY=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},TY=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&typeof e.alpha=="number"};function aa(n){if(typeof n!="object")throw new ys(8);if(bY(n))return Jf(n);if(vY(n))return GS(n);if(TY(n))return _Y(n);if(xY(n))return yY(n);throw new ys(8)}function VS(n,e,t){return function(){var i=t.concat(Array.prototype.slice.call(arguments));return i.length>=e?n.apply(this,i):VS(n,e,i)}}function li(n){return VS(n,n.length,[])}function wY(n,e){if(e==="transparent")return e;var t=oa(e);return aa($r({},t,{hue:t.hue+parseFloat(n)}))}li(wY);function vu(n,e,t){return Math.max(n,Math.min(e,t))}function SY(n,e){if(e==="transparent")return e;var t=oa(e);return aa($r({},t,{lightness:vu(0,1,t.lightness-parseFloat(n))}))}li(SY);function EY(n,e){if(e==="transparent")return e;var t=oa(e);return aa($r({},t,{saturation:vu(0,1,t.saturation-parseFloat(n))}))}li(EY);function RY(n,e){if(e==="transparent")return e;var t=oa(e);return aa($r({},t,{lightness:vu(0,1,t.lightness+parseFloat(n))}))}li(RY);function CY(n,e,t){if(e==="transparent")return t;if(t==="transparent")return e;if(n===0)return t;var r=fu(e),i=$r({},r,{alpha:typeof r.alpha=="number"?r.alpha:1}),s=fu(t),o=$r({},s,{alpha:typeof s.alpha=="number"?s.alpha:1}),a=i.alpha-o.alpha,c=parseFloat(n)*2-1,f=c*a===-1?c:c+a,p=1+c*a,g=(f/p+1)/2,v=1-g,x={red:Math.floor(i.red*g+o.red*v),green:Math.floor(i.green*g+o.green*v),blue:Math.floor(i.blue*g+o.blue*v),alpha:i.alpha*parseFloat(n)+o.alpha*(1-parseFloat(n))};return Jf(x)}var NY=li(CY),zS=NY;function MY(n,e){if(e==="transparent")return e;var t=fu(e),r=typeof t.alpha=="number"?t.alpha:1,i=$r({},t,{alpha:vu(0,1,(r*100+parseFloat(n)*100)/100)});return Jf(i)}var PY=li(MY),BY=PY;function DY(n,e){if(e==="transparent")return e;var t=oa(e);return aa($r({},t,{saturation:vu(0,1,t.saturation+parseFloat(n))}))}li(DY);function LY(n,e){return e==="transparent"?e:aa($r({},oa(e),{hue:parseFloat(n)}))}li(LY);function OY(n,e){return e==="transparent"?e:aa($r({},oa(e),{lightness:parseFloat(n)}))}li(OY);function FY(n,e){return e==="transparent"?e:aa($r({},oa(e),{saturation:parseFloat(n)}))}li(FY);function IY(n,e){return e==="transparent"?e:zS(parseFloat(n),"rgb(0, 0, 0)",e)}li(IY);function kY(n,e){return e==="transparent"?e:zS(parseFloat(n),"rgb(255, 255, 255)",e)}li(kY);function UY(n,e){if(e==="transparent")return e;var t=fu(e),r=typeof t.alpha=="number"?t.alpha:1,i=$r({},t,{alpha:vu(0,1,+(r*100-parseFloat(n)*100).toFixed(2)/100)});return Jf(i)}li(UY);var kg={Linear:{None:function(n){return n}},Quadratic:{Out:function(n){return n*(2-n)}}},lA;typeof self>"u"&&typeof process<"u"&&process.hrtime?lA=function(){var n=process.hrtime();return n[0]*1e3+n[1]/1e6}:typeof self<"u"&&self.performance!==void 0&&self.performance.now!==void 0?lA=self.performance.now.bind(self.performance):Date.now!==void 0?lA=Date.now:lA=function(){return new Date().getTime()};var Dl=lA,jS=(function(){function n(){this._tweens={},this._tweensAddedDuringUpdate={}}return n.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},n.prototype.removeAll=function(){this._tweens={}},n.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},n.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},n.prototype.update=function(e,t){e===void 0&&(e=Dl()),t===void 0&&(t=!1);var r=Object.keys(this._tweens);if(r.length===0)return!1;for(;r.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<r.length;i++){var s=this._tweens[r[i]],o=!t;s&&s.update(e,o)===!1&&!t&&delete this._tweens[r[i]]}r=Object.keys(this._tweensAddedDuringUpdate)}return!0},n})(),$S={Linear:function(n,e){var t=n.length-1,r=t*e,i=Math.floor(r),s=$S.Utils.Linear;return e<0?s(n[0],n[1],r):e>1?s(n[t],n[t-1],t-r):s(n[i],n[i+1>t?t:i+1],r-i)},Utils:{Linear:function(n,e,t){return(e-n)*t+n}}},HS=(function(){function n(){}return n.nextId=function(){return n._nextId++},n._nextId=0,n})(),WS=new jS,Jb=(function(){function n(e,t){t===void 0&&(t=WS),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=kg.Linear.None,this._interpolationFunction=$S.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=HS.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return n.prototype.getId=function(){return this._id},n.prototype.isPlaying=function(){return this._isPlaying},n.prototype.isPaused=function(){return this._isPaused},n.prototype.to=function(e,t){return this._valuesEnd=Object.create(e),t!==void 0&&(this._duration=t),this},n.prototype.duration=function(e){return this._duration=e,this},n.prototype.start=function(e){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var t in this._valuesStartRepeat)this._swapEndStartRepeatValues(t),this._valuesStart[t]=this._valuesStartRepeat[t]}return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e!==void 0?typeof e=="string"?Dl()+parseFloat(e):e:Dl(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},n.prototype._setupProperties=function(e,t,r,i){for(var s in r){var o=e[s],a=Array.isArray(o),c=a?"array":typeof o,f=!a&&Array.isArray(r[s]);if(!(c==="undefined"||c==="function")){if(f){var p=r[s];if(p.length===0)continue;p=p.map(this._handleRelativeValue.bind(this,o)),r[s]=[o].concat(p)}if((c==="object"||a)&&o&&!f){t[s]=a?[]:{};for(var g in o)t[s][g]=o[g];i[s]=a?[]:{},this._setupProperties(o,t[s],r[s],i[s])}else typeof t[s]>"u"&&(t[s]=o),a||(t[s]*=1),f?i[s]=r[s].slice().reverse():i[s]=t[s]||0}}},n.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},n.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},n.prototype.pause=function(e){return e===void 0&&(e=Dl()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this),this)},n.prototype.resume=function(e){return e===void 0&&(e=Dl()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},n.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},n.prototype.group=function(e){return this._group=e,this},n.prototype.delay=function(e){return this._delayTime=e,this},n.prototype.repeat=function(e){return this._initialRepeat=e,this._repeat=e,this},n.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},n.prototype.yoyo=function(e){return this._yoyo=e,this},n.prototype.easing=function(e){return this._easingFunction=e,this},n.prototype.interpolation=function(e){return this._interpolationFunction=e,this},n.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},n.prototype.onStart=function(e){return this._onStartCallback=e,this},n.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},n.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},n.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},n.prototype.onStop=function(e){return this._onStopCallback=e,this},n.prototype.update=function(e,t){if(e===void 0&&(e=Dl()),t===void 0&&(t=!0),this._isPaused)return!0;var r,i,s=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>s)return!1;t&&this.start(e)}if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),i=(e-this._startTime)/this._duration,i=this._duration===0||i>1?1:i;var o=this._easingFunction(i);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,o),this._onUpdateCallback&&this._onUpdateCallback(this._object,i),i===1)if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(r in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[r]=="string"&&(this._valuesStartRepeat[r]=this._valuesStartRepeat[r]+parseFloat(this._valuesEnd[r])),this._yoyo&&this._swapEndStartRepeatValues(r),this._valuesStart[r]=this._valuesStartRepeat[r];return this._yoyo&&(this._reversed=!this._reversed),this._repeatDelayTime!==void 0?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var a=0,c=this._chainedTweens.length;a<c;a++)this._chainedTweens[a].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},n.prototype._updateProperties=function(e,t,r,i){for(var s in r)if(t[s]!==void 0){var o=t[s]||0,a=r[s],c=Array.isArray(e[s]),f=Array.isArray(a),p=!c&&f;p?e[s]=this._interpolationFunction(a,i):typeof a=="object"&&a?this._updateProperties(e[s],o,a,i):(a=this._handleRelativeValue(o,a),typeof a=="number"&&(e[s]=o+(a-o)*i))}},n.prototype._handleRelativeValue=function(e,t){return typeof t!="string"?t:t.charAt(0)==="+"||t.charAt(0)==="-"?e+parseFloat(t):parseFloat(t)},n.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],r=this._valuesEnd[e];typeof r=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(r):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},n})();HS.nextId;var Ls=WS;Ls.getAll.bind(Ls);Ls.removeAll.bind(Ls);Ls.add.bind(Ls);Ls.remove.bind(Ls);Ls.update.bind(Ls);var Ug="http://www.w3.org/1999/xhtml";const ex={svg:"http://www.w3.org/2000/svg",xhtml:Ug,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function QS(n){var e=n+="",t=e.indexOf(":");return t>=0&&(e=n.slice(0,t))!=="xmlns"&&(n=n.slice(t+1)),ex.hasOwnProperty(e)?{space:ex[e],local:n}:n}function qY(n){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===Ug&&e.documentElement.namespaceURI===Ug?e.createElement(n):e.createElementNS(t,n)}}function GY(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function XS(n){var e=QS(n);return(e.local?GY:qY)(e)}function VY(){}function YS(n){return n==null?VY:function(){return this.querySelector(n)}}function zY(n){typeof n!="function"&&(n=YS(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var s=e[i],o=s.length,a=r[i]=new Array(o),c,f,p=0;p<o;++p)(c=s[p])&&(f=n.call(c,c.__data__,p,s))&&("__data__"in c&&(f.__data__=c.__data__),a[p]=f);return new Mi(r,this._parents)}function jY(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function $Y(){return[]}function HY(n){return n==null?$Y:function(){return this.querySelectorAll(n)}}function WY(n){return function(){return jY(n.apply(this,arguments))}}function QY(n){typeof n=="function"?n=WY(n):n=HY(n);for(var e=this._groups,t=e.length,r=[],i=[],s=0;s<t;++s)for(var o=e[s],a=o.length,c,f=0;f<a;++f)(c=o[f])&&(r.push(n.call(c,c.__data__,f,o)),i.push(c));return new Mi(r,i)}function XY(n){return function(){return this.matches(n)}}function KS(n){return function(e){return e.matches(n)}}var YY=Array.prototype.find;function KY(n){return function(){return YY.call(this.children,n)}}function ZY(){return this.firstElementChild}function JY(n){return this.select(n==null?ZY:KY(typeof n=="function"?n:KS(n)))}var eK=Array.prototype.filter;function tK(){return Array.from(this.children)}function nK(n){return function(){return eK.call(this.children,n)}}function rK(n){return this.selectAll(n==null?tK:nK(typeof n=="function"?n:KS(n)))}function iK(n){typeof n!="function"&&(n=XY(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var s=e[i],o=s.length,a=r[i]=[],c,f=0;f<o;++f)(c=s[f])&&n.call(c,c.__data__,f,s)&&a.push(c);return new Mi(r,this._parents)}function ZS(n){return new Array(n.length)}function sK(){return new Mi(this._enter||this._groups.map(ZS),this._parents)}function Jh(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}Jh.prototype={constructor:Jh,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function oK(n){return function(){return n}}function aK(n,e,t,r,i,s){for(var o=0,a,c=e.length,f=s.length;o<f;++o)(a=e[o])?(a.__data__=s[o],r[o]=a):t[o]=new Jh(n,s[o]);for(;o<c;++o)(a=e[o])&&(i[o]=a)}function lK(n,e,t,r,i,s,o){var a,c,f=new Map,p=e.length,g=s.length,v=new Array(p),x;for(a=0;a<p;++a)(c=e[a])&&(v[a]=x=o.call(c,c.__data__,a,e)+"",f.has(x)?i[a]=c:f.set(x,c));for(a=0;a<g;++a)x=o.call(n,s[a],a,s)+"",(c=f.get(x))?(r[a]=c,c.__data__=s[a],f.delete(x)):t[a]=new Jh(n,s[a]);for(a=0;a<p;++a)(c=e[a])&&f.get(v[a])===c&&(i[a]=c)}function uK(n){return n.__data__}function AK(n,e){if(!arguments.length)return Array.from(this,uK);var t=e?lK:aK,r=this._parents,i=this._groups;typeof n!="function"&&(n=oK(n));for(var s=i.length,o=new Array(s),a=new Array(s),c=new Array(s),f=0;f<s;++f){var p=r[f],g=i[f],v=g.length,x=cK(n.call(p,p&&p.__data__,f,r)),T=x.length,S=a[f]=new Array(T),E=o[f]=new Array(T),N=c[f]=new Array(v);t(p,g,S,E,N,x,e);for(var P=0,B=0,L,k;P<T;++P)if(L=S[P]){for(P>=B&&(B=P+1);!(k=E[B])&&++B<T;);L._next=k||null}}return o=new Mi(o,r),o._enter=a,o._exit=c,o}function cK(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function hK(){return new Mi(this._exit||this._groups.map(ZS),this._parents)}function fK(n,e,t){var r=this.enter(),i=this,s=this.exit();return typeof n=="function"?(r=n(r),r&&(r=r.selection())):r=r.append(n+""),e!=null&&(i=e(i),i&&(i=i.selection())),t==null?s.remove():t(s),r&&i?r.merge(i).order():i}function dK(n){for(var e=n.selection?n.selection():n,t=this._groups,r=e._groups,i=t.length,s=r.length,o=Math.min(i,s),a=new Array(i),c=0;c<o;++c)for(var f=t[c],p=r[c],g=f.length,v=a[c]=new Array(g),x,T=0;T<g;++T)(x=f[T]||p[T])&&(v[T]=x);for(;c<i;++c)a[c]=t[c];return new Mi(a,this._parents)}function pK(){for(var n=this._groups,e=-1,t=n.length;++e<t;)for(var r=n[e],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function mK(n){n||(n=gK);function e(g,v){return g&&v?n(g.__data__,v.__data__):!g-!v}for(var t=this._groups,r=t.length,i=new Array(r),s=0;s<r;++s){for(var o=t[s],a=o.length,c=i[s]=new Array(a),f,p=0;p<a;++p)(f=o[p])&&(c[p]=f);c.sort(e)}return new Mi(i,this._parents).order()}function gK(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function yK(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function _K(){return Array.from(this)}function vK(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var r=n[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function bK(){let n=0;for(const e of this)++n;return n}function xK(){return!this.node()}function TK(n){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var i=e[t],s=0,o=i.length,a;s<o;++s)(a=i[s])&&n.call(a,a.__data__,s,i);return this}function wK(n){return function(){this.removeAttribute(n)}}function SK(n){return function(){this.removeAttributeNS(n.space,n.local)}}function EK(n,e){return function(){this.setAttribute(n,e)}}function RK(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function CK(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(n):this.setAttribute(n,t)}}function NK(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,t)}}function MK(n,e){var t=QS(n);if(arguments.length<2){var r=this.node();return t.local?r.getAttributeNS(t.space,t.local):r.getAttribute(t)}return this.each((e==null?t.local?SK:wK:typeof e=="function"?t.local?NK:CK:t.local?RK:EK)(t,e))}function JS(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function PK(n){return function(){this.style.removeProperty(n)}}function BK(n,e,t){return function(){this.style.setProperty(n,e,t)}}function DK(n,e,t){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(n):this.style.setProperty(n,r,t)}}function LK(n,e,t){return arguments.length>1?this.each((e==null?PK:typeof e=="function"?DK:BK)(n,e,t??"")):OK(this.node(),n)}function OK(n,e){return n.style.getPropertyValue(e)||JS(n).getComputedStyle(n,null).getPropertyValue(e)}function FK(n){return function(){delete this[n]}}function IK(n,e){return function(){this[n]=e}}function kK(n,e){return function(){var t=e.apply(this,arguments);t==null?delete this[n]:this[n]=t}}function UK(n,e){return arguments.length>1?this.each((e==null?FK:typeof e=="function"?kK:IK)(n,e)):this.node()[n]}function e7(n){return n.trim().split(/^|\s+/)}function gy(n){return n.classList||new t7(n)}function t7(n){this._node=n,this._names=e7(n.getAttribute("class")||"")}t7.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function n7(n,e){for(var t=gy(n),r=-1,i=e.length;++r<i;)t.add(e[r])}function r7(n,e){for(var t=gy(n),r=-1,i=e.length;++r<i;)t.remove(e[r])}function qK(n){return function(){n7(this,n)}}function GK(n){return function(){r7(this,n)}}function VK(n,e){return function(){(e.apply(this,arguments)?n7:r7)(this,n)}}function zK(n,e){var t=e7(n+"");if(arguments.length<2){for(var r=gy(this.node()),i=-1,s=t.length;++i<s;)if(!r.contains(t[i]))return!1;return!0}return this.each((typeof e=="function"?VK:e?qK:GK)(t,e))}function jK(){this.textContent=""}function $K(n){return function(){this.textContent=n}}function HK(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function WK(n){return arguments.length?this.each(n==null?jK:(typeof n=="function"?HK:$K)(n)):this.node().textContent}function QK(){this.innerHTML=""}function XK(n){return function(){this.innerHTML=n}}function YK(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function KK(n){return arguments.length?this.each(n==null?QK:(typeof n=="function"?YK:XK)(n)):this.node().innerHTML}function ZK(){this.nextSibling&&this.parentNode.appendChild(this)}function JK(){return this.each(ZK)}function eZ(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function tZ(){return this.each(eZ)}function nZ(n){var e=typeof n=="function"?n:XS(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function rZ(){return null}function iZ(n,e){var t=typeof n=="function"?n:XS(n),r=e==null?rZ:typeof e=="function"?e:YS(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),r.apply(this,arguments)||null)})}function sZ(){var n=this.parentNode;n&&n.removeChild(this)}function oZ(){return this.each(sZ)}function aZ(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function lZ(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function uZ(n){return this.select(n?lZ:aZ)}function AZ(n){return arguments.length?this.property("__data__",n):this.node().__data__}function cZ(n){return function(e){n.call(this,e,this.__data__)}}function hZ(n){return n.trim().split(/^|\s+/).map(function(e){var t="",r=e.indexOf(".");return r>=0&&(t=e.slice(r+1),e=e.slice(0,r)),{type:e,name:t}})}function fZ(n){return function(){var e=this.__on;if(e){for(var t=0,r=-1,i=e.length,s;t<i;++t)s=e[t],(!n.type||s.type===n.type)&&s.name===n.name?this.removeEventListener(s.type,s.listener,s.options):e[++r]=s;++r?e.length=r:delete this.__on}}}function dZ(n,e,t){return function(){var r=this.__on,i,s=cZ(e);if(r){for(var o=0,a=r.length;o<a;++o)if((i=r[o]).type===n.type&&i.name===n.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=t),i.value=e;return}}this.addEventListener(n.type,s,t),i={type:n.type,name:n.name,value:e,listener:s,options:t},r?r.push(i):this.__on=[i]}}function pZ(n,e,t){var r=hZ(n+""),i,s=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,f=a.length,p;c<f;++c)for(i=0,p=a[c];i<s;++i)if((o=r[i]).type===p.type&&o.name===p.name)return p.value}return}for(a=e?dZ:fZ,i=0;i<s;++i)this.each(a(r[i],e,t));return this}function i7(n,e,t){var r=JS(n),i=r.CustomEvent;typeof i=="function"?i=new i(e,t):(i=r.document.createEvent("Event"),t?(i.initEvent(e,t.bubbles,t.cancelable),i.detail=t.detail):i.initEvent(e,!1,!1)),n.dispatchEvent(i)}function mZ(n,e){return function(){return i7(this,n,e)}}function gZ(n,e){return function(){return i7(this,n,e.apply(this,arguments))}}function yZ(n,e){return this.each((typeof e=="function"?gZ:mZ)(n,e))}function*_Z(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var r=n[e],i=0,s=r.length,o;i<s;++i)(o=r[i])&&(yield o)}var vZ=[null];function Mi(n,e){this._groups=n,this._parents=e}function bZ(){return this}Mi.prototype={constructor:Mi,select:zY,selectAll:QY,selectChild:JY,selectChildren:rK,filter:iK,data:AK,enter:sK,exit:hK,join:fK,merge:dK,selection:bZ,order:pK,sort:mK,call:yK,nodes:_K,node:vK,size:bK,empty:xK,each:TK,attr:MK,style:LK,property:UK,classed:zK,text:WK,html:KK,raise:JK,lower:tZ,append:nZ,insert:iZ,remove:oZ,clone:uZ,datum:AZ,on:pZ,dispatch:yZ,[Symbol.iterator]:_Z};function xZ(n){return typeof n=="string"?new Mi([[document.querySelector(n)]],[document.documentElement]):new Mi([[n]],vZ)}function TZ(n){let e;for(;e=n.sourceEvent;)n=e;return n}function wZ(n,e){if(n=TZ(n),e===void 0&&(e=n.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var r=t.createSVGPoint();return r.x=n.clientX,r.y=n.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[n.clientX-i.left-e.clientLeft,n.clientY-i.top-e.clientTop]}}return[n.pageX,n.pageY]}var cc,mn,s7,o7,Ma,tx,a7,l7,u7,yy,qg,Gg,QA={},A7=[],SZ=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ed=Array.isArray;function _s(n,e){for(var t in e)n[t]=e[t];return n}function _y(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function EZ(n,e,t){var r,i,s,o={};for(s in e)s=="key"?r=e[s]:s=="ref"?i=e[s]:o[s]=e[s];if(arguments.length>2&&(o.children=arguments.length>3?cc.call(arguments,2):t),typeof n=="function"&&n.defaultProps!=null)for(s in n.defaultProps)o[s]===void 0&&(o[s]=n.defaultProps[s]);return TA(n,o,r,i,null)}function TA(n,e,t,r,i){var s={type:n,props:e,key:t,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++s7,__i:-1,__u:0};return i==null&&mn.vnode!=null&&mn.vnode(s),s}function td(n){return n.children}function j0(n,e){this.props=n,this.context=e}function du(n,e){if(e==null)return n.__?du(n.__,n.__i+1):null;for(var t;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null)return t.__e;return typeof n.type=="function"?du(n):null}function c7(n){var e,t;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null){n.__e=n.__c.base=t.__e;break}return c7(n)}}function nx(n){(!n.__d&&(n.__d=!0)&&Ma.push(n)&&!ef.__r++||tx!=mn.debounceRendering)&&((tx=mn.debounceRendering)||a7)(ef)}function ef(){for(var n,e,t,r,i,s,o,a=1;Ma.length;)Ma.length>a&&Ma.sort(l7),n=Ma.shift(),a=Ma.length,n.__d&&(t=void 0,r=void 0,i=(r=(e=n).__v).__e,s=[],o=[],e.__P&&((t=_s({},r)).__v=r.__v+1,mn.vnode&&mn.vnode(t),vy(e.__P,t,r,e.__n,e.__P.namespaceURI,32&r.__u?[i]:null,s,i??du(r),!!(32&r.__u),o),t.__v=r.__v,t.__.__k[t.__i]=t,d7(s,t,o),r.__e=r.__=null,t.__e!=i&&c7(t)));ef.__r=0}function h7(n,e,t,r,i,s,o,a,c,f,p){var g,v,x,T,S,E,N,P=r&&r.__k||A7,B=e.length;for(c=RZ(t,e,P,c,B),g=0;g<B;g++)(x=t.__k[g])!=null&&(v=x.__i==-1?QA:P[x.__i]||QA,x.__i=g,E=vy(n,x,v,i,s,o,a,c,f,p),T=x.__e,x.ref&&v.ref!=x.ref&&(v.ref&&by(v.ref,null,x),p.push(x.ref,x.__c||T,x)),S==null&&T!=null&&(S=T),(N=!!(4&x.__u))||v.__k===x.__k?c=f7(x,c,n,N):typeof x.type=="function"&&E!==void 0?c=E:T&&(c=T.nextSibling),x.__u&=-7);return t.__e=S,c}function RZ(n,e,t,r,i){var s,o,a,c,f,p=t.length,g=p,v=0;for(n.__k=new Array(i),s=0;s<i;s++)(o=e[s])!=null&&typeof o!="boolean"&&typeof o!="function"?(typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?o=n.__k[s]=TA(null,o,null,null,null):ed(o)?o=n.__k[s]=TA(td,{children:o},null,null,null):o.constructor===void 0&&o.__b>0?o=n.__k[s]=TA(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):n.__k[s]=o,c=s+v,o.__=n,o.__b=n.__b+1,a=null,(f=o.__i=CZ(o,t,c,g))!=-1&&(g--,(a=t[f])&&(a.__u|=2)),a==null||a.__v==null?(f==-1&&(i>p?v--:i<p&&v++),typeof o.type!="function"&&(o.__u|=4)):f!=c&&(f==c-1?v--:f==c+1?v++:(f>c?v--:v++,o.__u|=4))):n.__k[s]=null;if(g)for(s=0;s<p;s++)(a=t[s])!=null&&(2&a.__u)==0&&(a.__e==r&&(r=du(a)),m7(a,a));return r}function f7(n,e,t,r){var i,s;if(typeof n.type=="function"){for(i=n.__k,s=0;i&&s<i.length;s++)i[s]&&(i[s].__=n,e=f7(i[s],e,t,r));return e}n.__e!=e&&(r&&(e&&n.type&&!e.parentNode&&(e=du(n)),t.insertBefore(n.__e,e||null)),e=n.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function CZ(n,e,t,r){var i,s,o,a=n.key,c=n.type,f=e[t],p=f!=null&&(2&f.__u)==0;if(f===null&&a==null||p&&a==f.key&&c==f.type)return t;if(r>(p?1:0)){for(i=t-1,s=t+1;i>=0||s<e.length;)if((f=e[o=i>=0?i--:s++])!=null&&(2&f.__u)==0&&a==f.key&&c==f.type)return o}return-1}function rx(n,e,t){e[0]=="-"?n.setProperty(e,t??""):n[e]=t==null?"":typeof t!="number"||SZ.test(e)?t:t+"px"}function v0(n,e,t,r,i){var s,o;e:if(e=="style")if(typeof t=="string")n.style.cssText=t;else{if(typeof r=="string"&&(n.style.cssText=r=""),r)for(e in r)t&&e in t||rx(n.style,e,"");if(t)for(e in t)r&&t[e]==r[e]||rx(n.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")s=e!=(e=e.replace(u7,"$1")),o=e.toLowerCase(),e=o in n||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),n.l||(n.l={}),n.l[e+s]=t,t?r?t.u=r.u:(t.u=yy,n.addEventListener(e,s?Gg:qg,s)):n.removeEventListener(e,s?Gg:qg,s);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in n)try{n[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?n.removeAttribute(e):n.setAttribute(e,e=="popover"&&t==1?"":t))}}function ix(n){return function(e){if(this.l){var t=this.l[e.type+n];if(e.t==null)e.t=yy++;else if(e.t<t.u)return;return t(mn.event?mn.event(e):e)}}}function vy(n,e,t,r,i,s,o,a,c,f){var p,g,v,x,T,S,E,N,P,B,L,k,q,I,U,j,J,Q=e.type;if(e.constructor!==void 0)return null;128&t.__u&&(c=!!(32&t.__u),s=[a=e.__e=t.__e]),(p=mn.__b)&&p(e);e:if(typeof Q=="function")try{if(N=e.props,P="prototype"in Q&&Q.prototype.render,B=(p=Q.contextType)&&r[p.__c],L=p?B?B.props.value:p.__:r,t.__c?E=(g=e.__c=t.__c).__=g.__E:(P?e.__c=g=new Q(N,L):(e.__c=g=new j0(N,L),g.constructor=Q,g.render=MZ),B&&B.sub(g),g.state||(g.state={}),g.__n=r,v=g.__d=!0,g.__h=[],g._sb=[]),P&&g.__s==null&&(g.__s=g.state),P&&Q.getDerivedStateFromProps!=null&&(g.__s==g.state&&(g.__s=_s({},g.__s)),_s(g.__s,Q.getDerivedStateFromProps(N,g.__s))),x=g.props,T=g.state,g.__v=e,v)P&&Q.getDerivedStateFromProps==null&&g.componentWillMount!=null&&g.componentWillMount(),P&&g.componentDidMount!=null&&g.__h.push(g.componentDidMount);else{if(P&&Q.getDerivedStateFromProps==null&&N!==x&&g.componentWillReceiveProps!=null&&g.componentWillReceiveProps(N,L),e.__v==t.__v||!g.__e&&g.shouldComponentUpdate!=null&&g.shouldComponentUpdate(N,g.__s,L)===!1){for(e.__v!=t.__v&&(g.props=N,g.state=g.__s,g.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(K){K&&(K.__=e)}),k=0;k<g._sb.length;k++)g.__h.push(g._sb[k]);g._sb=[],g.__h.length&&o.push(g);break e}g.componentWillUpdate!=null&&g.componentWillUpdate(N,g.__s,L),P&&g.componentDidUpdate!=null&&g.__h.push(function(){g.componentDidUpdate(x,T,S)})}if(g.context=L,g.props=N,g.__P=n,g.__e=!1,q=mn.__r,I=0,P){for(g.state=g.__s,g.__d=!1,q&&q(e),p=g.render(g.props,g.state,g.context),U=0;U<g._sb.length;U++)g.__h.push(g._sb[U]);g._sb=[]}else do g.__d=!1,q&&q(e),p=g.render(g.props,g.state,g.context),g.state=g.__s;while(g.__d&&++I<25);g.state=g.__s,g.getChildContext!=null&&(r=_s(_s({},r),g.getChildContext())),P&&!v&&g.getSnapshotBeforeUpdate!=null&&(S=g.getSnapshotBeforeUpdate(x,T)),j=p,p!=null&&p.type===td&&p.key==null&&(j=p7(p.props.children)),a=h7(n,ed(j)?j:[j],e,t,r,i,s,o,a,c,f),g.base=e.__e,e.__u&=-161,g.__h.length&&o.push(g),E&&(g.__E=g.__=null)}catch(K){if(e.__v=null,c||s!=null)if(K.then){for(e.__u|=c?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;s[s.indexOf(a)]=null,e.__e=a}else{for(J=s.length;J--;)_y(s[J]);Vg(e)}else e.__e=t.__e,e.__k=t.__k,K.then||Vg(e);mn.__e(K,e,t)}else s==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):a=e.__e=NZ(t.__e,e,t,r,i,s,o,c,f);return(p=mn.diffed)&&p(e),128&e.__u?void 0:a}function Vg(n){n&&n.__c&&(n.__c.__e=!0),n&&n.__k&&n.__k.forEach(Vg)}function d7(n,e,t){for(var r=0;r<t.length;r++)by(t[r],t[++r],t[++r]);mn.__c&&mn.__c(e,n),n.some(function(i){try{n=i.__h,i.__h=[],n.some(function(s){s.call(i)})}catch(s){mn.__e(s,i.__v)}})}function p7(n){return typeof n!="object"||n==null||n.__b&&n.__b>0?n:ed(n)?n.map(p7):_s({},n)}function NZ(n,e,t,r,i,s,o,a,c){var f,p,g,v,x,T,S,E=t.props||QA,N=e.props,P=e.type;if(P=="svg"?i="http://www.w3.org/2000/svg":P=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),s!=null){for(f=0;f<s.length;f++)if((x=s[f])&&"setAttribute"in x==!!P&&(P?x.localName==P:x.nodeType==3)){n=x,s[f]=null;break}}if(n==null){if(P==null)return document.createTextNode(N);n=document.createElementNS(i,P,N.is&&N),a&&(mn.__m&&mn.__m(e,s),a=!1),s=null}if(P==null)E===N||a&&n.data==N||(n.data=N);else{if(s=s&&cc.call(n.childNodes),!a&&s!=null)for(E={},f=0;f<n.attributes.length;f++)E[(x=n.attributes[f]).name]=x.value;for(f in E)if(x=E[f],f!="children"){if(f=="dangerouslySetInnerHTML")g=x;else if(!(f in N)){if(f=="value"&&"defaultValue"in N||f=="checked"&&"defaultChecked"in N)continue;v0(n,f,null,x,i)}}for(f in N)x=N[f],f=="children"?v=x:f=="dangerouslySetInnerHTML"?p=x:f=="value"?T=x:f=="checked"?S=x:a&&typeof x!="function"||E[f]===x||v0(n,f,x,E[f],i);if(p)a||g&&(p.__html==g.__html||p.__html==n.innerHTML)||(n.innerHTML=p.__html),e.__k=[];else if(g&&(n.innerHTML=""),h7(e.type=="template"?n.content:n,ed(v)?v:[v],e,t,r,P=="foreignObject"?"http://www.w3.org/1999/xhtml":i,s,o,s?s[0]:t.__k&&du(t,0),a,c),s!=null)for(f=s.length;f--;)_y(s[f]);a||(f="value",P=="progress"&&T==null?n.removeAttribute("value"):T!=null&&(T!==n[f]||P=="progress"&&!T||P=="option"&&T!=E[f])&&v0(n,f,T,E[f],i),f="checked",S!=null&&S!=n[f]&&v0(n,f,S,E[f],i))}return n}function by(n,e,t){try{if(typeof n=="function"){var r=typeof n.__u=="function";r&&n.__u(),r&&e==null||(n.__u=n(e))}else n.current=e}catch(i){mn.__e(i,t)}}function m7(n,e,t){var r,i;if(mn.unmount&&mn.unmount(n),(r=n.ref)&&(r.current&&r.current!=n.__e||by(r,null,e)),(r=n.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(s){mn.__e(s,e)}r.base=r.__P=null}if(r=n.__k)for(i=0;i<r.length;i++)r[i]&&m7(r[i],e,t||typeof n.type!="function");t||_y(n.__e),n.__c=n.__=n.__e=void 0}function MZ(n,e,t){return this.constructor(n,t)}function PZ(n,e,t){var r,i,s,o;e==document&&(e=document.documentElement),mn.__&&mn.__(n,e),i=(r=!1)?null:e.__k,s=[],o=[],vy(e,n=e.__k=EZ(td,null,[n]),i||QA,QA,e.namespaceURI,i?null:e.firstChild?cc.call(e.childNodes):null,s,i?i.__e:e.firstChild,r,o),d7(s,n,o)}function g7(n,e,t){var r,i,s,o,a=_s({},n.props);for(s in n.type&&n.type.defaultProps&&(o=n.type.defaultProps),e)s=="key"?r=e[s]:s=="ref"?i=e[s]:a[s]=e[s]===void 0&&o!=null?o[s]:e[s];return arguments.length>2&&(a.children=arguments.length>3?cc.call(arguments,2):t),TA(n.type,a,r||n.key,i||n.ref,null)}cc=A7.slice,mn={__e:function(n,e,t,r){for(var i,s,o;e=e.__;)if((i=e.__c)&&!i.__)try{if((s=i.constructor)&&s.getDerivedStateFromError!=null&&(i.setState(s.getDerivedStateFromError(n)),o=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(n,r||{}),o=i.__d),o)return i.__E=i}catch(a){n=a}throw n}},s7=0,o7=function(n){return n!=null&&n.constructor===void 0},j0.prototype.setState=function(n,e){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=_s({},this.state),typeof n=="function"&&(n=n(_s({},t),this.props)),n&&_s(t,n),n!=null&&this.__v&&(e&&this._sb.push(e),nx(this))},j0.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),nx(this))},j0.prototype.render=td,Ma=[],a7=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,l7=function(n,e){return n.__v.__b-e.__v.__b},ef.__r=0,u7=/(PointerCapture)$|Capture$/i,yy=0,qg=ix(!1),Gg=ix(!0);function sx(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function BZ(n){if(Array.isArray(n))return n}function DZ(n,e,t){return(e=UZ(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function LZ(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function OZ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ox(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function FZ(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ox(Object(t),!0).forEach(function(r){DZ(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ox(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function IZ(n,e){return BZ(n)||LZ(n,e)||qZ(n,e)||OZ()}function kZ(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function UZ(n){var e=kZ(n,"string");return typeof e=="symbol"?e:e+""}function tf(n){"@babel/helpers - typeof";return tf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tf(n)}function qZ(n,e){if(n){if(typeof n=="string")return sx(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?sx(n,e):void 0}}var zg=function(e){if(tf(e)!=="object")return e;var t=g7(e);if(t.props){var r;t.props=FZ({},t.props),t!=null&&(r=t.props)!==null&&r!==void 0&&r.children&&(t.props.children=Array.isArray(t.props.children)?t.props.children.map(zg):zg(t.props.children))}return t},GZ=function(e){return o7(g7(e))},VZ=function(e,t){delete t.__k,PZ(zg(e),t)};function zZ(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",t==="top"&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n))}}var jZ=`.float-tooltip-kap {
  position: absolute;
  width: max-content; /* prevent shrinking near right edge */
  max-width: max(50%, 150px);
  padding: 3px 5px;
  border-radius: 3px;
  font: 12px sans-serif;
  color: #eee;
  background: rgba(0,0,0,0.6);
  pointer-events: none;
}
`;zZ(jZ);var $Z=$n({props:{content:{default:!1},offsetX:{triggerUpdate:!1},offsetY:{triggerUpdate:!1}},init:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=r.style,s=i===void 0?{}:i,o=!!e&&tf(e)==="object"&&!!e.node&&typeof e.node=="function",a=xZ(o?e.node():e);a.style("position")==="static"&&a.style("position","relative"),t.tooltipEl=a.append("div").attr("class","float-tooltip-kap"),Object.entries(s).forEach(function(f){var p=IZ(f,2),g=p[0],v=p[1];return t.tooltipEl.style(g,v)}),t.tooltipEl.style("left","-10000px").style("display","none");var c="tooltip-".concat(Math.round(Math.random()*1e12));t.mouseInside=!1,a.on("mousemove.".concat(c),function(f){t.mouseInside=!0;var p=wZ(f),g=a.node(),v=g.offsetWidth,x=g.offsetHeight,T=[t.offsetX===null||t.offsetX===void 0?"-".concat(p[0]/v*100,"%"):typeof t.offsetX=="number"?"calc(-50% + ".concat(t.offsetX,"px)"):t.offsetX,t.offsetY===null||t.offsetY===void 0?x>130&&x-p[1]<100?"calc(-100% - 6px)":"21px":typeof t.offsetY=="number"?t.offsetY<0?"calc(-100% - ".concat(Math.abs(t.offsetY),"px)"):"".concat(t.offsetY,"px"):t.offsetY];t.tooltipEl.style("left",p[0]+"px").style("top",p[1]+"px").style("transform","translate(".concat(T.join(","),")")),t.content&&t.tooltipEl.style("display","inline")}),a.on("mouseover.".concat(c),function(){t.mouseInside=!0,t.content&&t.tooltipEl.style("display","inline")}),a.on("mouseout.".concat(c),function(){t.mouseInside=!1,t.tooltipEl.style("display","none")})},update:function(e){e.tooltipEl.style("display",e.content&&e.mouseInside?"inline":"none"),e.content?e.content instanceof HTMLElement?(e.tooltipEl.text(""),e.tooltipEl.append(function(){return e.content})):typeof e.content=="string"?e.tooltipEl.html(e.content):GZ(e.content)?(e.tooltipEl.text(""),VZ(e.content,e.tooltipEl.node())):(e.tooltipEl.style("display","none"),console.warn("Tooltip content is invalid, skipping.",e.content,e.content.toString())):e.tooltipEl.text("")}});function HZ(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",t==="top"&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n))}}var WZ=`.scene-nav-info {
  position: absolute;
  bottom: 5px;
  width: 100%;
  text-align: center;
  color: slategrey;
  opacity: 0.7;
  font-size: 10px;
  font-family: sans-serif;
  pointer-events: none;
  user-select: none;
}

.scene-container canvas:focus {
  outline: none;
}`;HZ(WZ);function jg(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function QZ(n){if(Array.isArray(n))return n}function XZ(n){if(Array.isArray(n))return jg(n)}function YZ(n,e,t){return(e=rJ(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function KZ(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function ZZ(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function JZ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function eJ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tJ(n,e){return QZ(n)||ZZ(n,e)||y7(n,e)||JZ()}function Ta(n){return XZ(n)||KZ(n)||y7(n)||eJ()}function nJ(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function rJ(n){var e=nJ(n,"string");return typeof e=="symbol"?e:e+""}function y7(n,e){if(n){if(typeof n=="string")return jg(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?jg(n,e):void 0}}var cn=window.THREE?window.THREE:{WebGLRenderer:lN,Scene:rf,PerspectiveCamera:wA,Raycaster:uN,SRGBColorSpace:XA,TextureLoader:Wg,Vector2:_t,Vector3:ge,Box3:cf,Color:jn,Mesh:gn,SphereGeometry:Jo,MeshBasicMaterial:ds,BackSide:yr,Clock:n4},_7=$n({props:{width:{default:window.innerWidth,onChange:function(e,t,r){isNaN(e)&&(t.width=r)}},height:{default:window.innerHeight,onChange:function(e,t,r){isNaN(e)&&(t.height=r)}},viewOffset:{default:[0,0]},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},lights:{default:[]},enablePointerInteraction:{default:!0,onChange:function(e,t){t.hoverObj=null,t.tooltip&&t.tooltip.content(null)},triggerUpdate:!1},pointerRaycasterThrottleMs:{default:50,triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},pointsHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(e){if(e.initialised){e.controls.enabled&&e.controls.update&&e.controls.update(Math.min(1,e.clock.getDelta())),e.postProcessingComposer?e.postProcessingComposer.render():e.renderer.render(e.scene,e.camera),e.extraRenderers.forEach(function(o){return o.render(e.scene,e.camera)});var t=+new Date;if(e.enablePointerInteraction&&t-e.lastRaycasterCheck>=e.pointerRaycasterThrottleMs){e.lastRaycasterCheck=t;var r=null;if(e.hoverDuringDrag||!e.isPointerDragging){var i=this.intersectingObjects(e.pointerPos.x,e.pointerPos.y);e.hoverOrderComparator&&i.sort(function(o,a){return e.hoverOrderComparator(o.object,a.object)});var s=i.find(function(o){return e.hoverFilter(o.object)})||null;r=s?s.object:null,e.intersection=s||null}r!==e.hoverObj&&(e.onHover(r,e.hoverObj,e.intersection),e.tooltip.content(r&&be(e.tooltipContent)(r,e.intersection)||null),e.hoverObj=r)}e.tweenGroup.update()}return this},getPointerPos:function(e){var t=e.pointerPos,r=t.x,i=t.y;return{x:r,y:i}},cameraPosition:function(e,t,r,i){var s=e.camera;if(t&&e.initialised){var o=t,a=r||{x:0,y:0,z:0};if(!i)p(o),g(a);else{var c=Object.assign({},s.position),f=v();e.tweenGroup.add(new Jb(c).to(o,i).easing(kg.Quadratic.Out).onUpdate(p).start()),e.tweenGroup.add(new Jb(f).to(a,i/3).easing(kg.Quadratic.Out).onUpdate(g).start())}return this}return Object.assign({},s.position,{lookAt:v()});function p(x){var T=x.x,S=x.y,E=x.z;T!==void 0&&(s.position.x=T),S!==void 0&&(s.position.y=S),E!==void 0&&(s.position.z=E)}function g(x){var T=new cn.Vector3(x.x,x.y,x.z);e.controls.enabled&&e.controls.target?e.controls.target=T:s.lookAt(T)}function v(){return Object.assign(new cn.Vector3(0,0,-1e3).applyQuaternion(s.quaternion).add(s.position))}},zoomToFit:function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:10,i=arguments.length,s=new Array(i>3?i-3:0),o=3;o<i;o++)s[o-3]=arguments[o];return this.fitToBbox(this.getBbox.apply(this,s),t,r)},fitToBbox:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:10,s=e.camera;if(t){var o=new cn.Vector3(0,0,0),a=Math.max.apply(Math,Ta(Object.entries(t).map(function(x){var T=tJ(x,2),S=T[0],E=T[1];return Math.max.apply(Math,Ta(E.map(function(N){return Math.abs(o[S]-N)})))})))*2,c=(1-i*2/e.height)*s.fov,f=a/Math.atan(c*Math.PI/180),p=f/s.aspect,g=Math.max(f,p);if(g>0){var v=o.clone().sub(s.position).normalize().multiplyScalar(-g);this.cameraPosition(v,o,r)}}return this},getBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0},r=new cn.Box3(new cn.Vector3(0,0,0),new cn.Vector3(0,0,0)),i=e.objects.filter(t);return i.length?(i.forEach(function(s){return r.expandByObject(s)}),Object.assign.apply(Object,Ta(["x","y","z"].map(function(s){return YZ({},s,[r.min[s],r.max[s]])})))):null},getScreenCoords:function(e,t,r,i){var s=new cn.Vector3(t,r,i);return s.project(this.camera()),{x:(s.x+1)*e.width/2,y:-(s.y-1)*e.height/2}},getSceneCoords:function(e,t,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=new cn.Vector2(t/e.width*2-1,-(r/e.height)*2+1),o=new cn.Raycaster;return o.setFromCamera(s,e.camera),Object.assign({},o.ray.at(i,new cn.Vector3))},intersectingObjects:function(e,t,r){var i=new cn.Vector2(t/e.width*2-1,-(r/e.height)*2+1),s=new cn.Raycaster;return s.params.Line.threshold=e.lineHoverPrecision,s.params.Points.threshold=e.pointsHoverPrecision,s.setFromCamera(i,e.camera),s.intersectObjects(e.objects,!0)},renderer:function(e){return e.renderer},scene:function(e){return e.scene},camera:function(e){return e.camera},postProcessingComposer:function(e){return e.postProcessingComposer},controls:function(e){return e.controls},tbControls:function(e){return e.controls}},stateInit:function(){return{scene:new cn.Scene,camera:new cn.PerspectiveCamera,clock:new cn.Clock,tweenGroup:new jS,lastRaycasterCheck:0}},init:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=r.controlType,s=i===void 0?"trackball":i,o=r.useWebGPU,a=o===void 0?!1:o,c=r.rendererConfig,f=c===void 0?{}:c,p=r.extraRenderers,g=p===void 0?[]:p,v=r.waitForLoadComplete,x=v===void 0?!0:v;e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.className="scene-container",t.container.style.position="relative",t.container.appendChild(t.navInfo=document.createElement("div")),t.navInfo.className="scene-nav-info",t.navInfo.textContent={orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"}[s]||"",t.navInfo.style.display=t.showNavInfo?null:"none",t.tooltip=new $Z(t.container),t.pointerPos=new cn.Vector2,t.pointerPos.x=-2,t.pointerPos.y=-2,["pointermove","pointerdown"].forEach(function(T){return t.container.addEventListener(T,function(S){if(T==="pointerdown"&&(t.isPointerPressed=!0),!t.isPointerDragging&&S.type==="pointermove"&&(S.pressure>0||t.isPointerPressed)&&(S.pointerType==="mouse"||S.movementX===void 0||[S.movementX,S.movementY].some(function(P){return Math.abs(P)>1}))&&(t.isPointerDragging=!0),t.enablePointerInteraction){var E=N(t.container);t.pointerPos.x=S.pageX-E.left,t.pointerPos.y=S.pageY-E.top}function N(P){var B=P.getBoundingClientRect(),L=window.pageXOffset||document.documentElement.scrollLeft,k=window.pageYOffset||document.documentElement.scrollTop;return{top:B.top+k,left:B.left+L}}},{passive:!0})}),t.container.addEventListener("pointerup",function(T){t.isPointerPressed&&(t.isPointerPressed=!1,!(t.isPointerDragging&&(t.isPointerDragging=!1,!t.clickAfterDrag))&&requestAnimationFrame(function(){T.button===0&&t.onClick(t.hoverObj||null,T,t.intersection),T.button===2&&t.onRightClick&&t.onRightClick(t.hoverObj||null,T,t.intersection)}))},{passive:!0,capture:!0}),t.container.addEventListener("contextmenu",function(T){t.onRightClick&&T.preventDefault()}),t.renderer=new(a?cS:cn.WebGLRenderer)(Object.assign({antialias:!0,alpha:!0},f)),t.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),t.container.appendChild(t.renderer.domElement),t.extraRenderers=g,t.extraRenderers.forEach(function(T){T.domElement.style.position="absolute",T.domElement.style.top="0px",T.domElement.style.pointerEvents="none",t.container.appendChild(T.domElement)}),t.postProcessingComposer=new eY(t.renderer),t.postProcessingComposer.addPass(new tY(t.scene,t.camera)),t.controls=new{trackball:uX,orbit:SX,fly:UX}[s](t.camera,t.renderer.domElement),s==="fly"&&(t.controls.movementSpeed=300,t.controls.rollSpeed=Math.PI/6,t.controls.dragToLook=!0),(s==="trackball"||s==="orbit")&&(t.controls.minDistance=.1,t.controls.maxDistance=t.skyRadius,t.controls.addEventListener("start",function(){t.controlsEngaged=!0}),t.controls.addEventListener("change",function(){t.controlsEngaged&&(t.controlsDragging=!0)}),t.controls.addEventListener("end",function(){t.controlsEngaged=!1,t.controlsDragging=!1})),[t.renderer,t.postProcessingComposer].concat(Ta(t.extraRenderers)).forEach(function(T){return T.setSize(t.width,t.height)}),t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix(),t.camera.position.z=1e3,t.scene.add(t.skysphere=new cn.Mesh),t.skysphere.visible=!1,t.loadComplete=t.scene.visible=!x,window.scene=t.scene},update:function(e,t){if(e.width&&e.height&&(t.hasOwnProperty("width")||t.hasOwnProperty("height"))){var r,i=e.width,s=e.height;e.container.style.width="".concat(i,"px"),e.container.style.height="".concat(s,"px"),[e.renderer,e.postProcessingComposer].concat(Ta(e.extraRenderers)).forEach(function(x){return x.setSize(i,s)}),e.camera.aspect=i/s;var o=e.viewOffset.slice(0,2);o.some(function(x){return x})&&(r=e.camera).setViewOffset.apply(r,[i,s].concat(Ta(o),[i,s])),e.camera.updateProjectionMatrix()}if(t.hasOwnProperty("viewOffset")){var a,c=e.width,f=e.height,p=e.viewOffset.slice(0,2);p.some(function(x){return x})?(a=e.camera).setViewOffset.apply(a,[c,f].concat(Ta(p),[c,f])):e.camera.clearViewOffset()}if(t.hasOwnProperty("skyRadius")&&e.skyRadius&&(e.controls.hasOwnProperty("maxDistance")&&t.skyRadius&&(e.controls.maxDistance=Math.min(e.controls.maxDistance,e.skyRadius)),e.camera.far=e.skyRadius*2.5,e.camera.updateProjectionMatrix(),e.skysphere.geometry=new cn.SphereGeometry(e.skyRadius)),t.hasOwnProperty("backgroundColor")){var g=fu(e.backgroundColor).alpha;g===void 0&&(g=1),e.renderer.setClearColor(new cn.Color(BY(1,e.backgroundColor)),g)}t.hasOwnProperty("backgroundImageUrl")&&(e.backgroundImageUrl?new cn.TextureLoader().load(e.backgroundImageUrl,function(x){x.colorSpace=cn.SRGBColorSpace,e.skysphere.material=new cn.MeshBasicMaterial({map:x,side:cn.BackSide}),e.skysphere.visible=!0,e.onBackgroundImageLoaded&&setTimeout(e.onBackgroundImageLoaded),!e.loadComplete&&v()}):(e.skysphere.visible=!1,e.skysphere.material.map=null,!e.loadComplete&&v())),t.hasOwnProperty("showNavInfo")&&(e.navInfo.style.display=e.showNavInfo?null:"none"),t.hasOwnProperty("lights")&&((t.lights||[]).forEach(function(x){return e.scene.remove(x)}),e.lights.forEach(function(x){return e.scene.add(x)})),t.hasOwnProperty("objects")&&((t.objects||[]).forEach(function(x){return e.scene.remove(x)}),e.objects.forEach(function(x){return e.scene.add(x)}));function v(){e.loadComplete=e.scene.visible=!0}}});function iJ(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",t==="top"&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n))}}var sJ=`.scene-container .clickable {
  cursor: pointer;
}`;iJ(sJ);function $g(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function oJ(n){if(Array.isArray(n))return $g(n)}function hc(n,e,t){return(e=hJ(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function aJ(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function lJ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ax(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function Pa(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ax(Object(t),!0).forEach(function(r){hc(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ax(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function uJ(n,e){if(n==null)return{};var t,r,i=AJ(n,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)t=s[r],e.indexOf(t)===-1&&{}.propertyIsEnumerable.call(n,t)&&(i[t]=n[t])}return i}function AJ(n,e){if(n==null)return{};var t={};for(var r in n)if({}.hasOwnProperty.call(n,r)){if(e.indexOf(r)!==-1)continue;t[r]=n[r]}return t}function nd(n){return oJ(n)||aJ(n)||fJ(n)||lJ()}function cJ(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function hJ(n){var e=cJ(n,"string");return typeof e=="symbol"?e:e+""}function fJ(n,e){if(n){if(typeof n=="string")return $g(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?$g(n,e):void 0}}function v7(n,e){var t=new e;return t._destructor&&t._destructor(),{linkProp:function(i){return{default:t[i](),onChange:function(o,a){a[n][i](o)},triggerUpdate:!1}},linkMethod:function(i){return function(s){for(var o=s[n],a=arguments.length,c=new Array(a>1?a-1:0),f=1;f<a;f++)c[f-1]=arguments[f];var p=o[i].apply(o,c);return p===o?this:p}}}}var dJ=["rendererConfig","waitForGlobeReady"],Zu=Pa(Pa({},window.THREE?window.THREE:{AmbientLight:px,DirectionalLight:dx,Vector2:_t,REVISION:of}),{},{CSS2DRenderer:MN}),b7=v7("globe",IS),pJ=Object.assign.apply(Object,nd(["globeImageUrl","bumpImageUrl","globeTileEngineUrl","globeTileEngineMaxLevel","globeCurvatureResolution","showGlobe","showGraticules","showAtmosphere","atmosphereColor","atmosphereAltitude","onGlobeReady","pointsData","pointLat","pointLng","pointColor","pointAltitude","pointRadius","pointResolution","pointsMerge","pointsTransitionDuration","arcsData","arcStartLat","arcStartLng","arcStartAltitude","arcEndLat","arcEndLng","arcEndAltitude","arcColor","arcAltitude","arcAltitudeAutoScale","arcStroke","arcCurveResolution","arcCircularResolution","arcDashLength","arcDashGap","arcDashInitialGap","arcDashAnimateTime","arcsTransitionDuration","polygonsData","polygonGeoJsonGeometry","polygonCapColor","polygonCapMaterial","polygonSideColor","polygonSideMaterial","polygonStrokeColor","polygonAltitude","polygonCapCurvatureResolution","polygonsTransitionDuration","pathsData","pathPoints","pathPointLat","pathPointLng","pathPointAlt","pathResolution","pathColor","pathStroke","pathDashLength","pathDashGap","pathDashInitialGap","pathDashAnimateTime","pathTransitionDuration","heatmapsData","heatmapPoints","heatmapPointLat","heatmapPointLng","heatmapPointWeight","heatmapBandwidth","heatmapColorFn","heatmapColorSaturation","heatmapBaseAltitude","heatmapTopAltitude","heatmapsTransitionDuration","hexBinPointsData","hexBinPointLat","hexBinPointLng","hexBinPointWeight","hexBinResolution","hexMargin","hexTopCurvatureResolution","hexTopColor","hexSideColor","hexAltitude","hexBinMerge","hexTransitionDuration","hexPolygonsData","hexPolygonGeoJsonGeometry","hexPolygonColor","hexPolygonAltitude","hexPolygonResolution","hexPolygonMargin","hexPolygonUseDots","hexPolygonCurvatureResolution","hexPolygonDotResolution","hexPolygonsTransitionDuration","tilesData","tileLat","tileLng","tileAltitude","tileWidth","tileHeight","tileUseGlobeProjection","tileMaterial","tileCurvatureResolution","tilesTransitionDuration","particlesData","particlesList","particleLat","particleLng","particleAltitude","particlesSize","particlesSizeAttenuation","particlesColor","particlesTexture","ringsData","ringLat","ringLng","ringAltitude","ringColor","ringResolution","ringMaxRadius","ringPropagationSpeed","ringRepeatPeriod","labelsData","labelLat","labelLng","labelAltitude","labelRotation","labelText","labelSize","labelTypeFace","labelColor","labelResolution","labelIncludeDot","labelDotRadius","labelDotOrientation","labelsTransitionDuration","htmlElementsData","htmlLat","htmlLng","htmlAltitude","htmlElement","htmlElementVisibilityModifier","htmlTransitionDuration","objectsData","objectLat","objectLng","objectAltitude","objectRotation","objectFacesSurface","objectThreeObject","customLayerData","customThreeObject","customThreeObjectUpdate"].map(function(n){return hc({},n,b7.linkProp(n))}))),mJ=Object.assign.apply(Object,nd(["globeMaterial","globeTileEngineClearCache","getGlobeRadius","getCoords","toGeoCoords"].map(function(n){return hc({},n,b7.linkMethod(n))}))),x7=v7("renderObjs",_7),gJ=Object.assign.apply(Object,nd(["width","height","backgroundColor","backgroundImageUrl","enablePointerInteraction"].map(function(n){return hc({},n,x7.linkProp(n))}))),yJ=Object.assign.apply(Object,nd(["lights","postProcessingComposer"].map(function(n){return hc({},n,x7.linkMethod(n))}))),_J=$n({props:Pa(Pa({onZoom:{triggerUpdate:!1},onGlobeClick:{triggerUpdate:!1},onGlobeRightClick:{triggerUpdate:!1},pointLabel:{default:"name",triggerUpdate:!1},onPointClick:{triggerUpdate:!1},onPointRightClick:{triggerUpdate:!1},onPointHover:{triggerUpdate:!1},arcLabel:{default:"name",triggerUpdate:!1},onArcClick:{triggerUpdate:!1},onArcRightClick:{triggerUpdate:!1},onArcHover:{triggerUpdate:!1},polygonLabel:{default:"name",triggerUpdate:!1},onPolygonClick:{triggerUpdate:!1},onPolygonRightClick:{triggerUpdate:!1},onPolygonHover:{triggerUpdate:!1},pathLabel:{default:"name",triggerUpdate:!1},onPathClick:{triggerUpdate:!1},onPathRightClick:{triggerUpdate:!1},onPathHover:{triggerUpdate:!1},onHeatmapClick:{triggerUpdate:!1},onHeatmapRightClick:{triggerUpdate:!1},onHeatmapHover:{triggerUpdate:!1},hexLabel:{triggerUpdate:!1},onHexClick:{triggerUpdate:!1},onHexRightClick:{triggerUpdate:!1},onHexHover:{triggerUpdate:!1},hexPolygonLabel:{triggerUpdate:!1},onHexPolygonClick:{triggerUpdate:!1},onHexPolygonRightClick:{triggerUpdate:!1},onHexPolygonHover:{triggerUpdate:!1},tileLabel:{default:"name",triggerUpdate:!1},onTileClick:{triggerUpdate:!1},onTileRightClick:{triggerUpdate:!1},onTileHover:{triggerUpdate:!1},particleLabel:{default:"name",triggerUpdate:!1},onParticleClick:{triggerUpdate:!1},onParticleRightClick:{triggerUpdate:!1},onParticleHover:{triggerUpdate:!1},labelLabel:{triggerUpdate:!1},onLabelClick:{triggerUpdate:!1},onLabelRightClick:{triggerUpdate:!1},onLabelHover:{triggerUpdate:!1},objectLabel:{default:"name",triggerUpdate:!1},onObjectClick:{triggerUpdate:!1},onObjectRightClick:{triggerUpdate:!1},onObjectHover:{triggerUpdate:!1},customLayerLabel:{default:"name",triggerUpdate:!1},onCustomLayerClick:{triggerUpdate:!1},onCustomLayerRightClick:{triggerUpdate:!1},onCustomLayerHover:{triggerUpdate:!1},pointerEventsFilter:{default:function(){return!0},triggerUpdate:!1},lineHoverPrecision:{default:.2,triggerUpdate:!1,onChange:function(e,t){t.renderObjs.lineHoverPrecision(e),t.renderObjs.pointsHoverPrecision(e)}},showPointerCursor:{default:!0,triggerUpdate:!1},globeOffset:{default:[0,0],triggerUpdate:!1,onChange:function(e,t){return Array.isArray(e)&&e.length===2&&t.renderObjs.viewOffset(e.map(function(r){return-r}))}}},pJ),gJ),methods:Pa(Pa({pauseAnimation:function(e){var t;return e.animationFrameRequestId!==null&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),(t=e.globe)===null||t===void 0||t.pauseAnimation(),this},resumeAnimation:function(e){var t;return e.animationFrameRequestId===null&&this._animationCycle(),(t=e.globe)===null||t===void 0||t.resumeAnimation(),this},_animationCycle:function(e){e.renderObjs.tick(),e.tweenGroup.update(),e.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},pointOfView:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=o();if(t.lat===void 0&&t.lng===void 0&&t.altitude===void 0)return i;var s=Object.assign({},i,t);if(["lat","lng","altitude"].forEach(function(c){return s[c]=+s[c]}),!r)a(s);else{for(;i.lng-s.lng>180;)i.lng-=360;for(;i.lng-s.lng<-180;)i.lng+=360;e.tweenGroup.add(new Gr(i).to(s,r).easing(er.Cubic.InOut).onUpdate(a).start())}return this;function o(){return e.globe.toGeoCoords(e.renderObjs.cameraPosition())}function a(c){var f=c.lat,p=c.lng,g=c.altitude;e.renderObjs.cameraPosition(e.globe.getCoords(f,p,g)),e.globe.setPointOfView(e.renderObjs.camera())}},getScreenCoords:function(e){for(var t,r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];var o=(t=e.globe).getCoords.apply(t,i);return e.renderObjs.getScreenCoords(o.x,o.y,o.z)},toGlobeCoords:function(e,t,r){var i=e.renderObjs.intersectingObjects(t,r).find(function(c){return(c.object.__globeObjType||c.object.parent.__globeObjType)==="globe"});if(!i)return null;var s=e.globe.toGeoCoords(i.point),o=s.lat,a=s.lng;return{lat:o,lng:a}},scene:function(e){return e.renderObjs.scene()},camera:function(e){return e.renderObjs.camera()},renderer:function(e){return e.renderObjs.renderer()},controls:function(e){return e.renderObjs.controls()},_destructor:function(e){e.globe._destructor(),this.pauseAnimation(),this.pointsData([]),this.arcsData([]),this.polygonsData([]),this.pathsData([]),this.heatmapsData([]),this.hexBinPointsData([]),this.hexPolygonsData([]),this.tilesData([]),this.particlesData([]),this.labelsData([]),this.htmlElementsData([]),this.objectsData([]),this.customLayerData([])}},mJ),yJ),stateInit:function(e){var t=e.rendererConfig,r=e.waitForGlobeReady,i=r===void 0?!0:r,s=uJ(e,dJ),o=new IS(Pa({waitForGlobeReady:i},s));return{globe:o,renderObjs:_7({controlType:"orbit",rendererConfig:t,waitForLoadComplete:i,extraRenderers:[new Zu.CSS2DRenderer]}).skyRadius(o.getGlobeRadius()*500).showNavInfo(!1).objects([o]).lights([new Zu.AmbientLight(13421772,Math.PI),new Zu.DirectionalLight(16777215,.6*Math.PI)]),tweenGroup:new f1}},init:function(e,t){var r=this;e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.style.position="relative";var i=document.createElement("div");t.container.appendChild(i),t.renderObjs(i),t.globe.rendererSize(t.renderObjs.renderer().getSize(new Zu.Vector2)),this.pointOfView({altitude:2.5});var s=t.globe.getGlobeRadius(),o=t.renderObjs.controls();t.renderObjs.camera().near=.05,o.minDistance=s+Math.max(.001,t.renderObjs.camera().near*1.1),o.maxDistance=s*100,o.enablePan=!1,o.enableDamping=!0,o.dampingFactor=.1,o.rotateSpeed=.3,o.zoomSpeed=.3,o.zoomToCursor=!0,o.addEventListener("change",function(){o.target.setScalar(0);var f=r.pointOfView();o.rotateSpeed=f.altitude*.3,o.zoomSpeed=Math.sqrt(f.altitude)*.5,t.globe.setPointOfView(t.renderObjs.camera()),t.onZoom&&t.onZoom(f)});var a=function(p){for(var g=p;g&&!g.hasOwnProperty("__globeObjType");)g=g.parent;return g},c={point:function(p){return p},arc:function(p){return p},polygon:function(p){return p.data},path:function(p){return p},heatmap:function(p){return p},hexbin:function(p){return p},hexPolygon:function(p){return p},tile:function(p){return p},particles:function(p,g){return!g||!g.hasOwnProperty("index")||p.length<=g.index?p:p[g.index]},label:function(p){return p},object:function(p){return p},custom:function(p){return p}};Zu.REVISION<155&&(t.renderObjs.renderer().useLegacyLights=!1),t.renderObjs.hoverFilter(function(f){var p=a(f);if(!p)return!1;var g=p.__globeObjType;if(g!=="globe"&&!c.hasOwnProperty(g))return!1;var v=c.hasOwnProperty(g)&&p.__data?c[g](p.__data):null;return["points","hexBinPoints"].some(function(x){return x===g})&&Array.isArray(v)?!1:t.pointerEventsFilter(p,v)}).tooltipContent(function(f,p){var g={point:t.pointLabel,arc:t.arcLabel,polygon:t.polygonLabel,path:t.pathLabel,hexbin:t.hexLabel,hexPolygon:t.hexPolygonLabel,tile:t.tileLabel,particles:t.particleLabel,label:t.labelLabel,object:t.objectLabel,custom:t.customLayerLabel},v=a(f),x=v&&v.__globeObjType;return v&&x&&g.hasOwnProperty(x)&&c.hasOwnProperty(x)&&be(g[x])(c[x](v.__data,p))||""}).onHover(function(f,p,g){var v={point:t.onPointHover,arc:t.onArcHover,polygon:t.onPolygonHover,path:t.onPathHover,heatmap:t.onHeatmapHover,hexbin:t.onHexHover,hexPolygon:t.onHexPolygonHover,tile:t.onTileHover,particles:t.onParticleHover,label:t.onLabelHover,object:t.onObjectHover,custom:t.onCustomLayerHover},x={globe:t.onGlobeClick,point:t.onPointClick,arc:t.onArcClick,polygon:t.onPolygonClick,path:t.onPathClick,heatmap:t.onHeatmapClick,hexbin:t.onHexClick,hexPolygon:t.onHexPolygonClick,tile:t.onTileClick,particles:t.onParticleClick,label:t.onLabelClick,object:t.onObjectClick,custom:t.onCustomLayerClick},T=a(f);if(T&&!v.hasOwnProperty(T.__globeObjType)&&(T=null),T!==t.hoverObj){var S,E=t.hoverObj?t.hoverObj.__globeObjType:null,N=t.hoverData,P=T?T.__globeObjType:null,B=(S=T)!==null&&S!==void 0&&S.__data?c[P](T.__data,g):null;E&&E!==P&&v[E]&&v[E](null,N||null),P&&v[P]&&v[P](B,E===P?N:null),t.renderObjs.renderer().domElement.classList[P&&x[P]&&be(t.showPointerCursor)(P,B)?"add":"remove"]("clickable"),t.hoverObj=T,t.hoverData=B}}).onClick(function(f,p,g){if(f){var v={globe:t.onGlobeClick,point:t.onPointClick,arc:t.onArcClick,polygon:t.onPolygonClick,path:t.onPathClick,heatmap:t.onHeatmapClick,hexbin:t.onHexClick,hexPolygon:t.onHexPolygonClick,tile:t.onTileClick,particles:t.onParticleClick,label:t.onLabelClick,object:t.onObjectClick,custom:t.onCustomLayerClick},x=a(f),T=x.__globeObjType;if(x&&v.hasOwnProperty(T)&&v[T]){var S=[p],E=g!=null&&g.isVector3?g:g?.point;if(T==="globe"){var N=r.toGeoCoords(E),P=N.lat,B=N.lng;S.unshift({lat:P,lng:B})}else S.push(r.toGeoCoords(E));c.hasOwnProperty(T)&&S.unshift(c[T](x.__data,g)),v[T].apply(v,S)}}}).onRightClick(function(f,p,g){if(f){var v={globe:t.onGlobeRightClick,point:t.onPointRightClick,arc:t.onArcRightClick,polygon:t.onPolygonRightClick,path:t.onPathRightClick,heatmap:t.onHeatmapRightClick,hexbin:t.onHexRightClick,hexPolygon:t.onHexPolygonRightClick,tile:t.onTileRightClick,particles:t.onParticleRightClick,label:t.onLabelRightClick,object:t.onObjectRightClick,custom:t.onCustomLayerRightClick},x=a(f),T=x.__globeObjType;if(x&&v.hasOwnProperty(T)&&v[T]){var S=[p],E=g!=null&&g.isVector3?g:g?.point;if(T==="globe"){var N=r.toGeoCoords(E),P=N.lat,B=N.lng;S.unshift({lat:P,lng:B})}else S.push(r.toGeoCoords(E));c.hasOwnProperty(T)&&S.unshift(c[T](x.__data,g)),v[T].apply(v,S)}}}),this._animationCycle()}}),jp={exports:{}},$p,lx;function vJ(){if(lx)return $p;lx=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return $p=n,$p}var Hp,ux;function bJ(){if(ux)return Hp;ux=1;var n=vJ();function e(){}function t(){}return t.resetWarningCache=e,Hp=function(){function r(o,a,c,f,p,g){if(g!==n){var v=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw v.name="Invariant Violation",v}}r.isRequired=r;function i(){return r}var s={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:i,element:r,elementType:r,instanceOf:i,node:r,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:t,resetWarningCache:e};return s.PropTypes=s,s},Hp}var Ax;function xJ(){return Ax||(Ax=1,jp.exports=bJ()()),jp.exports}var TJ=xJ();const D=fx(TJ);var wJ={width:D.number,height:D.number,backgroundColor:D.string,backgroundImageUrl:D.string,globeImageUrl:D.string,bumpImageUrl:D.string,showGlobe:D.bool,showGraticules:D.bool,showAtmosphere:D.bool,atmosphereColor:D.string,atmosphereAltitude:D.number,globeMaterial:D.object,onGlobeReady:D.func,onGlobeClick:D.func,onGlobeRightClick:D.func,pointsData:D.arrayOf(D.object),pointLat:D.oneOfType([D.number,D.string,D.func]),pointLng:D.oneOfType([D.number,D.string,D.func]),pointColor:D.oneOfType([D.string,D.func]),pointAltitude:D.oneOfType([D.number,D.string,D.func]),pointRadius:D.oneOfType([D.number,D.string,D.func]),pointResolution:D.number,pointsMerge:D.bool,pointsTransitionDuration:D.number,pointLabel:D.oneOfType([D.string,D.func]),onPointClick:D.func,onPointRightClick:D.func,onPointHover:D.func,arcsData:D.arrayOf(D.object),arcStartLat:D.oneOfType([D.number,D.string,D.func]),arcStartLng:D.oneOfType([D.number,D.string,D.func]),arcEndLat:D.oneOfType([D.number,D.string,D.func]),arcEndLng:D.oneOfType([D.number,D.string,D.func]),arcColor:D.oneOfType([D.string,D.arrayOf(D.string),D.func]),arcAltitude:D.oneOfType([D.number,D.string,D.func]),arcAltitudeAutoScale:D.oneOfType([D.number,D.string,D.func]),arcStroke:D.oneOfType([D.number,D.string,D.func]),arcCurveResolution:D.number,arcCircularResolution:D.number,arcDashLength:D.oneOfType([D.number,D.string,D.func]),arcDashGap:D.oneOfType([D.number,D.string,D.func]),arcDashInitialGap:D.oneOfType([D.number,D.string,D.func]),arcDashAnimateTime:D.oneOfType([D.number,D.string,D.func]),arcsTransitionDuration:D.number,arcLabel:D.oneOfType([D.string,D.func]),onArcClick:D.func,onArcRightClick:D.func,onArcHover:D.func,polygonsData:D.arrayOf(D.object),polygonGeoJsonGeometry:D.oneOfType([D.string,D.func]),polygonCapColor:D.oneOfType([D.string,D.func]),polygonCapMaterial:D.oneOfType([D.object,D.string,D.func]),polygonSideColor:D.oneOfType([D.string,D.func]),polygonSideMaterial:D.oneOfType([D.object,D.string,D.func]),polygonStrokeColor:D.oneOfType([D.string,D.func]),polygonAltitude:D.oneOfType([D.number,D.string,D.func]),polygonCapCurvatureResolution:D.oneOfType([D.number,D.string,D.func]),polygonsTransitionDuration:D.number,polygonLabel:D.oneOfType([D.string,D.func]),onPolygonClick:D.func,onPolygonRightClick:D.func,onPolygonHover:D.func,pathsData:D.array,pathPoints:D.oneOfType([D.array,D.string,D.func]),pathPointLat:D.oneOfType([D.number,D.string,D.func]),pathPointLng:D.oneOfType([D.number,D.string,D.func]),pathPointAlt:D.oneOfType([D.number,D.string,D.func]),pathResolution:D.number,pathColor:D.oneOfType([D.string,D.arrayOf(D.string),D.func]),pathStroke:D.oneOfType([D.number,D.string,D.func]),pathDashLength:D.oneOfType([D.number,D.string,D.func]),pathDashGap:D.oneOfType([D.number,D.string,D.func]),pathDashInitialGap:D.oneOfType([D.number,D.string,D.func]),pathDashAnimateTime:D.oneOfType([D.number,D.string,D.func]),pathTransitionDuration:D.number,pathLabel:D.oneOfType([D.string,D.func]),onPathClick:D.func,onPathRightClick:D.func,onPathHover:D.func,heatmapsData:D.array,heatmapPoints:D.oneOfType([D.array,D.string,D.func]),heatmapPointLat:D.oneOfType([D.number,D.string,D.func]),heatmapPointLng:D.oneOfType([D.number,D.string,D.func]),heatmapPointWeight:D.oneOfType([D.number,D.string,D.func]),heatmapBandwidth:D.oneOfType([D.number,D.string,D.func]),heatmapColorFn:D.oneOfType([D.string,D.func]),heatmapColorSaturation:D.oneOfType([D.number,D.string,D.func]),heatmapBaseAltitude:D.oneOfType([D.number,D.string,D.func]),heatmapTopAltitude:D.oneOfType([D.number,D.string,D.func]),heatmapsTransitionDuration:D.number,onHeatmapClick:D.func,onHeatmapRightClick:D.func,onHeatmapHover:D.func,hexBinPointsData:D.arrayOf(D.object),hexBinPointLat:D.oneOfType([D.number,D.string,D.func]),hexBinPointLng:D.oneOfType([D.number,D.string,D.func]),hexBinPointWeight:D.oneOfType([D.number,D.string,D.func]),hexBinResolution:D.number,hexMargin:D.oneOfType([D.number,D.func]),hexTopColor:D.func,hexSideColor:D.func,hexAltitude:D.oneOfType([D.number,D.func]),hexTopCurvatureResolution:D.number,hexBinMerge:D.bool,hexTransitionDuration:D.number,hexLabel:D.oneOfType([D.string,D.func]),onHexClick:D.func,onHexRightClick:D.func,onHexHover:D.func,hexPolygonsData:D.arrayOf(D.object),hexPolygonGeoJsonGeometry:D.oneOfType([D.string,D.func]),hexPolygonColor:D.oneOfType([D.string,D.func]),hexPolygonAltitude:D.oneOfType([D.number,D.string,D.func]),hexPolygonResolution:D.oneOfType([D.number,D.string,D.func]),hexPolygonMargin:D.oneOfType([D.number,D.string,D.func]),hexPolygonCurvatureResolution:D.oneOfType([D.number,D.string,D.func]),hexPolygonsTransitionDuration:D.number,hexPolygonLabel:D.oneOfType([D.string,D.func]),onHexPolygonClick:D.func,onHexPolygonRightClick:D.func,onHexPolygonHover:D.func,tilesData:D.arrayOf(D.object),tileLat:D.oneOfType([D.number,D.string,D.func]),tileLng:D.oneOfType([D.number,D.string,D.func]),tileAltitude:D.oneOfType([D.number,D.string,D.func]),tileWidth:D.oneOfType([D.number,D.string,D.func]),tileHeight:D.oneOfType([D.number,D.string,D.func]),tileUseGlobeProjection:D.oneOfType([D.bool,D.string,D.func]),tileMaterial:D.oneOfType([D.object,D.string,D.func]),tileCurvatureResolution:D.oneOfType([D.number,D.string,D.func]),tilesTransitionDuration:D.number,tileLabel:D.oneOfType([D.string,D.func]),onTileClick:D.func,onTileRightClick:D.func,onTileHover:D.func,ringsData:D.arrayOf(D.object),ringLat:D.oneOfType([D.number,D.string,D.func]),ringLng:D.oneOfType([D.number,D.string,D.func]),ringAltitude:D.oneOfType([D.number,D.string,D.func]),ringColor:D.oneOfType([D.string,D.arrayOf(D.string),D.func]),ringResolution:D.number,ringMaxRadius:D.oneOfType([D.number,D.string,D.func]),ringPropagationSpeed:D.oneOfType([D.number,D.string,D.func]),ringRepeatPeriod:D.oneOfType([D.number,D.string,D.func]),labelsData:D.arrayOf(D.object),labelLat:D.oneOfType([D.number,D.string,D.func]),labelLng:D.oneOfType([D.number,D.string,D.func]),labelAltitude:D.oneOfType([D.number,D.string,D.func]),labelRotation:D.oneOfType([D.number,D.string,D.func]),labelText:D.oneOfType([D.string,D.func]),labelSize:D.oneOfType([D.number,D.string,D.func]),labelTypeFace:D.object,labelColor:D.oneOfType([D.string,D.func]),labelResolution:D.number,labelIncludeDot:D.oneOfType([D.bool,D.string,D.func]),labelDotRadius:D.oneOfType([D.number,D.string,D.func]),labelDotOrientation:D.oneOfType([D.string,D.func]),labelsTransitionDuration:D.number,labelLabel:D.oneOfType([D.string,D.func]),onLabelClick:D.func,onLabelRightClick:D.func,onLabelHover:D.func,htmlElementsData:D.arrayOf(D.object),htmlLat:D.oneOfType([D.number,D.string,D.func]),htmlLng:D.oneOfType([D.number,D.string,D.func]),htmlAltitude:D.oneOfType([D.number,D.string,D.func]),htmlElement:D.oneOfType([D.string,D.func]),htmlTransitionDuration:D.number,objectsData:D.arrayOf(D.object),objectLat:D.oneOfType([D.number,D.string,D.func]),objectLng:D.oneOfType([D.number,D.string,D.func]),objectAltitude:D.oneOfType([D.number,D.string,D.func]),objectRotation:D.oneOfType([D.shape({x:D.number,y:D.number,z:D.number}),D.string,D.func]),objectFacesSurface:D.oneOfType([D.bool,D.string,D.func]),objectThreeObject:D.oneOfType([D.object,D.string,D.func]),objectLabel:D.oneOfType([D.string,D.func]),onObjectClick:D.func,onObjectRightClick:D.func,onObjectHover:D.func,customLayerData:D.arrayOf(D.object),customThreeObject:D.oneOfType([D.object,D.string,D.func]),customThreeObjectUpdate:D.oneOfType([D.string,D.func]),customLayerLabel:D.oneOfType([D.string,D.func]),onCustomLayerClick:D.func,onCustomLayerRightClick:D.func,onCustomLayerHover:D.func,enablePointerInteraction:D.bool,pointerEventsFilter:D.func,lineHoverPrecision:D.number,onZoom:D.func},T7=CN(_J,{methodNames:["pauseAnimation","resumeAnimation","pointOfView","scene","camera","renderer","postProcessingComposer","controls","getGlobeRadius","getCoords","getScreenCoords","toGeoCoords","toGlobeCoords"],initPropNames:["animateIn","waitForGlobeReady","rendererConfig"]});T7.displayName="Globe";T7.propTypes=wJ;export{T7 as default};
